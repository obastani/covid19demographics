"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},__assign.apply(this,arguments)},powerbi;!function(t){var e;!function(e){var i,o=jsCommon.CssConstants.createClassAndSelector,n=jsCommon.DOMConstants,r=e.Units.FontSize,s=jsCommon.FocusManager,a=jsCommon.FocusManagerFocusEventName,l=jsCommon.FocusNavModeAttribute,u=jsCommon.KeyUtils,c=jsCommon.StringExtensions,h=jsCommon.UrlUtils.UrlScheme,p=jsCommon.UrlUtils,d=o("textboxFocusElement"),f={linkTooltip:o("ql-link-tooltip"),toolbarUrlInput:o("toolbar-url-input")};!function(t){function i(t){var i=e.Font.FamilyMap[t];return i?i.family:t}function o(t){return _.findKey(e.Font.FamilyMap,function(e){return e.family===t||e.family.indexOf(t)>0})||t}t.Fonts=["Arial","Arial Black","Arial Unicode MS","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Georgia","Lucida Sans Unicode","Segoe (Bold)","Segoe UI","Segoe UI Light","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Wingdings"],t.FontSizes=[8,9,10,10.5,11,12,14,16,18,20,24,28,32,36,40,42,44,54,60,66,72,80,88,96],t.LegacyDefaultFont=e.Font.Family.light.family,t.LegacyFontSize=r.createFromPx(14),t.LegacyDefaultFontProperties={family:t.LegacyDefaultFont,size:t.LegacyFontSize},t.TextAlignments=["Left","Center","Right"],t.DefaultAlignment="Left",t.getCSSFromFont=i,t.getFontFromCSS=o}(i=e.TextboxFormatting||(e.TextboxFormatting={}));var v=function(){function t(t){t&&(this.supportsNarrativeExpressions=t.featureSwitches&&t.featureSwitches.narrativeTextbox,t.viewModelAdapter&&(this.viewModelAdapter=t.viewModelAdapter),this.disableScrollingInViewMode=t.disableScrollingInViewMode)}return t.prototype.init=function(t){this.element=t.element,this.host=t.host,this.viewport=t.viewport,this.style=t.style,this.readOnly=0===this.host.getViewMode(),this.paragraphs=[],this.defaultFont=__assign({},i.LegacyDefaultFontProperties),this.fontFamilies=i.Fonts.slice(),this.fontSizes=i.FontSizes.slice(),this.refreshView()},t.prototype.onResizing=function(t){var e=this.viewport;this.viewport=t,this.updateSize(),this.viewModelAdapter&&this.viewModelAdapter.onResizing(this.element,this.viewport,e,this.defaultFont)},t.prototype.onDataChanged=function(t){var o=t.dataViews;if(this.paragraphs=[],o&&o.length>0){var n=o[0].metadata.objects;n&&n.general&&(this.paragraphs=n.general.paragraphs),n&&n.values&&(this.evaluatedValues=n.values.evaluatedValues,this.referenceValues=n.values.referenceValues);var r=e.ColorHelper.create(this.style);this.defaultFont=e.FontProperties.createFromObjectOrStyle(n&&n.text,{family:"fontFamily",size:"fontSize",color:"color"},r,this.style,"foreground","label",i.LegacyDefaultFontProperties)}this.mergeParagraphFontsWithStandardFonts(),this.refreshView()},t.prototype.mergeParagraphFontsWithStandardFonts=function(){var t=_.map(i.FontSizes,function(t){return r.createFromPt(t)}).concat([this.defaultFont.size]),e=i.getFontFromCSS(this.defaultFont.family),o=i.Fonts.concat([e]),n=this.paragraphs;if(n)for(var s=0,a=n;s<a.length;s++){var l=a[s];if(l.textRuns)for(var u=0,c=l.textRuns;u<c.length;u++){var h=c[u],p=h&&h.textStyle;if(p){if(p.fontSize){var d=r.createFromCSS(p.fontSize);d&&t.push(d)}p.fontFamily&&o.push(p.fontFamily)}}}this.fontSizes=_.chain(t).map(function(t){return t.pt}).sortBy(function(t){return t}).uniqBy(function(t){return t}).value(),this.fontFamilies=_.chain(o).sortBy(function(t){return t}).uniqBy(function(t){return t}).value()},t.prototype.destroy=function(){this.editor&&(this.editor.destroy(),this.editor=void 0)},t.prototype.focus=function(){if(this.editor)return this.editor.focus(),!0},t.prototype.onViewModeChanged=function(t){this.readOnly=0===t,this.refreshView()},t.prototype.setSelection=function(t,e){this.editor&&this.editor.setSelection(t,e)},t.prototype.getSelection=function(){return this.editor.getSelection()},t.prototype.ensureFocusableElement=function(){var t=this,e=this.element;if(!e.find(d.selector).length){var i=$("<div>").width(0).height(0).attr("tabindex",0).addClass(d.class);e.append(i),i.on(a,function(){t.focus()})}},t.prototype.removeFocusableElement=function(){this.element.find(d.selector).remove()},t.prototype.refreshView=function(){var i=this;if(this.readOnly){this.editor&&(this.saveContents(),this.editor.destroy(),this.editor=null),this.element.empty();var o=g.convertParagraphsToHtml(this.paragraphs,this.defaultFont,this.evaluatedValues,this.supportsNarrativeExpressions),n=$("<div>").addClass(t.ClassAndSelector.class).css(e.FontProperties.toHTMLStyle(this.defaultFont)).append(o);this.viewModelAdapter&&this.viewModelAdapter.onDataChanged(n,this.viewport,this.defaultFont);var r=void 0;this.disableScrollingInViewMode?(r=n,this.element.append(n)):(r=this.$scrollableDiv=$("<div/>").addClass(t.ScrollWrapperClassAndSelector.class).css({height:this.viewport.height+"px","overflow-y":"auto","overflow-x":"hidden"}).append(n),this.element.append(this.$scrollableDiv)),this.removeFocusableElement(),r.attr("tabindex",0).attr("role","document").attr(l,"Browser").on("keydown",function(t){27===t.keyCode&&i.$scrollableDiv.removeAttr(l).removeAttr("tabindex")}).focusout(function(){i.$scrollableDiv.attr("tabindex",0).attr(l,"Browser")})}else{var s={defaultFont:this.defaultFont,evaluatedValues:this.evaluatedValues,fontFamilies:this.fontFamilies,fontSizes:this.fontSizes,referenceValues:this.referenceValues,supportsNarrativeExpressions:this.supportsNarrativeExpressions,onEscape:function(){return i.focus()}};if(this.editor)this.editor.updateOptions(s);else{this.editor=new y.QuillWrapper(this.readOnly,this.host,this.style,s),this.editor.textChanged=function(){return i.saveContents()},this.element.empty(),this.ensureFocusableElement();var a=this.editor.getElement();a.addClass(t.ClassAndSelector.class),this.element.append(a)}this.editor.getElement().css(e.FontProperties.toHTMLStyle(this.defaultFont));var u=this.editor.getSelection();this.editor.setContents(g.convertParagraphsToOps(this.paragraphs,this.supportsNarrativeExpressions)),u&&this.editor.setSelection(u.index,u.length)}this.updateSize()},t.prototype.saveContents=function(){if(this.editor){var t=this.editor.getContents();this.paragraphs=g.convertDeltaToParagraphs(t,this.supportsNarrativeExpressions);var e=[{objectName:"general",properties:{paragraphs:this.paragraphs},selector:null}];this.host.persistProperties(e)}},t.prototype.updateSize=function(){this.editor?this.editor.resize(this.viewport):this.$scrollableDiv&&this.$scrollableDiv.css("height",this.viewport.height+"px")},t.ClassAndSelector=jsCommon.CssConstants.createClassAndSelector("textbox"),t.ScrollWrapperClassAndSelector=jsCommon.CssConstants.createClassAndSelector("scrollWrapper"),t}();e.Textbox=v;var m;!function(t){var i="http://",o=function(){function t(t){this.smallViewportProperties=t}return t.prototype.onResizing=function(t,e,i,o){var n=this.isSmallViewport(i),r=this.isSmallViewport(e);n!==r&&this.applyScaleOnElement(t,r,o)},t.prototype.onDataChanged=function(t,e,i){this.isSmallViewport(e)&&this.applyScaleOnElement(t,!0,i)},t.prototype.isSmallViewport=function(t){return!!t&&!!this.smallViewportProperties&&(t.height<=this.smallViewportProperties.minHeightToScaleFontSize||t.width<=this.smallViewportProperties.minWidthToScaleFontSize)},t.prototype.applyScaleOnElement=function(i,o,n){o&&(n=__assign({},n,{size:t.scale(n.size)})),i.find(v.ClassAndSelector.selector).css(e.FontProperties.toHTMLStyle(n)),i.find(g.TextRunElement.selector).each(function(i,s){var a;if(o){var l=$(s).css("font-size"),u=void 0;u=l?r.createFromCSS(l):n.size,a=t.scale(u)}else{var c=$(s).data(g.ModelKeyName),h=c.textStyle&&c.textStyle.fontSize;h&&(a=r.createFromCSS(h))}var p=n;a&&(p=__assign({},n,{size:a})),e.FontProperties.applyStyleToElement(p,s)})},t.scale=function(t){var e,i=t.px;return e=i>66?32:i>42?28:i>26?24:i>16?20:i>11?14:12,r.createFromPx(e)},t}();t.ViewModelAdapter=o;var n=function(t){function e(){return t.call(this,{minHeightToScaleFontSize:1/0,minWidthToScaleFontSize:1/0})||this}return __extends(e,t),e}(o);t.AlwaysUseSmallViewport=n;var s=function(){function t(){}return t.format=function(t){return/^\S+@\S+\.\S+$/.test(t)?"mailto:"+t:/^https?:\/\//i.test(t)?t:i+t},t}();t.LinkPreview=s}(m=e.TextboxHelpers||(e.TextboxHelpers={}));var g;!function(o){function n(t,e){for(var i=[],o={textRuns:[]},n=0,r=t.ops.length;n<r;n++){var s=t.ops[n],a=s.attributes,l=s.insert;if("string"==typeof l){var c=l;a&&a.align&&(o.horizontalTextAlignment=a.align);var h=0,p=0,d=void 0;do{if(p=c.indexOf("\n",h),p<0?(d=!1,p=c.length):d=!0,p-h>0){var v=c.substring(h,p),m={value:v};if(a){void 0!==a.link&&u(a.link)&&(m.url=a.link);var g=f(a);g&&(m.textStyle=g)}o.textRuns.push(m)}d&&(0===o.textRuns.length&&o.textRuns.push({value:""}),i.push(o),o={textRuns:[]}),h=p+1}while(h<c.length)}else if("number"==typeof l);else if(e&&void 0!==l&&void 0!==l[y.QuillWrapper.smartNarrativesBlotClass.class]){var m={value:{propertyIdentifier:{objectName:"values",propertyName:"value"},selector:{id:l[y.QuillWrapper.smartNarrativesBlotClass.class]}}};if(a){var g=f(a);g&&(m.textStyle=g)}o.textRuns.push(m)}}return o.textRuns.length>0&&_.isString(o.textRuns[0].value)&&o.textRuns[0].value.length>0&&i.push(o),i}function s(t,e,i,n){for(var s=$(),a=0,c=t.length;a<c;++a){var h=t[a],p=!0,d=$("<p>").data(o.ModelKeyName,h);h.horizontalTextAlignment&&d.css("text-align",h.horizontalTextAlignment);for(var f=0,v=h.textRuns.length;f<v;++f){var m=h.textRuns[f],g=void 0,S=m.value;_.isEmpty(S)||(p=!1),g=void 0!==m.url&&u(m.url)?$("<a>").attr("href",m.url).attr("rel","noopener noreferrer").attr("target","_blank"):$("<span>");var C=l(S,i,n);g.text(C).addClass(o.TextRunElement.class).data(o.ModelKeyName,m);var x=m.textStyle;if(x){var b={};if(x.fontFamily&&(b["font-family"]=y.getCssFontFamily(x.fontFamily,e)),x.fontSize){var F=r.createFromCSS(x.fontSize);b["font-size"]=y.getCssFontSize(F,e)}x.fontStyle&&(b["font-style"]=x.fontStyle),x.fontWeight&&(b["font-weight"]=x.fontWeight),x.color&&(b.color=x.color),x.textDecoration&&(b["text-decoration"]=x.textDecoration),g.css(b)}d.append(g)}p&&d.append($("<br>")),s=s.add(d)}return s}function a(o,n){for(var r,s=[],a=0,l=o.length;a<l;++a){for(var c=o[a],h=0,p=c.textRuns.length;h<p;++h){var f=c.textRuns[h],m={},g=f.textStyle;g&&(g.fontFamily&&(m.font=e.Font.normalizeFamily(i.getCSSFromFont(v(g.fontFamily)))),g.fontSize&&(m.size=g.fontSize),g.color&&(m.color=g.color),m.italic="italic"===g.fontStyle||void 0,m.bold="bold"===g.fontWeight||void 0,m.underline="underline"===g.textDecoration||void 0);var S=f.value;f.url&&u(f.url)&&(m.link=f.url);var C=void 0;C=n&&t.isValueRef(S)?{attributes:m,insert:(r={},r[y.QuillWrapper.smartNarrativesBlotClass.class]=S.selector.id,r)}:{attributes:m,insert:S},s.push(C)}var x={insert:"\n"},b=d(c);b&&(x.attributes=b),s.push(x)}return s}function l(e,i,o){return o&&t.isValueRef(e)&&void 0!==i?i[e.selector.id]:e}function u(t){if(_.isEmpty(t))return!1;switch(p.getUrlScheme(t)){case h.http:case h.https:case h.mailto:return!0;default:return!1}}function d(t){var e={};return t.horizontalTextAlignment&&(e.align=t.horizontalTextAlignment),!_.isEmpty(e)&&e}function f(t){var o={};if(t.bold&&(o.fontWeight="bold"),t.font){var n=e.Font.normalizeFamily(_.unescape(t.font),!1);n=i.getFontFromCSS(n),o.fontFamily=n}return t.italic&&(o.fontStyle="italic"),t.size&&(o.fontSize=t.size),t.underline&&(o.textDecoration="underline"),t.color&&(o.color=t.color),o}function v(t){return!_.startsWith(t,"'")||c.containsIgnoreCase(t,",")?t:t.slice(1,t.length-1)}o.ModelKeyName="ModelObject",o.TextRunElement=jsCommon.CssConstants.createClassAndSelector("textRun"),o.convertDeltaToParagraphs=n,o.convertParagraphsToHtml=s,o.convertParagraphsToOps=a,o.getTextRunValue=l,o.isValidLinkUrl=u}(g=e.RichTextConversion||(e.RichTextConversion={}));var y;!function(t){function r(t,e){var o=i.getCSSFromFont(t);return o!==e.family?o:void 0}function a(t,e){return null==t?"":t.equals(e.size)?"":t.pt+"pt"}t.getCssFontFamily=r,t.getCssFontSize=a;var l=function(){function t(t,i,o,n){var r=this;this.readOnly=t,this.host=i,this.style=o,this.options=n,this.textChanged=_.noop,this.$container=$("<div>"),this.localizationProvider={get:function(t){return r.host.getLocalizedString(t)},getOptional:function(t){return r.host.getLocalizedString(t)},format:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return r.host.getLocalizedString(t,e)}},e.TextboxUtil.loadQuillResources?(this.initialized=!1,this.dependenciesLoaded=this.host.loader().require({javascript:"quill",css:["quill.core"]}).then(function(t){return r.initializeQuill(t)})):(this.initializeQuill(window.Quill),this.dependenciesLoaded=this.host.promiseFactory().resolve())}return t.prototype.updateOptions=function(t){var e=this;if(!this.initialized)return void this.dependenciesLoaded.then(function(){return e.updateOptions(t)});this.options=t;var i=this.toolbar;i&&i.updateOptions(t)},t.prototype.initializeQuill=function(t){this.quillStatic=t,this.rebuildQuillEditor(),this.initialized=!0,this.quillStatic.debug("error")},t.prototype.getElement=function(){return this.$container},t.prototype.getContents=function(){if(this.initialized)return this.editor.getContents()},t.prototype.setContents=function(t){var e=this;return this.initialized?void this.editor.setContents(t):void this.dependenciesLoaded.then(function(){return e.setContents(t)})},t.prototype.resize=function(t){this.$container.width(t.width),this.$container.height(t.height)},t.prototype.setReadOnly=function(t){var e=t!==this.readOnly;this.readOnly=t,this.initialized&&e&&this.rebuildQuillEditor()},t.prototype.setSelection=function(t,e){this.editor&&this.editor.setSelection(t,e)},t.prototype.getSelection=function(t){if(this.editor)return this.editor.getSelection(t)},t.prototype.focus=function(){this.editor&&0===$(document.activeElement).closest(this.$container).length&&this.editor.focus()},t.prototype.destroy=function(){this.host.setToolbar(null),this.toolbar=null,this.$container.remove(),this.$container=null,this.destroyEditor()},t.prototype.destroyEditor=function(){this.editor&&(_.isEmpty(this.destroyEditorActions)||(_.forEach(this.destroyEditorActions,function(t){return t()}),this.destroyEditorActions=void 0),this.editor=null)},t.prototype.getSelectionAtCursor=function(){var t=this.getTextWithoutTrailingBreak(),e=this.getSelection(!0);if(e&&0===e.length){var i=jsCommon.WordBreaker.find(e.index,t);return{index:i.start,length:i.end-i.start}}return e},t.prototype.getWord=function(){var t=this.getSelectionAtCursor();return this.getTextWithoutTrailingBreak().slice(t.index,t.index+t.length)},t.prototype.getEditorContainer=function(){if(this.editor)return $(this.editor.container)},t.prototype.getTextWithoutTrailingBreak=function(){return this.editor.getText().slice(0,-1)},t.prototype.rebuildQuillEditor=function(){var i=this,o=null,n=this.options.supportsNarrativeExpressions;this.editor&&(o=this.editor.getContents()),this.$container.empty(),this.$container.keydown(function(t){var e=t.which;t.ctrlKey&&u.isCtrlShortcutKey(e)&&t.stopPropagation(),(u.isArrowKey(e)||u.isNudgeModifierKey(e))&&t.stopPropagation(),u.isDeleteKey(e)&&t.stopPropagation(),t.altKey&&84===t.keyCode&&(i.focusToolbar(),t.stopPropagation())});var r=$("<div>"),s={readOnly:this.readOnly,formats:["bold","italic","underline","font","size","link","align","color"],modules:{history:{userOnly:!0}}};n&&s.formats.push(t.smartNarrativesBlotClass.class);var a=p.buildToolbarLinkInputTemplate(this.localizationProvider),l=h.LinkInput.buildNode(a);if(!this.readOnly){var d=this.toolbar;if(this.toolbar)d.updateOptions(this.options);else{d=this.toolbar=new h(this,this.localizationProvider,l,this.options);var f=d.getElement();f.addClass("unselectable"),f.toggleClass("high-contrast",this.style.isHighContrast),this.host.setToolbar(f,{preferHorizontalLayout:n,theme:n?"neutralGrayTheme":"darkTheme"}),s.modules.toolbar={container:f.get(0)}}r.attr("drag-resize-disabled","true")}if(this.destroyEditor(),this.destroyEditorActions=[],n&&this.setUpSmartNarrativesFormat(this.onSelectSmartNarrativesBlot.bind(this),this.getEvaluatedValues.bind(this),this.destroyEditorActions),this.editor=new this.quillStatic(r.get(0),s),!this.readOnly){var v=new h.LinkInput(l,this.editor,this.quillStatic),m=function(t){t?(i.editor.setSelection(i.getSelectionAtCursor()),v.open()):v.remove()},f=this.toolbar.getElement(),g=new h.ColorPicker({quill:this.editor,hostServices:this.host,$colorSwatch:f.find(h.ColorPicker.colorSwatchGlyphClassAndSelector.selector),$colorPickerButton:f.find(h.ColorPicker.pickerButtonClassAndSelector.selector),$colorPickerButtonWrapper:f.find(h.ColorPicker.pickerButtonWrapperClassAndSelector.selector),defaultColor:e.ColorHelper.getThemeColor(this.style,e.ForegroundColorName),format:"color"}),y=function(){return g.applyFormat(g.getColor())};t.setUpFontFormat(this.quillStatic);var S=this.editor.getModule("toolbar");S.addHandler("link",m),S.addHandler("color",y),this.destroyEditorActions.push(function(){S.addHandler("link",void 0),S.addHandler("color",void 0)}),n&&(this.smartNarrativesEditorContainer=new h.SmartNarrativesEditor({container:this.toolbar.getElement(),hostServices:this.host,quill:this.editor}),this.smartNarrativesEditorContainer.getSmartNarrativesEditor())}this.$container.append(r),o&&this.setContents(o);var C=_.debounce(function(){return i.onTextChanged()},t.textChangeThrottle),x=function(e,o,n){if("api"!==n){for(var r=0,s=e.ops;r<s.length;r++){var a=s[r];if(t.isInsertOp(a)){var l=a.insert;if(l&&c.containsWhitespace(l))return i.onTextChanged(),void C.cancel()}}C()}};this.editor.on("text-change",x),this.destroyEditorActions.push(function(){i.editor.off("text-change",x)});var b=function(e){var o=e.relatedTarget||document.activeElement;o&&(t.willBrowserHandleFocus(o)||i.targetIsInToolbar(o))||i.setSelection(null,null)};this.editor.root.addEventListener("blur",b,!1),this.destroyEditorActions.push(function(){i.editor.root.removeEventListener("blur",b,!1)})},t.setUpFontFormat=function(i){var o=i.import("parchment"),n=i.import("formats/font");n.value=function(i){var o=t.camelize(n.keyName);return _.escape(e.Font.normalizeFamily(i.style[o]))},n.canAdd=function(t,i){return null!=o.query(t,o.Scope.BLOT&(n.scope|o.Scope.TYPE))&&(null==n.whitelist||n.whitelist.indexOf(e.Font.normalizeFamily(_.unescape(i)))>-1)},n.add=function(i,o){if(!n.canAdd(i,o))return!1;var r=t.camelize(n.keyName),s=e.Font.normalizeFamily(_.unescape(o));return i.style[r]=s,!0}},t.prototype.setUpSmartNarrativesFormat=function(e,i,o){var r=this.quillStatic.import("blots/embed"),s=function(r){function s(){return null!==r&&r.apply(this,arguments)||this}return __extends(s,r),s.create=function(s){var a=r.create.call(this,s),l=i(),u=l[s],c=$("<span>").text(u).attr(n.contentEditableAttribute,"false");a.appendChild(c.get(0));var h=""+n.pointerDownEventName+t.smartNarrativesBlotClass.selector;return $(a).on(h,function(){e(s)}),o.push(function(){$(a).off(h)}),a.setAttribute(t.smartNarrativesBlotClass.class,s),a},s.value=function(e){return e.getAttribute(t.smartNarrativesBlotClass.class)},s.blotName=t.smartNarrativesBlotClass.class,s.className=t.smartNarrativesBlotClass.class,s.tagName="div",s}(r);this.quillStatic.register(s)},t.willBrowserHandleFocus=function(t){return"SELECT"===t.tagName||"INPUT"===t.tagName||!!t.getAttribute("contentEditable")},t.prototype.targetIsInToolbar=function(t){if("A"===t.tagName||"BUTTON"===t.tagName){var e=$(t),i=this.toolbar.getElement();return i.is(":visible")&&(e.is(i)||e.closest(i).length>0)}return!1},t.prototype.onTextChanged=function(){this.textChanged()},t.isInsertOp=function(t){return null!=t.insert},t.camelize=function(t){var e=t.split("-"),i=_.map(e.slice(1),function(t){return t[0].toUpperCase()+t.slice(1)}).join("");return e[0]+i},t.prototype.focusToolbar=function(){return!(!this.editor||!this.toolbar)&&void s.focusChildInGroup(this.toolbar.getElement().get(0))},t.prototype.getEvaluatedValues=function(){return this.options.evaluatedValues},t.prototype.onSelectSmartNarrativesBlot=function(t){this.smartNarrativesEditorContainer&&this.smartNarrativesEditorContainer.getSmartNarrativesEditor().onSelectEditableObject(t)},t.smartNarrativesBlotClass=o("smart-narratives-blot"),t.textChangeThrottle=600,t}();t.QuillWrapper=l;var h=function(){function t(e,i,o,n){this.quillWrapper=e,this.localizationProvider=i,this.linkInput=o,this.updateOptions(n);var r=t.ColorPicker.buildFontColorButtons(i.get("Visual_FontColor")),s=this.container=p.div().addClass("toolbar").addClass("themeableElement").attr("aria-label",p.getTooltip("FontControl",i)).attr("focus-nav-mode","Group");s.append(p.formatGroup().append(this.fontFamilyPicker).append(this.fontSizePicker).append(r)).append(p.formatGroup().append(p.formatButton(p.getTooltip("Bold",i),"bold")).append(p.formatButton(p.getTooltip("Italic",i),"italic")).append(p.formatButton(p.getTooltip("Underline",i),"underline"))).append(p.formatGroup().append(this.textAlignmentGroup)).append(p.formatGroup().append(p.formatButton(p.getTooltip("Link",i),"link")).append(this.linkInput)),n.supportsNarrativeExpressions&&(s.addClass("fixed-size"),s.append(p.smartNarrativesEditor()));var a=this.onEscape;a&&s.on("keydown",function(t){27===t.keyCode&&(t.stopPropagation(),t.preventDefault(),a())})}return t.prototype.getElement=function(){return this.container},t.prototype.updateOptions=function(t){var e=t.defaultFont;this.onEscape=t.onEscape,this.updateFontFamilyUI(e,t.fontFamilies),this.updateFontSizeUI(e,t.fontSizes),this.updateTextAlignmentUI()},t.prototype.updateFontSizeUI=function(t,e){var i="size",o=this.getFormatPath(i);this.updateStyleAllowList(this.quillWrapper.quillStatic,i,null,o,!0),this.fontSizes=_.map(e,function(t){return{label:""+t,value:t+"pt"}}),this.defaultFontSize=t.size.pt+"pt",this.fontSizePicker?p.updatePicker(this.fontSizePicker,this.fontSizes,this.defaultFontSize):this.fontSizePicker=p.picker(p.getTooltip("Size",this.localizationProvider),this.fontSizes,"size",this.defaultFontSize)},t.prototype.updateFontFamilyUI=function(t,o){var n="font",r=o.map(function(t){return e.Font.normalizeFamily(i.getCSSFromFont(t))}),s=this.getFormatPath(n);this.updateStyleAllowList(this.quillWrapper.quillStatic,n,r,s,!0),this.fontFamilies=_.map(o,function(t){return{label:t,value:_.escape(e.Font.normalizeFamily(i.getCSSFromFont(t)))}}),this.defaultFontFamily=_.escape(e.Font.normalizeFamily(i.getCSSFromFont(t.family))),this.fontFamilyPicker?p.updatePicker(this.fontFamilyPicker,this.fontFamilies,this.defaultFontFamily):this.fontFamilyPicker=p.picker(p.getTooltip("Font",this.localizationProvider),this.fontFamilies,"font",this.defaultFontFamily,function(t,e){return t.css("font-family",e.value),t})},t.prototype.updateTextAlignmentUI=function(){var t=this.defaultTextAlignment=i.DefaultAlignment;this.textAlignments=_.map(i.TextAlignments,function(e){var i=e.toLowerCase();return{label:e,value:e===t?"":i,glyph:"align"+i}});var e="align",o=_.map(this.textAlignments,function(t){return t.value}),n=this.getFormatPath(e);this.updateAllowList(this.quillWrapper.quillStatic,n,o),this.textAlignmentGroup||(this.textAlignmentGroup=p.toggleGroup("Text Alignment",this.textAlignments,"align",this.defaultTextAlignment,this.localizationProvider))},t.prototype.getFormatPath=function(t){return"formats/"+t},t.prototype.updateStyleAllowList=function(t,e,i,o,n){void 0===n&&(n=!1),this.updateAllowList(t,"attributors/style/"+e,i,o,n)},t.prototype.updateAllowList=function(t,e,i,o,n){void 0===n&&(n=!1);var r=t.import(e);r.whitelist=i,t.register(o||e,r,n)},t}();t.Toolbar=h;var p;!function(t){function e(t,e,i,o){return $('\n                        <a href="#" class="ql-preview" target="_blank"></a>\n                        <input class="input" type="text" aria-label="'+o+'">\n                        <span class="bar">&nbsp;|&nbsp;</span>\n                        <button class="ql-action ql-save">'+e+'</button>\n                        <button class="ql-action ql-edit">'+i+'</button>\n                        <button class="ql-remove">'+t+"</button>\n                    ")}function i(t){var i=s(),o=t.get("RichTextbox_Link_Done"),n=t.get("RichTextbox_Link_Remove"),r=t.get("RichTextbox_Link_Edit"),a=m("Link",t);return i.append(e(n,o,r,a)),i.html()}function n(){return a().addClass("ql-formats")}function r(){return s().addClass(t.smartNarrativesEditorClass.class)}function s(){return $("<div>")}function a(){return $("<span>")}function l(){return $("<button>")}function u(t,e,i,o,n){return e.map(function(t){var e=null!=t.glyph?t.glyph:i+t.value;return v(m(t.label,n),i,t.value,e)})}function c(t,e,i,o,n){return p(t,e,o,n).addClass("ql-"+i+" ql-picker")}function h(t,e,i,o){return d(t,e,i,o)}function p(t,e,i,o){return $("<select>").attr("title",t).attr("aria-label",t).append(f(e,i,o))}function d(t,e,i,o){return t.empty().append(f(e,i,o))}function f(t,e,i){return _.map(t,function(t){var o=$("<option>").text(t.label);return t.value===e?o.attr("selected","selected"):o.attr("value",t.value),void 0!==i&&(o=i(o,t)),o})}function v(t,e,i,o){var n=l();return null!=t&&n.attr("title",t).attr("aria-label",t),null!=e&&n.addClass("ql-"+e),null!=i&&n.attr("value",i),null==o&&(null!=e&&(o=e),null!=i&&(o=(o||"")+i)),null!=o&&n.addClass("powervisuals-glyph "+o),n}function m(t,e){return e.get("RichTextbox_"+t+"_ToolTip")}t.buildToolbarLinkInputTemplate=i,t.formatGroup=n,t.smartNarrativesEditor=r,t.div=s,t.span=a,t.button=l,t.toggleGroup=u,t.picker=c,t.updatePicker=h,t.selector=p,t.updateSelector=d,t.options=f,t.formatButton=v,t.getTooltip=m,t.smartNarrativesEditorClass=o("smart-narratives-editor")}(p=t.ToolbarBuilder||(t.ToolbarBuilder={})),function(t){var e=function(){function t(e,i,o){var n=this;this.$container=e,this.quill=i,this.quillStatic=o,this.$preview=this.$container.find("a.ql-preview"),this.$textbox=this.$container.find("input[type=text]"),this.textbox=this.$textbox[0],this.$action=this.$container.find(".ql-action"),this.hide(),this.$textbox.on("keydown",function(t){13===t.keyCode?n.onSave(t):27===t.keyCode&&n.onHide(t)}),["click","touchstart"].forEach(function(e){n.$action.on(e,function(e){n.$container.hasClass(t.editingClass)?n.onSave(e):n.onEdit(e)}),n.$container.find(".ql-remove").on(e,function(t){return n.onRemove(t)})}),i.on("selection-change",function(t){var e;if(null!=t||!n.isEditing){if(null!=t&&0===t.length){var o=void 0;if(e=i.scroll.descendant(n.quillStatic.import("formats/link"),t.index),n.link=e[0],o=e[1],null!=n.link){var r={index:t.index-o,length:n.link.length()};return void(_.isEqual(n.range,r)||(n.range=r,n.show()))}if(t.index>0){i.scroll.descendant(n.quillStatic.import("formats/link"),t.index-1)[0]&&n.quill.format("link",!1)}}n.hide()}})}return t.buildNode=function(t){return p.div().addClass(f.toolbarUrlInput.class).append($(t))},t.prototype.onHide=function(t){this.hide(),this.stopEvent(t)},t.prototype.onSave=function(t){this.save(),this.stopEvent(t)},t.prototype.onEdit=function(t){this.edit(),this.stopEvent(t)},t.prototype.onRemove=function(t){this.remove(),this.stopEvent(t)},t.prototype.stopEvent=function(t){t.stopPropagation(),t.preventDefault()},t.prototype.edit=function(){this.isEditing=!0,this.$container.addClass(t.editingClass),this.$textbox.focus(),this.textbox.setSelectionRange(0,this.textbox.value.length)},t.prototype.open=function(){this.range=this.quill.getSelection(),this.show(),this.edit()},t.prototype.hide=function(){this.range=this.link=null,this.$container.hide(),this.isEditing=!1},t.prototype.remove=function(){this.range=this.range||this.quill.getSelection(),this.quill.formatText(this.range,"link",!1,"user"),this.quill.setSelection(this.range,"silent"),this.hide()},t.prototype.save=function(){var t=this.range,e=this.textbox.value;0===t.length&&(this.quill.insertText(this.range.index,e),this.quill.setSelection(this.range.index,e.length),t=this.range=this.quill.getSelection()),this.quill.formatText(t.index,t.length,"link",e,"user"),this.quill.setSelection(t,"silent"),this.link=this.quill.scroll.descendant(this.quillStatic.import("formats/link"),t.index)[0],this.show()},t.prototype.show=function(){this.isEditing=!1,this.$container.removeClass(t.editingClass),this.$container.show();var e,i=this.range=this.range||this.quill.getSelection();null!=this.link?e=this.link.formats().link:(e=this.quill.getText(i.index,i.length),e=m.LinkPreview.format(e)),this.$textbox.val(e),this.$preview.text(e),this.$preview.attr("href",e)},t.editingClass="ql-editing",t}();t.LinkInput=e;var i=function(){function t(t){var e=this;this.quill=t.quill,this.hostServices=t.hostServices,this.$colorSwatch=t.$colorSwatch,this.$colorPickerButtonWrapper=t.$colorPickerButtonWrapper,this.defaultColor=t.defaultColor,this.format=t.format,this.promiseFactory=this.hostServices.promiseFactory(),this.currentColor=t.defaultColor,this.setSwatch(this.currentColor),t.$colorPickerButton.on("click",function(t){t.stopPropagation(),e.toggle()})}return t.buildFontColorButtons=function(e){var i=$("<span/>").addClass("powervisuals-glyph").addClass(t.colorGlyphClassAndSelector.class),o=$("<span/>").addClass("powervisuals-glyph").addClass(t.colorSwatchGlyphClassAndSelector.class),n=$("<button>").addClass("ql-color").addClass(t.colorButtonClassAndSelector.class).attr("title",e).attr("aria-label",e).val("false").append(i).append(o),r=$("<button>").addClass("colorpicker powervisuals-glyph chevrondown").addClass(t.pickerButtonClassAndSelector.class).val("false");return[n,$("<div>").addClass(t.pickerButtonWrapperClassAndSelector.class).append(r)]},t.prototype.onColorChange=function(t){this.setSwatch(t?t:this.defaultColor),this.applyFormat(t?t:null,this.range),this.currentColor=t},t.prototype.onClose=function(){var t=this.ensureRange();this.quill.setSelection(t.index,t.length),this.color?this.quill.format(this.format,this.color,"user"):this.quill.format(this.format,!1,"user")},t.prototype.getColor=function(){return this.currentColor},t.prototype.applyFormat=function(t,e){var i=this.ensureRange(e);this.color=t,t&&t!==this.defaultColor?this.quill.formatText(i.index,i.length,this.format,t,"user"):this.quill.formatText(i.index,i.length,this.format,!1,"user")},t.prototype.toggle=function(){this.range=this.ensureRange(),this.getColorPicker().then(function(t){return t.toggle()})},t.prototype.getColorPicker=function(){var t,e=this;if(!this.colorPicker&&this.existingDeferred)t=this.existingDeferred;else if(t=this.promiseFactory.defer(),this.colorPicker)t.resolve(this.colorPicker);else{this.existingDeferred=t;var i=this.$colorPickerButtonWrapper.get(0);this.hostServices.getUIComponentFactory().createColorPicker(i,{value:this.defaultColor},function(t){return e.onColorChange(t&&t.value)},function(){return e.onClose()}).then(function(i){e.colorPicker=i,t.resolve(i)})}return t.promise},t.prototype.setSwatch=function(t){this.$colorSwatch.get(0).style.setProperty("color",t,"important")},t.prototype.ensureRange=function(t){return t||this.quill.getSelection()||{index:0,length:0}},t.colorGlyphClassAndSelector=o("fontcolor"),t.colorSwatchGlyphClassAndSelector=o("fontcolorswatch"),t.colorButtonClassAndSelector=o("fontcolorbutton"),t.pickerButtonClassAndSelector=o("fontcolorpicker"),t.pickerButtonWrapperClassAndSelector=o("fontcolorbutton-wrapper"),t}();t.ColorPicker=i;var n=function(){function t(t){this.container=t.container,this.hostServices=t.hostServices,this.quill=t.quill}return t.prototype.getSmartNarrativesEditor=function(){var t=this;return this.component=this.component||this.hostServices.getUIComponentFactory().createSmartNarrativesEditor(this.container.find(p.smartNarrativesEditorClass.selector).get(0),function(){
return t.getSmartNarratives()},function(e){return t.onFocusSmartNarrative(e)},function(e){return t.onUpdateSmartNarratives(e)}),this.component},t.prototype.getSmartNarratives=function(){return[]},t.prototype.onFocusSmartNarrative=function(t){_.noop(t)},t.prototype.onUpdateSmartNarratives=function(t){_.noop(t)},t}();t.SmartNarrativesEditor=n}(h=t.Toolbar||(t.Toolbar={}))}(y=e.RichText||(e.RichText={}))}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={})),define("TextboxVisual/textboxModule",["require","exports"],function(t,e){function i(t){return new powerbi.visuals.Textbox(t)}function o(t){return new powerbi.visuals.TextboxHelpers.ViewModelAdapter(t)}function n(){return new powerbi.visuals.TextboxHelpers.AlwaysUseSmallViewport}Object.defineProperty(e,"__esModule",{value:!0}),e.createTextbox=i,e.createTextboxViewModelAdapter=o,e.createAlwaysUseSmallViewportTextboxViewModelAdapter=n});