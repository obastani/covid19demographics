"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var a,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(n<3?a(o):n>3?a(t,r,o):a(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},__assign.apply(this,arguments)},powerbi;!function(e){var t;!function(t){function r(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g,S,C,x,D,E){var w=t.Verbose(u,l,d,f,h,m,v,y,g,S,C,x,D,E),b=p(w.info,{endPoint:r,clientAndServerRequestIdMatch:i,responseRequestId:a,requestId:n,synchronous:o,cacheOptions:s});return{name:t.DataQueryDataEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({endPoint:b.endPoint,clientAndServerRequestIdMatch:b.clientAndServerRequestIdMatch,responseRequestId:b.responseRequestId,cacheOptions:b.cacheOptions},{requestId:b.requestId,synchronous:b.synchronous},w.formatted())},info:b,loggers:t.DataQueryDataLoggers}}function i(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g){var S=t.Verbose(i,a,n,o,s,u,l,d,f,h,m,v,y,g),C=p(S.info,{source:r});return{name:t.DataQueryCancellationEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({source:C.source},null,S.formatted())},info:C,loggers:t.DataQueryCancellationLoggers,logRatio:1e-4}}function a(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g,S,C,x,D,E){var w=t.Verbose(u,l,d,f,h,m,v,y,g,S,C,x,D,E),b=p(w.info,{endPoint:r,clientAndServerRequestIdMatch:i,responseRequestId:a,requestId:n,datasetIds:o,asErrorCode:s});return{name:t.DataGetConceptualSchemaEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({endPoint:b.endPoint,clientAndServerRequestIdMatch:b.clientAndServerRequestIdMatch,responseRequestId:b.responseRequestId,datasetIds:b.datasetIds,asErrorCode:b.asErrorCode},{requestId:b.requestId},w.formatted())},info:b,loggers:t.DataGetConceptualSchemaLoggers}}function n(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g){var S=t.Verbose(i,a,n,o,s,u,l,d,f,h,m,v,y,g),C=p(S.info,{requestId:r});return{name:t.DataExecuteQueryEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted(null,{requestId:C.requestId},S.formatted())},info:C,loggers:t.DataExecuteQueryLoggers}}function o(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g,S,C,x,D,E,w,b,I,M,V,R){var T=t.Verbose(v,y,g,S,C,x,D,E,w,b,I,M,V,R),_=p(T.info,{jsonparse:r,categorical:i,table:a,tree:n,matrix:o,single:s,script:u,total:l,mode:d,targetDataView:f,dsrLength:h,id:m});return{name:t.DataDsrToDataViewEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({total:_.total,mode:_.mode,targetDataView:_.targetDataView,dsrLength:_.dsrLength,id:_.id},{jsonparse:_.jsonparse,categorical:_.categorical,table:_.table,tree:_.tree,matrix:_.matrix,single:_.single,script:_.script},T.formatted())},info:_,loggers:t.DataDsrToDataViewLoggers,logRatio:1e-4}}function s(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g,S){var C=t.Verbose(a,n,o,s,u,l,d,f,h,m,v,y,g,S),x=p(C.info,{targetDataView:r,id:i});return{name:t.DataSampledDataViewKindAccessEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({targetDataView:x.targetDataView,id:x.id},null,C.formatted())},info:x,loggers:t.DataSampledDataViewKindAccessLoggers,logRatio:1e-4}}function u(r,i,a,n,o,s,u,l,d,f,h,m,v,y,g,S){var C=t.Verbose(a,n,o,s,u,l,d,f,h,m,v,y,g,S),x=p(C.info,{targetDataView:r,id:i});return{name:t.DataDataViewKindAccessEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({targetDataView:x.targetDataView,id:x.id},null,C.formatted())},info:x,loggers:t.DataDataViewKindAccessLoggers}}var c,l=jsCommon.Utility,p=jsCommon.UnionExtensions.mergeUnionType,d=e.telemetry.EventFactories;c=l?l.generateGuid:Function.prototype,t.DataQueryDataEventName="PBI.Data.QueryData",t.DataQueryData=r,d[t.DataQueryDataEventName]=function(r){return e.telemetryEventFactory(t.DataQueryDataEventName,r,t.DataQueryDataLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["requestId","synchronous"])},t.DataQueryCancellationEventName="PBI.Data.QueryCancellation",t.DataQueryCancellation=i,d[t.DataQueryCancellationEventName]=function(r){return e.telemetryEventFactory(t.DataQueryCancellationEventName,r,t.DataQueryCancellationLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.DataGetConceptualSchemaEventName="PBI.Data.GetConceptualSchema",t.DataGetConceptualSchema=a,d[t.DataGetConceptualSchemaEventName]=function(r){return e.telemetryEventFactory(t.DataGetConceptualSchemaEventName,r,t.DataGetConceptualSchemaLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["requestId"])},t.DataExecuteQueryEventName="PBI.Data.ExecuteQuery",t.DataExecuteQuery=n,d[t.DataExecuteQueryEventName]=function(r){return e.telemetryEventFactory(t.DataExecuteQueryEventName,r,t.DataExecuteQueryLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["requestId"])},t.DataDsrToDataViewEventName="PBI.Data.DsrToDataView",t.DataDsrToDataView=o,d[t.DataDsrToDataViewEventName]=function(r){return e.telemetryEventFactory(t.DataDsrToDataViewEventName,r,t.DataDsrToDataViewLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["jsonparse","categorical","table","tree","matrix","single","script"])},t.DataSampledDataViewKindAccessEventName="PBI.Data.SampledDataViewKindAccess",t.DataSampledDataViewKindAccess=s,d[t.DataSampledDataViewKindAccessEventName]=function(r){return e.telemetryEventFactory(t.DataSampledDataViewKindAccessEventName,r,t.DataSampledDataViewKindAccessLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.DataDataViewKindAccessEventName="PBI.Data.DataViewKindAccess",t.DataDataViewKindAccess=u,d[t.DataDataViewKindAccessEventName]=function(r){return e.telemetryEventFactory(t.DataDataViewKindAccessEventName,r,t.DataDataViewKindAccessLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)}}(t=e.telemetry||(e.telemetry={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t="UndefinedData",r=function(){function r(t,r,i,a,n,o,s){this.proxy=new e.ExecuteSemanticQueryProxy(t,r,n,i,o,s,a),this.featureSwitches=a,this.telemetryService=i}return r.prototype.execute=function(e){return this.proxy.execute(e)},r.prototype.transform=function(r,i,a,n){return void 0===r?{dataView:{metadata:{columns:[]},error:{code:t}}}:e.read(i,r,this.featureSwitches,this.telemetryService,a,n)},r.prototype.stopCommunication=function(){this.proxy.stopCommunication()},r.prototype.resumeCommunication=function(){this.proxy.resumeCommunication()},Object.defineProperty(r.prototype,"cache",{get:function(){return this.proxy.cache()},enumerable:!0,configurable:!0}),r.prototype.setLocalCacheResult=function(e,t){this.proxy.setLocalCacheResult(e,t)},r.prototype.setPreferredMaxConnections=function(e){this.proxy.setPreferredMaxConnections(e)},r}();e.DsrDataReader=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r=function(){function r(e,r,i){i=i||{},this.promiseFactory=e.promiseFactory(),this.client=i.client||new t.BingSocialClient(r),this.tileRequestDataFactory=i.tileRequestDataFactory||new t.TileRequestDataFactory}return r.prototype.execute=function(t){var r=t.command,i=r.searchKey,a=r.queryType;if(!i||!a)return null;var n=this.promiseFactory.defer(),o=this.tileRequestDataFactory.getTileRequestData(a);return o?this.client.requestData(n,i,o):n.reject(),e.createRejectablePromise2(n)},r.prototype.transform=function(e){return{dataView:e}},r}();t.BingSocialDataReader=r}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i;!function(r){function i(t,r,i,a,n){var o={};o[i]=!0;var s={displayName:t,queryName:t,index:r,isMeasure:!a,type:a?a:e.ValueType.fromDescriptor({numeric:!0}),roles:o};return n&&(s=e.Prototype.inherit(s,function(e){return e.objects={dataPoint:{fill:{solid:{color:n[t]}}}}})),s}function a(e,t){for(var r=t.split("."),i=0,a=r;i<a.length;i++){var n=a[i];if(!(null!=e&&n in e))return null;e=e[n]}return e}function n(e,r,i,a,n){n=n||{},void 0===n.percentize&&(n.percentize=!0);var u=t.SQExprBuilder.columnRef(t.SQExprBuilder.entity(null,"table"),"Column"),c=t.createCategoricalDataViewBuilder().withCategory(o(e,u,r,i,n.mapping)).withValues(s(e,a,n)).build();return c.metadata.objects={labels:{show:!0},categoryLabels:{show:!0}},c}function o(t,r,n,o,s){for(var u=[],c=0,l=t;c<l.length;c++){var p=l[c],d=a(p,n);s&&!(d="function"==typeof s?s(d):s[d])||u.push(d)}return{source:i(_.last(n.split(".")),0,o,e.ValueType.fromDescriptor({text:!0})),identityFrom:{fields:[r]},values:u}}function s(e,t,r){var a=_.map(e,function(e){return e.Count}),n=i("Count",1,t);r.percentize&&(a=u(a,n));var o=_.min(a),s=_.max(a);return n.aggregates={min:o,max:s},{columns:[{source:n,values:a}]}}function u(e,t){return t.objects=t.objects||{},t.objects.general={formatString:"0%"},c(e)}function c(e){var t=e.reduce(function(e,t){return e+t},0);return e.map(function(e){return e/t})}r.createMetadataColumn=i,r.getFieldFromString=a,r.createDataView=n}(i=r.ChartDataViewConstructorUtils||(r.ChartDataViewConstructorUtils={}))}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i=function(){function i(){}return i.prototype.formatResponse=function(e){for(var t=e[0].value,i=0,a=t;i<a.length;i++){var n=a[i];n.source="Bing",n.CreatedAt=r.ChartDataViewConstructorUtils.getFieldFromString(n,"Request.RequestTime")}var o=this.getCountsPerTime(t,"source"),s=["Bing"],u={Bing:"#FFB900"};return this.createLineChartDataView(s,o,u)},i.prototype.getCountsPerTime=function(e,t,i){for(var a={},n=0,o=e;n<o.length;n++){var s=o[n],u=s.CreatedAt,c=r.ChartDataViewConstructorUtils.getFieldFromString(s,t);i&&!(c=i[c])||(a[u]=a[u]||{},a[u][c]=s.Count)}return a},i.prototype.createLineChartDataView=function(r,a,n){var o=Object.keys(a),s=i.sortDateStrings(o),u=s.map(function(e){return new Date(e)}),c={},l={},p={},d={};i.getTableData(s,r,a,c,l,p,d);var f={source:{queryName:"CreatedAt",displayName:"CreatedAt",type:e.ValueType.fromDescriptor({dateTime:!0}),index:0},values:u},h=this.createMetadataColumns(r,n);return{metadata:{columns:h},categorical:{values:t.DataViewTransform.createValueColumns(this.createValueColumns(r,h,c,l,p,d)),categories:[f]}}},i.getTableData=function(e,t,r,i,a,n,o){for(var s=0,u=t;s<u.length;s++){var c=u[s];i[c]=[],o[c]=0}for(var l=0,p=e;l<p.length;l++)for(var d=p[l],f=0,h=t;f<h.length;f++){var c=h[f],m=r[d][c]||0;i[c].push(m),a[c]=a[c]?Math.max(a[c],m):m,n[c]=n[c]?Math.min(n[c],m):m,o[c]+=m}},i.prototype.createMetadataColumns=function(t,i){for(var a=[r.ChartDataViewConstructorUtils.createMetadataColumn("CreatedAt",0,"Category",e.ValueType.fromDescriptor({text:!0}))],n=0;n<t.length;n++){var o=t[n],s=r.ChartDataViewConstructorUtils.createMetadataColumn(o,n+1,"Y",null,i);a.push(s)}return a},i.prototype.createValueColumns=function(e,t,r,a,n,o){for(var s=[],u=0;u<e.length;u++){var c=e[u];s.push(i.createValueColumn(r[c],n[c],a[c],o[c],t[u+1]))}return s},i.createValueColumn=function(e,t,r,i,a){return{source:a,values:e,min:t,max:r,subtotal:i}},i.sortDateStrings=function(e){return e.sort(function(e,t){return new Date(e).getTime()-new Date(t).getTime()})},i}();r.ActivityChartResponseFormatter=i}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(){}return t.prototype.formatResponse=function(e){var t=parseInt(e[0],10),r=parseInt(e[1],10);if(0===r){var i=this.getMetadata("N/A");return{single:{value:0,column:i.columns[0]},metadata:i}}var a=(t-r)/r,n=this.getMetadata("+0.0%;-0.0%");return{single:{value:a,column:n.columns[0]},metadata:n}},t.prototype.getMetadata=function(t){return{columns:[{displayName:"Count Change",isMeasure:!0,type:e.ValueType.fromDescriptor({numeric:!0}),objects:{general:{formatString:t}}}]}},t}();t.CountChangeResponseFormatter=r}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(){}return t.prototype.formatResponse=function(t){var r={displayName:"Count",isMeasure:!0,type:e.ValueType.fromDescriptor({integer:!0})},i={columns:[r]};return{single:{value:t[0],column:r},metadata:i}},t}();t.CountResponseFormatter=r}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.formatResponse=function(e){return{metadata:{columns:[]},bingSocial:e[0].value}},e}();e.RawDataResponseFormatter=t}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.formatResponse=function(e){return{metadata:{columns:[]},bingSocial:e[0].value}},e}();e.BingNewsResponseFormatter=t}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i=function(){function i(e,t){this.fieldName=e,this.options=t||{}}return i.prototype.formatResponse=function(i){var a=i[0].value;if(this.options.logarithmic)for(var n=0,o=a;n<o.length;n++){var s=o[n];s.Count=Math.log(s.Count)}var u=r.ChartDataViewConstructorUtils.createDataView(a,this.fieldName,"Category","Y",{mapping:this.options.mapping,percentize:!1});u.metadata.columns[0].type=e.ValueType.fromDescriptor({geography:{country:!0}});var c={selects:[{type:e.ValueType.fromDescriptor({text:!0}),roles:{Category:!0}},{type:e.ValueType.fromDescriptor({numeric:!0}),roles:{Y:!0,Gradient:!0}}],objects:{dataPoint:[{properties:{fillRule:{linearGradient2:{min:{color:t.SQExprBuilder.text("#FFF0CC")},max:{color:t.SQExprBuilder.text("#FFB600")}}}}}]}};return t.DataViewTransform.apply({prototype:u,objectDescriptors:{dataPoint:{properties:{fill:{type:{fill:{solid:{color:!0}}}},fillRule:{type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},transforms:c,colorAllocatorFactory:powerbi.visuals.createColorAllocatorFactory(),dataViewMappings:powerbi.visuals.getTreemapCapabilities().dataViewMappings,dataRoles:null,visualStyle:e.visuals.visualStyles.create(),featureSwitches:{}}).dataViews[0]},i}();r.MapResponseFormatter=i}(r=t.bingSocial||(t.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(e,t){this.fieldName=e,this.options=t||{}}return t.prototype.formatResponse=function(t){var r=t[0].value;return e.ChartDataViewConstructorUtils.createDataView(r,this.fieldName,"Group","Values",this.options)},t}();e.TreeMapResponseFormatter=t}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.urlTemplates=e,this.responseFormatter=t}return e.prototype.getUrlTemplates=function(){return this.urlTemplates},e.prototype.getResponseFormatter=function(){return this.responseFormatter},e}();e.TileRequestData=t}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t="v6",r="powerbi/providers/bingsocial/?source={{source}}&type={{type}}&searchKey={{searchKey}}&newsApiVersion={{newsApiVersion}}",i=function(){function i(){}return i.prototype.getTileRequestData=function(e){return i.tileRequestData[e]},i.createUrl=function(e,i){return r.replace(/{{source}}/g,e).replace(/{{type}}/g,i).replace(/{{newsApiVersion}}/g,t)},i.languageMapping={aa:"Afar",af:"Afrikaans",agq:"Aghem",ak:"Akan",sq:"Albanian",gsw:"Alsatian",am:"Amharic",ar:"Arabic",hy:"Armenian",as:"Assamese",ast:"Asturian",asa:"Asu","az-Cyrl":"Azerbaijani (Cyrillic)","az-Latn":"Azerbaijani (Latin)",ksf:"Bafia","bm-Latn":"Bamanankan (Latin)",bn:"Bangla",bas:"Basaa",ba:"Bashkir",eu:"Basque",be:"Belarusian",bem:"Bemba",bez:"Bena",byn:"Blin",brx:"Bodo","bs-Cyrl":"Bosnian (Cyrillic)","bs-Latn":"Bosnian (Latin)",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan","tzm-Arab":"Central Atlas Tamazight (Arabic)","tzm-Latn":"Central Atlas Tamazight (Latin)","tzm-Tfng":"Central Atlas Tamazight (Tifinagh)","ku-Arab":"Central Kurdish","chr-Cher":"Cherokee (Cherokee)",cgg:"Chiga","zh-Hans":"Chinese (Simplified)","zh-Hant":"Chinese (Traditional)",swc:"Congo Swahili",kw:"Cornish",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",prs:"Dari",dv:"Divehi",dua:"Duala",nl:"Dutch",dz:"Dzongkha",bin:"Edo",ebu:"Embu",en:"English",eo:"Esperanto",et:"Estonian",ee:"Ewe",ewo:"Ewondo",fo:"Faroese",fil:"Filipino",fi:"Finnish",fr:"French",fur:"Friulian","ff-Latn":"Fulah",gl:"Galician",lg:"Ganda",ka:"Georgian",de:"German",el:"Greek",kl:"Greenlandic",gn:"Guarani",gu:"Gujarati",guz:"Gusii",ht:"Haitian","ha-Latn":"Hausa (Latin)",haw:"Hawaiian",he:"Hebrew",hi:"Hindi",mww:"Hmong Daw",hu:"Hungarian",is:"Icelandic",ig:"Igbo",smn:"Inari Sami",id:"Indonesian",ia:"Interlingua","iu-Cans":"Inuktitut (Canadian Aboriginal Syllabics)","iu-Latn":"Inuktitut (Latin)",iv:"Invariant Language",ga:"Irish",xh:"isiXhosa",zu:"isiZulu",it:"Italian",ja:"Japanese","jv-Latn":"Javanese (Latin)",dyo:"Jola-Fonyi",quc:"K'iche'",kea:"Kabuverdianu",kab:"Kabyle",kkj:"Kako",kln:"Kalenjin",kam:"Kamba",kn:"Kannada",kr:"Kanuri","ks-Deva":"Kashmiri (Devanagari)","ks-Arab":"Kashmiri (Perso-Arabic)",kk:"Kazakh",km:"Khmer",ki:"Kikuyu",rw:"Kinyarwanda",sw:"Kiswahili",kok:"Konkani",ko:"Korean",khq:"Koyra Chiini",ses:"Koyraboro Senni",nmg:"Kwasio",ky:"Kyrgyz",lkt:"Lakota",lag:"Langi",lo:"Lao",lv:"Latvian",ln:"Lingala",lt:"Lithuanian",dsb:"Lower Sorbian",lu:"Luba-Katanga",smj:"Lule Sami",luo:"Luo",lb:"Luxembourgish",luy:"Luyia",mk:"Macedonian",jmc:"Machame",mgh:"Makhuwa-Meetto",kde:"Makonde",mg:"Malagasy",ms:"Malay (Latin)",ml:"Malayalam",mt:"Maltese",mni:"Manipuri",gv:"Manx",mi:"Maori",arn:"Mapudungun",mr:"Marathi",mas:"Masai",mer:"Meru",mgo:"Meta'",moh:"Mohawk","mn-Cyrl":"Mongolian (Cyrillic)","mn-Mong":"Mongolian (Traditional Mongolian)",mfe:"Morisyen",mua:"Mundang",nqo:"N'Ko",naq:"Nama",ne:"Nepali",nnh:"Ngiemboon",jgo:"Ngomba",nd:"North Ndebele",kmr:"Northern Kurdish",se:"Northern Sami",nb:"Norwegian Bokmål",nn:"Norwegian Nynorsk",nus:"Nuer",nyn:"Nyankole",oc:"Occitan",or:"Odia",om:"Oromo","os-Cyrl":"Ossetian (Cyrillic)",pap:"Papiamento",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese","pa-Arab":"Punjabi (Arabic)","pa-Guru":"Punjabi (Gurmukhi)",quz:"Quechua",otq:"Querétaro Otomi",ksh:"Ripuarian",ro:"Romanian",rm:"Romansh",rof:"Rombo",rn:"Rundi",ru:"Russian",rwk:"Rwa",ssy:"Saho",sah:"Sakha",saq:"Samburu",sg:"Sango",sbp:"Sangu",sa:"Sanskrit",gd:"Scottish Gaelic",seh:"Sena","sr-Cyrl":"Serbian (Cyrillic)","sr-Latn":"Serbian (Latin)",st:"Sesotho",nso:"Sesotho sa Leboa",tn:"Setswana",ksb:"Shambala",sn:"Shona","sd-Arab":"Sindhi (Arabic)","sd-Deva":"Sindhi (Devanagari)",si:"Sinhala",ss:"siSwati",sms:"Skolt Sami",sk:"Slovak",sl:"Slovenian",xog:"Soga",so:"Somali",nr:"South Ndebele",sma:"Southern Sami",es:"Spanish","zgh-Tfng":"Standard Moroccan Tamazight (Tifinagh)",sv:"Swedish",syr:"Syriac","shi-Latn":"Tachelhit (Latin)","shi-Tfng":"Tachelhit (Tifinagh)",dav:"Taita","tg-Cyrl":"Tajik (Cyrillic)",ta:"Tamil",twq:"Tasawaq","tt-Cyrl":"Tatar (Cyrillic)",te:"Telugu",teo:"Teso",th:"Thai",bo:"Tibetan",tig:"Tigre",ti:"Tigrinya",to:"Tongan",tr:"Turkish","tk-Latn":"Turkmen (Latin)",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu","ug-Arab":"Uyghur (Arabic)","uz-Cyrl":"Uzbek (Cyrillic)","uz-Latn":"Uzbek (Latin)","uz-Arab":"Uzbek (Perso-Arabic)","vai-Latn":"Vai (Latin)","vai-Vaii":"Vai (Vai)","ca-ES-valencia":"Valencian",ve:"Venda",vi:"Vietnamese",vo:"Volapük",vun:"Vunjo",wae:"Walser",cy:"Welsh",fy:"Western Frisian",wal:"Wolaytta",wo:"Wolof",ts:"Xitsonga",yav:"Yangben",ii:"Yi",yi:"Yiddish",yo:"Yoruba",yua:"Yucatec Maya",dje:"Zarma",az:"Azerbaijani",bm:"Bamanankan",bs:"Bosnian",tzm:"Central Atlas Tamazight",chr:"Cherokee",zh:"Chinese",ha:"Hausa",iu:"Inuktitut",jv:"Javanese",ks:"Kashmiri",mn:"Mongolian",os:"Ossetian",pa:"Punjabi",sr:"Serbian",sd:"Sindhi",zgh:"Standard Moroccan Tamazight",shi:"Tachelhit",tg:"Tajik",tt:"Tatar",tk:"Turkmen",ug:"Uyghur",uz:"Uzbek",vai:"Vai"},i.languageOptions={mapping:function(e){if("string"==typeof e&&e){for(var t,r=e;r;){if(r in i.languageMapping){t=i.languageMapping[r];break}var a=Math.max(r.lastIndexOf("-"),0);r=r.substring(0,a)}return t||e}}},i.tileRequestData={bingVolume:new e.TileRequestData([i.createUrl("Bing","Volume")],new e.CountResponseFormatter),bingVolumeChange:new e.TileRequestData([i.createUrl("Bing","Volume"),i.createUrl("Bing","VolumeChange")],new e.CountChangeResponseFormatter),activity:new e.TileRequestData([i.createUrl("Bing","Activity")],new e.ActivityChartResponseFormatter),languages:new e.TileRequestData([i.createUrl("Bing","Language")],new e.TreeMapResponseFormatter("Query._Microsoft.Language",i.languageOptions)),news:new e.TileRequestData([i.createUrl("Bing","News")],new e.BingNewsResponseFormatter),location:new e.TileRequestData([i.createUrl("Bing","Location")],new e.MapResponseFormatter("User.Country",{logarithmic:!0}))},i}();e.TileRequestDataFactory=i}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e,t){return new a(e,t)}function r(e){return e||"dsr"}e.createDataReaderFactory=t;var i,a=function(){function e(e,t){if(t){var r=function(e){};for(var i in t)r(i)}this.plugins=e,this.extensions=t||{}}return e.prototype.getPlugin=function(e){return this.plugins[r(e)]},e.prototype.getExtension=function(e){return this.extensions[e]},e}();!function(e){function t(e,t){for(var r=a(t),n=[],o=0,s=e;o<s.length;o++){var u=s[o];if(!r||_.includes(r,u.name)){var c=i(u);_.includes(n,c)||n.push(c)}}return n}function i(e){return r(e.type)}function a(e){if(e){var t=[];return new o(t).run(e),t}}function n(e){return _.chain(e).map(function(e){return i(e)}).uniq().value()}e.findTypes=t,e.readerType=i,e.findSchemas=a,e.uniqueReaderTypes=n;var o=function(){function e(e){this.schemas=e}return e.prototype.run=function(e){for(var t=e.from(),r=0,i=t.keys();r<i.length;r++){var a=i[r];t.source(a).accept(this,void 0)}},e.prototype.visitEntity=function(e){var t=e.schema,r=this.schemas;_.includes(r,t)||r.push(t)},e.prototype.visitSubquery=function(e){this.run(e.subquery)},e.prototype.visitExpr=function(e){},e}()}(i=e.DataReaderUtils||(e.DataReaderUtils={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e,t){return new n(e,t)}function r(t,r,i){for(var a=[],n=0,o=r;n<o.length;n++){var s=o[n],u=e.DataReaderUtils.readerType(s);u===t&&a.push(s[u])}return i(a)}function i(e,t){if(e||t)return e?function(r,i){return e(r,i,t)}:t}var a=jsCommon.ArrayExtensions;e.createDataReaderProvider=t;var n=function(){function t(e,t){this.factory=e,this.hostServices=t,this.readers={},this.queryGen={},this.schemaReaders={}}return t.prototype.reader=function(e){var t=this;return this.findSinglePropertyDefinition(a.ensureArray(e),function(e){return e.reader(t.hostServices)},_.noop,this.readers)},t.prototype.readerType=function(e){var t=this,r=this.resolvePluginProperty(a.ensureArray(e),function(e){return e.reader(t.hostServices)},_.noop,this.readers);return r&&r.type},t.prototype.queryGenerator=function(e){return this.findSinglePropertyDefinition(a.ensureArray(e),function(e){return e.queryGenerator&&e.queryGenerator()},_.noop,this.queryGen)},t.prototype.queryExtensionLookup=function(t){var n=a.ensureArray(t),o=_.chain(n).map(function(t){return e.DataReaderUtils.readerType(t)}).uniq().value(),s=this.findSingleBasePropertyDefinition(o,function(e){return e.queryExtensionProvider&&r(e.name,n,e.queryExtensionProvider)});return i(this.findSingleExtensionPropertyDefinition(o,function(e){return e.queryExtensionProvider&&r(e.name,n,e.queryExtensionProvider)}),s)},t.prototype.schemaReader=function(e){var t=this;return this.findSinglePropertyDefinition([e],function(e){return e.schemaReader&&e.schemaReader(t.hostServices)},function(e){return e.schemaReader&&e.schemaReader(t.hostServices)},this.schemaReaders)},t.prototype.getCacheKey=function(e){var t=a.ensureArray(e);return t.length<2?t[0]:"["+t.join(",")+"]"},t.prototype.findSinglePropertyDefinition=function(e,t,r,i){var a=this.getCacheKey(e),n=i[a];if(n)return n;var o=this.resolvePluginProperty(e,t,r,i);return o?i[a]=o.property:void 0},t.prototype.findSingleExtensionPropertyDefinition=function(e,t){for(var r,i,a=0,n=e;a<n.length;a++){var o=n[a],s=this.factory.getPlugin(o);if(s){if(i&&i!==s.name)return;i=s.name}else{var u=this.factory.getExtension(o);if(!u)return;if(i&&i!==u.extends)return;i=u.extends;var c=t(u);if(c){if(r&&c!==r)return;r=c}}}return r},t.prototype.findSingleBasePropertyDefinition=function(e,t){for(var r,i,a=0,n=e;a<n.length;a++){var o=n[a],s=this.factory.getPlugin(o);if(s){if(i&&i!==s.name)return;i=s.name;var u=t(s);if(u){if(r&&u!==r)return;r=u}}}return r},t.prototype.resolvePluginProperty=function(e,t,r,i){for(var a,n=0,o=e;n<o.length;n++){var s=o[n],u=this.resolveProperty(s,t,r,i);if(!u||a&&u.property!==a.property)return;a=u}return a},t.prototype.resolveProperty=function(e,t,r,i){var a,n;if(i&&(a=this.getCacheKey(e),n=i[a]))return{type:e,property:n};var o=this.factory.getPlugin(e);if(o){if(n=t(o),!n)return;return i&&(i[a]=n),{type:e,property:n}}var s=this.factory.getExtension(e);return s?(n=r(s))?(i&&(i[a]=n),{type:e,property:n}):this.resolveProperty(s.extends,t,r,i):void 0},t}()}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e){for(var t=e.length,i=0;i<t;i++){var a=e[i];r.applyDataReductionDefaults(a)}}e.applyDataReductionDefaults=t;var r;!function(e){function t(e){e.categorical&&a(e.categorical),e.table&&i(e.table),e.matrix&&r(e.matrix)}function r(e){e.rows&&o(e.rows),e.columns&&o(e.columns)}function i(e){e.rows&&o(e.rows)}function a(e){if(!e.dataReductionAlgorithm){e.categories&&o(e.categories);var t=e.values;t&&t.group&&n(t)}}function n(e){e.group.dataReductionAlgorithm||(e.group.dataReductionAlgorithm=s())}function o(e){e.dataReductionAlgorithm||(e.dataReductionAlgorithm=s())}function s(){return{top:{}}}e.applyDataReductionDefaults=t}(r||(r={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function r(e){var t=e.mappings;if(!t)return[];var r=new n(e.queryDefn,e.queryProjections,e.schema,e.objectDescriptors,e.objectDefinitions,e.roles||[],e.featureSwitches);return _.map(t,function(e){return r.compileMapping(e)})}var i=jsCommon.ArrayExtensions,a=jsCommon.UnionExtensions;t.compileDataView=r;var n=function(){function r(e,r,i,a,n,o,s){this.featureSwitches=s,this.queryDefn=e,this.queryProjections=r,this.schema=i,this.objectDescriptors=a,this.objectDefinitions=n,this.roles=o,this.exprEvaluationContext=t.SQExprUtils.buildExprEvaluationContext(this.queryDefn.from())}return r.prototype.compileMapping=function(e){var t=this.compileMetadata(),r={metadata:t};return e.categorical&&(r.categorical=this.compileCategorical(e.categorical)),e.table&&(r.table=this.compileTable(e.table)),e.single&&(r.single=this.compileSingle(e.single)),e.tree&&(r.tree=this.compileTree(e.tree)),e.matrix&&(r.matrix=this.compileMatrix(e.matrix)),e.scriptResult&&(r.scriptResult=this.compileScriptResult(e.scriptResult,t)),e.usage&&(r.usage=this.compileUsage(e.usage)),r},r.prototype.compileMetadata=function(){for(var r={columns:[]},i=this.queryDefn.orderBy(),a=function(e){var a=_.find(i,function(r){return t.SQExpr.equals(r.expr,e.expr)}),o=t.SQExprUtils.getParameterMetadata(e.expr,n.schema);r.columns.push({displayName:void 0,queryName:e.name,type:n.tryGetExprType(e.expr),sort:a&&a.direction,parameter:o})},n=this,o=0,s=this.queryDefn.select();o<s.length;o++){a(s[o])}var u=this.objectDescriptors,c=this.objectDefinitions;if(!c||!u)return r;var l=t.DataViewObjectEvaluationUtils.groupObjectsBySelector(c),p=t.createStaticEvalContext(e.visuals.visualStyles.create());if(!_.isEmpty(l.metadataOnce)){var d=this.evaluateMetadataOnceObjects(l.metadataOnce,p);d&&(r.objects=d)}if(!_.isEmpty(l.metadata))for(var f=0,h=r.columns;f<h.length;f++){var m=h[f],d=this.evaluateMetadataObjects(m,l.metadata,p);d&&(m.objects=d)}return r},r.prototype.evaluateMetadataOnceObjects=function(r,i){for(var a,n=0,o=r;n<o.length;n++){var s=o[n],u=s.selector&&s.selector.id,c=t.DataViewObjectEvaluationUtils.evaluateDataViewObjects(i,this.objectDescriptors,s.objects,this.featureSwitches);c&&(a||(a={}),e.DataViewObjects.mergeObjects(a,c,u))}return a},r.prototype.evaluateMetadataObjects=function(r,i,a){for(var n,o=0,s=i;o<s.length;o++){var u=s[o],c=u.selector;if(c.metadata&&c.metadata===r.queryName){var l=t.DataViewObjectEvaluationUtils.evaluateDataViewObjects(a,this.objectDescriptors,u.objects,this.featureSwitches);return l&&(n||(n={}),e.DataViewObjects.mergeObjects(n,l,c.id)),n}}},r.prototype.compileCategorical=function(e){var t={};e.categories&&(t.categories=this.compileRoleMappingWithReduction(e.categories));var r=e.values;if(r){var i=this.compileGrouped(r),n=this.compileList(r),o=this.compileRoleMapping(r);t.values=a.mergeUnionType(i,n,o)}return e.includeEmptyGroups&&(t.includeEmptyGroups=e.includeEmptyGroups),null!=e.dataVolume&&(t.dataVolume=e.dataVolume),e.dataReductionAlgorithm&&(t.dataReductionAlgorithm=this.compileReduction(e.dataReductionAlgorithm)),t},r.prototype.compileTable=function(e){var t=this.compileRoleMappingWithReduction(e.rows),r=this.compileListWithReduction(e.rows),i=a.mergeUnionType(t,r),n={rows:i};return null!=e.dataVolume&&(n.dataVolume=e.dataVolume),n},r.prototype.compileSingle=function(e){return{role:this.compileRole(e.role)}},r.prototype.compileScriptResult=function(e,t){return{dataInput:this.compileMapping(e.dataInput),script:this.compileScriptDefinition(e.script,t)}},r.prototype.compileScriptDefinition=function(t,r){var i=e.ScriptResultUtil.getScriptInputFromScriptDefinition(this.queryProjections,this.queryDefn.select(),this.schema,t,r.objects);return{source:t.source,provider:t.provider,scriptInput:i,scriptSourceDefault:t.scriptSourceDefault,scriptProviderDefault:t.scriptProviderDefault,scriptOutputType:t.scriptOutputType}},r.prototype.compileTree=function(e){var t={};return e.nodes&&(t.nodes=this.compileForWithReduction(e.nodes)),e.values&&(t.values=this.compileFor(e.values)),null!=e.dataVolume&&(t.dataVolume=e.dataVolume),t},r.prototype.compileMatrix=function(e){var t={};if(e.rows){var r=this.compileForWithReduction(e.rows),i=this.compileListWithCompositeWithReduction(e.rows);t.rows=a.mergeUnionType(r,i)}if(e.columns&&(t.columns=this.compileForWithReduction(e.columns)),e.values){var r=this.compileRoleMapping(e.values),i=this.compileList(e.values);t.values=a.mergeUnionType(r,i)}return null!=e.dataVolume&&(t.dataVolume=e.dataVolume),t;
},r.prototype.compileUsage=function(e){if(e.regression||e.forecast)return e},r.prototype.compileListWithReduction=function(e){var t=this.compileList(e);if(t)return e.dataReductionAlgorithm&&(t.dataReductionAlgorithm=this.compileReduction(e.dataReductionAlgorithm)),t},r.prototype.compileList=function(e){var t=this;if(e.select){return{select:_.map(e.select,function(e){return t.compileRoleMapping(e)})}}},r.prototype.compileListWithCompositeWithReduction=function(e){var t=this.compileListWithComposite(e);if(t)return e.dataReductionAlgorithm&&(t.dataReductionAlgorithm=this.compileReduction(e.dataReductionAlgorithm)),t},r.prototype.compileListWithComposite=function(e){var t=this;if(e.select){return{select:_.map(e.select,function(e){return t.compileRoleMappingWithComposite(e)})}}},r.prototype.compileGrouped=function(e){var t=this;if(e.group){var r=this.compileRole(e.group.by),i=_.map(e.group.select,function(e){return t.compileRoleMapping(e)}),a={group:{by:r,select:i}};return e.group.dataReductionAlgorithm&&(a.group.dataReductionAlgorithm=this.compileReduction(e.group.dataReductionAlgorithm)),a}},r.prototype.compileRoleMapping=function(e){var t=this.compileBind(e),r=this.compileFor(e);return a.mergeUnionType(t,r)},r.prototype.compileRoleMappingWithComposite=function(e){var t=this.compileBind(e),r=this.compileFor(e),i=this.compileComposite(e);return a.mergeUnionType(t,r,i)},r.prototype.compileRoleMappingWithReduction=function(e){var t=this.compileRoleMapping(e),r=this.compileList(e);if(t||r){var i=a.mergeUnionType(t,r);return i&&e.dataReductionAlgorithm&&(i.dataReductionAlgorithm=this.compileReduction(e.dataReductionAlgorithm)),i}},r.prototype.compileBind=function(e){if(e.bind){return{bind:{to:this.compileRole(e.bind.to,e.bind.aggregates)}}}},r.prototype.compileForWithReduction=function(e){var t=this.compileFor(e);if(t)return e.dataReductionAlgorithm&&(t.dataReductionAlgorithm=this.compileReduction(e.dataReductionAlgorithm)),t},r.prototype.compileFor=function(e){if(e.for){return{for:{in:this.compileRole(e.for.in)}}}},r.prototype.compileComposite=function(e){var t=this;if(e.composite){return{composite:_.map(e.composite,function(e){return t.compileRoleMapping(e)})}}},r.prototype.compileRole=function(e,r){var a,n=this,o=this.queryDefn.select(),s=this.queryProjections[e],u=i.findItemWithName(this.roles,e);if(s&&s.all().length>0){var c=!1;u&&(c=t.ScalarKeyUtils.isScalarKeySupportedForRole(this.schema,this.queryDefn,this.queryProjections,u.name));var l=this.getScalarKeyRoleItemQueryRef(s);a=_.map(s.all(),function(e){var t=e.queryRef===l;return n.createDataViewRoleItem(o.withName(e.queryRef),u,c,t)})}var p={role:e,items:a},d=this.queryProjections[e];return d&&(d.showAll&&(p.showAll=!0),d.activeProjectionRefs&&(p.activeItems=d.activeProjectionRefs)),r&&(p.aggregates=_.cloneDeep(r)),p},r.prototype.getScalarKeyRoleItemQueryRef=function(e){var t=e.activeProjectionRefs;return _.isEmpty(t)?e.all()[0].queryRef:_.last(t)},r.prototype.createDataViewRoleItem=function(e,t,r,i){var a={queryName:e.name},n=this.tryGetExprType(e.expr);return n&&(a.type=n),t&&null!=t.joinPredicate&&(a.joinPredicate=t.joinPredicate),a.scalarKeyInfo={hasScalarKey:r&&i},a},r.prototype.tryGetExprType=function(e){var t=e.getMetadata(this.schema,this.exprEvaluationContext);if(t)return t.type},r.prototype.compileReduction=function(e){if(e){var t={};if(e.top&&(t.top={},e.top.count&&(t.top.count=e.top.count)),e.bottom&&(t.bottom={},e.bottom.count&&(t.bottom.count=e.bottom.count)),e.sample&&(t.sample={},e.sample.count&&(t.sample.count=e.sample.count)),e.window&&(t.window={},e.window.count&&(t.window.count=e.window.count)),e.binnedLineSample&&(t.binnedLineSample={}),e.overlappingPointsSample){var r=e.overlappingPointsSample;t.overlappingPointsSample={},r.count&&(t.overlappingPointsSample.count=r.count);var i=this.getCompiledRoleForCartesianRoleKind(0);i&&(t.overlappingPointsSample.x={role:i});var a=this.getCompiledRoleForCartesianRoleKind(1);a&&(t.overlappingPointsSample.y={role:a})}return e.topNPerLevel&&(t.topNPerLevel={count:e.topNPerLevel.count,fallbackTopCount:e.topNPerLevel.fallbackTopCount}),t}},r.prototype.getCompiledRoleForCartesianRoleKind=function(e){var t=_.filter(this.roles,function(t){return t.cartesianKind===e});if(1===_.size(t))return this.compileRole(t[0].name)},r}()}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.Version;e.ObjectPropertyVersionWildcard="*";var r;!function(r){function i(t,r,i,n,o){return a(o[t],r,i,n)||a(o[e.ObjectPropertyVersionWildcard],r,i,n)||{objectName:r,propertyName:i}}function a(e,r,i,a){var n=e&&e[r]&&e[r][i];if(n){for(var o=n.currentId;n&&t.gt(n.version,a);)o=n.previousId,n=n.previous;return o}}function n(e,r,i,a,n,s){return o(e,r,null,i,a,n,s,function(){return!1})===t.ZeroStr}function o(r,i,a,n,o,u,c,l){return t.max(s(r[e.ObjectPropertyVersionWildcard],o,u,i,a,c,l),s(r[n],o,u,i,a,c,l))}function s(r,i,a,n,o,s,c){var l=r&&r[i];return l?t.max(u(l[e.ObjectPropertyVersionWildcard],n,o,s,c),u(l[a],n,o,s,c)):t.ZeroStr}function u(e,r,i,a,n){if(!e)return t.ZeroStr;for(var o=e.length-1;o>=0;o--){var s=e[o];if(!t.lt(a,s.version))break;var u=s.property.matchByContents;if((!u||u(r,i))&&(!s.property.isExprBound||n()))return s.version}return t.ZeroStr}function c(e,r,i){var a=e[i];if(a){var n=a[r.objectName];if(n){var o=n[r.propertyName];return _.reduce(o,function(e,r){return r.property.matchByContents||r.property.isExprBound?e:t.max(e,r.version)},t.ZeroStr)}}return t.ZeroStr}r.getThemePropertyId=i,r.shouldApplyDefnToTheme=n,r.getVersionForDefinition=o,r.getFirstVersionForIdentifier=c}(r=e.DataViewObjectVersioning||(e.DataViewObjectVersioning={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;jsCommon.ArrayExtensions;!function(t){function r(e,t,r,a){a&&o(e,t,a),r&&i(e,t,r)}function i(e,t,r){var i=t.categories;if(!_.isEmpty(i)){n(e,t,a(i,r))}}function a(e,t){for(var r=e[0].values.length,i=[],a=r-1;a>=0;a--)t(a,e)&&i.push(a);return i}function n(t,r,i){if(!_.isEmpty(i)){if(e.DataViewCategoricalUtils.getRowCount(r)===i.length)return void c(t,r);var a=r.categories;if(!_.isEmpty(a))for(var n=0,o=a;n<o.length;n++){var s=o[n];p(s.values,i),p(s.identity,i)}var u=r.values;if(!_.isEmpty(u))for(var l=0,d=u;l<d.length;l++){var f=d[l];p(f.values,i)}}}function o(e,t,r){var i=t.values&&t.values.grouped();if(!_.isEmpty(i)){s(e,t,l(t.values&&t.values.source,i,r))}}function s(e,t,r){if(!_.isEmpty(r)){var i=t.values,a=i.grouped();if(a.length===r.length)return void c(e,t);var n=a[0].values.length;if(n>0)for(var o=e.columns,s=0,l=r;s<l.length;s++){for(var d=l[s],f=d*n,h=f,m=f+n;h<m;h++){var v=i[h].source;u(o,v)}i.splice(f,n)}p(a,r),i.grouped=function(){return a}}}function u(e,t){var r=e.indexOf(t);r>=0&&e.splice(r,1)}function c(e,t){var r=t.categories;if(r)for(var i=0,a=r;i<a.length;i++){var n=a[i];n.values.splice(0),n.identity.splice(0)}var o=t.values;if(o){var s=o.grouped();if(!_.isEmpty(s)){for(var c=s[0],l=e.columns,p=function(e){var t=e.source;if(t.groupName){var r=_.find(l,function(e){return!e.groupName&&e.index===t.index&&e.isMeasure===t.isMeasure});r?(e.source=r,u(l,t)):delete t.groupName}},d=0,f=c.values;d<f.length;d++){p(f[d])}var h=[{values:c.values,objects:c.objects}];if(o.grouped=function(){return h},s.length>=2){var m=c.values.length;if(m>0){for(var v=s.length-1,y=m*v,g=m,S=m+y;g<S;g++){u(l,o[g].source)}o.splice(m,y)}}}for(var C=0,x=o;C<x.length;C++){var D=x[C];D.values.splice(0),delete D.identity}}}function l(e,t,r){for(var i=[],a=t.length-1;a>=0;a--)r(t[a],e)&&i.push(a);return i}function p(e,t){if(!_.isEmpty(t)){if(e.length===t.length)return void e.splice(0);for(var r,i=0,a=0,n=t;a<n.length;a++){var o=n[a];void 0===r||r===o+1?(r=o,i++):(e.splice(r,i),r=o,i=1)}e.splice(r,i)}}t.removeGroupInstances=r}(t=e.QueryDataViewCategorical||(e.QueryDataViewCategorical={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,i=e.data.QueryDataViewCategorical,a=jsCommon.StringExtensions;!function(e){function r(e,r){if(!t.SQFilter.targetsEqual(e,r))return!1;var i=e.condition,o=r.condition;if(i instanceof t.SQContainsExpr&&o instanceof t.SQContainsExpr){var s=n.getInfoIfFilteringByStringConstant(i),u=n.getInfoIfFilteringByStringConstant(o);if(s&&u&&t.SQExpr.equals(s.otherSide,u.otherSide))return a.contains(m(s.constantValue),m(u.constantValue))}return!1}function s(e,t){if(!_.some(t,function(e){return!c(e)})){for(var r=new o(e),i=0,a=t;i<a.length;i++)a[i].condition.accept(r);return r.getClientSideFiltersIfAllSupported()}}function u(e,t){if(!_.isEmpty(t)&&!_.isEmpty(e.metadata.columns)){var r=e.categorical;if(r){var a=f(r.values&&r.values.source,t),n=d(r.categories,t);i.removeGroupInstances(e.metadata,r,n,a)}return e}}function c(e){return!e.target}function l(e){var t=e.Condition;if(t.Contains)return t.Contains.SelectIndex}function p(e,t){if(_.isEmpty(e)||_.isEmpty(t))return[];for(var r={},i=0,a=t;i<a.length;i++){r[a[i].index]=!0}return _.filter(e,function(e){return!!r[l(e)]})}function d(e,t){var r=p(t,_.map(e,function(e){return e.source}));if(!_.isEmpty(r)){return function(e,t){for(var i=function(r){if(_.every(t,function(t){return h(r,t.values[e])}))return{value:!0}},a=0,n=r;a<n.length;a++){var o=n[a],s=i(o);if("object"==typeof s)return s.value}return!1}}}function f(e,t){if(e){var r=p(t,[e]);if(!_.isEmpty(r)){return function(e){if(!!e.identity)for(var t=e.name,i=0,a=r;i<a.length;i++){var n=a[i];if(h(n,t))return!0}return!1}}}}function h(e,t){var r=!1,i=e.Condition;if(i.Contains)if(_.isString(t)){var n=m(t);r=!a.contains(n,i.Contains.LiteralValue)}else r=!0;return r}function m(e){return e?a.normalizeCase(e):e}e.isMoreRestrictiveFilter=r,e.tryConvertToClientSideFilters=s,e.applyClientSideFilters=u,e.normalizeString=m}(r=t.ClientSideFilter||(t.ClientSideFilter={}));var n,o=function(e){function i(t){var r=e.call(this)||this;return r.clientSideFilters=[],r.selects=t,r}return __extends(i,e),i.prototype.visitContains=function(e){if(!this.hasUnsupportedFilter()){var i=!1,a=n.getInfoIfFilteringByStringConstant(e);if(a){var o=a.constantValue,s=t.SQExprUtils.indexOfNamedExpr(this.selects,a.otherSide);if(s>=0&&o){var u={Condition:{Contains:{SelectIndex:s,LiteralValue:r.normalizeString(o)}}};this.clientSideFilters.push(u),i=!0}}i||this.setUnsupportedFilter()}},i.prototype.visitAnd=function(e){this.hasUnsupportedFilter()||(e.left.accept(this),e.right.accept(this))},i.prototype.visitDefault=function(e){this.setUnsupportedFilter()},i.prototype.getClientSideFiltersIfAllSupported=function(){if(!this.hasUnsupportedFilter())return this.clientSideFilters},i.prototype.hasUnsupportedFilter=function(){return void 0===this.clientSideFilters},i.prototype.setUnsupportedFilter=function(){this.clientSideFilters=void 0},i}(t.DefaultSQExprVisitor);!function(e){function r(t){if(t){var r=e.getValueIfStringConstant(t.left);return r?{constantValue:r,otherSide:t.right}:(r=e.getValueIfStringConstant(t.right),{constantValue:r,otherSide:t.left})}}function i(e){if(t.SQExpr.isConstant(e)&&e.type.text)return e.value}e.getInfoIfFilteringByStringConstant=r,e.getValueIfStringConstant=i}(n||(n={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.DataViewAnalysis,i=e.data.SQExprUtils,a=jsCommon.StringExtensions,n=function(){function e(e,t,r,i,a,n,o){this.warningType=e,this.propertyId=t,this.valueExpr=r,this.selector=i,this.objectDiplayName=a,this.propertyDisplayName=n,this.expectedValueType=o}return e.prototype.columnNameFromIndex=function(e){},Object.defineProperty(e.prototype,"code",{get:function(){switch(this.warningType){case 1:return"DataBoundObjectQueryExtensionWarningInvalidType";case 2:return"DataBoundObjectQueryExtensionWarningMissingReference";case 0:return;default:debug.assertNever(this.warningType)}},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e,r){if(r){var i=[],n=e.get("NamePattern_Colon"),o=1===this.warningType,s=o?"DataBoundExprWarning_InvalidType_Title":"DataBoundExprWarning_MissingReference_Title",u=o?"DataBoundExprWarning_InvalidType_Message":"DataBoundExprWarning_MissingReference_Message";i.push(a.format(e.get(s),t.getDisplayName(this.propertyDisplayName,e))),i.push(a.format(n,e.get("VisualWarning_PropertyEvaluation_Tooltip_Section"),t.getDisplayName(this.objectDiplayName,e)));var c=r(this.valueExpr);return i.push(a.format(n,e.get("Field_Source"),c)),o&&this.expectedValueType&&i.push(a.format(n,e.get("DataBoundExprWarning_ExpectedDataType"),t.DataBoundExprWarning.getPrimitiveValueType(this.expectedValueType,e))),i.push(e.get(u)),{message:i.join("\n"),displayableErrorInfo:[]}}},e}();t.DataBoundObjectQueryExtensionWarning=n;var o;!function(a){function o(e,t,r,i,a,n){return u(e,t,r,i,a,n)}function s(e,t){return!!u(e,null,t,{},{},{})}function u(r,i,a,o,s,u){function f(a,c,f,g,S){var C,x=S&&S.properties[c],D=a[c],E=x.type;if(x.rule){if(!l(x.rule.conditions,s,u))return;var w=p(x.rule,r,o);if(_.isEmpty(w))return;f={data:_.map(w,function(e){return t.createDataViewScopeIdentity(e)})},C=t.DataViewObjectDefinitions.getDataBoundExprs(D,x.type,f,m,w[0])}else if(E&&E.dataBars){if(f&&f.metadata){var b=m.withName(f.metadata);b&&(_.isEmpty(f.data)&&(f=_.cloneDeep(f),f.data=[t.DataViewWildcard.create()]),C=t.DataViewObjectDefinitions.getDataBoundExprs(D,x.type,f,m,m.withName(f.metadata).expr))}}else C=t.DataViewObjectDefinitions.getDataBoundExprs(a[c],E,f,m);if(!_.isEmpty(C)){var I=d(f,m,o);if(f&&!h(f,m)&&(I=void 0),void 0!==I)for(var M=0,V=C;M<V.length;M++){var R=V[M];if(R.expr){if(i){var T=R.expr.getMetadata(i);if(null==T||!e.ValueType.isCompatibleTo(E,[T.type])){var P=T?1:2,N=T?e.ValueType.fromDescriptor(E):null,A=new n(P,{objectName:g,propertyName:c},R.expr,f,S.displayName,x.displayName,N);v.push(A);continue}}t.DataBoundExprExtractor.addUnique(y,R)}}}}if(!_.isEmpty(a)){for(var m=r.select(),v=[],y=[],g=0,S=a;g<S.length;g++){var C=S[g];C.objects&&C.descriptors&&t.DataViewObjectDefinitions.visitPropertyDefinitions(C.objects,C.descriptors,f)}for(var x=[],D=0,E=y;D<E.length;D++){var w=E[D],b=w.selector,I=c(w,r);r=I.queryDefn;var M={queryName:I.queryName,selector:b};w.aggregates&&(M.aggregates=w.aggregates),b&&!_.isEmpty(b.data)&&(M.joinPredicate=0),x.push(M)}return _.isEmpty(x)&&_.isEmpty(v)?void 0:{queryDefn:r,warnings:v,additionalProjections:x}}}function c(e,t){var r,i=e.expr,a=e.aggregates,n=e.selector;return a||n&&!_.isEmpty(n.data)?(r=t.selectNameOf(i))?{queryName:r,queryDefn:t}:(t=t.addSelect(i),{queryName:t.selectNameOf(i),queryDefn:t}):(t=t.addSelect(i),{queryName:_.last(t.select()).name,queryDefn:t})}function l(e,t,i){if(!e)return!0;for(var a=0,n=e;a<n.length;a++){var o=n[a],s=r.checkForConditionErrors(t,o,i);if(_.isEmpty(s))return!0}return!1}function p(e,t,r){var i=e.inputRole;if(i){var a=r[i];if(!_.isEmpty(a)){return _.chain(t.select()).filter(function(e){return _.includes(a,e.name)}).map(function(e){return e.expr}).value()}}}function d(e,r,a){if(t.Selector.equals(e,null))return null;var n=e.data;if(!n)return null;for(var o=[],s=0,u=n;s<u.length;s++){var c=u[s];if(t.Selector.isRoleWildcard(c)){var l=f(a,c.roles,r);o.push.apply(o,l)}else if(t.Selector.isWildcard(c)){var l=f(a,Object.keys(a),r);o.push.apply(o,l)}else t.Selector.isScopeWildcard(c)||t.Selector.isScopeTotal(c)?o.push.apply(o,c.exprs):t.Selector.isScopeIdentity(c)?o.push(c.expr):debug.assertNever(c)}if(0!==o.length){for(var p=[],d=0,h=r;d<h.length;d++){var m=h[d],v=i.indexOfExpr(o,m.expr);if(!(v<0)&&(o.splice(v,1),p.push(m.name),0===o.length))break}if(!(o.length>0||0===p.length))return p}}function f(e,t,r){for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a];i.push.apply(i,e[o])}var s=_.filter(r,function(e){return _.includes(i,e.name)});return _.map(s,function(e){return e.expr})}function h(e,t){var r=e.metadata;if(!r)return!0;for(var i=0,a=t;i<a.length;i++){if(a[i].name===r)return!0}}a.extend=o,a.needsToExtend=s,a.matchesAnyCondition=l,a.getScopeRefs=d}(o=t.DataBoundObjectQueryExtender||(t.DataBoundObjectQueryExtender={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e,t,i){var a=t[i];if(a){var n=a.all();return _.filter(_.map(n,function(t){return r(e,t)}),function(e){return e})}}function r(e,t){if(t){var r=e.select().withName(t.queryRef);return r?r.expr:void 0}}e.tryGetExprs=t,e.tryGetExprByProjection=r}(t=e.ProjectionUtils||(e.ProjectionUtils={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(t,r,a,n){var o=e.ProjectionUtils.tryGetExprs(r,a,n);if(_.isEmpty(o))return!1;if(!(o[0]instanceof e.SQHierarchyLevelExpr))return!1;var s=o[0];if(1!==e.SQExprGroupUtils.groupExprs(t,o).length)return!1;var u=e.SQExprConverter.asFieldPattern(s,t),c=e.SQHierarchyExprUtils.getConceptualHierarchyLevelFromExpr(t,u),l=c&&c.column;if(!l)return!1;var p=l.type;if(!p.temporal||!p.temporal.year)return!1;if(!i(o[0],t))return!1;var d=a[n],f=d.getLastActiveQueryReference();if(f){var h=d.all(),m=_.findIndex(h,function(e){return e.queryRef===f});if(m===-1)return!1;for(var v=0;v<m;v++)if(!_.includes(d.activeProjectionRefs,h[v].queryRef))return!1}return!0}function i(t,r){if(t){t=e.VariationRewriter.run(t,r);var i=t.getTargetEntity();if(i){var a=e.SQExprUtils.getConceptualEntity(i,r),n=_.filter(a.properties,function(e){return e.type.temporal&&e.type.temporal.paddedDateTableDate});return 1===n.length?e.SQExprBuilder.columnRef(i,n[0].name):void 0}}}t.isScalarKeySupportedForRole=r,t.getScalarKeyExpr=i}(t=e.ScalarKeyUtils||(e.ScalarKeyUtils={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i;!function(r){function i(e){var r=[];p(e.from(),r);var i,n=s(e.where(),I.create),o=e.transforms();if(!_.isEmpty(o)){i=[];for(var u=0,c=o;u<c.length;u++){var l=c[u],d=_.map(l.input.parameters,function(e){return I.createNamed(e)}),f={Name:l.name,Algorithm:l.algorithm,Input:{Parameters:d},Output:void 0};if(l.input.table){var h=g(l.input.table.columns);f.Input.Table={Name:l.input.table.name,Columns:h}}if(l.output&&l.output.table){var m=g(l.output.table.columns);f.Output={Table:{Name:l.output.table.name,Columns:m}}}i.push(f)}}for(var v=a(e.orderBy(),!1),y=[],S=e.select(),C=0,x=S.length;C<x;C++)y.push(I.createNamed(S[C]));var D,E=e.groupBy();if(E&&E.length){D=[];for(var C=0,x=E.length;C<x;C++)D.push(I.createNamed(E[C]))}var w={Version:t.SemanticQueryVersions.Version2,From:r,Select:y};return n&&(w.Where=n),i&&(w.Transform=i),v&&(w.OrderBy=v),D&&(w.GroupBy=D),e.top()&&(w.Top=e.top()),w}function a(e,t){var r;if(e&&e.length){r=[];for(var i=0,a=e.length;i<a;i++){var n=e[i];r.push({Direction:n.direction,Expression:t?I.createStandalone(n.expr):I.create(n.expr)})}}return r}function n(e){var t;try{t=u(e)}catch(e){}if(t&&!o(t))return t}function o(e){for(var t=0,r=e.select();t<r.length;t++){if(!r[t].expr)return!0}return!1}function s(e,t){var r;if(!_.isEmpty(e)){r=[];for(var i=0,a=e;i<a.length;i++){var n=a[i],o={Condition:t(n.condition)};_.isEmpty(n.target)||(o.Target=_.map(n.target,t)),r.push(o)}}return r}function u(e){var r=e.Version?e.Version:t.SemanticQueryVersions.Version0,i=r<t.SemanticQueryVersions.Version1,a=w.from(e.From),n=new t.SemanticQueryBuilder(a),o=e.Where;if(o)for(var s=0,u=o.length;s<u;s++){var c=w.filter(o[s],a);c&&(i&&(c=M.Upgrade(r,c)),n.addWhere(c))}var l=e.Transform,p=a;if(!_.isEmpty(l)){for(var d={},f=a.keys(),h=0,m=f;h<m.length;h++){var v=m[h];d[v]=a.source(v)}for(var s=0,u=l.length;s<u;s++){if(l[s].Input&&l[s].Input.Table){var y=l[s].Input.Table.Name;d[y]=new C((void 0),y)}if(l[s].Output&&l[s].Output.Table){var y=l[s].Output.Table.Name;d[y]=new C((void 0),y)}}p=new t.SQFrom(d);for(var s=0,u=l.length;s<u;s++)n.addTransform(w.transform(l[s],p))}var g=e.OrderBy;if(g)for(var s=0,u=g.length;s<u;s++)n.addOrderBy(w.sort(g[s],a));for(var S=e.Select,x={},s=0,u=S.length;s<u;s++)n.addSelect(w.select(S[s],x,p));var D=e.GroupBy;if(D)for(var E={},s=0,u=D.length;s<u;s++)n.addGroupBy(w.groupBy(D[s],E,a));return e.Top&&n.setTop(e.Top),n.toQuery()}function c(e,t){return _.isEmpty(e)?[]:_.map(e,function(e){return w.sort(e,t)})}function l(e){var r=[];p(e.from(),r);var i=s(e.where(),I.create);return{Version:t.SemanticQueryVersions.Version2,From:r,Where:i}}function p(e,t){for(var r=e.keys(),i=new E(e),a=0,n=r.length;a<n;a++)t.push(e.source(r[a]).accept(i,a))}function d(e){return w.from(e)}function f(e,r){for(var i=e.Version?e.Version:t.SemanticQueryVersions.Version0,a=i<t.SemanticQueryVersions.Version1,n=w.from(e.From),o=new t.SemanticQueryBuilder(n),s=e.Where,u=0,c=s.length;u<c;u++){var l=w.filter(s[u],n);l?(a&&(l=M.Upgrade(i,l)),o.addWhere(l)):r&&(_.isEmpty(r.RemovedIndexes)&&(r.RemovedIndexes=[]),r.RemovedIndexes.push(u))}return o.toFilter()}function h(e){return I.createStandalone(e)}function m(e){return I.create(e)}function v(e){return b.createStandalone(e)}function y(e,t){return b.create(e,t)}function g(e){return _.map(e,function(e){var t={Expression:I.createNamed(e.expression)};return e.role&&(t.Role=e.role),t})}var S=e.data.FilterKindDetector,C=e.data.SQFromEntitySource,x=e.data.SQFromSubquerySource,D=jsCommon.StringExtensions;r.serializeQuery=i,r.serializeSortDefinitions=a,r.tryDeserializeQuery=n,r.deserializeQuery=u,r.deserializeSortDefinitions=c,r.serializeFilter=l,r.serializeFrom=p,r.deserializeFrom=d;var E=function(){function e(e){this.from=e}return e.prototype.visitEntity=function(e,t){return{Name:this.from.keys()[t],Entity:e.entity,Schema:e.schema}},e.prototype.visitSubquery=function(e,t){return{Name:this.from.keys()[t],Expression:{Subquery:{Query:r.serializeQuery(e.subquery)}},Type:2}},e.prototype.visitExpr=function(e,t){return{Name:this.from.keys()[t],Expression:r.serializeExpr(e.expr),Type:2}},e}();r.SQFromSourceSerializer=E,r.deserializeFilter=f,r.serializeExpr=h,r.serializeExprWithRef=m,r.deserializeExpr=v,r.deserializeExprWithRef=y;var w;!function(e){function r(e){for(var r={},i=0,a=e.length;i<a;i++){var n=e[i];switch(n.Type){case 2:n.Expression.Subquery?r[n.Name]=new x(u(n.Expression.Subquery.Query)):r[n.Name]=new t.SQFromExprSource(b.createFromSourceExpression(n.Expression));break;default:r[n.Name]=new C(n.Schema,n.Entity)}}return new t.SQFrom(r)}function i(e,t){var r=t?b.create(e.Condition,t):b.createStandalone(e.Condition);if(r){var i={condition:r};if(e.Target){i.target=[];for(var a=0,n=e.Target;a<n.length;a++){var o=n[a],s=t?b.create(o,t):b.createStandalone(o);if(!s)return;i.target.push(s)}}return i}}function a(e,t){return{direction:e.Direction,expr:b.create(e.Expression,t)}}function n(t,r,i){return e.toNamedQueryExpression(t,r,i)}function o(t,r,i){return e.toNamedQueryExpression(t,r,i)}function s(t,r){var i=_.map(t.Input.Parameters,function(t){return e.toNamedQueryExpression(t,{},r)}),a={name:t.Name,algorithm:t.Algorithm,input:{parameters:i},output:{}};if(t.Input.Table){var n=l(t.Input.Table.Columns,r);a.input.table={name:t.Input.Table.Name,columns:n}}if(t.Output&&t.Output.Table){var o=l(t.Output.Table.Columns,r);a.output.table={name:t.Output.Table.Name,columns:o}}return a}function c(e,r,i){var a=b.create(e,i),n=e.Name||D.findUniqueName(r,t.SQExprUtils.defaultName(a));return r[n]=!0,{name:n,expr:a}}function l(t,r){var i={};return _.map(t,function(t){return{role:t.Role,expression:e.toNamedQueryExpression(t.Expression,i,r)}})}e.from=r,e.filter=i,e.sort=a,e.select=n,e.groupBy=o,e.transform=s,e.toNamedQueryExpression=c}(w||(w={}));var b,I=function(){function e(e){this.standalone=e}return e.create=function(t){return t.accept(e.instance)},e.createNamed=function(t){var r=t.expr.accept(e.instance);return t.name&&(r.Name=t.name),r},e.createStandalone=function(t){return t.accept(e.standaloneInstance)},e.prototype.visitColumnRef=function(e){return{Column:{Expression:e.source.accept(this),Property:e.ref}}},e.prototype.visitMeasureRef=function(e){return{Measure:{Expression:e.source.accept(this),Property:e.ref}}},e.prototype.visitNativeMeasure=function(e){var t={Language:e.language,Expression:e.expression,DataType:e.dataType};e.proposedName&&(t.ProposedName=e.proposedName),e.format&&(t.Format=e.format);var r=e.expressionContentCache;return!r||!r.dependencies&&null==r.unrecognizedIdentifiers?{NativeMeasure:t}:(t.ExpressionContentCache={},r.dependencies&&(t.ExpressionContentCache.Dependencies=this.serializeAll(r.dependencies)),null!=r.unrecognizedIdentifiers&&(t.ExpressionContentCache.UnrecognizedIdentifiers=r.unrecognizedIdentifiers),{NativeMeasure:t})},e.prototype.visitNativeColumn=function(e){var t={Language:e.language,Expression:e.expression,DataType:e.dataType,Source:e.source.accept(this)};e.proposedName&&(t.ProposedName=e.proposedName),e.format&&(t.Format=e.format);var r=e.expressionContentCache;return!r||!r.dependencies&&null==r.unrecognizedIdentifiers?{NativeColumn:t}:(t.ExpressionContentCache={},r.dependencies&&(t.ExpressionContentCache.Dependencies=this.serializeAll(r.dependencies)),null!=r.unrecognizedIdentifiers&&(t.ExpressionContentCache.UnrecognizedIdentifiers=r.unrecognizedIdentifiers),{NativeColumn:t})},e.prototype.visitAggr=function(e){return{Aggregation:{Expression:e.arg.accept(this),Function:e.func}}},e.prototype.visitPercentile=function(e){var t={Percentile:{Expression:e.arg.accept(this),K:e.k}};return e.exclusive&&(t.Percentile.Exclusive=e.exclusive),t},e.prototype.visitRangePercent=function(e){return{RangePercent:{Min:e.min.accept(this),Max:e.max.accept(this),Percent:e.percent}}},e.prototype.visitHierarchy=function(e){return{Hierarchy:{Expression:e.arg.accept(this),Hierarchy:e.hierarchy}}},e.prototype.visitPropertyVariationSource=function(e){var t=e.arg.accept(this),r=e.property,i=e.name;return{PropertyVariationSource:{Expression:{SourceRef:t.SourceRef},Name:i,Property:r}}},e.prototype.visitHierarchyLevel=function(e){return{HierarchyLevel:{Expression:e.arg.accept(this),Level:e.level}}},e.prototype.visitSelectRef=function(e){return{SelectRef:{ExpressionName:e.expressionName}}},e.prototype.visitBetween=function(e){return{Between:{Expression:e.arg.accept(this),LowerBound:e.lower.accept(this),UpperBound:e.upper.accept(this)}}},e.prototype.visitIn=function(e){var t=this.serializeAll(e.args),r=e.values;if(r){for(var i=[],a=0,n=r.length;a<n;a++)i.push(this.serializeAll(r[a]));return{In:{Expressions:t,Values:i}}}return{In:{Expressions:this.serializeAll(e.args),Table:e.table.accept(this)}}},e.prototype.visitEntity=function(e){var t;if(this.standalone){t={Schema:e.schema,Entity:e.entity}}else t={Source:e.variable};return{SourceRef:t}},e.prototype.visitSubqueryRef=function(e){return{SourceRef:{Source:e.variable}}},e.prototype.visitNamedQueryRef=function(e){return this.standalone?{NamedQueryReference:{Name:e.queryName}}:{SourceRef:{Source:e.variable}}},e.prototype.visitAnd=function(e){return{And:{Left:e.left.accept(this),Right:e.right.accept(this)}}},e.prototype.visitOr=function(e){return{Or:{Left:e.left.accept(this),Right:e.right.accept(this)}}},e.prototype.visitCompare=function(e){return{Comparison:{ComparisonKind:e.comparison,Left:e.left.accept(this),Right:e.right.accept(this)}}},e.prototype.visitConditional=function(e){var t=this,r={Conditional:{Cases:_.map(e.cases,function(e){return t.visitCase(e)})}},i=e.defaultValue;return i&&(r.Conditional.DefaultValue=i.accept(this)),r},e.prototype.visitCase=function(e){return{Condition:e.condition.accept(this),Value:e.value.accept(this)}},e.prototype.visitContains=function(e){return{Contains:{Left:e.left.accept(this),Right:e.right.accept(this)}}},e.prototype.visitDateAdd=function(e){return{DateAdd:{Expression:e.arg.accept(this),Amount:e.amount,TimeUnit:e.unit}}},e.prototype.visitDateSpan=function(e){return{DateSpan:{Expression:e.arg.accept(this),TimeUnit:e.unit}}},e.prototype.visitExists=function(e){return{Exists:{Expression:e.arg.accept(this)}}},e.prototype.visitNot=function(e){return{Not:{Expression:e.arg.accept(this)}}},e.prototype.visitNow=function(e){return{Now:{}}},e.prototype.visitDefaultValue=function(e){return{DefaultValue:{}}},e.prototype.visitAnyValue=function(e){var t={};return null!=e.defaultValueOverridesAncestors&&(t.DefaultValueOverridesAncestors=e.defaultValueOverridesAncestors),{AnyValue:t}},e.prototype.visitFillRule=function(e){var t={},r=e.rule;return r.linearGradient2&&(t.linearGradient2=this.visitLinearGradient2(r.linearGradient2)),r.linearGradient3&&(t.linearGradient3=this.visitLinearGradient3(r.linearGradient3)),{FillRule:{Input:e.input.accept(this),FillRule:t}}},e.prototype.visitLinearGradient2=function(e){var t={min:this.visitRuleStop(e.min),max:this.visitRuleStop(e.max)},r=this.visitNullColoringStrategy(e.nullColoringStrategy);return r&&(t.nullColoringStrategy=r),t},e.prototype.visitLinearGradient3=function(e){var t={min:this.visitRuleStop(e.min),mid:this.visitRuleStop(e.mid),max:this.visitRuleStop(e.max)},r=this.visitNullColoringStrategy(e.nullColoringStrategy);return r&&(t.nullColoringStrategy=r),t},e.prototype.visitRuleStop=function(e){var t={color:e.color.accept(this)};return e.value&&(t.value=e.value.accept(this)),t},e.prototype.visitNullColoringStrategy=function(e){if(e){var t={strategy:e.strategy.accept(this)};return e.color&&(t.color=e.color.accept(this)),t}},e.prototype.visitThemeDataColor=function(e){return{ThemeDataColor:{ColorId:e.colorId,Percent:e.percent}}},e.prototype.visitStartsWith=function(e){return{StartsWith:{Left:e.left.accept(this),Right:e.right.accept(this)}}},e.prototype.visitGroupRef=function(e){var t=this;return{GroupRef:{Expression:e.source.accept(this),Property:e.ref,GroupedColumns:_.map(e.groupedExprs,function(e){return e.accept(t)})}}},e.prototype.visitConstant=function(e){switch(e.type.primitiveType){case 5:case 7:case 2:case 4:case 3:case 0:case 1:return{Literal:{Value:e.valueEncoded}}}},e.prototype.visitArithmetic=function(e){return{Arithmetic:{Left:e.left.accept(this),Right:e.right.accept(this),Operator:e.operator}}},e.prototype.visitFloor=function(e){var t={Floor:{Expression:e.arg.accept(this),Size:e.size}};return null!=e.timeUnit&&(t.Floor.TimeUnit=e.timeUnit),t},e.prototype.visitResourcePackageItem=function(e){return{ResourcePackageItem:{PackageName:e.packageName,PackageType:e.packageType,ItemName:e.itemName}}},e.prototype.visitScopedEval=function(e){return{ScopedEval:{Expression:e.expression.accept(this),Scope:this.serializeAll(e.scope)}}},e.prototype.visitFilteredEval=function(t){return{FilteredEval:{Expression:t.expression.accept(this),Filters:s(t.filters,this.standalone?e.createStandalone:e.create)}}},e.prototype.visitWithRef=function(e){return{WithRef:{ExpressionName:e.expressionName}}},e.prototype.visitTransformTableRef=function(e){return{TransformTableRef:{Source:e.source}}},e.prototype.visitTransformOutputRoleRef=function(e){return{TransformOutputRoleRef:{Role:e.role,Transform:e.transform}}},e.prototype.visitRoleRef=function(e){return{RoleRef:{Role:e.role}}},e.prototype.visitAllRolesRef=function(e){return{AllRolesRef:{}}},e.prototype.visitDiscretize=function(e){return{Discretize:{Expression:e.source.accept(this),Count:e.count}}},e.prototype.visitMember=function(e){return{Member:{Expression:e.source.accept(this),Member:e.member}}},e.prototype.serializeAll=function(e){for(var t=[],r=0,i=e.length;r<i;r++)t.push(e[r].accept(this));return t},e.instance=new e,e.standaloneInstance=new e((!0)),e}(),M=function(){function e(){}return e.Upgrade=function(e,r){if(!r)return null;if(!r.condition)return null;var i=S.run(r.condition);return e===t.SemanticQueryVersions.Version0&&2!==i?{condition:r.condition}:r},e}();!function(e){function r(e,t){return d(e.Column,t)||v(e.Measure,t)||y(e.NativeMeasure,t)||g(e.NativeColumn,t)||s(e.SourceRef,t)||D(e.Aggregation,t)||S(e.SelectRef,t)||C(e.Percentile,t)||x(e.RangePercent,t)||u(e.Arithmetic,t)||c(e.Floor,t)||l(e.Discretize,t)||p(e.Member,t)||h(e.Hierarchy,t)||m(e.HierarchyLevel,t)||f(e.PropertyVariationSource,t)||E(e.And,t)||b(e.Between,t)||I(e.In,t)||M(e.Or,t)||V(e.Contains,t)||R(e.Comparison,t)||T(e.Conditional,t)||N(e.DateAdd,t)||A(e.DateSpan,t)||F(e.Exists,t)||Q(e.Not,t)||B(e.Now)||z(e.DefaultValue)||q(e.AnyValue)||k(e.StartsWith,t)||G(e.FillRule,t)||K(e.ThemeDataColor)||j(e.ResourcePackageItem,t)||L(e.ScopedEval,t)||O(e.FilteredEval,t)||W(e.WithRef,t)||U(e.TransformTableRef,t)||H(e.TransformOutputRoleRef,t)||oe(e.Literal)||se(e.GroupRef,t)||ue(e.RoleRef)||ce(e.AllRolesRef)||le(e.NamedQueryReference)||n(e);
}function i(e){return r(e,null)}function a(e,t){for(var i=[],a=0,n=e.length;a<n;a++)i.push(r(e[a],t));return i}function n(e){return Z(e.Boolean)||X(e.DateTime)||$(e.DateTimeSecond)||X(e.Date)||ee(e.Decimal)||te(e.Integer)||re(e.Null)||ie(e.Number)||ae(e.String)}function o(e){return i(e)}function s(e,r){if(e){if(!r){var i=e;return t.SQExprBuilder.entity(i.Schema,i.Entity)}var a=e,n=a.Source,o=r.source(n);return o?t.isSQFromEntitySource(o)?t.SQExprBuilder.entity(o.schema,o.entity,n):t.isSQFromSubquerySource(o)?t.SQExprBuilder.subqueryRef(n):o.expr.as(n):void 0}}function u(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.arithmetic(a,n,e.Operator)}}function c(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.floor(a,e.Size,e.TimeUnit)}}function l(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.discretize(a,e.Count)}}function p(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.member(a,e.Member)}}function d(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.columnRef(a,e.Property)}}function f(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.propertyVariationSource(a,e.Name,e.Property)}}function h(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.hierarchy(a,e.Hierarchy)}}function m(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.hierarchyLevel(a,e.Level)}}function v(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.measureRef(a,e.Property)}}function y(e,r){if(e){var i=void 0;return e.ExpressionContentCache&&(i={unrecognizedIdentifiers:e.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:a(e.ExpressionContentCache.Dependencies)}),"dax"!==e.Language,t.SQExprBuilder.nativeMeasure(e.Language,e.Expression,e.DataType,e.ProposedName,i,e.Format)}}function g(e,i){if(e){var n=void 0;if(e.ExpressionContentCache&&(n={unrecognizedIdentifiers:e.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:a(e.ExpressionContentCache.Dependencies)}),"dax"!==e.Language)return;if(!e.Source)return;var o=r(e.Source,i);return t.SQExprBuilder.nativeColumn(e.Language,e.Expression,e.DataType,o,e.ProposedName,n,e.Format)}}function S(e,r){if(e)return t.SQExprBuilder.selectRef(e.ExpressionName)}function C(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.percentile(a,e.K,e.Exclusive||!1)}}function x(e,i){if(e){var a=r(e.Min,i),n=r(e.Max,i);if(a&&n)return t.SQExprBuilder.rangePercent(a,n,e.Percent)}}function D(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.aggregate(a,e.Function)}}function E(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.and(a,n)}}function b(e,i){if(e){var a=r(e.Expression,i),n=r(e.LowerBound,i),o=r(e.UpperBound,i);if(a&&n&&o)return t.SQExprBuilder.between(a,n,o)}}function I(e,i){if(e){if(e.Values)return t.SQExprBuilder.inValues(a(e.Expressions,i),_.map(e.Values,function(e){return a(e,i)}));var n=r(e.Table,i);if(n)return t.SQExprBuilder.inTable(a(e.Expressions,i),n)}}function M(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.or(a,n)}}function V(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.contains(a,n)}}function R(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.compare(e.ComparisonKind,a,n)}}function T(e,i){if(e){for(var a=e.Cases,n=a.length,o=new Array(n),s=0;s<n;s++){var u=P(a[s]);if(!u){o=void 0;break}o[s]=u}if(e.DefaultValue){var c=r(e.DefaultValue);if(o&&c)return t.SQExprBuilder.conditional(o,c)}else if(o)return t.SQExprBuilder.conditional(o)}}function P(e){if(e){var t=r(e.Condition),i=r(e.Value);if(t&&i)return{condition:t,value:i}}}function N(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.dateAdd(e.TimeUnit,e.Amount,a)}}function A(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.dateSpan(e.TimeUnit,a)}}function F(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.exists(a)}}function Q(e,i){if(e){var a=r(e.Expression,i);if(a)return t.SQExprBuilder.not(a)}}function B(e){if(e)return t.SQExprBuilder.now()}function z(e){if(e)return t.SQExprBuilder.defaultValue()}function q(e){if(e)return t.SQExprBuilder.anyValue(e.DefaultValueOverridesAncestors)}function k(e,i){if(e){var a=r(e.Left,i),n=r(e.Right,i);if(a&&n)return t.SQExprBuilder.startsWith(a,n)}}function G(e,i){if(e){var a=r(e.Input,i),n=e.FillRule,o={},s=n.linearGradient2,u=n.linearGradient3;if(s){o.linearGradient2={min:J(s.min,i),max:J(s.max,i)};var c=Y(s.nullColoringStrategy,i);c&&(o.linearGradient2.nullColoringStrategy=c)}else if(u){o.linearGradient3={min:J(u.min,i),mid:J(u.mid,i),max:J(u.max,i)};var c=Y(u.nullColoringStrategy,i);c&&(o.linearGradient3.nullColoringStrategy=c)}return t.SQExprBuilder.fillRule(a,o)}}function K(e){if(e)return t.SQExprBuilder.themeDataColor(e.ColorId,e.Percent)}function j(e,r){if(e)return t.SQExprBuilder.resourcePackageItem(e.PackageName,e.PackageType,e.ItemName)}function L(e,i){if(e){var n=r(e.Expression,i);if(n)return t.SQExprBuilder.scopedEval(n,a(e.Scope,i))}}function O(e,i){if(e){var a=r(e.Expression,i);return t.SQExprBuilder.filteredEval(a,_.map(e.Filters,function(e){return w.filter(e,i)}))}}function W(e,r){if(e)return t.SQExprBuilder.withRef(e.ExpressionName)}function U(e,r){if(e)return t.SQExprBuilder.transformTableRef(e.Source)}function H(e,r){if(e)return t.SQExprBuilder.transformOutputRoleRef(e.Role,e.Transform)}function J(e,t){if(e){var i={color:r(e.color,t)};return e.value&&(i.value=r(e.value,t)),i}}function Y(e,t){if(e){var i={strategy:r(e.strategy,t)};return e.color&&(i.color=r(e.color,t)),i}}function Z(e){if(e)return t.SQExprBuilder.boolean(e.Value)}function X(e){if(e){var r=ne(e);if(r)return t.SQExprBuilder.dateTime(r)}}function $(e){if(e){var r=ne(e);return t.SQExprBuilder.dateSpan(5,t.SQExprBuilder.dateTime(r))}}function ee(e){if(e){var r=e.Value;return t.SQExprBuilder.decimal(r)}}function te(e){if(e){var r=e.Value;return t.SQExprBuilder.integer(r)}}function re(e){if(e)return t.SQExprBuilder.nullConstant()}function ie(e){if(e)return t.PrimitiveValueEncoding.parseValueToSQExpr(e.Value)}function ae(e){if(e){var r=e.Value;return t.SQExprBuilder.text(r)}}function ne(e){return jsCommon.DateExtensions.tryDeserializeDate(e.Value)}function oe(e){if(e)return t.PrimitiveValueEncoding.parseValueToSQExpr(e.Value)}function se(i,a){if(i){var n=r(i.Expression,a),o=_.map(i.GroupedColumns,function(t){return e.create(t,a)});if(n&&!_.isEmpty(o))return t.SQExprBuilder.groupRef(i.Property,n,o)}}function ue(e){if(e)return t.SQExprBuilder.roleRef(e.Role)}function ce(e){if(e)return t.SQExprBuilder.allRolesRef()}function le(e){if(e)return t.SQExprBuilder.namedQueryRef(e.Name)}e.create=r,e.createStandalone=i,e.createConst=n,e.createFromSourceExpression=o}(b||(b={}))}(i=r.SemanticQuerySerializer||(r.SemanticQuerySerializer={}))}(r=t.services||(t.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){t.Forecast={name:"Forecast",inputRoles:[{name:"X",visualDataRoleMatching:{cartesianKind:0}},{name:"Y",visualDataRoleMatching:{cartesianKind:1}}],outputRoles:[{name:"forecast.ForecastValue",algorithmRole:"Forecast",columnName:"forecastValue",kind:e.VisualDataRoleKind.Measure},{name:"forecast.ConfidenceHighBound",algorithmRole:"UpperBound",columnName:"confidenceHighBound",kind:e.VisualDataRoleKind.Measure},{name:"forecast.ConfidenceLowBound",algorithmRole:"LowerBound",columnName:"confidenceLowBound",kind:e.VisualDataRoleKind.Measure}]},t.KMeansClustering={name:"KMeansClustering",inputRoles:[{name:"Attribute",visualDataRoleMatching:{matchMeasure:!0,skipJoinPredicateNone:!0}},{name:"Item",visualDataRoleMatching:{matchGrouping:!0}}],outputRoles:[{name:"Series",algorithmRole:"ClusterId",columnName:"clusterId",kind:e.VisualDataRoleKind.Grouping}]},t.SpatialClustering={name:"SpatialClustering",inputRoles:[{name:"Attribute",visualDataRoleMatching:{matchMeasure:!0,skipJoinPredicateNone:!0}},{name:"Item",visualDataRoleMatching:{matchGrouping:!0}}],outputRoles:[{name:"Series",algorithmRole:"ClusterId",columnName:"clusterId",kind:e.VisualDataRoleKind.Grouping}]}}(r=t.plugins||(t.plugins={}))}(r=t.transforms||(t.transforms={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){function r(){return new i}t.createTransformPluginService=r;var i=function(){function t(){this.plugins=e.data.transforms.plugins}return t.prototype.getTransformPlugin=function(e){if(e)return this.plugins[e]},t}()}(r=t.transforms||(t.transforms={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r=e.data.DefaultSQExprVisitorWithArg,i=e.data.SQExprBuilder,a=e.data.SQHierarchyExpr,n=e.data.SQPropertyVariationSourceExpr,o=(e.data.SQEntityExpr,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitColumnRef=function(e,t){if(e.hasGroupOnKeys(t)){var r=e.getConceptualProperty(t),a=e.getTargetEntity();return _.map(r.column.keys,function(e){return i.columnRef(a,e.name)})}return[e]},t.prototype.visitHierarchyLevel=function(e,t){var r=e.arg.getTargetEntity();if(!r)return[e];if(e.arg instanceof a){var o=void 0,s=r.schema,u=e.arg;if(u.arg instanceof n){var c=u.arg,l=t.schema(s).findTargetEntityOfVariation(r.entity,c.property,c.name);if(!l)return[e];o=i.entity(s,l.name)}else o=r;var p=t.schema(s).findHierarchyLevel(o.entity,u.hierarchy,e.level),d=p.column.name;return this.visitColumnRef(i.columnRef(o,d),t)}return[e]},t.prototype.visitDefault=function(e){return[e]},t}(r));t.SelectToIdentityExpressionsVisitor=o}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(e,t){var r=e.length;if(1===r)return{mapping:e[0]};for(var n,o=[],s=e[0].updateType,u=0;u<r;u++){var c=e[u];if(s=i(c.updateType,s),!c.categorical)return;0===u&&(n={metadata:c.metadata,categorical:{}}),a.mergeCategorical(n.categorical,c.categorical),o.push(a.createSplit(t,c.categorical))}return n.updateType=s,{mapping:n,splits:o}}function i(e,t){return null===e||0===e||null===t||0===t?0:e===t?e:1===e||1===t?1:2}t.mergeMappings=r;var a;!function(t){function r(e,t){if(t.categories)if(e.categories){i(e,t)}else e.categories=t.categories;if(null!=t.dataVolume||null!=e.dataVolume){var r=Math.max(t.dataVolume||0,e.dataVolume||0);t.dataVolume=e.dataVolume=r}if(t.dataReductionAlgorithm)if(e.dataReductionAlgorithm){a(t.dataReductionAlgorithm,e.dataReductionAlgorithm)}else e.dataReductionAlgorithm=t.dataReductionAlgorithm;if(t.values){var s=e.values;s||(s=e.values={});var u=t.values,c=u.group;if(n(s,u),o(s,u.select),c){var l=e.values.group;l?o(l,c.select):e.values.group={select:c.select.concat([]),by:c.by,dataReductionAlgorithm:c.dataReductionAlgorithm}}}}function i(e,t){if(!e&&!t)return!0;if(e&&t){if(!e.categories&&!t.categories)return!0;if(e.categories&&t.categories){var r=e.categories,i=t.categories;if(!a(r.dataReductionAlgorithm,i.dataReductionAlgorithm))return!1;var n=r,o=i;if(n.bind||o.bind)return _.isEqual(n.bind,o.bind);var s=r,u=i;if(s.for||u.for)return _.isEqual(s.for,u.for);var c=r,l=i;return!c.select&&!l.select||_.isEqual(c.select,l.select)}}return!1}function a(e,t){return!e||!t||_.isEqual(e,t)}function n(e,t){(t.bind||t.for)&&(e.select||(e.select=[]),e.select.push(t))}function o(e,t){var r;t&&(e.select||(e.select=[]),(r=e.select).push.apply(r,t))}function s(t,r){var i={selects:{}},a={visitRole:function(e){return u(i,t,e)}};return e.CompiledDataViewMapping.visitCategoricalCategories(r.categories,a),e.CompiledDataViewMapping.visitGrouped(r.values,a),e.CompiledDataViewMapping.visitCategoricalValues(r.values,a),i}function u(e,t,r){var i=r.items;if(!_.isEmpty(r.items))for(var a=[],n=0,o=i;n<o.length;n++){var s=o[n],u=s.queryName,c=t[u];a[c]||(e.selects[c]=!0,a[c]=!0)}}t.mergeCategorical=r,t.createSplit=s}(a||(a={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){e[e.None=0]="None",e[e.AllowCache=1]="AllowCache",e[e.AllowQuery=2]="AllowQuery",e[e.CacheResult=4]="CacheResult",e[e.PreventRefresh=8]="PreventRefresh"}(t=e.QueryCacheOptions||(e.QueryCacheOptions={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i;!function(r){function i(e,r){var i=n(e,r);if(i)return t.PrimitiveValueEncoding.parseValue(i.Value)}function a(e,r){var i=n(e,r);if(i)return t.PrimitiveValueEncoding.parseValueToSQExpr(i.Value)}function n(e,t){for(var r=0,i=e.length;r<i;r++){var a=e[r];if(a.Id===t)return a}}function o(t,r){t=t||0;var i=0;switch(t){case 2048:i=1;break;case 1:i=3;break;case 3:i=4;break;case 4096:i=5;break;case 20:i=6;break;case 4:i=7;break;case 8:i=9;break;case 67:i=4,r="Years";break;case 35:i=4,r="Months"}return e.ValueType.fromPrimitiveTypeAndCategory(i,r)}function s(e,t){var i=e.SecondaryHierarchy;return i?t&&t.Secondary?r.getDynamicMember(i,t.Secondary.Groupings,0):r.getDynamicMemberFallback(i):null}function u(e,t,i){var a=e.PrimaryHierarchy;if(!a)return null;var n;return i&&(n=void 0!==e.Calculations),t&&t.Primary?r.getDynamicMember(a,t.Primary.Groupings,0,n):r.getDynamicMemberFallback(a,n)}function c(e,t,i,a){if(0===e.length)return null;if(!t||0===t.length)return r.getDynamicMemberFallback(e,a);var n=t[i].Member;if(!n)return r.getDynamicMemberFallback(e,a);for(var o=0,s=e;o<s.length;o++){var u=s[o];if(u.Id===n)return u}return null}function l(e,t){return 2===e.length?e[1]:void 0===t||t===!0?e[0]:null}function p(e,t,r){void 0===r&&(r=!0);var i=t.source.aggregates;switch(i||(t.source.aggregates=i={}),t.aggregateKind){case 1:return void(i.subtotal=e);case 2:return void(i.max=e);case 3:return void(i.min=e);case 4:return void(r||(i.single=e));case 5:return void(i.count=e);case 6:return void(i.average=e);case 8:return void(i.median=e);case 7:var a=t.aggregate.Percentile,n=i.percentiles;n||(n=i.percentiles=[]);var o={k:a.K,value:e};return null!=a.Exclusive&&(o.exclusive=a.Exclusive),void n.push(o)}}function d(e,t){void 0!==e.subtotal&&(t.subtotal=e.subtotal),void 0!==e.min&&(t.min=e.min),void 0!==e.max&&(t.max=e.max),void 0!==e.minLocal&&(t.minLocal=e.minLocal),void 0!==e.maxLocal&&(t.maxLocal=e.maxLocal),void 0!==e.count&&(t.count=e.count)}function f(e,t,r,i){return e+(i-t)*(r+1)}r.findAndParseCalculation=i,r.findAndParseCalculationToSQExpr=a,r.findCalculation=n,r.describeDataType=o,r.getTopLevelSecondaryDynamicMember=s,r.getTopLevelPrimaryDynamicMember=u,r.getDynamicMember=c,r.getDynamicMemberFallback=l,r.fillMetadataColumnAggregate=p,r.copyAggregates=d;var h=function(){function e(){}return Object.defineProperty(e.prototype,"name",{get:function(){return"maxLocal"},enumerable:!0,configurable:!0}),e.prototype.update=function(e){if("number"==typeof e&&!isNaN(e)){var t=this.current;this.current=void 0===t?e:Math.max(t,e)}},e.prototype.value=function(){return this.current},e}();r.MaxValueAggregator=h;var m=function(){function e(){}return Object.defineProperty(e.prototype,"name",{get:function(){return"minLocal"},enumerable:!0,configurable:!0}),e.prototype.update=function(e){if("number"==typeof e&&!isNaN(e)){var t=this.current;this.current=void 0===t?e:Math.min(t||0,e)}},e.prototype.value=function(){return this.current},e}();r.MinValueAggregator=m,r.computeAggIdx=f}(i=r.DataShapeUtility||(r.DataShapeUtility={}))}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t=e.ClientErrorStrings,r=jsCommon.StringExtensions;e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError="DMTS_MultipleGatewaysWithAllDatasourcesToBindError",e.DMTS_DatasourceHasNoCredentialError="DMTS_DatasourceHasNoCredentialError",e.DMTS_OAuthTokenRefreshFailedError="DMTS_OAuthTokenRefreshFailedError",e.DM_GWPipeline_Client_GatewayUnreachable="DM_GWPipeline_Client_GatewayUnreachable",e.DM_GWPipeline_Client_OAuthTokenRefreshFailedError="DM_GWPipeline_Client_OAuthTokenRefreshFailedError",e.DMTS_UserLostPermissionToDatasourceError="DMTS_UserLostPermissionToDatasourceError",e.DMTS_UserNotFoundInADGraphError="DMTS_UserNotFoundInADGraphError",e.DM_GWPipeline_Gateway_DataSourceAccessError="DM_GWPipeline_Gateway_DataSourceAccessError",e.DM_GWPipeline_Gateway_ImpersonationError="DM_GWPipeline_Gateway_ImpersonationError",e.DM_GWPipeline_Gateway_InvalidMashupConnectionString="DM_GWPipeline_Gateway_InvalidMashupConnectionString",e.DM_GWPipeline_Gateway_DatabaseLoginError="DM_GWPipeline_Gateway_DatabaseLoginError",e.DM_GWPipeline_Gateway_SqlTimeoutException="DM_GWPipeline_Gateway_SqlTimeoutException",e.DM_GWPipeline_Gateway_AdomdTimeoutException="DM_GWPipeline_Gateway_AdomdTimeoutException",e.DM_GWPipeline_Gateway_InvalidObjectNameException="DM_GWPipeline_Gateway_InvalidObjectNameException",e.DM_GWPipeline_Gateway_InvalidConnectionCredentials="DM_GWPipeline_Gateway_InvalidConnectionCredentials",e.DM_GWPipeline_Gateway_ConnectionBrokenException="DM_GWPipeline_Gateway_ConnectionBrokenException",e.DM_GWPipeline_Gateway_MemoryError="DM_GWPipeline_Gateway_MemoryError",e.DM_GWPipeline_Gateway_MissingStructureError="DM_GWPipeline_Gateway_MissingStructureError",e.DM_GWPipeline_Gateway_UnprocessedStructureError="DM_GWPipeline_Gateway_UnprocessedStructureError",e.DM_GWPipeline_Gateway_ModelLoadError="DM_GWPipeline_Gateway_ModelLoadError",e.DM_GWPipeline_Gateway_CancellationError="DM_GWPipeline_Gateway_CancellationError",e.DM_GWPipeline_Gateway_CancellationOrTimeoutError="DM_GWPipeline_Gateway_CancellationOrTimeoutError",e.DM_GWPipeline_Gateway_QueryExecutionError="DM_GWPipeline_Gateway_QueryExecutionError",e.DM_GWPipeline_Gateway_RecalculationRequiredError="DM_GWPipeline_Gateway_RecalculationRequiredError",e.DM_GWPipeline_Gateway_TimeoutError="DM_GWPipeline_Gateway_TimeoutError",e.DM_GWPipeline_Gateway_AdomdConnectError="DM_GWPipeline_Gateway_AdomdConnectError",e.DM_GWPipeline_Gateway_MashupDataAccessError="DM_GWPipeline_Gateway_MashupDataAccessError",e.DM_GWPipeline_Gateway_DatabaseConnectError="DM_GWPipeline_Gateway_DatabaseConnectError",e.DM_GWPipeline_Gateway_ServerUnreachable="DM_GWPipeline_Gateway_ServerUnreachable",e.RS_AccessDenied="rsAccessDenied",e.azureValues="azure:values",e.KnownDsrClientErrors={ComplexSlicerNotAllowedWithMeasures:{localizedContent:"DsrError_ComplexSlicerNotAllowedWithMeasuresValue"},ComplexHighlightsNotAllowed:{localizedContent:"DsrError_ComplexHighlightsNotAllowed_Details",localizedMessage:"DsrError_ComplexHighlightsNotAllowed_ShortMessage"},CouldNotResolveModelReferencesInSemanticQuery:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContent:"DsrError_CouldNotResolveModelRefErrorValNoItems",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelRefErrorValFormat",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690865"},ExclusivePercentileOutOfRange:{localizedMessage:"DsrError_ExclusivePercentileOutOfRangeMessage",localizedTitle:"DsrError_ExclusivePercentileOutOfRangeKey",localizedContent:"DsrError_ExclusivePercentileOutOfRangeValue"},InvalidDataShapeNoOutputData:{localizedContent:"DsrError_InvalidDataShapeValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690860"},InvalidUnconstrainedJoin:{localizedTitle:"DsrError_InvalidUnconstrainedJoinKey",localizedContent:"DsrError_InvalidUnconstrainedJoinValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690861"},IsRelatedToManyNotSupportedForDetailTable:{localizedMessage:"DsrError_IsRelatedToManyNotSupportedForDetailTableMessage",localizedTitle:"DsrError_IsRelatedToManyNotSupportedForDetailTableKey",localizedContent:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueFormat"},AA_PowerBIScriptPayloadTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746290"},AA_PowerBIScriptResultTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746291"},AA_PowerBIScriptReturnedNoImageError:{localizedMessage:"DsrError_ScriptReturnedNoImageMessage",localizedTitle:"DsrError_ScriptReturnedNoImageKey",localizedContent:"DsrError_ScriptReturnedNoImageContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733479"},AA_PowerBIScriptRuntimeErrorError:{localizedTitle:"DsrError_ScriptRuntimeErrorKey",localizedMessage:"DsrError_ScriptRuntimeErrorMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=733477"},AA_PowerBIScriptTimeoutError:{localizedMessage:"DsrError_ScriptTimeoutMessage",localizedTitle:"DsrError_ScriptTimeoutKey",localizedContent:"DsrError_ScriptTimeoutContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733478"},AA_PowerBIRequestsQueueOverflowError:{localizedTitle:"DsrError_RequestsQueueOverflowKey",localizedMessage:"DsrError_RequestsQueueOverflowMessage",localizedContent:"DsrError_RequestsQueueOverflowContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799576"},AA_PowerBIScriptRuntimeMaxMemoryError:{localizedTitle:"DsrError_ScriptRuntimeMaxMemoryKey",localizedMessage:"DsrError_ScriptRuntimeMaxMemoryMessage",localizedContent:"DsrError_ScriptRuntimeMaxMemoryContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799578"},AA_PowerBIScriptRuntimeMaxDiskIOError:{localizedTitle:"DsrError_ScriptRuntimeMaxDiskIOKey",localizedMessage:"DsrError_ScriptRuntimeMaxDiskIOMessage",localizedContent:"DsrError_ScriptRuntimeMaxDiskIOContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799579"},AA_PowerBIScriptMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeMissingDependencyMessage",localizedContent:"DsrError_ScriptRuntimeMissingDependencyContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799857"},AA_PowerBIScriptSpecificPackageWithMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799858"},AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799859"},AA_PowerBIScriptMissingSpecificPackageError:{localizedTitle:"DsrError_ScriptRuntimeMissingSpecificPackageKey",localizedMessage:"DsrError_ScriptRuntimeMissingSpecificPackageMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=800225"},ModelMeasuresNotSupportedForDetailTable:{localizedMessage:"DsrError_ModelMeasuresNotSupportedForDetailTableMessage",localizedTitle:"DsrError_ModelMeasuresNotSupportedForDetailTableKey",localizedContent:"DsrError_ModelMeasuresNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_ModelMeasuresNotSupportedForDetailTableValueFormat"},ModelUnavailable:{localizedContent:"DsrError_ModelUnavailableValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},NoUniqueKeyForDetailTable:{localizedContent:"DsrError_NoUniqueKeyForDetailTableValue"},OverlappingKeysOnOppositeHierarchies:{localizedTitle:"DsrError_OverlappingKeysKey",localizedContent:"DsrError_OverlappingKeysValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690863"},rsQueryMemoryLimitExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsQueryTimeoutExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsAccessDenied:{localizedMessage:"DsrError_NoPermissionMessage",localizedTitle:"DsrError_NoPermissionKey",localizedContent:"DsrError_NoAccessForVisual",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},UnsupportedDateTimeLiteral:{localizedMessage:"DsrError_UnsupportedDateTimeMessage",localizedTitle:"DsrError_UnsupportedDateTimeKey",localizedContent:"DsrError_UnsupportedDateTimeValueNoItems",localizedContentWithAffectedItems:"DsrError_UnsupportedDateTimeValueFormat"},InvalidExtensionDax_UnclosedBracketIdentifier:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedBracketIdentifier"},InvalidExtensionDax_UnexpectedCloseParenthesis:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnexpectedCloseParenthesis"},InvalidFilterComparisonIncompatibleExpressions:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},InvalidFilterConditionIncompatibleDataType:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},ExtensionMeasureEmptyExpression:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureEmptyExpression"},ExtensionMeasureNameNotUniqueModel:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUniqueModel"},ExtensionMeasureNameNotUnique:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUnique"},CouldNotResolveModelReferencesInQueryExtensionSchema:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelReferencesInQueryExtensionSchema"},QueryExtensionMeasureError:{localizedContentWithAffectedItemsAndPosition:"DsrError_QueryExtensionMeasureError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_QueryExtensionMeasureErrorWithDetails"},QueryExtensionMeasureUnexpectedEndOfUserInput:{localizedContentWithAffectedItems:"DsrError_QueryExtensionMeasureUnexpectedEndOfUserInput"},UnsupportedDataSourceVariables:{localizedMessage:"DsrError_UnsupportedDataSourceVariablesMessage",localizedTitle:"DsrError_UnsupportedDataSourceVariablesKey",localizedContent:"DsrError_UnsupportedDataSourceVariablesContent"},DataExtensionMissingResultSet:{localizedMessage:"DsrError_DataExtensionMissingResultSetMessage",localizedTitle:"DsrError_DataExtensionMissingResultSetKey",localizedContent:"DsrError_DataExtensionMissingResultSetContent"}};var i=function(){function i(e){this.oDataError=e,this.oDataCode=this.parseCode()}return Object.defineProperty(i,"maxNumberOfCommaValues",{get:function(){return 9},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"code",{get:function(){return this.oDataCode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"oDataErrorMessage",{get:function(){if(this.oDataError&&this.oDataError.message&&this.oDataError.message.value)return this.oDataError.message.value},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"source",{get:function(){switch(this.oDataError.source){case"PowerBI":return"PowerBI";case"External":return"External";case"Unknown":return;case"User":return i.isCodeKnown(this.code)?"User":void 0}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"AdditionalErrorMessages",{get:function(){if(this.oDataError){var t=this.oDataError[e.azureValues];if(!_.isEmpty(t))for(var r=0,i=t;r<i.length;r++){var a=i[r];if(!_.isEmpty(a.additionalMessages))return a.additionalMessages}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"powerBiErrorDetails",{get:function(){if(this.oDataError){var t=this.oDataError[e.azureValues];if(!_.isEmpty(t))for(var r=0,i=t;r<i.length;r++){var a=i[r];if(!_.isEmpty(a.powerBiErrorDetails))return a.powerBiErrorDetails}}},enumerable:!0,configurable:!0}),i.prototype.getDetails=function(t){var r=this.oDataError[e.azureValues],a=null;if(r)for(var n=0,o=r;n<o.length;n++){var s=o[n];if(s.details){a=s.details;break}}var u=i.getErrorDetailsFromStatusCode(this.code,this.oDataErrorMessage,a,this.AdditionalErrorMessages,t),c=u.displayableErrorInfo[0].errorInfoKey;if(!i.isCodeKnown(this.code)&&a&&(u.displayableErrorInfo=[]),a){var l=0===u.displayableErrorInfo.length?c:t.get("DsrError_MoreInfo");u.displayableErrorInfo.push({errorInfoKey:l,errorInfoValue:a})}return u},i.getErrorDetailsFromStatusCode=function(r,a,n,o,s){var u=s.get("DsrError_Key"),c=s.get("DsrError_UnknownErrorValue"),l=s.get("DsrError_Message"),p=jsCommon.PowerBIDefaultHelpPage,d=e.KnownDsrClientErrors[r];if(d){u=d.localizedTitle?s.get(d.localizedTitle):u;c=i.getContent(r,n,o,d,s)||c,l=d.localizedMessage?s.get(d.localizedMessage):l,p=d.helpLink||p,d.useODataErrorMessageAsContent&&(c=a||l)}var f={message:l,displayableErrorInfo:[{errorInfoKey:u,errorInfoValue:c}],helpLink:p};return f.debugErrorInfo=[],!d&&r&&f.debugErrorInfo.push({errorInfoKey:t.ErrorCode,errorInfoValue:r}),d&&d.useODataErrorMessageAsContent||!a||f.debugErrorInfo.push({errorInfoKey:t.ODataErrorMessage,errorInfoValue:a}),f},i.getContent=function(t,a,n,o,s){if(o.localizedContentWithAffectedItemsAndPosition||o.localizedContentWithAffectedItemsAndPositionAndDetails){var u=i.findAdditionalMessageWithAffectedItemsAndPosition(t,n);if(o.localizedContentWithAffectedItemsAndPositionAndDetails&&a&&u)return r.format(s.get(o.localizedContentWithAffectedItemsAndPositionAndDetails),r.constructCommaSeparatedList(u.AffectedItems,s,i.maxNumberOfCommaValues),e.formattingService.formatValue(u.Line),e.formattingService.formatValue(u.Position),a);if(o.localizedContentWithAffectedItemsAndPosition&&u)return r.format(s.get(o.localizedContentWithAffectedItemsAndPosition),r.constructCommaSeparatedList(u.AffectedItems,s,i.maxNumberOfCommaValues),e.formattingService.formatValue(u.Line),e.formattingService.formatValue(u.Position))}if(o.localizedContentWithAffectedItems){var c=i.getAffectedItemsFromStatusCode(t,n);if(c.length>0)return r.format(s.get(o.localizedContentWithAffectedItems),r.constructCommaSeparatedList(c,s,i.maxNumberOfCommaValues))}if(o.localizedContent)return s.get(o.localizedContent)},i.findAdditionalMessageWithAffectedItemsAndPosition=function(e,t){return _.find(t,function(t){return t.Code===e&&!_.isEmpty(t.AffectedItems)&&null!=t.Position&&null!=t.Line})},i.getAffectedItemsFromStatusCode=function(e,t){for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.Code===e)return a.AffectedItems||[]}return[]},i.prototype.parseCode=function(){var t=this.oDataError.code,r=this.oDataError[e.azureValues],a=[];if(r)for(var n=0,o=r;n<o.length;n++){var s=o[n];s.additionalMessages&&(a=s.additionalMessages)}if(a.length>0)for(var u=0,c=a;u<c.length;u++){var l=c[u];if(i.isCodeKnown(l.Code)){t=l.Code;break}}return t},i.isCodeKnown=function(e){switch(e){case"ComplexSlicerNotAllowedWithMeasures":case"ComplexHighlightsNotAllowed":case"ExclusivePercentileOutOfRange":case"InvalidDataShapeNoOutputData":case"InvalidFilterComparisonIncompatibleExpressions":case"InvalidFilterConditionIncompatibleDataType":case"InvalidUnconstrainedJoin":case"ModelUnavailable":case"OverlappingKeysOnOppositeHierarchies":case"rsQueryMemoryLimitExceeded":case"rsQueryTimeoutExceeded":case"CouldNotResolveModelReferencesInSemanticQuery":case"QueryExtensionMeasureUnexpectedEndOfUserInput":case"rsAccessDenied":case"NoUniqueKeyForDetailTable":case"IsRelatedToManyNotSupportedForDetailTable":
case"ModelMeasuresNotSupportedForDetailTable":case"UnsupportedDateTimeLiteral":case"InvalidExtensionDax_UnclosedBracketIdentifier":case"InvalidExtensionDax_UnexpectedCloseParenthesis":case"ExtensionMeasureEmptyExpression":case"ExtensionMeasureNameNotUniqueModel":case"ExtensionMeasureNameNotUnique":case"CouldNotResolveModelReferencesInQueryExtensionSchema":case"QueryExtensionMeasureError":case"UnsupportedDataSourceVariables":case"DataExtensionMissingResultSet":return!0;default:return!1}},i}();e.DsrClientError=i}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.httpService=e}return e.prototype.requestData=function(e,t,r){var i=[],a=r.getUrlTemplates(),n=r.getResponseFormatter();t=this.formatSearchKey(t);for(var o=0,s=a;o<s.length;o++){var u=s[o],c=$.Deferred();i.push(c),u=u.replace(/{{searchKey}}/g,encodeURIComponent(t)),this.makeRequest(u,c)}$.when.apply($,i).then.call(this,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=n.formatResponse(Array.prototype.slice.call(t));e.resolve(i)},e.reject)},e.prototype.formatSearchKey=function(e){return e=e.trim().toUpperCase(),e=this.removeEdgeBinaryOperator(e,"AND"),e=this.removeEdgeBinaryOperator(e,"OR")},e.prototype.removeEdgeBinaryOperator=function(e,t){return _.startsWith(e,t+" ")&&(e=t.toLowerCase()+e.slice(t.length)),_.endsWith(e," "+t)&&(e=e.slice(0,e.length-t.length)+t.toLowerCase()),e},e.prototype.makeRequest=function(e,t){var r=this.httpService.powerbiRequestOptions();r.responseType="json",this.httpService.get(e,r).then(function(e){var r=e.data;if("string"==typeof r)try{r=JSON.parse(r)}catch(e){return t.reject()}t.resolve(r)},t.reject)},e}();e.BingSocialClient=t}(t=e.bingSocial||(e.bingSocial={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r=jsCommon.StringExtensions,i=function(){function e(){}return e}();t.LimitMetadata=i;var a=function(){function i(e,t,r){this.computeMetadata(e,r,t)}return Object.defineProperty(i.prototype,"code",{get:function(){return"DsrLimitsWarning"},enumerable:!0,configurable:!0}),i.prototype.computeMetadata=function(e,t,r){if(this.limits={},e.Limits){var a=i.getExceededLimitsDetails(e,r),n=e.Limits,o=!!a.Primary,s=!!a.Secondary,u=!!a.Intersection;if(e.ScriptVisualBinding)return void(this.hasScriptVisualBinding=!0);var c=e.Expressions&&e.Expressions.Primary&&e.Expressions.Primary.Groupings?e.Expressions.Primary.Groupings:[],l=e.Expressions&&e.Expressions.Secondary&&e.Expressions.Secondary.Groupings?e.Expressions.Secondary.Groupings:[];o&&s?(this.groupings=c.concat(l),this.limits.Primary=i.getLimitMetadata(n.Primary,t),this.limits.Secondary=i.getLimitMetadata(n.Secondary,t)):o?(this.groupings=c,this.limits.Primary=i.getLimitMetadata(n.Primary,t)):s&&(this.groupings=l,this.limits.Secondary=i.getLimitMetadata(n.Secondary,t)),u&&(this.limits.Intersection=i.getLimitMetadata(n.Intersection,t))}},i.prototype.getDetails=function(e){var t=!!this.limits.Primary,r=!!this.limits.Secondary,a=null,n=-1;return this.hasScriptVisualBinding?a=e.get("DsrLimitWarning_TooMuchDataValMultipleColumns"):t||r?t&&r?(n=this.limits.Primary.Type,a=this.getErrorInfoValue(this.groupings,e.get("DsrLimitsWarning_MultipleColumnsWithIssuesFormat"),e)):t?(n=this.limits.Primary.Type,a=this.getErrorInfoValue(this.groupings,i.getDetailedMessageFormatForOneColumn(n,e),e)):(n=this.limits.Secondary.Type,a=this.getErrorInfoValue(this.groupings,i.getDetailedMessageFormatForOneColumn(n,e),e)):this.limits.Intersection&&(n=this.limits.Intersection.Type,a=i.getDetailedMessageFormatForOneColumn(n,e)),a||(a=e.get("DsrLimitWarning_TooMuchDataValMultipleColumns")),{message:i.getMessage(n,e),displayableErrorInfo:[{errorInfoKey:i.getKey(n,e),errorInfoValue:a}],helpLink:i.getHelpLink(n)}},i.getExceededLimitsDetails=function(e,t){for(var r=e.Limits,i={},a=0,n=t;a<n.length;a++){var o=n[a];r.Primary&&o.Id===r.Primary.Id?i.Primary=r.Primary:r.Secondary&&o.Id===r.Secondary.Id?i.Secondary=r.Secondary:r.Intersection&&o.Id===r.Intersection.Id&&(i.Intersection=r.Intersection)}return i},i.prototype.getErrorInfoValue=function(e,t,i){if(!e||0===e.length)return null;for(var a=[],n=0,o=e.length;n<o;n++){var s=e[n],u=this.getGroupingNameFromGroupingKeys(s);u&&a.push(u)}var c,l=a.length;return 0===l?null:(c=1===l?a[0]:a.join(i.get("ListJoin_Separator")),r.format(t,c))},i.prototype.getGroupingNameFromGroupingKeys=function(e){for(var t=e.Keys,r=0,i=t.length;r<i;r++){var a=t[r];if(null!==a.Select&&void 0!==a.Select){if(!this.columnNameFromIndex)return;return this.columnNameFromIndex(a.Select)}}},i.getMessage=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleMessage");case 3:case 4:return t.get("DsrLimitWarning_HighDensitySampleMessage");default:return t.get("DsrLimitWarning_TooMuchDataMessage")}},i.getKey=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleKey");case 3:case 4:return t.get("DsrLimitWarning_HighDensitySampleKey");default:return t.get("DsrLimitWarning_TooMuchDataKey")}},i.getDetailedMessageFormatForOneColumn=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleVal");case 3:return t.get("DsrLimitWarning_HighDensitySampleVal");case 4:return t.get("DsrLimitWarning_OverlappingPointsDetails");default:return t.get("DsrLimitWarning_TooMuchDataVal")}},i.getHelpLink=function(e){switch(e){case 3:return"https://go.microsoft.com/fwlink/?linkid=848757";case 4:return"https://go.microsoft.com/fwlink/?linkid=853820"}},i.getLimitMetadata=function(e,t){return e.Top?{Type:0,Count:i.getLimitCount(e.Top,t)}:e.Bottom?{Type:1,Count:i.getLimitCount(e.Bottom,t)}:e.Sample?{Type:2,Count:i.getLimitCount(e.Sample,t)}:e.BinnedLineSample?{Type:3,Count:i.getBinnedLineSampleCount(e.BinnedLineSample)}:e.OverlappingPointsSample?{Type:4,Count:i.getLimitCount(e.OverlappingPointsSample,t)}:{Type:-1,Count:null}},i.getLimitCount=function(r,i){if(r.Calc&&i){var a=t.DataShapeUtility.findCalculation(i,r.Calc);if(a){var n=e.PrimitiveValueEncoding.parseValue(a.Value);if(_.isNumber(n))return n}}return r.Count},i.getBinnedLineSampleCount=function(e){return e.MaxTargetPointCount},i}();t.DsrLimitsWarning=a}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e){switch(e){case 0:return r}}var r="Warning";e.getDsrMessageSeverityValue=t,e.KnownDsrMessages={"ForecastErrorType.DataIsTooSmall":{localizedMessage:"DsrMessage_NotEnoughDataMessage",localizedTitle:"DsrMessage_NotEnoughDataTitle",localizedContent:"DsrMessage_NotEnoughDataContent",isTransformMessage:!0},"ForecastErrorType.TooManyMissingValues":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.NoDominantStepDetected":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.InputTimeStampsNotSorted":{localizedMessage:"DsrMessage_UnsortedDataMessage",localizedTitle:"DsrMessage_UnsortedDataTitle",localizedContent:"DsrMessage_UnsortedDataContent",isTransformMessage:!0},"ForecastErrorType.XAxisIsNull":{localizedMessage:"DsrMessage_ForecastXValueNullMessage",localizedTitle:"DsrMessage_ForecastXValueNullTitle",localizedContent:"DsrMessage_ForecastXValueNullContent",isTransformMessage:!0},"ForecastErrorType.InvalidSeasonality":{localizedMessage:"DsrMessage_ForecastInvalidSeasonalityMessage",localizedTitle:"DsrMessage_ForecastInvalidSeasonalityTitle",localizedContent:"DsrMessage_ForecastInvalidSeasonalityContent",isTransformMessage:!0},"ForecastErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ForecastVariantDataTypeMessage",localizedTitle:"DsrMessage_ForecastVariantDataTypeTitle",localizedContent:"DsrMessage_ForecastVariantDataTypeContent",isTransformMessage:!0},"ForecastErrorType.Unexpected":{localizedMessage:"DsrMessage_ForecastErrorMessage",localizedTitle:"DsrMessage_ForecastErrorTitle",localizedContent:"DsrMessage_ForecastErrorContent",isTransformMessage:!0},ForecastTransformUnsupported:{localizedMessage:"DsrMessage_ForecastNotSupportedMessage",localizedTitle:"DsrMessage_ForecastNotSupportedTitle",localizedContent:"DsrMessage_ForecastNotSupportedContent",isTransformMessage:!0},"ClusteringErrorType.LessThanKDataPoints":{localizedMessage:"DsrMessage_ClusterTooManyClustersTitle",localizedTitle:"DsrMessage_ClusterTooManyClustersTitle",localizedContent:"DsrMessage_ClusterTooManyClustersContent",isTransformMessage:!0},"ClusteringErrorType.TooManyDataPoints":{localizedMessage:"DsrMessage_ClusterExceedsLimitTitle",localizedTitle:"DsrMessage_ClusterExceedsLimitTitle",localizedContent:"DsrMessage_ClusterExceedsLimitContent",isTransformMessage:!0},"ClusteringErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ClusterVariantDataTypeTitle",localizedTitle:"DsrMessage_ClusterVariantDataTypeTitle",localizedContent:"DsrMessage_ClusterVariantDataTypeContent",isTransformMessage:!0}};var i=function(){function t(e){this.dataShapeMessage=e}return Object.defineProperty(t.prototype,"code",{get:function(){return this.dataShapeMessage.Code},enumerable:!0,configurable:!0}),t.prototype.getDetails=function(t){var r=e.KnownDsrMessages[this.dataShapeMessage.Code];return{message:t.get(r.localizedMessage),displayableErrorInfo:[{errorInfoKey:t.get(r.localizedTitle),errorInfoValue:t.get(r.localizedContent)}]}},t.prototype.isTransformMessage=function(){var t=e.KnownDsrMessages[this.code];return t&&t.isTransformMessage},t}();e.DsrMessage=i}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(e){if(2===e.Version)return!0}function a(e){return e.MinorVersion}function n(e,t,r,i,a,n){if(!t)return null;t.data&&(t=t.data);var s;n&&(s=n.createChildActivity("Parse Query Result"));var u={},c=t,l=jsCommon.performance.now();_.isString(t)&&(u.dsrLength=t.length,u.jsonParse=f(function(){c=JSON.parse(t)}),s&&s.attachPerformanceActivityMetrics({jsonParse:u.jsonParse}));var p=o(e,c.descriptor,c.dsr,r.enableCellLevelFormatting,c.requestId,c.clientSideFilters,a,u,i,l,c.timestamp,c.fromCache,c.metrics,r.scopedAggregates);return s&&s.resolve(),p}function o(a,n,o,s,c,p,d,f,h,m,v,y,g,S){if(!o)return null;f||(f={}),4&a&&(a|=8);var C,x;if(i(o)){if(x="dsr2-read",performance&&performance.mark&&performance.mark(x+"-start"),f.mode="V2",1!==_.size(o.DS))return null;var D=r.createDsrParserContext(n),E=r.reader.V2.createDsrParser(o,D);C=l(new r.DataViewConverterContext(a,n,D,S,E.dataShapes()),E,f,S),E.reset();var w=E.dataShapes();w.next();if(w.limitsExceeded()){C.warnings||(C.warnings=[]);var b=new r.DsrLimitsWarning(n,r.toDsrV1Limit(w),r.toDsrV1Calc(w));C.warnings.push(b),r.reader.V1.applyReductionMetadata(C.dataView,b.limits)}u(w,C),C.dataView&&!_.isEmpty(p)&&(t.ClientSideFilter.applyClientSideFilters(C.dataView,p),C.disallowPersisting=!0)}else x="dsr1-read",performance&&performance.mark&&performance.mark(x+"-start"),f.mode="V1Old",C=r.reader.V1.read(a,n,o,s,f,c,p,d);return C&&(C.timestamp=v,C.fromCache=y,g&&(C.performanceActivities=r.parseExecutionEvents(g.Events))),performance&&(performance.mark&&performance.mark(x+"-end"),performance.measure&&performance.measure(x,x+"-start",x+"-end")),f.total=jsCommon.performance.now()-m,h&&h.logEvent(e.telemetry.DataDsrToDataView,f.jsonParse,f.categorical,f.table,f.tree,f.matrix,f.single,f.script,f.total,f.mode,a,f.dsrLength,d),C}function s(e){if(!e)return!1;var t=e.data;return _.isString(t)&&(t=d.tryParseJSON(t)),!_.isEmpty(t)&&c(t.dsr)}function u(e,t){var i=e.messages();if(i)for(;i.next();)r.KnownDsrMessages[i.code()]&&i.severity()===r.getDsrMessageSeverityValue(0)&&(t.warnings||(t.warnings=[]),t.warnings.push(i.dsrMessage()))}function c(e){if(e)if(i(e)){for(var t=r.reader.V2.createDsrParser(e,void 0).dataShapes();t.next();)if(t.hasRestartTokens())return!0}else for(var a=e.DataShapes,n=0,o=a;n<o.length;n++){var s=o[n];if(!_.isEmpty(s.RestartTokens))return!0}return!1}function l(e,t,i,a){var n={columns:e.createDataViewMetadataColumns()},o={dataView:{metadata:n}};if(p(t,o),e.includes(2)){var s,u=f(function(){s=r.converters.createMatrix(e,t,n,a),s&&(o.dataView.matrix=s,t.lockCache())});s&&(i.matrix=u)}if(e.includes(1)){var c,l=f(function(){c=r.converters.categorical(e,t,n),c&&(o.dataView.categorical=c,t.lockCache())});c&&(i.categorical=l)}if(e.includes(8)){var d,h=f(function(){d=r.converters.createTable(e,t,n),d&&(o.dataView.table=d,t.lockCache())});d&&(i.table=h)}if(e.includes(16)){var m,v=f(function(){m=r.converters.createTree(e,t),m&&(o.dataView.tree=m,t.lockCache())});m&&(i.tree=v)}if(e.includes(4)){var y,g=f(function(){y=r.converters.createSingle(e,t),y&&(o.dataView.single=y)});y&&(i.single=g)}return o}function p(e,t){e.reset();var r=e.dataShapes();r.next(),r.complete()||(t.dataView.metadata.segment={},t.restartToken=r.restartTokens())}var d=jsCommon.JsonExtensions,f=jsCommon.PerfTimer.logTime;r.isDsrV2=i,r.getDsrV2MinorVersion=a,r.read=n,r.readDsr=o,r.containsRestartToken=s}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=jsCommon.EnumExtensions,r=function(){function r(e,t,r,i,a){this.targets=e,this.descriptor=t,this.selects=t.Select,this.selectIndexToColumn={},this.aggregateCalcMetadata={},this.calcInfo={},this.calcIdToColumnIndices={},this.dataMemberIdToIdentityBuilder={};var n=t.Expressions;this.primaryAxisGroupings=n&&n.Primary&&n.Primary.Groupings,this.secondaryAxisGroupings=n&&n.Secondary&&n.Secondary.Groupings,this.measureSelectIndices=[],this.dataMemberIdToMetadata=r.dataMemberIdToMetadata,this.maxPrimaryDepth=r.maxPrimaryDepth,this.maxSecondaryDepth=r.maxSecondaryDepth,this.scopedAggregatesEnabled=i,this.dataShapeParser=a}return r.prototype.includes=function(e){return t.hasFlag(this.targets,e)},r.prototype.createDataViewMetadataColumns=function(){var t=this.selects;if(!_.isEmpty(t)){var r=[],i=t.length;this.selectIndexToColumnIndex=new Array(i);for(var a=0,n=i;a<n;a++){var o=t[a];if(o){var s=this.createColumns(r,a),u=s.column,c=s.columnIdx,l=s.dynamicFormatColumn;this.selectIndexToColumn[a]=u,this.selectIndexToColumnIndex[a]=c,o.Kind===e.SelectKind.Measure&&this.measureSelectIndices.push(a);var p=o.Aggregates;if(p)for(var d=0,f=p;d<f.length;d++){var h=f[d],m=this.getAggregateKind(h.Aggregate);this.createAggregateCalcMetadata(h.Ids,m,u,a,h.Aggregate)}var v=o.Value;v&&(this.calcIdToColumnIndices[v]||(this.calcIdToColumnIndices[v]=[]),this.calcIdToColumnIndices[v].push(c),null!=o.Depth&&null!=o.SecondaryDepth||(this.aggregateCalcMetadata[v]={source:u,aggregateKind:4,selectIdx:a})),o.Kind===e.SelectKind.Measure&&(o.Subtotal&&this.createAggregateCalcMetadata(o.Subtotal,1,u,a),o.SubtotalDynamicFormat&&this.createAggregateCalcMetadata(_.map(o.SubtotalDynamicFormat,function(e){return e&&e.Format}),1,l,a),o.Count&&this.createAggregateCalcMetadata(o.Count,5,u,a),o.Max&&this.createAggregateCalcMetadata(o.Max,2,u,a),o.Min&&this.createAggregateCalcMetadata(o.Min,3,u,a))}}this.parseAxisGroupings(this.primaryAxisGroupings),this.parseAxisGroupings(this.secondaryAxisGroupings);for(var y in this.calcIdToColumnIndices)_.size(this.calcIdToColumnIndices[y])>1&&(this.calcInfo[y].hasDuplicateColumnIndices=!0);return this.scopedAggregatesEnabled&&(this.createScopedAggregateMetadata(),this.fillDataShapeScopeAggregateValues()),r}},r.prototype.parseAxisGroupings=function(t){if(t)for(var r=this.calcInfo,i=this.selects,a=0,n=t;a<n.length;a++)for(var o=n[a],s=0,u=o.Keys;s<u.length;s++){var c=u[s];null!=c.Select?r[i[c.Select].Value].forIdentity=!0:c.Calc&&(r[c.Calc]={kind:e.SelectKind.Group,forIdentity:!0,isGroupKeyButNotSelect:!0})}},r.prototype.createAggregateCalcMetadata=function(e,t,r,i,a){for(var n=0,o=e;n<o.length;n++){var s=o[n],u=this.aggregateCalcMetadata[s]={source:r,aggregateKind:t,selectIdx:i};a&&(u.aggregate=a)}},r.prototype.getAggregateKind=function(e){return e.Average?6:e.Max?2:e.Min?3:e.Median?8:e.Percentile?7:void 0},r.prototype.createColumns=function(t,r){var i=t.length,a=this.createMetadataColumn(r);t.push(a);var n=this.selects[r],o=n.Kind,s=this.calcInfo;if(s[n.Value]={kind:o,columnIndex:i,selectIdx:r,calcKind:1},n.Subtotal)for(var u=0,c=n.Subtotal;u<c.length;u++){var l=c[u];s[l]={columnIndex:i,kind:o,selectIdx:r,calcKind:2}}if(n.Highlight){var p=n.Highlight.Value;p&&(s[p]={columnIndex:i,kind:o,selectIdx:r,calcKind:3})}if(this.scopedAggregatesEnabled){if(!_.isEmpty(n.Aggregates))for(var d=0,f=n.Aggregates;d<f.length;d++){var h=f[d];if(h.Aggregate.Scope)for(var m=0,v=h.Ids;m<v.length;m++){var y=v[m];s[y]={columnIndex:i,kind:o,selectIdx:r,calcKind:7}}}var g=n.Highlight;if(g&&!_.isEmpty(g.Aggregates))for(var S=g.Aggregates,C=0,x=S;C<x.length;C++){var h=x[C];if(h.Aggregate.Scope)for(var D=0,E=h.Ids;D<E.length;D++){var y=E[D];s[y]={columnIndex:i,kind:o,selectIdx:r,calcKind:8}}}}var w=this.tryCreateDynamicFormatColumnMetadata(r,a);if(w){var b=i+1;if(t.push(w),s[n.DynamicFormat.Format]={columnIndex:b,kind:e.SelectKind.Measure,selectIdx:r,calcKind:4},n.SubtotalDynamicFormat)for(var I=0,M=n.SubtotalDynamicFormat;I<M.length;I++){var l=M[I],V=l&&l.Format;V&&(s[V]={columnIndex:b,kind:e.SelectKind.Measure,selectIdx:r,calcKind:5})}var R=n.Highlight&&n.Highlight.DynamicFormat&&n.Highlight.DynamicFormat.Format;R&&(s[R]={columnIndex:b,kind:e.SelectKind.Measure,selectIdx:r,calcKind:6})}return{column:a,columnIdx:i,dynamicFormatColumn:w}},r.prototype.createMetadataColumn=function(t){var r=this.selects[t],i={displayName:"",index:t};r.Format&&(i.format=r.Format),i.type=e.DataShapeUtility.describeDataType(r.Type,r.DataCategory),r.Kind===e.SelectKind.Measure&&(i.isMeasure=!0);var a=r.GroupKeys;if(a)for(var n=i.identityExprs=new Array(a.length),o=0;o<a.length;o++)n[o]=e.convertKey(a[o],t,this.selects);return i},r.prototype.tryCreateDynamicFormatColumnMetadata=function(e,t){var r=this.selects[e];if(r.DynamicFormat&&r.DynamicFormat.Format){var i={displayName:"",isMeasure:!0};return t.formatSource={formatString:i},i}},r.prototype.createScopedAggregateMetadata=function(){for(var e=this.selects,t=e.length,r=this.selectIndexToColumn,i=0,a=t;i<a;i++){var n=e[i];if(n){var o=n.Aggregates,s=r[i];if(!_.isEmpty(o))for(var u=0,c=o;u<c.length;u++){var l=c[u];this.createScopedAggregateCalcMetadata(l,s)}var p=n.Highlight;if(p&&!_.isEmpty(p.Aggregates))for(var d=p.Aggregates,f=0,h=d;f<h.length;f++){var l=h[f];this.createScopedAggregateCalcMetadata(l,s)}}}},r.prototype.createScopedAggregateCalcMetadata=function(e,t){var r=e.Aggregate,i=r.Scope;if(i){for(var a=this.selectIndexToColumn,n=i.PrimaryDepth,o=new Array(n),s=this.primaryAxisGroupings,u=0,c=0;c<n;c++)for(var l=s[c].Keys,p=0,d=l;p<d.length;p++){var f=d[p],h=f.Select,m=a[h];o[u++]=m}for(var v={column:t,inputScope:o,respectInstanceFilters:r.RespectInstanceFilters},y=e.Ids,g=this.calcInfo,S=0,C=y;S<C.length;S++){var x=C[S],D=g[x];D.scopedAggregateCalcMetadata={metadata:v,aggregateKind:this.getAggregateKind(r)}}}},r.prototype.fillDataShapeScopeAggregateValues=function(){var e=this.dataShapeParser;if(e){var t=this.calcInfo;e.reset();for(var i=(e.next(),function(){var i=t[e.calcId()];if(!i||!i.scopedAggregateCalcMetadata)return"continue";var a=i.scopedAggregateCalcMetadata,n=a.metadata,o=n.column,s=n.inputScope,u=n.respectInstanceFilters,c={inputScope:s,respectInstanceFilters:u,values:{},highlight:{}};if(o.scopedAggregates){var l=_.find(o.scopedAggregates,function(e){return r.sameScopedAggregatesInputScope(e.inputScope,s)&&e.respectInstanceFilters===u});l?c=l:o.scopedAggregates.push(c)}else o.scopedAggregates=[c];var p=void 0;switch(i.calcKind){case 7:p=c.values;break;case 8:p=c.highlight}var d=e.calcValue();switch(a.aggregateKind){case 3:p.min=d;break;case 2:p.max=d;break;case 6:p.avg=d}});e.nextCalc();)i()}},r.sameScopedAggregatesInputScope=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},r}();e.DataViewConverterContext=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,i=e.Prototype;!function(t){function r(t,r,n){var o=i.inherit(t);return a(t,o,"tree",r,e.telemetry.DataDataViewKindAccess,16,n),a(t,o,"categorical",r,e.telemetry.DataSampledDataViewKindAccess,1,n),a(t,o,"table",r,e.telemetry.DataSampledDataViewKindAccess,8,n),a(t,o,"matrix",r,e.telemetry.DataSampledDataViewKindAccess,2,n),a(t,o,"single",r,e.telemetry.DataSampledDataViewKindAccess,4,n),o}function a(e,t,r,i,a,n,o){var s={enumerable:!0,configurable:!0,get:function(){return i.logEvent(a,n,o),delete t[r],e[r]},set:function(t){e[r]=t}};Object.defineProperty(t,r,s)}t.wrapKindProperties=r}(r=t.DataViewTelemetry||(t.DataViewTelemetry={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(e){var r=e.Select,a=e.Expressions,n=a&&a.Primary&&a.Primary.Groupings,o=a&&a.Secondary&&a.Secondary.Groupings,s={},u=n&&[],c=o&&[];if(n)for(var l=0,p=n.length;l<p;l++)i(s,n[l],l,u,r);if(o)for(var l=0,p=o.length;l<p;l++)c[l]=[],i(s,o[l],l,c,r);var d=0,f=[];if(r&&o)for(var l=0;l<r.length;l++){var h=r[l];h&&h.Kind===t.SelectKind.Measure&&null==h.Depth&&null==h.SecondaryDepth&&(f[d++]=l)}return{intersectionMeasureCount:f.length,intersectionMeasureToSelectIndex:f,secondaryLeafDataMemberId:o&&[],dataMemberIdToMetadata:s,selects:r,maxPrimaryDepth:_.size(n),maxSecondaryDepth:_.size(o),memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},intersectionCalcMetadataCache:{},primaryDataMemberIdCache:u,secondaryDataMemberIdCache:c,instancesCalcCache:{},lastIntersectionCalcCache:{},locked:!1}}function i(e,r,i,n,o){var s=n[i]=[],u=a(r.Keys,o),c=r.Member;if(c){s.push(c);var l=e[c]={identityFields:u,axisGrouping:r,kind:1,depth:i+1};r.RestartIdentities&&(l.restartValuesBuilder=new t.RestartValuesBuilder(r.RestartIdentities))}var p=r.SubtotalMember;p&&(s.push(p),e[p]={identityFields:u,kind:2,depth:i})}function a(e,t){for(var r=e.length,i=new Array(r),a=0;a<r;a++)i[a]=n(e[a],e[a].Select,t);return i}function n(r,i,a){var n=r.Source;if(!n){var o=a[i].Name;if(!o)return;return e.SQExprBuilder.selectRef(o)}return e.SQExprBuilder.columnRef(e.SQExprBuilder.entity(t.schemaName(n),n.Entity||n.EntitySet),n.Property)}var o=function(){function t(e){this.values=e,this.parsedValues=new Array(e.length),this.parsedValueExprs=new Array(e.length)}return t.prototype.getCalcValue=function(t,r){if(!(t>=this.parsedValues.length)){var i=this.parsedValues[t];return void 0===i&&(i=e.PrimitiveValueEncoding.parseOptimizedValue(this.values[t],r),this.parsedValues[t]=i),i}},t.prototype.getCalcValueExpr=function(t,r,i){if(!(r>=this.parsedValues.length)){var a=this.parsedValueExprs[r];return void 0===a&&(a=e.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(t,this.values[r],i),this.parsedValueExprs[r]=a),a}},t}(),s=function(){function e(e){if(e){this.resolvedValueDictionaries={};for(var t in e)this.resolvedValueDictionaries[t]=new o(e[t])}}return e.prototype.getCalcValue=function(e,t,r){if(t&&"number"==typeof e){var i=this.resolvedValueDictionaries[t];return i.getCalcValue(e,r)}},e.prototype.getCalcValueExpr=function(e,t,r,i){if(r&&"number"==typeof t){var a=this.resolvedValueDictionaries[r];return a.getCalcValueExpr(e,t,i)}},e}();t.ValueDictionaryHandler=s,t.createDsrParserContext=r,t.convertKey=n}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(e,t){this.context=e,this.calcIdToGroupingKeysIndex={},this.initialize(t)}return t.prototype.initialize=function(e){var t=this.context,r=t.selects,i=t.dataMemberIdToMetadata[e];this.identityFields=i.identityFields,this.identityFieldsCount=this.identityFields.length;for(var a=i.axisGrouping,n=a.Keys,o=0;o<this.identityFieldsCount;o++){var s=n[o];this.calcIdToGroupingKeysIndex[s.Calc||r[s.Select].Value]=o}},t.prototype.reset=function(){this.identityParts=new Array(this.identityFieldsCount)},t.prototype.addExpr=function(t,r){var i=this.calcIdToGroupingKeysIndex[t],a=this.identityFields[i];a&&(this.identityParts[i]=e.SQExprBuilder.equal(a,r))},t.prototype.getIdentity=function(){for(var t,r=this.identityParts,i=this.identityFieldsCount,a=0;a<i;a++)t=e.SQExprBuilder.and(t,r[a]);var n=e.createDataViewScopeIdentity(t);return n},t.prototype.getIdentityFields=function(){return this.identityFields},t}();t.IdentityBuilder=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=e.DataShapeUtility.MaxValueAggregator,r=e.DataShapeUtility.MinValueAggregator,i=function(){function i(e){this.context=e,this.measureValueAggregatorsBySelectIdx=[]}return i.prototype.read=function(t,r){void 0===r&&(r=!0);for(var i=this.context,a=i.selects,n=new Array(a.length),o=new Array(a.length);t.nextCalc();){var s=i.aggregateCalcMetadata[t.calcId()];s&&s.aggregateKind&&(e.DataShapeUtility.fillMetadataColumnAggregate(t.calcValue(),s,!1),3===s.aggregateKind&&(n[s.selectIdx]=!0),2===s.aggregateKind&&(o[s.selectIdx]=!0))}r&&this.addLocalAggregators(n,o)},i.prototype.addLocalAggregators=function(e,i){for(var a=this.measureValueAggregatorsBySelectIdx,n=this.context.measureSelectIndices,o=n.length,s=!1,u=0;u<o;u++){var c=n[u];e[c]||(s=!0,a[c]||(a[c]=[]),a[c].push(new r)),i[c]||(s=!0,a[c]||(a[c]=[]),a[c].push(new t))}this.hasLocalAggregators=s},i.prototype.update=function(e,t){if(this.hasLocalAggregators){var r=this.measureValueAggregatorsBySelectIdx[t];if(r)for(var i=0,a=r;i<a.length;i++){var n=a[i];n.update(e)}}},i.prototype.copyToColumns=function(){for(var e=this.context.measureSelectIndices,t=e.length,r=0;r<t;r++){var i=e[r],a=this.context.selectIndexToColumn[i],n=this.measureValueAggregatorsBySelectIdx[i];if(n){var o=a.aggregates;if(n)for(var s=0,u=n;s<u.length;s++){var c=u[s],l=c.value();void 0!==l&&(a.aggregates||(o=a.aggregates={}),a.aggregates[c.name]=l)}}}},i}();e.Aggregator=i}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){function i(e,t,r){if(a.isCompatible(e))return(new a).run(e,t,r)}r.categorical=i;var a=function(){function r(){}return r.prototype.run=function(r,i,a){this.metadata=a,this.context=r,this.dsrParser=i,this.selectIndexToCategoryColumn={},this.selectIndexToPrimaryValueColumn={},this.intersectionValueColumnsMap=[],this.primaryMeasureCount=0,this.intersectionMeasureCount=0,this.seriesSelectIndex=-1,this.primaryMeasureSelectIndexMap=[],this.intersectionMeasuresSelectIndexMap=[],this.selectIndexToValueColumnsMap=[],i.reset(),this.aggregator=new t.Aggregator(r);var n=this.dsrParser.dataShapes();n.next();var o={};if(0===r.maxPrimaryDepth){this.readSelectsAndCreateCategoryColumns(void 0,void 0);var s=o.values=e.DataViewTransform.createValueColumns();this.readMeasuresWithNoGrouping(n,s)}else{var u=[],c=[];o.categories=u,this.readSelectsAndCreateCategoryColumns(u,c);var s=void 0;(this.intersectionMeasureCount>0||this.primaryMeasureCount>0||this.seriesSelectIndex>=0)&&(o.values=s=e.DataViewTransform.createValueColumns()),this.readSecondaryAndCreateValueColumns(s);var l={};this.readData(n,s,c,l),void 0!==l.value&&(o.lastMergeIndex=l.value)}return o},r.isCompatible=function(e){return e.maxPrimaryDepth<=1&&e.maxSecondaryDepth<=1&&!(0===e.maxPrimaryDepth&&e.maxSecondaryDepth>0)&&_.size(e.selects)>0},r.prototype.readSelectsAndCreateCategoryColumns=function(e,r){var i=this.context,a=i.selectIndexToColumn,n=i.selects,o=n.length,s=this.dsrParser.dataShapes().secondaryHierarchy();this.primaryMeasureSelectIndexMap=new Array(n.length),this.intersectionMeasuresSelectIndexMap=new Array(n.length);for(var u=!!s,c=0;c<o;c++){var l=n[c];if(l&&l.Value){if(l.Kind===t.SelectKind.Group){if(null!=l.SecondaryDepth){this.seriesSelectIndex=c;continue}if(null!=l.Depth){var p={source:a[c],values:[],identity:r};e.push(p),this.selectIndexToCategoryColumn[c]=p}}else l.Kind===t.SelectKind.Measure&&(u&&null==l.Depth?this.intersectionMeasuresSelectIndexMap[this.intersectionMeasureCount++]=c:this.primaryMeasureSelectIndexMap[this.primaryMeasureCount++]=c)}}},r.prototype.readSecondaryAndCreateValueColumns=function(e){var t=this.dsrParser.dataShapes().secondaryHierarchy();return t?(this.addIntersectionValueColumns(e,t),void(this.primaryMeasureCount>0&&this.addPrimaryValueColumns(e))):void this.addPrimaryValueColumns(e,!0)},r.prototype.addIntersectionValueColumns=function(e,r){for(var i,a=new Array,n=this.context;r.next();){var o=r.id(),s=r.instances();if(2!==n.dataMemberIdToMetadata[o].kind){var u=n.dataMemberIdToIdentityBuilder[o];u||(u=new t.IdentityBuilder(n,o),n.dataMemberIdToIdentityBuilder[o]=u),i=u.getIdentityFields();for(var c=-1;s.next();){c++,u.reset();for(var l=void 0,p=void 0;s.nextCalc();){p=s.calcId();var d=this.context.calcInfo[p];d.isGroupKeyButNotSelect||(l=s.calcValue()),d.forIdentity&&u.addExpr(p,s.calcValueAsExpr())}this.addIntersectionValueColumnsCore(e,a,p,l,c,u.getIdentity())}0===e.length&&0===a.length&&this.addIntersectionValueColumnsCore(e,a,void 0,void 0,0,void 0),e.grouped=function(){return a},e.source=this.context.selectIndexToColumn[this.seriesSelectIndex],e.identityFields=i}else for(;s.next(););}},r.prototype.addIntersectionValueColumnsCore=function(e,t,r,i,a,n){for(var o=this.context,s=o.selects,u=this.intersectionMeasureCount,c=new Array(u),l=this.metadata.columns,p=function(t){var r=void 0,u=d.intersectionMeasuresSelectIndexMap[t];void 0!==i?(r=o.createColumns(l,u).column,r.groupName=i):r=_.find(l,function(e){return e.index===u});var p=d.createValueColumn(r,n,u,!!s[u].Highlight);e.push(p),c[t]=p;var f=s[u],h=d.intersectionValueColumnsMap[a];h||(h=d.intersectionValueColumnsMap[a]={}),h[f.Value]=p;var m=f.Highlight&&f.Highlight.Value;m&&(h[m]=p)},d=this,f=0;f<u;f++)p(f);var h={values:c};void 0!==i&&(h.name=i),void 0!==n&&(h.identity=n),t.push(h)},r.prototype.addPrimaryValueColumns=function(e,t){for(var r=new Array(this.primaryMeasureCount),i=this.context,a=i.selects,n=0;n<this.primaryMeasureCount;n++){var o=this.primaryMeasureSelectIndexMap[n],s=i.selectIndexToColumn[o],u=this.createValueColumn(s,void 0,o,!!a[o].Highlight);this.selectIndexToPrimaryValueColumn[o]=u,r[n]=u,e.push(u)}if(t&&e){var c=[{values:r}];e.grouped=function(){return c}}},r.prototype.createValueColumn=function(e,t,r,i){var a={source:e,values:[]};i&&(a.highlights=[]),t&&(a.identity=t);var n=this.selectIndexToValueColumnsMap[r];return n||(n=this.selectIndexToValueColumnsMap[r]=[]),n.push(a),a},r.prototype.readData=function(e,r,i,a){var n=this.context,o=e.primaryHierarchy();for(this.aggregator.read(e,0===this.intersectionMeasureCount);o.next();){var s=o.id(),u=n.dataMemberIdToMetadata[s];if(u){var c=1===u.kind,l=n.dataMemberIdToIdentityBuilder[s];!l&&c&&(l=new t.IdentityBuilder(n,s),n.dataMemberIdToIdentityBuilder[s]=l);for(var p=o.instances();p.next();){for(l&&l.reset(),1===p.restartFlagKind()&&(a.value=p.currentIndex());p.nextCalc();)this.readPrimaryHierarchyCalc(p,l);l&&i.push(l.getIdentity()),this.parseIntersections(p)}if(c)for(var d=l.getIdentityFields(),f=0;f<n.selects.length;f++){var h=this.selectIndexToCategoryColumn[f];h&&(h.identityFields=d)}}}this.aggregator.copyToColumns(),this.copyAggregatesToValueColumns()},r.prototype.copyAggregatesToValueColumns=function(){for(var e=this.context.measureSelectIndices,r=this.context.selectIndexToColumn,i=e.length,a=0;a<i;a++){var n=e[a],o=r[n].aggregates;if(o){var s=this.selectIndexToPrimaryValueColumn[n];s&&t.DataShapeUtility.copyAggregates(o,s);var u=this.selectIndexToValueColumnsMap[n];if(u)for(var c=0,l=u;c<l.length;c++){var p=l[c];t.DataShapeUtility.copyAggregates(o,p);
}}}},r.prototype.readPrimaryHierarchyCalc=function(e,r){var i=e.calcId(),a=this.context.aggregateCalcMetadata[i];if(a&&1===a.aggregateKind)return void t.DataShapeUtility.fillMetadataColumnAggregate(e.calcValue(),a);var n=this.context.calcInfo[i];if(n){var o=e.calcValue();if(n.kind===t.SelectKind.Group)n.isGroupKeyButNotSelect||this.selectIndexToCategoryColumn[n.selectIdx].values.push(o),n.forIdentity&&r.addExpr(i,e.calcValueAsExpr());else if(n.kind===t.SelectKind.Measure){var s=n.calcKind;1===s?(this.selectIndexToPrimaryValueColumn[n.selectIdx].values.push(o),this.aggregator.update(o,n.selectIdx)):3===s&&this.selectIndexToPrimaryValueColumn[n.selectIdx].highlights.push(o)}}},r.prototype.parseIntersections=function(e){var t=e.intersections();if(t)for(var r=this.context.calcInfo,i=0;t.next();){var a=this.intersectionValueColumnsMap[i];if(t.nextCalc()){if(!this.parseIntersectionCalc(t,a,r))continue;for(i++;t.nextCalc();)this.parseIntersectionCalc(t,a,r)}}},r.prototype.parseIntersectionCalc=function(e,t,r){var i=e.calcId(),a=r[i];if(a){switch(a.calcKind){case 1:return t[i].values.push(e.calcValue()),!0;case 3:return t[i].highlights.push(e.calcValue()),!0;case 4:case 6:return!0;case 2:case 5:return!1}}},r.prototype.readMeasuresWithNoGrouping=function(e,t){this.aggregator.read(e),this.aggregator.copyToColumns();var r=e.primaryHierarchy();if(r.next()){this.addPrimaryValueColumns(t,!0);for(var i=this.context.calcInfo,a=r.instances();a.next();)for(;a.nextCalc();){var n=a.calcId(),o=i[n];o&&(1===o.calcKind?this.selectIndexToPrimaryValueColumn[o.selectIdx].values.push(a.calcValue()):3===o.calcKind&&this.selectIndexToPrimaryValueColumn[o.selectIdx].highlights.push(a.calcValue()))}}},r}()}(r=t.converters||(t.converters={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(e,t,r,a){return new i(e,t,r,a).run()}t.createMatrix=r;var i=function(){function t(t,r,i,a){this.context=t,this.dsrParser=r,this.metadata=i,this.scopedAggregateEnabled=a,this.primaryHierarchyLevelsCount=t.maxPrimaryDepth,this.secondaryHierarchyLevelsCount=t.maxSecondaryDepth,this.aggregator=new e.Aggregator(t),this.scopedAggregatesEnabled=a}return t.prototype.run=function(){this.createHierarchiesSources(),this.valueSources=this.readValueSources();var e=this.aggregator,t=this.dsrParser;t.reset();var r=t.dataShapes();this.calcInfoCache={};r.next();e.read(r,1===this.primaryHierarchyLevelsCount&&0===this.secondaryHierarchyLevelsCount);var i=r.secondaryHierarchy(),a=this.readHierarchy(1,i),n=r.primaryHierarchy(),o=this.readHierarchy(0,n);return e.copyToColumns(),{rows:o,columns:a,valueSources:this.valueSources}},t.prototype.createHierarchiesSources=function(){for(var t=this.context.selects,r=this.primaryHierarchyLevelsCount,i=this.secondaryHierarchyLevelsCount,a=this.primaryHierarchySources=new Array(r),n=this.secondaryHierarchySources=new Array(i),o=0;o<r;o++)a[o]=[];for(var o=0;o<i;o++)n[o]=[];for(var s=this.metadata.columns,u=s.length,c=this.columnIndexToZoneIndex=new Array(u),o=0;o<u;o++){var l=s[o],p=l.index;if(null!=p){var d=t[p],f=void 0;d.Kind===e.SelectKind.Group&&(null!=d.Depth?f=a[d.Depth]:null!=d.SecondaryDepth&&(f=n[d.SecondaryDepth]),c[o]=f.length,f.push(l))}}},t.prototype.readHierarchy=function(e,t){var r,i,a=this.measureCount;switch(e){case 0:if(r=this.context.primaryAxisGroupings,i=this.primaryHierarchyLevelsCount,!r)return this.createRowHierarchyForNoGroupings(t);break;case 1:if(r=this.context.secondaryAxisGroupings,i=this.secondaryHierarchyLevelsCount,!r)return 0===a?{levels:[],root:{children:[]}}:this.createColumnHierarchyForNoGroupings()}for(var n={levels:new Array(i),root:{}},o=0===e?this.primaryHierarchySources:this.secondaryHierarchySources,s=0;s<i;s++)n.levels[s]={sources:o[s]};1===e&&a>1&&n.levels.push(this.createColumnHierarchyMeasuresLevel());var u=this.context;return this.readNodeChildren(u,u.calcInfo,this.columnIndexToZoneIndex,u.dataMemberIdToIdentityBuilder,u.dataMemberIdToMetadata,n.root,t,0,e,n.levels),n},t.prototype.readNodeChildren=function(t,r,i,a,n,o,s,u,c,l){if(s&&0!==s.count())for(var p;s.next();){var d=s.id(),f=n[d];if(f){var h=2===f.kind,m=h&&0===u,v=void 0,y=void 0;h||(v=a[d],v||(v=a[d]=new e.IdentityBuilder(t,d)),y=v.getIdentityFields());var g=s.instances();if(!g||0===g.count())continue;y&&(o.childIdentityFields=y),p||(p=o.children=[]);var S=this.calcInfoCache[d];for(null==S&&(S=this.calcInfoCache[d]=[]);g.next();)p.push(this.readNode(t,a,n,r,i,g,u,h,m,S,c,v,f.restartValuesBuilder,l))}}},t.prototype.readNode=function(t,r,i,a,n,o,s,u,c,l,p,d,f,h){var m=t.aggregateCalcMetadata,v={level:s};1===o.restartFlagKind()&&(v.isMerge=!0),u?v.isSubtotal=!0:d.reset();for(var y=[],g=0;o.nextCalc();g++){var S=o.calcId(),C=l[g];if(!C){if(C=a[S],!C)continue;l[g]=C}var x=C.columnIndex,D=n[x],E=C.kind,w=void 0;if(E===e.SelectKind.Group){var b=o.calcValueAsExpr();w=b.value,C.isGroupKeyButNotSelect||(y[D]={value:w,levelSourceIndex:D}),d.addExpr(S,b)}else if(E===e.SelectKind.Measure){if(this.secondaryHierarchyLevelsCount>0)continue;null==v.values&&(v.values={});var I=v.values[D];I||(I=v.values[D]={},D>0&&(I.valueSourceIndex=D)),w=o.calcValue(),this.readNodeValueCalc(I,w,C),this.scopedAggregatesEnabled&&C.scopedAggregateCalcMetadata&&this.setScopeAggregateValue(v,w,C,h[s-1]),!c||2!==C.calcKind&&5!==C.calcKind||e.DataShapeUtility.fillMetadataColumnAggregate(w,m[S])}if(C.hasDuplicateColumnIndices)for(var M=0,V=t.calcIdToColumnIndices[S];M<V.length;M++){var R=V[M],T=n[R];y[T]||(y[T]={value:w,levelSourceIndex:T})}}if(!u){v.levelValues=y,v.value=y[0].value,v.identity=d.getIdentity();var _=o.restartKind();_&&(1===_?v.restartKind=1:2===_?v.restartKind=2:3===_&&(v.restartKind=3),v.restartKind&&(v.restartValues=f.getRestartValues(o)))}var P=o.intersections(),N=o.members();return P?this.readIntersectionsValues(a,n,v,P):N?this.readNodeChildren(t,a,n,r,i,v,N,s+1,p,h):1===p&&this.measureCount>1&&(s===this.secondaryHierarchyLevelsCount-1||v.isSubtotal)&&this.createColumnHierarchyMeasuresNodes(v),v},t.prototype.setScopeAggregateValue=function(t,r,i,a){var n,o=i.scopedAggregateCalcMetadata,s=this.findDataViewNodeAggregates(t,o.metadata);switch(i.calcKind){case 7:n=s.values;break;case 8:n=s.highlight}switch(o.aggregateKind){case 2:n.max=r;break;case 3:n.min=r;break;case 6:n.avg=r}var u=o.metadata,c=a.aggregates;if(c){_.some(c,function(t){return t.column===u.column&&e.DataViewConverterContext.sameScopedAggregatesInputScope(t.inputScope,u.inputScope)&&t.respectInstanceFilters===u.respectInstanceFilters})||c.push(u)}else a.aggregates=[u]},t.prototype.findDataViewNodeAggregates=function(t,r){var i,a=t.aggregateValues;return a?(i=_.find(a,function(t){var i=t.metadata;return i.column===r.column&&e.DataViewConverterContext.sameScopedAggregatesInputScope(i.inputScope,r.inputScope)&&i.respectInstanceFilters===r.respectInstanceFilters}),i||(i={metadata:r,values:{},highlight:{}},a.push(i))):(i={metadata:r,values:{},highlight:{}},t.aggregateValues=[i]),i},t.prototype.readIntersectionsValues=function(e,t,r,i){var a=this.measureCount;if(0!==a)for(var n=r.values={},o=0;i.next();){for(var s=0;s<a;s++){var u=n[a*o+s]={};s>0&&(u.valueSourceIndex=s)}for(;i.nextCalc();){var c=e[i.calcId()];if(c){var l=t[c.columnIndex],u=n[a*o+l];this.readNodeValueCalc(u,i.calcValue(),c)}}o++}},t.prototype.readNodeValueCalc=function(e,t,r){switch(r.calcKind){case 1:case 4:e.value=t,this.aggregator.update(t,r.selectIdx);break;case 2:case 5:e.value=t;break;case 3:case 6:e.highlight=t;break;case 7:case 8:break;default:debug.assertNever(r.calcKind)}},t.prototype.createRowHierarchyForNoGroupings=function(e){var t={level:0,values:{}},r={levels:[],root:{children:[t]}};e.next();var i=e.instances();return this.readNodeForNoGroupings(t,i),r},t.prototype.readNodeForNoGroupings=function(e,t){var r=this.context.calcInfo,i=this.columnIndexToZoneIndex;t.next();for(var a=e.values={};t.nextCalc();){var n=t.calcId(),o=r[n];if(o){var s=i[o.columnIndex],u=a[s];u||(u=a[s]={},s>0&&(u.valueSourceIndex=s)),this.readNodeValueCalc(u,t.calcValue(),o)}}},t.prototype.createColumnHierarchyForNoGroupings=function(){var e=[],t={};return this.measureCount>0&&(e=[this.createColumnHierarchyMeasuresLevel()],this.createColumnHierarchyMeasuresNodes(t)),{levels:e,root:t}},t.prototype.createColumnHierarchyMeasuresLevel=function(){for(var e=this.measureCount,t=new Array(e),r=0;r<e;r++)t[r]=this.valueSources[r];return{sources:t}},t.prototype.createColumnHierarchyMeasuresNodes=function(e){for(var t=null==e.level?0:this.secondaryHierarchyLevelsCount,r=this.measureCount,i=e.children=new Array(r),a=e.isSubtotal,n=0;n<r;n++){var o=i[n]={level:t};n>0&&(o.levelSourceIndex=n),a&&(o.isSubtotal=!0)}},t.prototype.readValueSources=function(){for(var e=this.context,t=e.selects,r=e.measureSelectIndices,i=r.length,a=e.selectIndexToColumn,n=e.selectIndexToColumnIndex,o=this.columnIndexToZoneIndex,s=[],u=0;u<i;u++){var c=r[u],l=t[c],p=n[c],d=a[c];if(o[p]=s.length,s.push(d),l.DynamicFormat&&l.DynamicFormat.Format){var f=d.formatSource&&d.formatSource.formatString;o[p+1]=s.length,s.push(f)}}return this.measureCount=s.length,s},t}()}(t=e.converters||(e.converters={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(e,t,r){return new i(e,t,r).run()}t.createTable=r;var i=function(){function t(t,r,i){this.context=t,this.dsrParser=r,this.metadata=i,this.aggregator=new e.Aggregator(t)}return t.prototype.run=function(){if(this.isCompatible()){var e=this.metadata,t={columns:e.columns},r=this.dsrParser;r.reset();var i=r.dataShapes(),a=(i.next(),this.aggregator);a.read(i);var n=i.primaryHierarchy();return 1===this.context.maxPrimaryDepth?this.readRows(t,n):0===this.context.maxPrimaryDepth&&this.readRowWithoutGrouping(t,n),a.copyToColumns(),t}},t.prototype.readRows=function(t,r){var i,a,n=this.context,o=this.getRowCellsCount(r);for(r.reset();r.next();){var s=r.id(),u=n.dataMemberIdToMetadata[s];if(u){var c=u.kind,l=r.instances(),p=[];if(1===c){var d=n.dataMemberIdToIdentityBuilder[s];d||(d=n.dataMemberIdToIdentityBuilder[s]=new e.IdentityBuilder(n,s));var f=u.axisGrouping,h=l.count();i=new Array(h);for(var m=new Array(h),v=0;l.next();v++)1===l.restartFlagKind()&&(a=v),d.reset(),i[v]=this.readRow(l,f,p,o,d,!1),m[v]=d.getIdentity();_.isEmpty(m)||(t.identity=m),t.identityFields=d.getIdentityFields()}else if(2===c){if(0===o)continue;for(;l.next();){for(var y=this.readRow(l,null,p,o,null,!0),g=y.length,v=0;v<g;v++){var S=y[v];void 0===S&&(y[v]=null)}t.totals=y}}t.rows=i,void 0!==a&&(t.lastMergeIndex=a)}}},t.prototype.readRow=function(t,r,i,a,n,o){var s,u=this.aggregator,c=new Array(a),l=0===i.length;l&&r&&(s=this.createCalcIdToGroupingIdentityIndexMap(r),i.length=t.calcCount());for(var p=this.context,d=p.aggregateCalcMetadata,f=0;t.nextCalc();f++){var h=t.calcId();if(l){var m=s&&s[h],v=p.calcInfo[h],y=v&&v.columnIndex,g=v&&v.selectIdx;!v||3!==v.calcKind&&6!==v.calcKind||(y=null),i[f]={axisGroupingIndex:m,columnIndex:y,hasDuplicateColumnIndices:v&&v.hasDuplicateColumnIndices,isGroupKeyOnly:null!=m&&null==y,selectIndex:g,aggregateMetadata:d[h]}}var S=i[f];if(null!=S.columnIndex){var C=t.calcValue();if(c[S.columnIndex]=C,o?e.DataShapeUtility.fillMetadataColumnAggregate(C,S.aggregateMetadata):u.update(C,S.selectIndex),S.hasDuplicateColumnIndices)for(var x=0,D=p.calcIdToColumnIndices[h];x<D.length;x++){var E=D[x];void 0===c[E]&&(c[E]=C)}}n&&n.addExpr(h,t.calcValueAsExpr())}return c},t.prototype.readRowWithoutGrouping=function(e,t){if(t.next()){var r=t.instances(),i=[];if(r.next()){for(var a=[];r.nextCalc();){var n=r.calcId(),o=this.context.calcInfo[n];o&&3!==o.calcKind&&(a[o.columnIndex]=r.calcValue())}i.push(a)}e.rows=i}},t.prototype.getRowCellsCount=function(e){for(e.reset();e.next();){var t=e.id(),r=this.context.dataMemberIdToMetadata[t];if(r&&1===r.kind){var i=e.instances();if(i.next()){for(var a=0;i.nextCalc();){var n=i.calcId(),o=this.context.calcInfo[n];!o||1!==o.calcKind&&2!==o.calcKind||(o.hasDuplicateColumnIndices?a+=_.size(this.context.calcIdToColumnIndices[n]):a++)}return a}}}return 0},t.prototype.createCalcIdToGroupingIdentityIndexMap=function(e){for(var t={},r=e.Keys,i=this.context.selects,a=r.length,n=0;n<a;n++){var o=r[n];t[o.Calc||i[o.Select].Value]=n}return t},t.prototype.isCompatible=function(){var e=this.context;return 0===e.maxSecondaryDepth&&e.maxPrimaryDepth<=1},t}()}(t=e.converters||(e.converters={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(e,t){return new i(e,t).run()}t.createTree=r;var i=function(){function t(t,r){this.context=t,this.dsrParser=r,this.calcIndexToCalcMetadataDictionary={},this.aggregator=new e.Aggregator(t)}return t.prototype.run=function(){if(this.isCompatible()){var e={};return this.parseTree(e),{root:e}}},t.prototype.parseTree=function(e){var t=this.dsrParser;t.reset();var r=t.dataShapes(),i=(r.next(),this.context.maxPrimaryDepth);this.aggregator.read(r,1===i),0===i?this.parseDataMembersWithNoGrouping(e,r.primaryHierarchy()):this.parseDataMembers(e,r.primaryHierarchy(),0),this.parseAggregates(e)},t.prototype.parseDataMembers=function(t,r,i){for(;r.next();){var a=this.context,n=r.id(),o=a.dataMemberIdToMetadata[n];if(o){var s=r.instances(),u=this.calcIndexToCalcMetadataDictionary[n];switch(u||(u=[],this.calcIndexToCalcMetadataDictionary[n]=u),o.kind){case 1:var c=a.dataMemberIdToIdentityBuilder[n];c||(c=new e.IdentityBuilder(a,n),a.dataMemberIdToIdentityBuilder[n]=c);var l=c.getIdentityFields();l&&(t.childIdentityFields=l),this.parseInstances(t,s,u,c,!1,i);break;case 2:this.parseInstances(t,s,u,null,!0,i)}}}},t.prototype.parseInstances=function(t,r,i,a,n,o){var s=this.context,u=this.aggregator,c=s.aggregateCalcMetadata,l=t.children;for(n||!l&&r.count()>0&&(l=t.children=new Array(r.count()));r.next();){var p=void 0,d=void 0,f=void 0;n||a.reset();var h=0===i.length;h&&(i.length=r.calcCount());for(var m=0;r.nextCalc();m++){n&&(p=t.values),p||(p={});var v=r.calcId();if(h){var y=s.calcInfo[v];i[m]=y}var g=i[m];if(g){var S=r.calcValue(),C=g.calcKind,x=g.kind,D=g.selectIdx;if(n)this.addTreeNodeMeasureValues(p,D,C,S),0===o&&e.DataShapeUtility.fillMetadataColumnAggregate(S,c[v]);else{var E=g.isGroupKeyButNotSelect;E||this.addTreeNodeMeasureValues(p,D,C,S),x===e.SelectKind.Group?(E||(f=S),a.addExpr(v,r.calcValueAsExpr())):x===e.SelectKind.Measure&&1===C&&(d=S,u.update(S,D))}}}if(n)t.values=p,1===r.restartFlagKind()&&(t.isMerge=!0);else{var w={values:p,identity:a.getIdentity()};void 0!==f&&(w.name=f),void 0!==d&&(w.value=d),1===r.restartFlagKind()&&(w.isMerge=!0);var b=r.members();b&&this.parseDataMembers(w,b,o+1),l[r.currentIndex()]=w}}},t.prototype.addTreeNodeMeasureValues=function(e,t,r,i){var a=e[t];switch(!a&&this.isSupportedMeasureType(r)&&(a=e[t]={}),r){case 1:a.value=i;break;case 2:a.subtotal=i;break;case 3:a.highlight=i;break;case 4:case 5:case 6:}},t.prototype.isSupportedMeasureType=function(e){return 1===e||2===e||3===e},t.prototype.parseDataMembersWithNoGrouping=function(e,t){t.next();var r=t.instances();r.next();for(var i,a=this.context.calcInfo;r.nextCalc();){e.values||(e.values=i={});var n=a[r.calcId()];if(n){var o=n.calcKind,s=r.calcValue();this.addTreeNodeMeasureValues(i,n.selectIdx,o,s),1===o&&(e.value=s)}}},t.prototype.isCompatible=function(){return 0===_.size(this.context.secondaryAxisGroupings)},t.prototype.parseAggregates=function(t){var r=this.context;this.aggregator.copyToColumns();for(var i=r.measureSelectIndices,a=i.length,n=0;n<a;n++){var o=i[n],s=r.selectIndexToColumn[o].aggregates,u=t.values;if(s){u||(u=t.values={});var c=u[o];c||(c=u[o]={}),e.DataShapeUtility.copyAggregates(s,c)}}},t}()}(t=e.converters||(e.converters={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(e,t){if(i.isCompatible(e))return new i(e,t).run()}t.createSingle=r;var i=function(){function t(t,r){this.context=t,this.dsrParser=r,this.aggregator=new e.Aggregator(t)}return t.prototype.run=function(){return this.parseSingle()},t.prototype.parseSingle=function(){var e=this.dsrParser;e.reset();var t=e.dataShapes();t.next();return this.aggregator.read(t,!1),this.aggregator.copyToColumns(),0===this.context.maxPrimaryDepth?this.parseMeasureValue(t.primaryHierarchy()):this.parseSubtotal(t.primaryHierarchy())},t.prototype.parseMeasureValue=function(e){for(;e.next();)return this.parseInstance(e.instances())},t.prototype.parseSubtotal=function(e){for(;e.next();){if(2===this.context.dataMemberIdToMetadata[e.id()].kind)return this.parseInstance(e.instances())}},t.prototype.parseInstance=function(t){for(var r,i,a=this.context,n=a.calcInfo;t.next();)for(;t.nextCalc();){var o=t.calcId(),s=n[o];if(s){var u=s.calcKind,c=2===u;(1===u||c)&&(r=t.calcValue(),i=s.selectIdx,c&&e.DataShapeUtility.fillMetadataColumnAggregate(r,a.aggregateCalcMetadata[o]))}}if(void 0!==r)return{column:a.selectIndexToColumn[i],value:r}},t.isCompatible=function(e){return 0===e.maxSecondaryDepth&&1===e.measureSelectIndices.length},t}()}(t=e.converters||(e.converters={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(i){var a;!function(a){var n;!function(a){function n(r,a,n,s,c,p,d,f){if(!l(n))return null;var h=n.DataShapes[0];if(h["odata.error"]){var m=new e.DsrClientError(h["odata.error"]);return p&&(m.requestId=p),{error:m}}var v=new S(r,a,f,new C(a,h),s),y=u(v).read(a.Expressions,h,c),g={dataView:y};if(h.RestartTokens&&(g.restartToken=h.RestartTokens),h.DataLimitsExceeded&&h.DataLimitsExceeded.length>0){g.warnings||(g.warnings=[]);var x=new i.DsrLimitsWarning(a,h.DataLimitsExceeded,h.Calculations);g.warnings.push(x),o(y,x.limits)}if(h.DataShapeMessages&&h.DataShapeMessages.length>0)for(var D=0,E=h.DataShapeMessages;D<E.length;D++){var w=E[D];i.KnownDsrMessages[w.Code]&&w.Severity===t.dsr.getDsrMessageSeverityValue(0)&&(g.warnings||(g.warnings=[]),g.warnings.push(new i.DsrMessage(w)))}return g.dataView&&!_.isEmpty(d)&&(t.ClientSideFilter.applyClientSideFilters(g.dataView,d),g.disallowPersisting=!0),g}function o(e,t){if(e.metadata.dataReduction={},e.categorical){var r=e.metadata.dataReduction.categorical={};t.Primary&&(r.categories=s(t.Primary)),t.Secondary&&(r.values=s(t.Secondary)),t.Intersection&&(r.metadata=s(t.Intersection))}if(e.matrix){var r=e.metadata.dataReduction.matrix={};t.Primary&&(r.rows=s(t.Primary))}}function s(e){switch(e.Type){case 3:return{binnedLineSample:{}};case 4:return{overlappingPointsSample:{}};default:return{}}}function u(e){if(null!=e.scriptVisualBinding)return new v(e);for(var t=0,r=0,i=e.selects,a=0,n=i.length;a<n;a++){var o=i[a];o&&(null!=o.Depth&&(t=Math.max(t,o.Depth+1)),null!=o.SecondaryDepth&&(r=Math.max(r,o.SecondaryDepth+1)))}return r>=1&&1===t?new g(e):new y(e)}function c(e,t){var r=e.values;r||(r=e.values={});var i=r[t];return i||(i=r[t]={}),i}function l(e){return e&&1===_.size(e.DataShapes)}var p=jsCommon.EnumExtensions,d=jsCommon.PerfTimer,f=i.DataShapeUtility.MaxValueAggregator,h=i.DataShapeUtility.MinValueAggregator;a.read=n,a.applyReductionMetadata=o;var m;!function(e){function t(e,t,r,i){var a=d.start("DSR.matrix("+e.perfId+")"),u=[],c=[],l=[];n(e,u,c,l,i.columns);var p=[],f=s(e,c,l.length,t,r,p),h=o(e,u,t,r,p),m={root:h,levels:u},v={root:f,levels:c},y={rows:m,columns:v,valueSources:l};return a(),y}function r(e){for(var t={sources:[]},r=0,i=e.length;r<i;r++)t.sources.push(e[r]);return t}function a(e,t,r){for(var i=0,a=t.length;i<a;i++){var n=t[i];if(n&&n.index===r&&void 0===n.groupName)return n}return e.createColumns(t,r)}function n(e,t,n,o,s){for(var u=e.selects,c=0,l=u.length;c<l;c++){var p=u[c];if(p){var d=a(e,s,c);if(p.Kind===i.SelectKind.Measure)o.push(d);else if(null!=p.Depth){var f=t[p.Depth];null!=f?f.sources.push(d):t[p.Depth]=r([d])}else if(null!=p.SecondaryDepth){var h=n[p.SecondaryDepth];null!=h?h.sources.push(d):n[p.SecondaryDepth]=r([d])}p.DynamicFormat&&p.DynamicFormat.Format&&e.enableCellLevelFormatting&&o.push(d.formatSource.formatString)}}var m=o.length;(m>1||m>0&&(0===t.length||0===n.length))&&n.push(r(o))}function o(e,t,r,a,n){if(a.PrimaryHierarchy&&0!==a.PrimaryHierarchy.length){var o;r&&r.Primary&&(o=r.Primary.Groupings);var s=0,u=0;r&&(s=l(r.Primary),u=l(r.Secondary));var c=_.filter(e.selects,function(e){return e&&e.Kind===i.SelectKind.Measure});return f(e,t,a.PrimaryHierarchy,o,function(t,r,i,a,o){C(r,c,i,a,n,s,u,e.enableCellLevelFormatting),t.stats.primary++})}}function s(e,t,r,i,a,n){if(!a.SecondaryHierarchy||0===a.SecondaryHierarchy.length){var o={};return p(o,r,0,!1),o}var s;return i&&i.Secondary&&(s=i.Secondary.Groupings),f(e,t,a.SecondaryHierarchy,s,function(r,i,a,o,s){if(s<t.length)if(o.isSubtotal){var c=t.length-1,l=t[c].sources.length;l>1&&p(o,l,c,!0)}else{var d=t[s];p(o,d.sources.length,s,!1)}n.push(u(o)),e.stats.secondary++})}function u(e){return e.isSubtotal?e.level:e.level+1}function l(e){return e&&e.Groupings?e.Groupings.length:0}function p(e,t,r,i){e.children=[];for(var a=0;a<t;a++){var n={level:r};a>0&&(n.levelSourceIndex=a),e.children.push(n),i&&(n.isSubtotal=!0)}}function f(e,t,r,i,a){var n={};return h(e,t,n,r,i,0,a),n}function h(e,t,r,i,a,n,o){if(i)for(var s=e.selects,u=m(t,n),c=0,l=i.length;c<l;c++)for(var p=i[c],d=0,f=0,g=p.Instances.length;f<g;f++){var S=p.Instances[f];if(0===d&&(d=y(s,a,n,p,S),4===d))break;var C={level:n};if(r.children||(r.children=[]),r.children.push(C),1===d){var x=v(s,S.Calculations,u);if(!_.isEmpty(x)){C.levelValues=x;var D=_.last(x);C.value=D.value,D.levelSourceIndex>0&&(C.levelSourceIndex=D.levelSourceIndex)}}else 3===d&&(C.isSubtotal=!0);S.RestartFlag&&1===S.RestartFlag&&(C.isMerge=!0),a&&1===d&&(r.childIdentityFields=e.readKeys(a,n),C.identity=e.readIdentity(a,S,n));var E=S.Members;E&&E.length>0?h(e,t,C,E,a,n+1,o):o&&o(e,d,S,C,n+1)}}function m(e,t){var r=[],i=e&&e[t]&&e[t].sources;if(!_.isEmpty(i))for(var a=0,n=i.length;a<n;a++){var o=i[a];r[o.index]=a}return r}function v(e,t,r){for(var a,n=0,o=e.length;n<o;n++){var s=e[n];if(s&&s.Value&&s.Kind===i.SelectKind.Group){var u=i.DataShapeUtility.findAndParseCalculation(t,s.Value);void 0!==u&&(a||(a=[]),a.push({levelSourceIndex:r[n],value:u}))}}return a}function y(e,t,r,a,n){if(t&&t.length>r&&null!=a.Id){var o=t[r];if(a.Id===o.Member)return 1;if(a.Id===o.SubtotalMember)return 3}var s=n.Calculations;if(s){for(var u=!1,c=0,l=e.length;c<l;c++){var p=e[c];if(p&&i.DataShapeUtility.findCalculation(s,p.Value)){if(p.Kind===i.SelectKind.Group)return 1;u||p.Kind!==i.SelectKind.Measure||(u=!0)}}if(u)return 2}return 4}function g(e,t,r,i,a,n,o,s,u){if(r)for(var c={index:0},l=0,p=t.length;l<p;l++){var d=t[l],f=d.Highlight,h=f&&f.Value,m=f&&f.DynamicFormat&&f.DynamicFormat.Format;if(S(e,r,i,a,c,n,o,s,d,d.Value,h,d.Subtotal),d.DynamicFormat&&d.DynamicFormat.Format&&u){var v=_.map(d.SubtotalDynamicFormat,function(e){return e&&e.Format});S(e,r,i,a,c,n,o,s,d,d.DynamicFormat.Format,m,v)}}}function S(e,t,r,a,n,o,s,l,p,d,f,h){var m=c(r,a.index),v=null;if(3!==e&&(v=i.DataShapeUtility.findAndParseCalculation(t,d)),null==v){var y=u(r),g=x(t,h,y,o,s,l);void 0!==g&&(v=g)}f&&(m.highlight=i.DataShapeUtility.findAndParseCalculation(t,f)),m.value=v,n.index>0&&(m.valueSourceIndex=n.index),a.index++,n.index++}function C(e,t,r,i,a,n,o,s){var u=r.Intersections,c={index:0};if(u){for(var l=0,p=u.length;l<p;l++)if(u[l].Calculations){var d=a[l];g(e,t,u[l].Calculations,i,c,d,n,o,s)}}else g(e,t,r.Calculations,i,c,0,n,o,s)}function x(e,t,r,a,n,o){if(t){var s=i.DataShapeUtility.computeAggIdx(r,a,n,o);if(s<t.length)return i.DataShapeUtility.findAndParseCalculation(e,t[s])}}e.parse=t}(m||(m={}));var v=function(){function e(e){this._context=e}return e.prototype.read=function(e,r,a){var n=this,o={metadata:{columns:[]}};return a.script=d.logTime(function(){if(r.PrimaryHierarchy&&r.PrimaryHierarchy.length>0){var e=r.PrimaryHierarchy[0];if(e&&e.Instances.length>0){var a=e.Instances[0],s=a.Calculations,u=n._context.scriptVisualBinding.PayloadCalculationId||n._context.scriptVisualBinding.ImageCalculationId,c=i.DataShapeUtility.findCalculation(s,u);if(c){var l=c.Value,p=t.PrimitiveValueEncoding.parseBinary(l);p&&(o.scriptResult={payloadBase64:p})}}}}),o},e}(),y=function(){function r(e){this.context=e}return r.prototype.read=function(e,t,r){var i=this,a=this.context,n=this.readMetadata(t.IsComplete),o={metadata:n},s=a.includes(16),u=a.includes(1),c=a.includes(4),l=a.includes(8);if(s||u||c||l){var p,f=d.logTime(function(){p=i.parseTree(n.columns,e,t)});s&&(r.tree=f+d.logTime(function(){var e=i.createTree(n,p);e&&(o.tree=e)})),u&&(r.categorical=f+d.logTime(function(){var e=i.categorize(n,p);e&&(o.categorical=e)})),c&&(r.single=f+d.logTime(function(){var e=i.createSingleValue(n,p);e&&(o.single=e)})),l&&(r.table=f+d.logTime(function(){var e=i.createTable(n,p);e&&(o.table=e)}))}return a.includes(2)&&(r.matrix=d.logTime(function(){var r=m.parse(i.context,e,t,o.metadata);r&&(o.matrix=r)})),o},r.prototype.readMetadata=function(e){for(var t={columns:[]},r=this.context,i=r.selects,a=0,n=i.length;a<n;a++){i[a]?r.createColumns(t.columns,a):r.actionHistory|=1}return e||(t.segment={}),t},r.prototype.parseTree=function(e,t,a){var n=d.start("DSR.tree("+this.context.perfId+")"),o={},s=this.context.selects;this.parseRootAggregates(e,o);var u=i.DataShapeUtility.getTopLevelPrimaryDynamicMember(a,t,!0);if(u){var c=a.PrimaryHierarchy[0];u!==c&&this.parseValues(s,o,r.getFirstInstanceCalcs(c));var l=void 0;t&&t.Primary&&(l=t.Primary.Groupings),this.parseRecursive(o,u,l,0,e)}else _.isEmpty(a.PrimaryHierarchy)||this.parseValues(s,o,r.getFirstInstanceCalcs(a.PrimaryHierarchy[0]));return n(),o},r.prototype.parseRecursive=function(e,t,r,a,n){var o,s=this.context,u=t.Instances,c=u.length;c&&(e.children=[],0===a&&(o=x.create(e,s))),r&&(e.childIdentityFields=s.readKeys(r,a));for(var l=0;l<c;l++){var p=u[l],d={};e.children.push(d),p.RestartFlag&&1===p.RestartFlag&&(d.isMerge=!0),this.parseValues(s.selects,d,p.Calculations,o),r&&(d.identity=s.readIdentity(r,p,a));var f=p.Members;if(this.parseAggregates(s.selects,d,p.Calculations,f,a+1),!_.isEmpty(f)){var h=i.DataShapeUtility.getDynamicMember(f,r,a+1);h&&this.parseRecursive(d,h,r,a+1)}}o&&o.complete(n)},r.getFirstInstanceCalcs=function(e){var t=e.Instances;return t.length>0?t[0].Calculations:null},r.prototype.parseRootAggregates=function(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r],o=n.aggregates;o&&i.DataShapeUtility.copyAggregates(o,c(t,r))}},r.prototype.parseAggregates=function(e,t,r,a,n){for(var o=0,s=e.length;o<s;o++){var u=e[o];if(u){var l=C.parseAggregates(u,r,a,n);if(l){var p=this.context.selectIndexToColumnIndexMap[o];i.DataShapeUtility.copyAggregates(l,c(t,p))}}}},r.prototype.parseValues=function(e,t,r,a){if(!_.isEmpty(r))for(var n=0,o=0,s=e.length;n<s;n++){var u=e[n];if(u){if(u.Value){var l=i.DataShapeUtility.findAndParseCalculation(r,u.Value);void 0!==l&&(u.Kind===i.SelectKind.Group?t.name=l:(t.value=l,a&&a.add(o,l)),c(t,o).value=l)}if(u.Highlight){var p=i.DataShapeUtility.findAndParseCalculation(r,u.Highlight.Value);void 0!==p&&(c(t,o).highlight=p)}if(o++,u.DynamicFormat&&u.DynamicFormat.Format&&this.context.enableCellLevelFormatting){var l=i.DataShapeUtility.findAndParseCalculation(r,u.DynamicFormat.Format);c(t,o).value=l,o++}}}},r.prototype.categorize=function(e,r){if(!this.canCategorize())return null;for(var a,n=d.start("DSR.categorical("+this.context.perfId+")"),o={},s=0,u=e.columns.length;s<u;s++){var c=e.columns[s];if(void 0!==c.index)if(c.isMeasure){var l={source:c,values:[]},p=c.aggregates;p&&i.DataShapeUtility.copyAggregates(p,l),o.values||(o.values=t.DataViewTransform.createValueColumns()),o.values.push(l)}else a||(a=[]),a.push({columnIndex:s,metadataColumn:c})}if(a){o.categories=[];for(var f=void 0,h=0,m=a.length;h<m;h++){var v=a[h],y=r.children,g={source:v.metadataColumn,values:[]};if(y)for(var S=0,C=y.length;S<C;S++){var x=y[S];if(g.values.push(x.values[v.columnIndex].value),0===h&&(this.writeCategoricalValues(e,x,o.values),x.identity&&(f||(f=[]),f.push(x.identity))),x.isMerge){var D=o;D.lastMergeIndex=S}}f&&(g.identity=f),r.childIdentityFields&&(g.identityFields=r.childIdentityFields),o.categories.push(g)}}else this.writeCategoricalValues(e,r,o.values);return n(),o},r.prototype.canCategorize=function(){for(var e=this.context,t=e.selects,r=0,i=t.length;r<i;r++){var a=t[r];if(a&&a.Depth>0)return!1}return!0},r.prototype.createTree=function(t,r){var i=this.context;if(!(2&i.actionHistory||1&i.actionHistory))return{root:r};var a=e.Prototype.inherit(r),n=t.columns,o=r.values;if(o){for(var s={},u=0;u<n.length;u++){var c=n[u];void 0!==c.index&&void 0!==o[u]&&(s[c.index]=o[u])}a.values=s}var l=r.children;return l&&(a.children=this.removeFormatSourceFromTreeChildren(n,l)),{root:a}},r.prototype.removeFormatSourceFromTreeChildren=function(t,r){for(var i=r.length,a=_.map(r,function(e){return e}),n=0;n<i;n++){var o=e.Prototype.inherit(a[n]);a[n]=o;for(var s={},u=0;u<t.length;u++){var c=t[u];void 0!==c.index&&void 0!==a[n].values[u]&&(s[c.index]=a[n].values[u])}a[n].values=s;var l=a[n].children;l&&(a[n].children=this.removeFormatSourceFromTreeChildren(t,l))}return a},r.prototype.createTable=function(e,t){for(var r,i=this.context.selects,a=0,n=i.length;a<n;a++){if(i[a]){var o=i[a].Depth;o>=0&&(r=Math.max(o,r||0))}}if(r>0)return null;var s,u,c=d.start("DSR.table("+this.context.perfId+")"),l=[],p=e.columns.length;if(r>=0){var f=t.children;if(f)for(var a=0,h=f.length;a<h;a++){var m=f[a];this.toTableRow(m,p,l),m.isMerge&&(s=a),m.identity&&(u||(u=[]),u.push(m.identity))}}else this.toTableRow(t,p,l);var v=this.toTotals(t,p),y={rows:l,columns:e.columns};if(u&&(y.identity=u),t.childIdentityFields&&(y.identityFields=t.childIdentityFields),v&&(y.totals=v),s>=0){y.lastMergeIndex=s}return c(),y},r.prototype.toTableRow=function(e,t,r){for(var i=[],a=0;a<t;a++){var n=e.values[a];n&&i.push(n.value)}r.push(i)},r.prototype.toTotals=function(e,t){var r=[],i=e.values,a=!1;if(i)for(var n=0;n<t;n++){var o=i[n],s=o?o.subtotal:null;a=a||null!=s,r.push(s)}return a?r:null},r.prototype.writeCategoricalValues=function(e,t,r){for(var i=e.columns,a=0,n=0,o=i.length;n<o;n++){var s=i[n];if(s.isMeasure&&void 0!==s.index){var u=t.values[n];if(u){var c=r[a++];c.values.push(u.value),void 0!==u.highlight&&(c.highlights||(c.highlights=[]),c.highlights.push(u.highlight))}}}},r.prototype.createSingleValue=function(t,r){if(r.values){for(var i=t.columns,a=null,n=void 0,o=0,s=i.length;o<s;o++)if(i[o].isMeasure&&null!=i[o].index){if(a)return null;a=i[o],n=o}if(!a)return null;var u=r.values[n];if(!u)return null;var c=0===e.DataViewAnalysis.countGroups(t.columns)?u.value:u.subtotal;return void 0===c?null:{column:a,value:c}}return null},r}(),g=function(){function e(e){this._context=e,this._categoriesMetadata=[],this._primaryMeasureSelects=[],this._measureSelects=[],this._secondarySelects=[],this._seriesColumn=null}return e.prototype.read=function(e,t,r){var i=this,a=this._context,n={metadata:this.readMetadata(t.IsComplete)};return a.includes(1)&&(r.categorical=d.logTime(function(){var r=i.categorize(t,n.metadata,e);r&&(n.categorical=r)})),a.includes(2)&&(r.matrix=d.logTime(function(){var r=m.parse(i._context,e,t,n.metadata);r&&(n.matrix=r)})),n},e.prototype.readMetadata=function(e){for(var t={columns:[]},r=this._context,a=r.selects,n=0,o=a.length;n<o;n++){var s=a[n];if(s)if(s.Kind!==i.SelectKind.Measure){var u=r.createColumns(t.columns,n);s.SecondaryDepth>=0?(this._secondarySelects.push(s),this._secondaryDepth=Math.max(this._secondaryDepth||0,s.SecondaryDepth),this._seriesColumn=u):0===s.Depth&&this._categoriesMetadata.push({select:s,column:u})}else 0===s.Depth?this._primaryMeasureSelects.push(s):this._measureSelects.push(s)}return e||(t.segment={}),t},e.prototype.categorize=function(e,t,r){if(0!==this._secondaryDepth||0===this._categoriesMetadata.length)return null;
var a,n,o=d.start("DSR.categorical("+this._context.perfId+", secondary)");r&&(r.Primary&&(a=r.Primary.Groupings),r.Secondary&&(n=r.Secondary.Groupings));var s=i.DataShapeUtility.getTopLevelSecondaryDynamicMember(e,r),u=this.readColumnsFromSecondary(s,t,n,e.Calculations),c=i.DataShapeUtility.getTopLevelPrimaryDynamicMember(e,r),l=this.readCategoriesAndValues(c,t,u,a),p={categories:l.categories,values:u};return void 0!==l.lastMergeIndex&&(p.lastMergeIndex=l.lastMergeIndex),o(),p},e.prototype.readColumnsFromSecondary=function(e,t,r,a){var n,o=this._context;r&&(n=o.readKeys(r,0));var s=[],u=o.selects,c=this._measureSelects.length,l=[],p=e.Instances,d=p.length;if(d)for(var f=0;f<d;f++){var h=p[f],m=h.Calculations,v=void 0;r&&(v=o.readIdentity(r,h,0));for(var y=0,g=this._secondarySelects.length;y<g;y++){for(var S=this._secondarySelects[y],C=i.DataShapeUtility.findAndParseCalculation(m,S.Value),x=[],D=0;D<c;D++){var E=this._measureSelects[D],w=u.indexOf(E),b=o.createColumns(t.columns,w,!0);void 0!==C&&(b.groupName=C);var I={source:b,values:[]};v&&(I.identity=v),this.addColumnAggregates(a,E,I),s.push(I),x.push(I)}l.push({identity:v,name:C,values:x})}}else{for(var D=0;D<c;D++){var E=this._measureSelects[D],w=u.indexOf(E),b=o.createColumns(t.columns,w),I={source:b,values:[]};this.addColumnAggregates(a,E,I),s.push(I)}l.push({values:s.slice()})}for(var D=0,M=this._primaryMeasureSelects.length;D<M;D++){var V=this._primaryMeasureSelects[D],w=u.indexOf(V),b=o.createColumns(t.columns,w),I={source:b,values:[]};s.push(I)}n&&(s.identityFields=n);var R=this._seriesColumn;return R&&(s.source=R),s.grouped=function(){return l},s},e.prototype.addColumnAggregates=function(e,t,r){e&&(t.Max&&(r.max=i.DataShapeUtility.findAndParseCalculation(e,t.Max[0])),t.Min&&(r.min=i.DataShapeUtility.findAndParseCalculation(e,t.Min[0])))},e.prototype.readCategoriesAndValues=function(e,t,r,a){for(var n,o=[],s=this._categoriesMetadata,u=s.length,c=this._context,l=0;l<u;l++){var p={source:s[l].column,values:[]};o.push(p),a&&(n||(n=[]),p.identity=n,p.identityFields=c.readKeys(a,0))}for(var d,f=e.Instances,h=this._primaryMeasureSelects,l=0,m=f.length;l<m;l++){var v=f[l];1===v.RestartFlag&&(d=l);for(var y=0;y<u;y++){var p=o[y];p.values.push(i.DataShapeUtility.findAndParseCalculation(v.Calculations,s[y].select.Value))}n&&n.push(c.readIdentity(a,v,0));for(var g=v.Intersections,S=0,C=0,x=g.length;C<x;C++)for(var D=g[C].Calculations,E=0,w=this._measureSelects.length;E<w;E++){var b=this._measureSelects[E],I=i.DataShapeUtility.findAndParseCalculation(D,b.Value);if(void 0!==I){var M=r[S++];if(M.values.push(I),b.Highlight){M.highlights||(M.highlights=[]);var V=i.DataShapeUtility.findAndParseCalculation(D,b.Highlight.Value);M.highlights.push(V)}}}for(var C=0,x=h.length;C<x;C++){var b=h[C],D=v.Calculations,I=i.DataShapeUtility.findAndParseCalculation(D,b.Value),M=r[S++];if(M.values.push(I),b.Highlight){M.highlights||(M.highlights=[]);var R=i.DataShapeUtility.findAndParseCalculation(D,b.Highlight.Value);M.highlights.push(R)}}}return{categories:o,lastMergeIndex:d}},e}(),S=function(){function e(e,t,r,i,a){this.targets=e,this.selects=t.Select,this.scriptVisualBinding=t.ScriptVisualBinding,this.perfId=r||"",this.stats={id:r||void 0,primary:0,secondary:0},this.aggregateReader=i,this.enableCellLevelFormatting=a,this.cacheItems=[],this.selectIndexToColumnIndexMap={}}return e.prototype.createColumns=function(e,t,r){var i=e.length,a=this.columnMetadata(t,i,r);e.push(a);var n=e.length,o=this.tryCreatingDynamicFormatColumnMetadata(t,n,a);return o&&e.push(o),a},e.prototype.columnMetadata=function(e,t,r){var a=this.selects[e],n={displayName:"",index:e};if(a.Format&&(n.format=a.Format),n.type=i.DataShapeUtility.describeDataType(a.Type,a.DataCategory),a.Kind===i.SelectKind.Measure&&(n.isMeasure=!0),!r){var o=this.aggregateReader.compute(a,t);o&&(n.aggregates=o)}var s=a.GroupKeys;if(s)for(var u=n.identityExprs=[],c=0,l=s;c<l.length;c++){var p=l[c],d=this.convertKey(p);u.push(d)}return this.selectIndexToColumnIndexMap[e]=t,n},e.prototype.tryCreatingDynamicFormatColumnMetadata=function(e,t,r,a){var n=this.selects[e];if(this.enableCellLevelFormatting&&n.DynamicFormat&&n.DynamicFormat.Format){var o={displayName:"",isMeasure:!0};r.formatSource={formatString:o};var s={Kind:i.SelectKind.Measure,Subtotal:_.map(n.SubtotalDynamicFormat,function(e){return e&&e.Format})};if(!a){var u=this.aggregateReader.compute(s,t);u&&(o.aggregates=u)}return this.actionHistory|=2,o}},e.prototype.readIdentity=function(e,r,a){for(var n,o=this.readKeys(e,a),s=e[a].Keys,u=0,c=s.length;u<c;u++){var l=s[u],p=l.Calc||this.selects[l.Select].Value,d=i.DataShapeUtility.findAndParseCalculationToSQExpr(r.Calculations,p),f=t.SQExprBuilder.equal(o[u],d);n=t.SQExprBuilder.and(n,f)}return t.createDataViewScopeIdentity(n)},e.prototype.readKeys=function(e,t){var r=this.getAxisCache(e),i=r.exprs[t];if(void 0===i){i=r.exprs[t]=[];for(var a=e[t].Keys,n=0,o=a.length;n<o;n++)i.push(this.convertKey(a[n]))}return i},e.prototype.includes=function(e){return p.hasFlag(this.targets,e)},e.prototype.getAxisCache=function(e){for(var t=this.cacheItems,r=0,i=t.length;r<i;r++){var a=t[r];if(a.axisGroupings===e)return a}var n={axisGroupings:e,exprs:[]};return t.push(n),n},e.prototype.convertKey=function(e){var i=e.Source;return t.SQExprBuilder.columnRef(t.SQExprBuilder.entity(r.schemaName(i),i.Entity||i.EntitySet),i.Property)},e}(),C=function(){function e(e,t){this.selects=e.Select,this.dataShape=t}return e.prototype.compute=function(t,r,i){var a=this.cache;if(a){var n=a[r];if(n)return n}if(t){a||(this.cache=a={});var o=this.dataShape,s=e.parseAggregates(t,o.Calculations,o.PrimaryHierarchy,0);return i&&!s&&(s={}),a[r]=s,s}},e.prototype.updateAggregates=function(e,t,r,i){var a=this.compute(e,t,!0);if(a)return a[r]=i,a},e}();!function(e){function t(e,t,r,a){var n=!_.isEmpty(r)&&y.getFirstInstanceCalcs(r[0]);if(!_.isEmpty(t)||!_.isEmpty(n)){var o;if(!_.isEmpty(n)&&e.Subtotal){var s=e.Subtotal[a];if(s){var u=i.DataShapeUtility.findAndParseCalculation(n,s);void 0!==u&&(o||(o={}),o.subtotal=u)}}if(!_.isEmpty(t)){if(e.Max){var s=e.Max[a];if(s){var u=i.DataShapeUtility.findAndParseCalculation(t,s);void 0!==u&&(o||(o={}),o.max=u)}}if(e.Min){var s=e.Min[a];if(s){var u=i.DataShapeUtility.findAndParseCalculation(t,s);void 0!==u&&(o||(o={}),o.min=u)}}if(e.Count){var s=e.Count[a];if(s){var u=i.DataShapeUtility.findAndParseCalculation(t,s);void 0!==u&&(o||(o={}),o.count=u)}}var c=e.Aggregates;if(c)for(var l=0,p=c;l<p.length;l++){var d=p[l],f=d.Aggregate,s=d.Ids[a];if(s){var u=i.DataShapeUtility.findAndParseCalculation(t,s);if(void 0!==u){var h=f.Percentile;if(h){var m={k:h.K,value:u};h.Exclusive&&(m.exclusive=h.Exclusive),o||(o={});var v=o.percentiles;v||(v=o.percentiles=[]),v.push(m)}else f.Average?(o||(o={}),o.average=u):f.Median&&(o||(o={}),o.median=u)}}}if(0===a){var s=e.Value;if(s){var u=i.DataShapeUtility.findAndParseCalculation(t,s);void 0!==u&&(o||(o={}),o.single=u)}}}return o}}e.parseAggregates=t}(C||(C={}));var x=function(){function e(e,t,r,i,a){this.node=e,this.aggregateReader=t,this.selects=r,this.enableCellLevelFormatting=a,this.aggregators=i}return e.create=function(t,r){for(var a=t.values,n=r.selects,o=!1,s={},u=0,c=0,l=n.length;u<l;u++){var p=n[u];if(p)if(p.Kind===i.SelectKind.Measure){var d=void 0,m=void 0;if(a&&(m=a[c])){if(d=[],void 0===m.min&&d.push(new h),void 0===m.max&&d.push(new f),0===d.length){c++;continue}}else d=[new h,new f];s[c]=d,o=!0,c++,p.DynamicFormat&&p.DynamicFormat.Format&&r.enableCellLevelFormatting&&c++}else c++}if(o)return new e(t,r.aggregateReader,r.selects,s,r.enableCellLevelFormatting)},e.prototype.add=function(e,t){var r=this.aggregators[e];if(r)for(var i=0,a=r.length;i<a;i++)r[i].update(t)},e.prototype.complete=function(e){for(var t=this.aggregators,r=this.node,i=this.aggregateReader,a=0,n=0,o=this.selects.length;a<o;a++){var s=this.selects[a];if(s){var u=t[n];if(u){for(var l=0,p=u.length;l<p;l++){var d=u[l],f=d.value();if(void 0!==f){var h=d.name;c(r,n)[h]=f;e[n].aggregates=i.updateAggregates(s,n,h,f)}}n++,s&&s.DynamicFormat&&s.DynamicFormat.Format&&this.enableCellLevelFormatting&&n++}else n++}}},e}()}(n=a.V1||(a.V1={}))}(a=i.reader||(i.reader={}))}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){var i;!function(i){function a(e,t){return new o(e,t)}function n(e){var t=e.toString(2),r=t.substr(0,t.length-g);return parseInt(r,2)}i.createDsrParser=a;var o=function(){function e(e,t){this.dsrParserContext=t,this.parser=new c(e.DS,this.dsrParserContext)}return e.prototype.dataShapes=function(){return this.parser},e.prototype.reset=function(){this.parser.reset()},e.prototype.lockCache=function(){this.dsrParserContext.locked||(this.dsrParserContext.locked=!0)},e}(),s=function(){function e(e){this.calculationContainerKind=e,this.nullValuesHandler=new v,this.repeatedValuesHandler=new y}return e.prototype.initialize=function(e,t){this.lastContainerCalculations=t,this.repeatedValuesHandler.initialize(e&&e.R,t),this.nullValuesHandler.initialize(e&&e.Ø)},e.prototype.getCurrentCalc=function(e,t,r,i){if(!r)return null;var a;return a=this.repeatedValuesHandler.tryRead(e),void 0!==a?a:(a=this.nullValuesHandler.tryRead(e),void 0!==a?(this.lastContainerCalculations[e]=null,a):(t?t.next()&&(a=t.current(),this.lastContainerCalculations[e]=a):(a=r[i],void 0===a&&(a=null),this.lastContainerCalculations[e]=a),a))},e}(),u=function(){function t(e,t,r){this.context=e,this.calcMetadataCacheKey=r,this.baseCalculationParser=new s(t)}return t.prototype.setCalculations=function(e){this.calculationContainer=e;var t=this.context;if(t){var i=this.calcMetadataCacheKey,a=e.S;a&&(this.metadata=a,i&&!t.locked&&(t.memberInstanceCalcMetadataCache[i]=a),this.lastContainerCalculations||(this.lastContainerCalculations=new Array(a.length))),t.instancesCalcCache[i]&&(this.lastContainerCalculations=t.instancesCalcCache[i]),this.baseCalculationParser.initialize(e,this.lastContainerCalculations);var n=e.C;a=this.getCalcMetadata(),a?this.calcMetadataIt=new r.Iterator(a):this.calcMetadataIt&&this.calcMetadataIt.reset(),_.size(n)>0?this.calcIt=new r.Iterator(n):this.calcIt=void 0}},t.prototype.restartCalcs=function(){this.calcIt&&this.calcIt.reset(),this.calcMetadataIt.reset(),delete this.dsrCalcValue},t.prototype.nextCalc=function(){var e=!1,t=this.calcMetadataIt;return t&&(e=t.next()||e,e&&(this.dsrCalcValue=this.baseCalculationParser.getCurrentCalc(t.index(),this.calcIt,this.calculationContainer,this.calcId())),t.done()&&(this.context.instancesCalcCache[this.calcMetadataCacheKey]=this.lastContainerCalculations)),e||!1},t.prototype.calcId=function(){return this.metadata[this.calcMetadataIt.index()].N},t.prototype.getCalcMetadata=function(){var e=this.metadata;return e||(e=this.metadata=this.context.memberInstanceCalcMetadataCache[this.calcMetadataCacheKey]),e},t.prototype.calcValue=function(){var t=this.metadata[this.calcMetadataIt.index()],r=this.context.valueDictionaryHandler.getCalcValue(this.dsrCalcValue,t.DN,t.T);return void 0===r&&(r=e.PrimitiveValueEncoding.parseOptimizedValue(this.dsrCalcValue,t.T)),r},t.prototype.calcValueAsExpr=function(){var t=this.calcMetadataIt.current(),r=this.calcValue(),i=this.context.valueDictionaryHandler.getCalcValueExpr(r,this.dsrCalcValue,t.DN,t.T);return i||(i=e.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(r,this.dsrCalcValue,t.T)),i},t.prototype.calcCount=function(){return this.calcMetadataIt?this.calcMetadataIt.count():this.calcIt?this.calcIt.count():0},t}(),c=function(e){function i(t,i){var a=e.call(this,i,1)||this;return a.parserContext=i,a.it=new r.Iterator(t),a}return __extends(i,e),i.prototype.reset=function(){this.it.reset()},i.prototype.index=function(){return this.it.index()},i.prototype.count=function(){return this.it.count()},i.prototype.next=function(){this.primaryHierarchyParser=this.secondaryHierarchyParser=this.messageParser=void 0;var e=this.it.next();if(e){var r=this.it.current();this.setCalculations(r),this.context&&(this.context.valueDictionaryHandler=new t.ValueDictionaryHandler(r.ValueDicts))}return e},i.prototype.primaryHierarchy=function(){if(!this.primaryHierarchyParser&&this.parserContext){var e=this.it.current().PH;this.primaryHierarchyParser=e&&new d(e,this.parserContext,0,0)}return this.primaryHierarchyParser},i.prototype.secondaryHierarchy=function(){if(!this.secondaryHierarchyParser&&this.parserContext){var e=this.it.current().SH;this.secondaryHierarchyParser=e&&new d(e,this.parserContext,1,0)}return this.secondaryHierarchyParser},i.prototype.messages=function(){return!this.messageParser&&_.size(this.it.current().Msg)>0&&(this.messageParser=new p(this.it.current().Msg)),this.messageParser},i.prototype.hasRestartTokens=function(){return _.size(this.restartTokens())>0},i.prototype.restartTokens=function(){return this.it.current().RT},i.prototype.complete=function(){return this.it.current().IC},i.prototype.hasAllData=function(){return this.it.current().HAD},i.prototype.limitsExceeded=function(){return _.size(this.it.current().DLEx)>0},i.prototype.limits=function(){return this.limitsParser||(this.limitsParser=new l(this.it.current().DLEx)),this.limitsParser},i}(u),l=function(){function e(e){this.it=new r.Iterator(e)}return e.prototype.next=function(){return this.it.next()},e.prototype.id=function(){return this.it.current().N},e.prototype.count=function(){return this.it.count()},e}(),p=function(){function e(e){this.it=new r.Iterator(e)}return e.prototype.next=function(){return this.it.next()},e.prototype.code=function(){return this.it.current().Code},e.prototype.severity=function(){return this.it.current().Severity},e.prototype.dsrMessage=function(){return new t.DsrMessage(this.it.current())},e}(),d=function(){function e(e,t,i,a){this.context=t,this.hierarchy=i,this.depth=a,this.it=new r.Iterator(e)}return e.prototype.count=function(){return this.it.count()},e.prototype.reset=function(){this.it.reset(),this.dataMemberId=void 0},e.prototype.next=function(){this.instancesParser&&(this.instancesParser=void 0),this.dataMemberId&&(this.dataMemberId=void 0);var e=this.it.next();if(e){var t=this.dataMemberIdCache();if(_.size(t)>0)for(var r=this.it.current(),i=0,a=t[this.depth];i<a.length;i++){var n=a[i];r[n]&&(this.dataMemberId=n)}if(void 0===this.dataMemberId){var o=Object.keys(this.it.current());1===_.size(o)&&(this.dataMemberId=o[0])}}return e},e.prototype.id=function(){return this.dataMemberId},e.prototype.dataMemberIdCache=function(){return 0===this.hierarchy?this.context.primaryDataMemberIdCache:this.context.secondaryDataMemberIdCache},e.prototype.instances=function(){if(!this.instancesParser){var e=this.it.current()[this.dataMemberId];this.instancesParser=e&&new f(e,this.context,this.id(),this.hierarchy,this.depth)}return this.instancesParser},e}(),f=function(e){function t(t,i,a,n,o){var s=e.call(this,i,2,a)||this;return s.parentDataMemberId=a,s.hierarchy=n,s.depth=o,s.it=new r.Iterator(t),s}return __extends(t,e),t.prototype.next=function(){var e=this.it.next();if(e){var t=this.it.current();this.context.locked||t.M||1!==this.hierarchy||this.context.secondaryLeafDataMemberId.push(this.parentDataMemberId),this.setCalculations(t),this.dataMemberIt=void 0,this.intersectionParserDirty=!0}return e},t.prototype.count=function(){return this.it.count()},t.prototype.currentIndex=function(){return this.it.index()},t.prototype.intersections=function(){if(!this.intersectionParser){this.intersectionParserDirty=!1;var e=this.it.current().X;return this.intersectionParser=e&&new h(e,this.context,this.parentDataMemberId)}return this.intersectionParserDirty?(this.intersectionParserDirty=!1,this.intersectionParser.reset(this.it.current().X),this.intersectionParser):this.intersectionParser},t.prototype.restartFlagKind=function(){return this.it.current().RF},t.prototype.restartKind=function(){return this.it.current().RK},t.prototype.members=function(){if(!this.dataMemberIt){var e=this.it.current().M;this.dataMemberIt=e&&new d(e,this.context,this.hierarchy,this.depth+1)}return this.dataMemberIt},t}(u),h=function(){function i(e,t,i){this.context=t,this.parentDataMemberId=i,this.it=new r.Iterator(null),this.reset(e),this.baseCalculationParser=new s(3),this.intersectionMeasureCount=_.size(this.context.intersectionMeasureToSelectIndex),this.expectedIntersectionCount=_.size(this.context.secondaryLeafDataMemberId);var a=t.dataMemberIdToMetadata[i];this.primaryMemberIsGroupMember=1===a.kind,this.primaryDataMemberDepth=a.depth,this.calcMetadataCache=t.intersectionCalcMetadataCache[i],this.calcMetadataCache||t.locked||(this.calcMetadataCache=t.intersectionCalcMetadataCache[i]=new Array(this.expectedIntersectionCount))}return i.prototype.reset=function(e){this.it.reset(e),this.logicalIntersectionIndex=-1,this.physicalIntersectionIndex=-1,this.hasIntersectionElements=e.length>0},i.prototype.next=function(){if(this.resetCalcIt(),this.logicalIntersectionIndex++,this.logicalIntersectionIndex>=this.expectedIntersectionCount)return!1;if(this.setIntersectionId(),this.it.count()===this.expectedIntersectionCount){var e=this.it.next();return e&&this.initialize(this.it.current()),e}if(this.hasIntersectionElements){var t=void 0;if((0===this.logicalIntersectionIndex||this.physicalIntersectionIndex<this.logicalIntersectionIndex)&&this.it.next()&&(t=this.it.current(),t.I||0===this.logicalIntersectionIndex?this.physicalIntersectionIndex=t.I||0:this.physicalIntersectionIndex++),this.physicalIntersectionIndex===this.logicalIntersectionIndex)return t||(t=this.it.current()),this.initialize(t),!0}return this.initialize(),!0},i.prototype.setIntersectionId=function(){this.intersectionId=this.parentDataMemberId+this.context.secondaryLeafDataMemberId[this.logicalIntersectionIndex]},i.prototype.resetCalcIt=function(e){var t=e&&e.C;this.currentCalcIndex=-1,this.currentCalc=void 0,t?this.calcIt=new r.Iterator(t):this.calcIt=void 0},i.prototype.initialize=function(e){if(this.resetCalcIt(e),e){var t=e.S;if(t&&!this.context.locked){void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=t.length),this.calcMetadataCache[this.logicalIntersectionIndex]=t;for(var r=this.context.calcIdToCalcMetadata,i=0,a=t;i<a.length;i++){r[a[i].N]=t}}}this.calculationContainer=e;var n=this.context.lastIntersectionCalcCache[this.intersectionId];!n&&this.intersectionId&&(n=this.context.lastIntersectionCalcCache[this.intersectionId]=new Array(this.intersectionCalcCount)),this.baseCalculationParser.initialize(e,n);var o=this.getCalcMetadata();o&&(this.currentCalcMetadata=o,void 0===this.intersectionCalcCount&&(this.intersectionMeasureCount>0?this.intersectionCalcCount=this.currentCalcMetadata.length:this.intersectionCalcCount=0))},i.prototype.restartCalcs=function(){this.calcIt&&this.calcIt.reset(),this.currentCalcIndex=-1,delete this.currentCalc},i.prototype.nextCalc=function(){var e=++this.currentCalcIndex;return e<this.intersectionCalcCount?(this.currentCalc=this.baseCalculationParser.getCurrentCalc(e,this.calcIt,this.calculationContainer,this.calcId()),!0):(this.currentCalc=void 0,!1)},i.prototype.calcId=function(){return this.currentCalcMetadata[this.currentCalcIndex].N},i.prototype.getCalcMetadata=function(){var e=this.calcMetadataCache[this.logicalIntersectionIndex];if(!e&&!this.context.locked){var t=this.getExpectedCalcId();t&&(e=this.calcMetadataCache[this.logicalIntersectionIndex]=this.context.calcIdToCalcMetadata[t])}return e},i.prototype.getExpectedCalcId=function(){if(0!==this.intersectionMeasureCount){var e=this.context,r=e.dataMemberIdToMetadata[e.secondaryLeafDataMemberId[this.logicalIntersectionIndex]],i=1===r.kind,a=this.currentCalcIndex<0?e.intersectionMeasureToSelectIndex[0]:e.intersectionMeasureToSelectIndex[this.currentCalcIndex],n=e.selects[a];if(i&&this.primaryMemberIsGroupMember)return n.Value;if(n.Subtotal){var o=t.DataShapeUtility.computeAggIdx(this.primaryDataMemberDepth,r.depth,e.maxPrimaryDepth,e.maxSecondaryDepth);return n.Subtotal.length>o&&n.Subtotal[o]}}},i.prototype.calcValue=function(){return void 0!==this.currentCalc&&null!==this.currentCalc?this.parseCalcValue(this.currentCalc):null},i.prototype.parseCalcValue=function(t){var r=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],i=this.context.valueDictionaryHandler.getCalcValue(t,r.DN,r.T);return void 0===i&&(i=e.PrimitiveValueEncoding.parseOptimizedValue(t,r.T)),i},i.prototype.calcValueAsExpr=function(){if(void 0!==this.currentCalc)return this.parseCalcValueExpr(this.currentCalc,this.calcValue());if(this.it.index()===this.logicalIntersectionIndex){var t=this.calcValue();return null===t?e.SQExprBuilder.nullConstant():this.parseCalcValueExpr(this.it.current()[this.calcId()],t)}return e.SQExprBuilder.nullConstant()},i.prototype.parseCalcValueExpr=function(t,r){var i=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],a=this.context.valueDictionaryHandler.getCalcValueExpr(r,t,i.DN,i.T);return void 0===a&&(a=e.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(r,t,i.T)),a},i.prototype.calcCount=function(){return this.calcIt?this.calcIt.count():0},i}(),m=function(){function e(){}return e.prototype.initialize=function(t){this.value=t,t>e.MaxSignedNumberFor32Bits?this.overflowValue=n(t):this.overflowValue=0},e.prototype.hasBitAtPosition=function(e){if(e>52)return!1;if(this.value>0){var t=0,r=this.value;return e<31?t=1<<e:(t=1<<e-31,r=this.overflowValue),(r&t)>0}},e.MaxSignedNumberFor32Bits=Math.pow(2,31)-1,e}();i.BitSequenceHandler=m;var v=function(){function e(){this.bitSequenceHandler=new m}return e.prototype.initialize=function(e){this.bitSequenceHandler.initialize(e)},e.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return null},e}(),y=function(){function e(){this.bitSequenceHandler=new m}return e.prototype.initialize=function(e,t){this.bitSequenceHandler.initialize(e),this.lastContainerCalculations=t},e.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return this.lastContainerCalculations[e]},e}(),g=31;i.getLast33BitsIn64Bits=n}(i=r.V2||(r.V2={}))}(r=t.reader||(t.reader={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){function r(e,t){var r=t.options;if(1===r.executionType){var i=_.findIndex(e,function(e){return e.options.queryId===r.queryId});if(i>-1)return!0}return!1}function i(e){return!!t.isRejectableQueuedExecution(e)&&e.execution.rejected()}var a=jsCommon.JsonComparer,n=4;t.http2MaxConnections=20;var o=function(){function o(e,t,r,i){this.preferredMaxBatchesConfigured=e>0,this.maxBatches=this.preferredMaxBatchesConfigured?e:n,this.queryExecuteCallback=t,this.pending=[],this.timeoutService=r,this.telemetryV2Enabled=i,this.useHttp2QueryDataEnabled=jsCommon.BrowserUtils.browserSupportsHttp2()}return o.prototype.enqueue=function(t){var i=this;if(!r(this.pending,t))return this.pending.push(t),this.currentBatchDeferred||(this.currentBatchDeferred=t.options.telemetryV2Enabled?new e.PbiDeferred((!0)):$.Deferred(),this.timeoutService.setTimeout(0,this.telemetryV2Enabled).promise.then(function(){var e=i.createBatches();i.clearPending(),i.queryExecuteCallback(e),i.currentBatchDeferred.resolve(),i.currentBatchDeferred=void 0})),t.options.telemetryV2Enabled?this.currentBatchDeferred.promise:this.currentBatchDeferred.promise()},o.prototype.clearPending=function(){this.pending=[]},o.prototype.setMaxBatches=function(e){this.maxBatches=e,this.preferredMaxBatchesConfigured=e>0},o.prototype.createBatches=function(){var e=[],r=this.sortQueriesByDataSource(),i=this.maxBatches,a=!1;if(!this.preferredMaxBatchesConfigured&&this.useHttp2QueryDataEnabled){_.some(r,function(e){return _.some(e.dataSources,function(e){return e.isLimitedParallelQueryModel})})||(i=t.http2MaxConnections,a=!0)}if(r.length>=i)for(var n=0,o=r.length;n<o;++n)e.push(this.createBatchFromDataSourceGroup(r[n]));else e=this.splitDataSourcesIntoBatches(r,i);return a&&_.forEach(e,function(e){return e.useSynchronous=!0}),e},o.prototype.sortQueriesByDataSource=function(){for(var e=[],t=this.pending,r=0,a=t.length;r<a;++r){var n=t[r];if(!i(n)){var o=this.findDataSourceGroup(n.options.dataSources,e,n.options.cacheResponseOnServer);if(o)o.queuedExecutions.push(n);else{var s={dataSources:n.options.dataSources,queuedExecutions:[n],cacheResponseOnServer:n.options.cacheResponseOnServer,cacheOptions:n.options.cacheOptions};e.push(s)}}}return e},o.prototype.findDataSourceGroup=function(e,t,r){for(var i=0,n=t.length;i<n;++i){var o=t[i];if(a.equals(e,o.dataSources)&&o.cacheResponseOnServer===r)return o}return null},o.prototype.createBatchFromDataSourceGroup=function(e){for(var r=[],i=[],a=e.queuedExecutions,n=[],o=[],s=[],u=[],c=0,l=a.length;c<l;++c){var p=a[c],d=a[c].options;t.isRejectableQueuedExecution(p)?(r.push(d.command),i.push(p.deferred),n.push(d.queryId),s.push(d.applicationContext),1===d.requestPriority&&o.push(1)):u.push(d.queryId)}return{dataSources:e.dataSources,queries:r,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,queryIds:n,cancelQueryIds:u,priorities:o,applicationContexts:s}},o.prototype.splitDataSourcesIntoBatches=function(e,t){for(var r=[],i=0,a=e.length;i<a;++i)r.push(this.createBatchFromDataSourceGroup(e[i]));return r=this.splitBatches(r,t)},o.prototype.splitBatches=function(e,t){for(var r=e.slice();r.length<t;){for(var i=void 0,a=0,n=r.length;a<n;++a){var o=r[a];o.queries.length>1&&(!i||i.queries.length<o.queries.length)&&(i=o)}if(!i)return r;r.push(this.splitBatch(i)),i=null}return r},o.prototype.splitBatch=function(e){var t=e.queries.length,r=e.queries.splice(t/2),i=e.promises.splice(t/2),a=e.queryIds.splice(t/2),n=e.applicationContexts.splice(t/2),o=e.cancelQueryIds.length,s=[];return o&&(s=e.cancelQueryIds.splice(o/2)),{dataSources:e.dataSources,queries:r,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,queryIds:a,cancelQueryIds:s,priorities:e.priorities,applicationContexts:n}},o}();t.ExecuteSemanticQueryBatcher=o}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){function r(e,t,r,i,a,n,o,s){return new c(e,t,r,i,a,n,o,s)}function i(e){return _.head(e)}function a(e){return null!=e&&void 0!==e.deferred&&void 0!==e.execution}function n(e){return!!a(e)&&e.execution.pending()}var o=e.ClientErrorStrings,s=e.telemetry.DataQueryDataEventName,u=jsCommon.HttpUtils;t.createExecuteSemanticQueryProxyHttpCommunication=r,t.executeSemanticQueryRequestVersion1="1.0.0";var c=function(){function r(e,t,r,i,a,n,o,s){this.httpService=e,this.impersonationStateProvider=n,this.promiseFactory=i,this.telemetryService=t,this.localeProvider=r,this.uri=a,this.featureSwitches=o,this.directToMwcConnectionInfoService=s}return r.prototype.execute=function(e,r,i,a,n,o,s,u,c){var l=this.httpService.powerbiRequestOptions(null,"ExecuteSemanticQuery"),p=t.generateSemanticQueryRequest(e,r,this.localeProvider,i,a,this.impersonationStateProvider,n,o,s,u),d=this.featureSwitches&&this.featureSwitches().telemetryV2,f=this.promiseFactory.defer(d),h=this.uri;c&&(h+="?synchronous=true");var m=h,v=l.authorizationHeaderOverride,y=p.modelId;if(this.featureSwitches&&this.featureSwitches().directToMwc&&this.directToMwcConnectionInfoService){var g=this.directToMwcConnectionInfoService.checkModelConnectionInfo(y);!g||this.impersonationStateProvider&&this.impersonationStateProvider.impersonating?this.sendHttpRequest(h,p,l,f,m,v,i,c):this.sendDirectToMwcRequestWithFallbackOnFailure(g,h,p,l,f,y,m,v,i,c)}else this.sendHttpRequest(h,p,l,f,m,v,i,c);return f.promise},r.prototype.sendDirectToMwcRequestWithFallbackOnFailure=function(t,r,i,a,n,o,s,u,c,l){var p=this;r=t.capacityUri+"query",a.mwcTokenAuthorizationModelId=o,a.authorizationHeaderOverride=t.mwcToken;var d=this.telemetryService.startEvent(e.telemetry.DataQueryData,this.uri,!0,null,null,l,c);a.headers["x-ms-parent-activity-id"]=d.event.id,this.httpService.post(r,i,a).then(function(e){p.attachHttpMetadataToTelemetry(d.event,e,r),d.resolve(),n.resolve(p.attachHttpMetadataToResult(e))},function(t){p.attachHttpMetadataToTelemetry(d.event,t,r),d.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),p.directToMwcConnectionInfoService.removeModelConnectionInfo(o),a.authorizationHeaderOverride=u,a.mwcTokenAuthorizationModelId=null,p.sendHttpRequest(s,i,a,n,s,u,c,l)})},r.prototype.sendHttpRequest=function(t,r,i,a,n,o,s,u){var c=this,l=this.telemetryService.startEvent(e.telemetry.DataQueryData,this.uri,!0,null,null,u,s);this.httpService.post(t,r,i).then(function(e){c.attachHttpMetadataToTelemetry(l.event,e,t),l.resolve(),a.resolve(c.attachHttpMetadataToResult(e))},function(r){c.attachHttpMetadataToTelemetry(l.event,r,t),l.reject(e.errorDetailsHelper.getTelemetryErrorDetails(r.error,r.status)),a.reject(c.attachHttpMetadataToResult(r))})},r.prototype.attachHttpMetadataToTelemetry=function(e,t,r){e.info.endPoint=r,e.info.clientAndServerRequestIdMatch=u.clientAndServerRequestIdMatch(t),e.info.responseRequestId=u.getResponseRequestId(t),e.info.requestId=t.requestId},r.prototype.attachHttpMetadataToResult=function(e){if(e&&e.data){var t=e.data;return t.requestId=e.responseRequestId||e.requestId,t.httpStatusCode=e.status,t}return{jobIds:null,results:null,requestId:e.responseRequestId||e.requestId,httpStatusCode:e.status}},__decorate([e.MonitorWith(s)],r.prototype,"execute",null),r}(),l=function(){function r(r,i,a,n,o,s,u){var c=this;this.communication=i,this.telemetryService=n,this.promiseFactory=r.promiseFactory(),this.delayedQueryResultResolver=o?o:new p,this.batcher=new t.ExecuteSemanticQueryBatcher(null==s?0:s,function(e){for(var t=0,r=e.length;t<r;++t)c.executeBatch(e[t])},a,u&&u.telemetryV2),this.queryCache=t.createQueryCache(this.promiseFactory,function(e,t){c.enqueueExecution({options:e,deferred:t.deferred,execution:t.promise})},function(t,r){c.telemetryService.logEvent(e.telemetry.DataQueryCancellation,r),c.enqueueExecution({options:t})},u)}return r.prototype.enqueueExecution=function(e){this.isCommunicationStopped?(this.pausedQueries=this.pausedQueries||[],this.pausedQueries.push(e)):this.batcher.enqueue(e)},r.prototype.execute=function(t){if(!_.isEmpty(t.dataSources))return this.queryCache.ensure(t);var r=this.promiseFactory.defer(t.telemetryV2Enabled),i=e.createRejectablePromise2(r);return r.resolve(t.command),i},r.prototype.stopCommunication=function(){this.isCommunicationStopped=!0},r.prototype.resumeCommunication=function(){this.isCommunicationStopped=!1;var e=this.pausedQueries;if(e){for(var t=0,r=e.length;t<r;t++){var i=e[t];n(i)&&this.batcher.enqueue(i)}this.pausedQueries=void 0}},r.prototype.cache=function(){return this.queryCache},r.prototype.setLocalCacheResult=function(e,t){this.queryCache.put(e.dataSources,e.command,t)},r.prototype.setPreferredMaxConnections=function(e){this.batcher.setMaxBatches(e)},r.prototype.executeBatch=function(e){var t=this,r=e.promises;this.communication.execute(e.queries,e.dataSources,e.cacheOptions,e.cacheResponseOnServer,e.queryIds,e.cancelQueryIds,e.priorities,e.applicationContexts,e.useSynchronous).then(function(e){return t.onSuccess(e,r)},function(e){return t.onError(e,r)})},r.prototype.onSuccess=function(r,i){this.rejectExecutionsForMissingJobs(r,i);for(var a=r.jobIds,n={},o=0,s=i.length;o<s;++o)n[a[o]]=i[o];for(var u=r.results,o=0,s=u.length;o<s;++o){var c=u[o],l=c.result,p=c.jobId,d=n[p];delete n[p];var f=l.data,h=l.error;if(f){var m={descriptor:f.descriptor,dsr:f.dsr,metrics:f.metrics,requestId:r.requestId,timestamp:f.timestamp,fromCache:f.fromCache};d.resolve(m)}else if(h){var v=new e.ServiceErrorToClientError(h);v.requestId=r.requestId,d.reject(v)}else l.asyncResult&&this.delayedQueryResultResolver.resolveDelayedQuery(c.jobId,r.requestId,d)}if(!_.isEmpty(Object.keys(n))){var h=new t.ExecuteSemanticQueryProxyError(r.requestId,"MissingJobResult");for(var p in n)n[p].reject(h)}},r.prototype.rejectExecutionsForMissingJobs=function(e,r){
var i=e.jobIds.length,a=r.length;if(a>i)for(var n=new t.ExecuteSemanticQueryProxyError(e.requestId,"MissingJobId"),o=i;o<a;o++)r[o].reject(n)},r.prototype.onError=function(t,r){var i;if(t&&t.requestError&&(i=new e.ServiceErrorToClientError(t.requestError)),i)i.requestId=t.requestId;else{var a=t.error,n=void 0,o=void 0,s=void 0;if(a){n=a.message,o=a.code;var u=a["pbi.error"]&&a["pbi.error"].exceptionCulprit;null!=u&&(s=e.errorDetailsHelper.getErrorSource(u))}i=t&&null!=t.httpStatusCode&&t.requestId?new e.HttpClientError(t.httpStatusCode,t.requestId,o,n,s):new d(t.requestId)}for(var c=0,l=r.length;c<l;c++)r[c].reject(i)},r}();t.ExecuteSemanticQueryProxy=l;var p=function(){function e(){}return e.prototype.resolveDelayedQuery=function(e,t,r){r.reject(new f(e))},e}(),d=function(e){function t(t){var r=this;return r=e.call(this,"ExecuteSemanticQueryUnknownError")||this,r.httpRequestId=t,r}return __extends(t,e),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!0,configurable:!0}),t.prototype.getDetails=function(t){var r=e.prototype.getDetails.call(this,t);return r.debugErrorInfo=r.debugErrorInfo||[],r.debugErrorInfo.push({errorInfoKey:o.HttpRequestId,errorInfoValue:this.httpRequestId}),r},t}(e.UnknownClientError),f=function(e){function t(t){var r=this;return r=e.call(this,"DelayedQueryTimeoutError")||this,r.jobId=t,r}return __extends(t,e),t.prototype.getDetails=function(t){var r=e.prototype.getDetails.call(this,t);return r.debugErrorInfo=r.debugErrorInfo||[],r.debugErrorInfo.push({errorInfoKey:o.JobId,errorInfoValue:this.jobId}),r},t}(e.UnknownClientError);t.single=i,t.isRejectableQueuedExecution=a}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(e,t){this.requestId=e,this.errorCode=t}return Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getDetails=function(t){return{message:t.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:t.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:t.get("ServiceError_ExecuteSemanticQueryErrorValue")},{errorInfoKey:t.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:this.code}],debugErrorInfo:[{errorInfoKey:e.ClientErrorStrings.ClientErrorCode,errorInfoValue:this.code}]}},t}();t.ExecuteSemanticQueryProxyError=r}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e){for(var t=[],a={},n=0,o=e;n<o.length;n++){var s=o[n],u={id:s.Id,name:s.Name,component:s.Component,start:i.parseIsoDate(s.Start).valueOf(),end:s.End?i.parseIsoDate(s.End).valueOf():void 0,metrics:s.Metrics,done:!0,rootId:void 0};s.ParentId?(a[s.ParentId]||(a[s.ParentId]=[]),a[s.ParentId].push(u)):t.push(u)}return r(t,a),t}function r(e,t){for(var i=0,a=e;i<a.length;i++){var n=a[i];t[n.id]&&(n.children=t[n.id],r(n.children,t))}}var i=jsCommon.DateExtensions;e.parseExecutionEvents=t}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i,a=e.data.SQExprBuilder;!function(e){function r(e){var t=e.mappings;if(1!==t.length)return e;var r=i(t[0]);if(!r)return e;var a=e.queryRewrites;return a||(a=e.queryRewrites=[]),n(e,r.queryNames,a),s(r),e}function i(e){var r,i;if(t.CompiledDataViewMapping.visitMapping(e,{visitRole:function(e){if(e.aggregates&&!_.isEmpty(e.items)){r||(r={},i=[]);for(var t=0,a=e.items;t<a.length;t++){r[a[t].queryName]=e.aggregates}i.push(e)}}}),r)return{queryNames:r,roles:i}}function n(e,t,r){var i=e.query.select();for(var n in t){var s=i.withName(n).expr,u=t[n],c={};u.min&&(c.min=o(e,a.aggregate(s,3))),u.max&&(c.max=o(e,a.aggregate(s,4))),r.push({aggregatesAdded:{originalQueryRef:n,aggregates:c}})}}function o(e,r){e.query=e.query.addSelect(r);var i=e.query.select(),a=t.SQExprUtils.indexOfNamedExpr(i,r),n=i[a],o=e.additionalProjections;return o||(o=e.additionalProjections=[]),o.push({queryName:n.name,selector:null}),{index:a,expr:r,queryName:n.name}}function s(e){for(var t=e.queryNames,r=0,i=e.roles;r<i.length;r++){var a=i[r];_.remove(a.items,function(e){return t[e.queryName]})}}e.run=r}(i=r.AggregatesQueryRewriter||(r.AggregatesQueryRewriter={}))}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(e,t,r){for(var a=[],n=[],o={by:null,select:[]},s={categories:{select:a},values:{group:o,select:n}},u={},c=0,l=t;c<l.length;c++){var p=l[c];if(!p.categorical)return;var d=p.categorical;i(d,u,a,n,o),null!=d.dataVolume&&null==s.dataVolume&&(s.dataVolume=d.dataVolume)}var f=[];for(var h in u){var m=u[h];if(!_.isEmpty(m.categoryAndValueGroup)&&!_.isEmpty(m.categoryOnly))for(var v=0,y=m.categoryAndValueGroup;v<y.length;v++){var g=y[v],S=e.select();e=e.addSelect(S.withName(h).expr);var C=e.select(),x=C.length-1,D=C[x],E=g.roleItem.queryName;g.roleItem.queryName=D.name,f.push({selectExprAdded:{selectIndex:x,namedSQExpr:D}}),f.push({projectionQueryRefChanged:{role:g.roleName,oldQueryRef:E,newInternalQueryRef:g.roleItem.queryName}})}}return{query:e,mappings:[{metadata:t[0].metadata,categorical:s}],queryRewrites:_.isEmpty(f)?void 0:f,additionalProjections:r}}function i(t,r,i,o,s){var u=t.values;if(u){e.CompiledDataViewMapping.visitCategoricalCategories(t.categories,{visitRole:function(e){n(i,e)}});var c;e.CompiledDataViewMapping.visitGrouped(u,{visitRole:function(e){if(s.by=e,e.items)for(var t=0,i=e.items;t<i.length;t++){var n=i[t];a(r,e.role,n,!0),c=!0}}}),e.CompiledDataViewMapping.visitCategoricalValues(u,{visitRole:function(e,t){if(n(1===t?s.select:o,e),e.items)for(var i=0,u=e.items;i<u.length;i++){var l=u[i];a(r,e.role,l,c)}}})}}function a(e,t,r,i){var a=r.queryName,n=e[a];n||(n=e[a]={categoryAndValueGroup:[],categoryOnly:[]});var o={roleName:t,roleItem:r};i?n.categoryAndValueGroup.push(o):n.categoryOnly.push(o)}function n(e,t){for(var r={for:{in:t}},i=0,a=e;i<a.length;i++){var n=a[i];if(s.equals(n,r))return}e.push(r)}var o,s=jsCommon.JsonComparer;!function(e){function t(e){var t=e.mappings.length;return 1===t?e:t>1?r(e.query,e.mappings,e.additionalProjections):void 0}e.run=t}(o=t.MultiMappedQueryRewriter||(t.MultiMappedQueryRewriter={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(t){return t.Schema||e.DefaultSchemaName}e.DefaultSchemaName=void 0,e.schemaName=t;var r;!function(e){e[e.None=0]="None",e[e.Group=1]="Group",e[e.Measure=2]="Measure"}(r=e.SelectKind||(e.SelectKind={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e,t){r(e,t,void 0)}function r(e,t,r){t.visitDescriptor(e,r);var a=e.Select;if(a&&a.length)for(var n=0,o=a.length;n<o;n++)t.visitSelect(a[n],r);var s=e.Expressions;s&&i(s,t,r)}function i(e,t,r){t.visitExpressions(e,r),a(e.Primary,t,r);var i=e.Secondary;i&&a(i,t,r)}function a(e,t,r){t.visitDataShapeExpressionsAxis(e,r);for(var i=e.Groupings,a=0,o=i.length;a<o;a++)n(i[a],t,r)}function n(e,t,r){t.visitDataShapeExpressionsAxisGrouping(e,r);for(var i=e.Keys,a=0,n=i.length;a<n;a++)o(i[a],t,r)}function o(e,t,r){t.visitDataShapeExpressionsAxisGroupingKey(e,r),t.visitConceptualPropertyReference(e.Source,r)}e.traverseQueryBindingDescriptor=t,e.traverseQueryBindingDescriptorWithArg=r;var s=function(){function e(){}return e.prototype.visitDescriptor=function(e,t){},e.prototype.visitSelect=function(e,t){},e.prototype.visitExpressions=function(e,t){},e.prototype.visitDataShapeExpressionsAxis=function(e,t){},e.prototype.visitDataShapeExpressionsAxisGrouping=function(e,t){},e.prototype.visitDataShapeExpressionsAxisGroupingKey=function(e,t){},e.prototype.visitConceptualPropertyReference=function(e,t){},e}();e.DefaultQueryBindingDescriptorVisitorWithArg=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(s);e.DefaultQueryBindingDescriptorVisitor=u}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(){return new a}function i(e){for(var t=[],r=0,i=e.length;r<i;r++){var a=e[r];a.entityRename&&t.push(new o(a.entityRename)),a.propertyRename&&t.push(new s(a.propertyRename))}return t}t.createQueryCacheHandler=r;var a=function(){function e(){}return e.prototype.apply=function(e,t,r){var i=new n(r);e.rewriteCacheEntries("dsr",t,i)},e}(),n=function(){function r(t){this.descriptorRewriters=i(t),this.schemaRewriters=e.createSchemaChangeRewriters(t)}return r.prototype.rewriteDataQueryCacheKey=function(e){return e.Commands[0].SemanticQueryDataShapeCommand=this.rewriteCacheKey(e.Commands[0].SemanticQueryDataShapeCommand),e},r.prototype.rewriteCacheKey=function(t){for(var r=e.services.SemanticQuerySerializer,i=this.schemaRewriters,a=r.deserializeQuery(t.Query),n=0,o=i.length;n<o;n++)a=a.rewrite(i[n]);return t.Query=r.serializeQuery(a),t},r.prototype.rewriteCacheResult=function(e){for(var r=this.descriptorRewriters,i=0,a=r.length;i<a;i++){var n=r[i];t.traverseQueryBindingDescriptor(e.descriptor,n)}return e},r}(),o=function(e){function r(t){var r=e.call(this)||this;return r.change=t,r}return __extends(r,e),r.prototype.visitConceptualPropertyReference=function(e){this.change.schema===t.schemaName(e)&&e.Entity===this.change.before&&(e.Entity=this.change.after)},r}(t.DefaultQueryBindingDescriptorVisitor),s=function(e){function r(t){var r=e.call(this)||this;return r.change=t,r}return __extends(r,e),r.prototype.visitConceptualPropertyReference=function(e){this.change.schema===t.schemaName(e)&&e.Property===this.change.before&&(e.Property=this.change.after)},r}(t.DefaultQueryBindingDescriptorVisitor)}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=jsCommon.ArrayExtensions,r=function(){function r(e,t){!t.ScriptVisualBinding,this._metadata=e,this._binding=t}return r.prototype.getSelectRestatements=function(){return this.getRestatements()},r.prototype.getGroupRestatements=function(){return this.getRestatements(e.SelectKind.Group)},r.prototype.getMeasureRestatements=function(){return this.getRestatements(e.SelectKind.Measure)},r.prototype.getFilterRestatements=function(){var e=this._metadata.Filters;if(_.isEmpty(e))return null;for(var r=[],i=0,a=e.length;i<a;i++){var n=e[i];r.push(n?n.Restatement:"")}return t.emptyToNull(r)},r.prototype.getRestatements=function(e){var r=this._metadata,i=this._binding,a=[];if(!i.ScriptVisualBinding)for(var n=0,o=r.Select.length;n<o;n++){var s=i.Select[n],u=r.Select[n];s&&(void 0!==e&&s.Kind!==e||a.push(u.Restatement||""))}return t.emptyToNull(a)},r}();e.QueryDescription=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(e){return new f(t.services.SemanticQuerySerializer,e)}function a(e,t,r,i,a,n,s,u,c,l,p,d,f,m){var v=n;if(n)for(var y=0,g=o([r],i);y<g.length;y++){var S=g[y];v=v.rewrite(S)}var C;return n&&(C=[e.serializeFilter(v)]),h.generateBaseDataShapeBinding(t,r,i,a,C,s,u,c,l,e,p,d,f,m)}function n(e){for(var t,r=e.select(),i=r.length-1;i>=0;i--)p.isConstant(r[i].expr)&&(r.splice(i,1),t=!0);return t?e.select(r):e}function o(e,t){return[new m,new y(e,t),new v]}var s=jsCommon.ArrayExtensions,u=e.data.services,c=e.data.FilterKindDetector,l=e.data.dsr.SelectToIdentityExpressionsVisitor,p=e.data.SQExpr;r.createQueryGenerator=i;var d=1e3,f=function(){function i(e,t){this.serializer=e,this.featureSwithes=t}return i.prototype.execute=function(e){var t=this.executeForQueryOnlyImpl(e);if(!t||!t.dataShapeBinding&&t.mergedQueries&&t.mergedQueries.mapping&&2===t.mergedQueries.mapping.updateType)return{command:void 0};var r=t.mergedQueries,i=t.dataShapeBinding,a=t.query;this.adjustIntersectionDataReduction(i,r.mapping,a,e.highVolumeOverride),_.isEmpty(a.groupBy())||this.applyDataReductionForGroupByQuery(i,a);var n=t.mergedQueries&&t.mergedQueries.mapping&&1===t.mergedQueries.mapping.updateType&&_.isEmpty(e.additionalProjections);return{command:this.createDataQuery(a,t.queryExtensionSchema,e.dataSourceVariables,i,t.compiledDataViewMappings,e.dataWindow,e.executionMetricsKinds,e.anchorTime),splits:r.splits,queryRewrites:t.queryRewrites,deferred:n}},i.prototype.executeForQueryOnly=function(e){var t=this.executeForQueryOnlyImpl(e);return t&&t.query},i.prototype.produceIdentities=function(e,t){var r=new l;return e.accept(r,t)},i.prototype.executeForQueryOnlyImpl=function(e){var i=this.getQueryableMappings(e.mappings),n=this.prepareQuery(e.query,i,e.additionalProjections),o=n.query,s=n.mappings,u=n.queryRewrites,c=n.additionalProjections,l=h.getIndicesByName(o),p=r.mergeMappings(i,l);t.applyDataReductionDefaults(e.mappings);var d;e.highVolumeOverride&&(d=6),p.mapping.categorical&&h.updateMappingsWithScalarKeys(p.mapping,l);var f=a(this.serializer,l,p.mapping,o.select(),c,e.highlightFilter,e.restartToken,o.groupBy(),d,e.expansionStates,e.keepProjectionOrder,e.noDefaultProjections,e.windowExpansion,this.featureSwithes);t.DataViewPivotCategoricalToPrimaryGroups.pivotBinding(f,s,p.mapping,o.select(),3,d),this.queryHasMeasureFilter(o)&&(this.processTargetsForMeasureFilters(o,s,f),o=this.adjustQueryMeasureFilters(o,f));var m;if(e.queryExtensionLookup){var v=e.queryExtensionLookup(o,u);o=v.query,m=v.extensions,u=v.queryRewrites}return{query:o,queryExtensionSchema:m,mergedQueries:p,dataShapeBinding:f,compiledDataViewMappings:s,queryRewrites:u}},i.prototype.hasAmbiguousEqualitySemantics=function(e){return p.equals(e,t.SQExprBuilder.boolean(!1))||p.equals(e,t.SQExprBuilder.integer(0))},i.prototype.getQueryableMappings=function(e){return _.filter(e,function(e){return!e.usage||!e.usage.regression})},i.prototype.prepareQuery=function(e,t,r){for(var i=0,a=o(t,e.select());i<a.length;i++){var s=a[i];e=e.rewrite(s)}var u=this.rewriteQuery(e,t,r);return u.query=n(u.query),u},i.prototype.rewriteQuery=function(e,t,i){var a={query:e,mappings:t,additionalProjections:i};return a=r.MultiMappedQueryRewriter.run(a),a=r.AggregatesQueryRewriter.run(a)},i.prototype.adjustIntersectionDataReduction=function(e,r,i,a){if(r.categorical){var n=r.categorical;if(n.dataReductionAlgorithm)if(e.DataReduction&&e.DataReduction.Intersection)e.Primary&&!e.Secondary&&(e.DataReduction.Primary=e.DataReduction.Intersection,e.DataReduction.Intersection=void 0);else{var o=e.Primary&&(!e.DataReduction||!e.DataReduction.Primary),s=e.Secondary&&(!e.DataReduction||!e.DataReduction.Secondary);if(!o&&!s)return;e.DataReduction||(e.DataReduction={DataVolume:n.dataVolume||(a?6:3)}),o&&(e.DataReduction.Primary=t.DataShapeBindingDataReduction.createFrom(n.dataReductionAlgorithm,i.select())),s&&(e.DataReduction.Secondary=t.DataShapeBindingDataReduction.createFrom(n.dataReductionAlgorithm,i.select()))}}},i.prototype.applyDataReductionForGroupByQuery=function(e,r){e.DataReduction={},e.DataReduction.Primary=t.DataShapeBindingDataReduction.createFrom({top:{count:d}},r.select())},i.prototype.generateScriptVisualCommand=function(t,r){var i=e.ScriptResultUtil.extractScriptResult(t);if(i||(i=e.ScriptResultUtil.extractScriptResultDefaultFromDataViewMappings(t)),!i)return null;var a={Version:0,Script:i.source,RenderingEngine:i.provider,ScriptOutputType:i.outputType};r&&r.height&&r.width&&(a.ViewportWidthPx=r.width,a.ViewportHeightPx=r.height);var n=e.ScriptResultUtil.findScriptResultMapping(t);return n&&n.script.scriptInput&&(a.ScriptInput=n.script.scriptInput),{ScriptVisualCommand:a}},i.prototype.queryHasMeasureFilter=function(e){for(var t=0,r=e.where();t<r.length;t++){var i=r[t];if(1===c.run(i.condition))return!0}return!1},i.prototype.removeExprFromTargetExprs=function(e,t){for(var r=0,i=e;r<i.length;r++){var a=i[r],n=a.target;if(null!=n)for(var o=0,s=n.length;o<s;o++)p.equals(n[o],t)&&n.splice(o,1)}},i.prototype.processTargetsForMeasureFilters=function(e,r,i){for(var a=this,n=this.getProjectedSelectIndexMap(i),o=0,u=r;o<u.length;o++){var c=u[o];t.CompiledDataViewMapping.visitMapping(c,{visitRole:function(t){var r=t.activeItems,i=t.items;if(r&&!_.isEmpty(r)&&!_.isEmpty(i))for(var o=_.findIndex(i,function(e){return _.includes(r,e.queryName)}),u=0;u<o;u++){var c=i[u].queryName,l=e.select(),p=s.indexWithName(l,c);if(!n[p]){var d=l[p].expr;a.removeExprFromTargetExprs(e.where(),d)}}}})}},i.prototype.adjustQueryMeasureFilters=function(e,r){var i=e.where(),a=[],n=[];if(_.isEmpty(r.Primary.Groupings)||_.isEmpty(r.Primary.Groupings[0].Projections)||!_.isEmpty(r.Secondary))return e;for(var o=e.select(),s=r.Primary.Groupings[0].Projections,u=0,c=s;u<c.length;u++){var l=c[u],p=o[l];if(!t.SQExprUtils.isMeasure(p.expr))return e}for(var d=0,f=i;d<f.length;d++){var h=f[d];_.isEmpty(h.target)?n.push(h):a.push(h)}if(_.isEmpty(a))return e;var m=t.SemanticQuery.createWith({from:e.from(),select:e.select(),orderBy:e.orderBy(),top:e.top(),transforms:e.transforms(),groupBy:e.groupBy(),where:n}),v=t.SemanticFilter.fromMeasureFilters(e,a,r);return m=m.addSemanticFilter(v)},i.prototype.getProjectedSelectIndexMap=function(e){return e?_.chain([e.Primary,e.Secondary]).filter(function(e){return e&&!_.isEmpty(e.Groupings)}).map(function(e){return e.Groupings}).flatten().filter(function(e){return!_.isEmpty(e.Projections)}).map(function(e){return e.Projections}).flatten(!1).reduce(function(e,t){return e[t]=!0,e},{}).value():{}},i.prototype.createDataQuery=function(e,t,r,i,a,n,o,s){var u={Query:this.serializer.serializeQuery(e),Binding:i,AnchorTime:s};t&&(u.Extension=t),r&&(u.DataSourceVariables=r),o&&(u.ExecutionMetricsKind=o);var c={SemanticQueryDataShapeCommand:u},l={Commands:[c]},p=this.generateScriptVisualCommand(a,n);return p&&l.Commands.push(p),l},i}();r.generateDataShapeBinding=a;var h;!function(e){function r(e,t,o,s,u,c,p,d,f,h,m,v,g,S){var C=new y(e,o,m,S).withRestartToken(c).withHighlightFilter(u).withAdditionalProjections(s);if(t.table&&(C=C.withGroupBy(p)),2!==t.updateType)if(t.categorical)i(C,t.categorical,v);else if(t.table)a(C,t.table);else if(t.matrix)n(C,t.matrix,f,v,g);else if(t.tree)l(C,t.tree,v);else if(t.scriptResult)return r(e,t.scriptResult.dataInput,o,s);return d&&C.withDataVolume(d),C.withTopLevelAggregates(t.scopedAggregates),C.toBinding(t)}function i(e,r,i){t.CompiledDataViewMapping.visitCategoricalCategories(r.categories,{visitRole:function(t){e.withPrimaryGrouping(t.items,t.activeItems,t.showAll,t.subtotalType,!0,i)},visitReduction:function(t){e.withPrimaryDataReduction(t)}}),t.CompiledDataViewMapping.visitGrouped(r.values,{visitRole:function(t){e.withSecondaryGrouping(t.items,t.activeItems,t.showAll,t.subtotalType,i)},visitReduction:function(t){e.withSecondaryDataReduction(t)}}),t.CompiledDataViewMapping.visitCategoricalValues(r.values,{visitRole:function(t,r){e.withInnermostGrouping(t.items,t.showAll,t.subtotalType,void 0,1!==r)}}),e.withIntersectionDataReduction(r.dataReductionAlgorithm).withDataVolume(r.dataVolume).withIncludeEmptyGroups(r.includeEmptyGroups)}function a(e,r){t.CompiledDataViewMapping.visitTable(r,{visitRole:function(t){e.withPrimaryGrouping(t.items,t.activeItems,t.showAll,t.subtotalType,!0,!1)},visitReduction:function(t){e.withPrimaryDataReduction(t)}}),e.withDataVolume(r.dataVolume)}function n(e,r,i,a,n){var s=new v(e,a);t.CompiledDataViewMapping.visitMatrixRows(r.rows,s);var u=o(s.primaryRoleItems,s.primaryActiveRoleItems,s.primaryRoles,i,a);u&&e.withPrimaryExpansion(u),n&&e.withPrimaryWindowExpansion(n),t.CompiledDataViewMapping.visitMatrixColumns(r.columns,{visitRole:function(t){e.withSecondaryGroupingNested(t.items,t.activeItems,t.showAll,t.subtotalType,a)},visitReduction:function(t){e.withSecondaryDataReduction(t)}}),t.CompiledDataViewMapping.visitMatrixValues(r.values,{visitRole:function(t){e.withInnermostGrouping(t.items,t.showAll,t.subtotalType,!0,!1)}}),e.withDataVolume(r.dataVolume)}function o(e,t,r,i,a){if(!(_.isEmpty(i)||_.isEmpty(t)&&a)){var n=_.find(i,function(e){return _.isEqual(e.roles,r)});if(!_.isEmpty(n.levels)){e=_.uniqBy(e,function(e){return e.queryName}),t=_.uniq(t);var o=_.isEmpty(t)?e.length:t.length,s=o-1;return u.DataShapeBindingExpansionStateSerializer.serializeExpansionState(n,s)}}}function c(e){return u.DataShapeBindingWindowExpansionStateSerializer.serializeWindowExpansionState(e)}function l(e,r,i){t.CompiledDataViewMapping.visitTreeNodes(r.nodes,{visitRole:function(t){e.withPrimaryGroupingNested(t.items,t.activeItems,t.showAll,t.subtotalType,i)},visitReduction:function(t){e.withPrimaryDataReduction(t)}}),t.CompiledDataViewMapping.visitTreeValues(r.values,{visitRole:function(t){e.withInnermostGrouping(t.items,t.showAll,t.subtotalType)}}),e.withDataVolume(r.dataVolume)}function p(e){for(var t={},r=e.select(),i=e.groupBy(),a=0,n=r.length;a<n;a++)t[r[a].name]=a;for(var a=0,n=i.length;a<n;a++)t[i[a].name]=a;return t}function d(e,t){if(t)for(var r=0,i=t.Groupings;r<i.length;r++){var a=i[r];if(_.includes(a.Projections,e))return!0}}function f(e){switch(e){case 1:return 1;case 2:return 2;case 0:return}}function h(e){var t={K:e.k};return e.exclusive&&(t.Exclusive=e.exclusive),{Percentile:t}}function m(e,r){var i=function(){function e(e){this.indicesByName=e}return e.prototype.visitRole=function(e,t){if(!_.isEmpty(e.items)){for(var r,i=0,a=e.items;i<a.length;i++){var n=a[i];n.scalarKeyInfo&&null!=n.scalarKeyInfo.scalarKeyQueryName&&(r=n.scalarKeyInfo.scalarKeyQueryName)}r&&(this.primaryScalarKey=this.indicesByName[r])}},e}(),a=new i(r);t.CompiledDataViewMapping.visitMapping(e,a),null!=a.primaryScalarKey&&t.CompiledDataViewMapping.visitMapping(e,{visitRole:function(){},visitReduction:function(e){e.binnedLineSample&&(e.binnedLineSample.primaryScalarKey=a.primaryScalarKey)}})}e.generateBaseDataShapeBinding=r;var v=function(){function e(e,t){this.inComposite=!1,this.startedCompositeNest=!1,this.builder=e,this.noDefaultProjections=t}return e.prototype.visitRole=function(e){var t,r;if(this.inComposite){var i=this.startedCompositeNest;this.startedCompositeNest=!0,this.builder.withPrimaryGrouping(e.items,e.activeItems,e.showAll,e.subtotalType,i,this.noDefaultProjections)}else this.builder.withPrimaryGroupingNested(e.items,e.activeItems,e.showAll,e.subtotalType,this.noDefaultProjections);this.primaryRoleItems||(this.primaryRoleItems=[]),this.primaryRoles||(this.primaryRoles=[]),this.primaryRoles.push(e.role),(t=this.primaryRoleItems).push.apply(t,e.items),_.isEmpty(e.activeItems)||(this.primaryActiveRoleItems||(this.primaryActiveRoleItems=[]),(r=this.primaryActiveRoleItems).push.apply(r,e.activeItems))},e.prototype.visitReduction=function(e){this.builder.withPrimaryDataReduction(e)},e.prototype.enterComposite=function(){this.inComposite=!0,this.startedCompositeNest=!1},e.prototype.exitComposite=function(){this.inComposite=!1,this.startedCompositeNest=!1},e}();e.getIndicesByName=p,e.updateMappingsWithScalarKeys=m;var y=function(){function e(e,t,r,i){this.indicesByName=e,this.querySelects=t,this.reduction={DataVolume:3},this.joinPredicateBehaviors=[],this.insertProjection=r?s.insertUnique:s.insertSorted,this.featureSwitches=i}return e.prototype.withRestartToken=function(e){return this.restartToken=e,this},e.prototype.withPrimaryWindowExpansion=function(e){return this.reduction.Primary&&this.reduction.Primary.TopNPerLevel&&(this.reduction.Primary.TopNPerLevel.WindowExpansion=c(e)),this},e.prototype.withDataVolume=function(e){return null==e?this:(this.reduction.DataVolume=e,this)},e.prototype.withIncludeEmptyGroups=function(e){return this.includeEmptyGroups=e,this},e.prototype.withHighlightFilter=function(e){return this.highlightFilter=e,this},e.prototype.withGroupBy=function(e){return _.isEmpty(e)||(this.groupByNames=_.map(e,function(e){return e.name})),this},e.prototype.withPrimaryGrouping=function(e,t,r,i,a,n){if(e=this.filterItems(e,t,n),_.isEmpty(e))return this;var o;return this.primary?a?o=_.last(this.primary.Groupings):(o={Projections:[]},this.primary.Groupings.push(o)):(o={Projections:[]},this.primary={Groupings:[o]}),this.updateGrouping(o,e,r,i),this},e.prototype.withPrimaryExpansion=function(e){return this.ensurePrimaryAxis(),this.primary.Expansion=e,this},e.prototype.ensurePrimaryAxis=function(){this.primary||(this.primary={Groupings:[]})},e.prototype.ensureSecondaryAxis=function(){this.secondary||(this.secondary={Groupings:[]})},e.prototype.withPrimaryGroupingNested=function(e,t,r,i,a){if(e=this.filterItems(e,t,a),_.isEmpty(e))return this;this.primary||(this.primary={Groupings:[]});var n;return n=this.primary.Groupings,this.withNested(n,e,r,i)},e.prototype.withSecondaryGrouping=function(e,t,r,i,a){if(e=this.filterItems(e,t,a),_.isEmpty(e))return this;var n;if(this.primary){var o=_.last(this.primary.Groupings);this.containsAll(o,e)?n=o:(this.secondary||(this.secondary={Groupings:[]}),n={Projections:[]},this.secondary.Groupings.push(n))}else n={Projections:[]},this.primary={Groupings:[n]},this.pivotedSecondaryToPrimary=!0;return this.updateGrouping(n,e,r,i),this},e.prototype.withSecondaryExpansion=function(e){return this.ensureSecondaryAxis(),this.secondary.Expansion=e,this},e.prototype.withSecondaryGroupingNested=function(e,t,r,i,a){if(e=this.filterItems(e,t,a),_.isEmpty(e))return this;var n;return this.primary?(this.secondary||(this.secondary={Groupings:[]}),n=this.secondary.Groupings):(n=[],this.primary={Groupings:n},this.pivotedSecondaryToPrimary=!0),this.withNested(n,e,r,i)},e.prototype.withInnermostGrouping=function(e,t,r,i,a){if(e=this.filterItems(e,null,!1),_.isEmpty(e))return this;var n;if(i&&this.secondary?n=_.last(this.secondary.Groupings):this.primary?n=_.last(this.primary.Groupings):(n={Projections:[]},this.primary={Groupings:[n]}),this.updateGrouping(n,e,t,r),this.secondary&&a)for(var o=_.last(this.secondary.Groupings),s=this.indicesByName,u=0,c=e;u<c.length;u++){var l=c[u];this.addSuppressedProjection(o,s[l.queryName])}return this},e.prototype.withPrimaryDataReduction=function(e){return e&&this.primary?(this.reduction.Primary=t.DataShapeBindingDataReduction.createFrom(e,this.querySelects),this):this},e.prototype.withSecondaryDataReduction=function(e){return this.pivotedSecondaryToPrimary?this.withPrimaryDataReduction(e):e&&this.secondary?(this.reduction.Secondary=t.DataShapeBindingDataReduction.createFrom(e,this.querySelects),this):this},e.prototype.withIntersectionDataReduction=function(e){return e?this.reduction.Primary||this.reduction.Secondary?this:e.binnedLineSample?(this.reduction.Intersection=t.DataShapeBindingDataReduction.createFrom(e,this.querySelects),this):this:this},e.prototype.withTopLevelAggregates=function(e){var t=this.featureSwitches;if(!t||!t.scopedAggregates)return this;if(_.isEmpty(e))return this;var r=this.convertScopedAggregate(e,this.primary.Groupings,0);return r?(this.aggregates?this.aggregates.concat(r):this.aggregates=r,this):this},e.prototype.convertScopedAggregate=function(e,t,r){for(var i={},a=0,n=e;a<n.length;a++){var o=n[a],s=this.indicesByName[o.queryName];if(void 0!==s){var u=this.toAggregateScope(o.scope,t,r);if(u){i[s]||(i[s]=[]);var c=i[s];o.min&&c.push({Scope:u,RespectInstanceFilters:!0,Min:{}}),o.max&&c.push({Scope:u,RespectInstanceFilters:!0,Max:{}}),o.average&&c.push({Scope:u,RespectInstanceFilters:!0,Average:{}})}}}if(!_.isEmpty(i)){var l=new Array(Object.keys(i).length),p=0;for(var s in i)l[p++]={Select:+s,Aggregations:i[s]};return l}},e.prototype.toAggregateScope=function(e,r,i){for(var a=0,n=this.querySelects,o=0,s=r;o<s.length;o++){var u=s[o];if(!_.isEmpty(u.ShowItemsWithNoData))return;for(var c=u.Projections,l=function(r){var o=n[r];if(t.SQExprUtils.isMeasure(o.expr))return"continue";var s=o.name;return e.some(function(e){return e===s})?void 0:a>i?{value:{PrimaryDepth:a}}:{value:void 0}},p=0,d=c;p<d.length;p++){var f=d[p],h=l(f);if("object"==typeof h)return h.value}a++}return a>i?{PrimaryDepth:a}:void 0},e.prototype.updateScopeAggregatesForGroupings=function(e,t){var r=this.featureSwitches;if(r&&r.scopedAggregates&&t&&e)for(var i=0,a=0,n=t;a<n.length;a++){var o=n[a],s=o.aggregates;if(!_.isEmpty(s)){var u=this.convertScopedAggregate(s,e,i+1);_.isEmpty(u)||(e[i].Aggregates=u),i++}}},e.prototype.updateGrouping=function(e,t,r,i){this.addProjections(e.Projections,t);var a=this.indicesByName;if(r){e.ShowItemsWithNoData||(e.ShowItemsWithNoData=[]);for(var n=0,o=t;n<o.length;n++){var s=o[n];this.insertProjection(e.ShowItemsWithNoData,a[s.queryName])}}for(var u=t[0].subtotalType,c=1,l=t.length;c<l;c++)if(t[c].subtotalType!==u){u=void 0;break}var p=f(null!=u?u:i);null!=p&&(e.Subtotal=p);var d=this.groupByNames;d&&(e.GroupBy=_.map(d,function(e){return a[e]}))},e.prototype.withNested=function(e,t,r,i){for(var a=0,n=t;a<n.length;a++){var o=n[a],s={Projections:[]};this.updateGrouping(s,[o],r,i),e.push(s)}return this.updateScopeAggregatesForGroupings(e,t),this},e.prototype.filterItems=function(e,t,r){if(!_.isEmpty(e)){e=_.uniqBy(e,function(e){return e.queryName});var i,a=this.indicesByName;t&&(i=[]);for(var n=0,o=e.length;n<o;n++){var u=e[n],c=null,l=t&&!_.isEmpty(t)&&!_.includes(t,u.queryName);null==a[u.queryName]?c=n-1:(l||this.isReferenced(u))&&(c=n),null==c?i&&i.push(u):i||(i=c<0?[]:s.range(e,0,c))}return i||(r?[]:e)}},e.prototype.isReferenced=function(e){var t=this.indicesByName[e.queryName];return d(t,this.primary)||d(t,this.secondary)||_.includes(this.projections,t)},e.prototype.containsAll=function(e,t){for(var r=e.Projections,i=this.indicesByName,a=0,n=t;a<n.length;a++){var o=n[a];if(!_.includes(r,i[o.queryName]))return!1}return!0},e.prototype.addProjections=function(e,t){for(var r=this.indicesByName,i=0,a=t;i<a.length;i++){var n=a[i],o=r[n.queryName];this.insertProjection(e,o),this.addJoinPredicateBehavior(o,n.joinPredicate)}},e.prototype.addJoinPredicateBehavior=function(e,t){this.joinPredicateBehaviors[e]?void 0===t&&(this.joinPredicateBehaviors[e].behavior=t):this.joinPredicateBehaviors[e]={behavior:t}},e.prototype.withAdditionalProjections=function(e){return _.isEmpty(e)||(this.additionalProjections=e),this},e.prototype.applyAdditional=function(e){var r=this,i=this.querySelects,a=this.additionalProjections,n=g.findActive(e);if(!_.isEmpty(a))for(var o=this.primary,s=this.secondary,u=this.projections,c=0,l=a;c<l.length;c++){var p=l[c],d=t.DataBoundObjectQueryExtender.getScopeRefs(p.selector,i,n),f=this.indicesByName[p.queryName];if(this.applyAggregates(f,p.aggregates),null!==d){var h=_.map(d,function(e){return r.indicesByName[e]}),m=s&&!_.isEmpty(s.Groupings),v=o&&this.addAdditional(f,h,o.Groupings);v&&m&&this.addSuppressedProjection(_.last(s.Groupings),f),v||(v=m&&this.addAdditional(f,h,s.Groupings)),v&&this.addJoinPredicateBehavior(f,p.joinPredicate)}else{if(p.aggregates)continue;u||(this.projections=u=[]),this.insertProjection(u,f),this.addJoinPredicateBehavior(f,p.joinPredicate)}}},e.prototype.addAdditional=function(e,t,r){for(var i=0,a=r.length;i<a;i++){var n=r[i],o=n.Projections;if(_.remove(t,function(e){return _.includes(o,e)}),0===t.length)return this.insertProjection(_.last(r).Projections,e),!0}return!1},e.prototype.addSuppressedProjection=function(e,t){e.SuppressedProjections||(e.SuppressedProjections=[]),this.insertProjection(e.SuppressedProjections,t)},e.prototype.applyAggregates=function(e,t){if(t){var r=this.aggregates;r||(r=this.aggregates=[]);var i=[],a={Select:e,Aggregations:i};if(t.min&&i.push({Min:{}}),t.max&&i.push({Max:{}}),t.average&&i.push({Average:{}}),t.median&&i.push({Median:{}}),t.percentiles)for(var n=0,o=t.percentiles;n<o.length;n++){var s=o[n];i.push(h(s))}r.push(a)}},e.prototype.toBinding=function(e){this.applyAdditional(e);var t=this.primary,r=this.projections;if(!t){if(!r)return;t={Groupings:[{Projections:r}]},r=null}var i=this.restartToken;i&&this.reduction.Primary&&this.reduction.Primary.Window&&(this.reduction.Primary.Window.RestartTokens=i);
var a={Primary:t};this.secondary&&(a.Secondary=this.secondary),r&&(a.Projections=r),(this.reduction.Primary||this.reduction.Secondary||this.reduction.Intersection)&&(a.DataReduction=this.reduction),this.includeEmptyGroups&&(a.IncludeEmptyGroups=this.includeEmptyGroups);var n=this.aggregates;n&&(a.Aggregates=n);for(var o=[],s=0;s<this.joinPredicateBehaviors.length;s++)this.joinPredicateBehaviors[s]&&0===this.joinPredicateBehaviors[s].behavior&&o.push(s);return _.isEmpty(o)||(a.SuppressedJoinPredicates=o),a.Version=1,this.highlightFilter&&(a.Highlights=this.highlightFilter),a},e}()}(h||(h={}));var m=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.visitScopedEval=function(e){return _.isEmpty(e.scope)?e:t.SQExprBuilder.scopedEval(e.expression,_.filter(e.scope,function(e){return!p.isWithRef(e)}))},r}(t.SQExprRewriter),v=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.visitGroupRef=function(e){return new t.SQColumnRefExpr(e.source,e.ref)},r}(t.SQExprRewriter),y=function(e){function r(t,r){var i=e.call(this)||this;return i.mappings=t,i.selects=r,i}return __extends(r,e),r.prototype.visitScopedEval=function(e){for(var r=[],i=!1,a=0,n=e.scope;a<n.length;a++){var o=n[a];if(p.isRoleRef(o)){i=!0;for(var s=0,u=this.mappings;s<u.length;s++){var c=u[s],l=g.findActive(c),d=l[o.role];if(d)for(var f=function(e){var t=_.find(h.selects,function(t){return t.name===e});t&&r.push(t.expr)},h=this,m=0,v=d;m<v.length;m++){var y=v[m];f(y)}}}else r.push(o)}return i?t.SQExprBuilder.scopedEval(e.expression,_.uniqBy(r,function(e){return t.services.SemanticQuerySerializer.serializeExpr(e)})):e},r}(t.SQExprRewriter),g=function(){function e(){this.queryReferencesByRole={}}return e.findActive=function(r){var i=new e;return t.CompiledDataViewMapping.visitMapping(r,i),i.queryReferencesByRole},e.prototype.visitRole=function(e){var t=e.items;_.isEmpty(e.activeItems)||(t=_.filter(t,function(t){return _.includes(e.activeItems,t.queryName)})),this.queryReferencesByRole[e.role]=_.map(t,function(e){return e.queryName})},e}()}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(e,t,r,i){return new l(e,t,r,i)}function a(e){return e&&e.Window&&null!=e.Window.RestartTokens}function n(e){return!e||!!e.Window}function o(e,t){if(r.isDsrV2(e)){if(!t)return!1;for(var i=r.reader.V2.createDsrParser(e,void 0).dataShapes(),a=r.getDsrV2MinorVersion(e);i.next();)if(a&&a>=1){if(i.hasAllData()!==!0)return!1}else if(!i.complete()||i.limitsExceeded()||i.hasRestartTokens())return!1;return!0}return _.every(e.DataShapes,function(e){return e&&e.IsComplete&&_.isEmpty(e.DataLimitsExceeded)&&!e.RestartTokens})}function s(e){if(e&&e.From&&e.Select)return t.services.SemanticQuerySerializer.deserializeQuery(e)}var u=jsCommon.Utility;r.createQueryCache=i;var c,l=function(){function t(e,t,r,i){this.featureSwitches=i,this.createQuery=t,this.createCancelQuery=r,this.promiseFactory=e,this.cacheByModel={}}return t.prototype.ensure=function(r){var i=this,n=r.command,s=n.Commands[0].SemanticQueryDataShapeCommand,u=this.ensureCache(r.dataSources),l=c.generateCacheKeyDataQuery(n);if(u.hasCacheEntry(l)){if(t.allowCacheOrDefault(r))return u.bindCacheEntry(l,void 0,r.telemetryV2Enabled);u.clearEntry(l)}var p=c.createCacheItemContext(n,this.featureSwitches,l),d=this.findEquivalentCache(r,u,p);if(d)return d;var f=u.createCacheEntry(l,p,this.rewriteCacheDataWithoutExecutionMetrics,r.telemetryV2Enabled),h=_.assign({},r,{queryId:p.queryId,executionType:0});f.promise.catch(function(t){e.isHttpClientError(t)||i.featureSwitches&&i.featureSwitches.queryCancellation&&i.createCancelQuery({dataSources:h.dataSources,command:h.command,allowCache:h.allowCache,allowClientSideFilters:h.allowClientSideFilters,cacheResponseOnServer:h.cacheResponseOnServer,ignoreViewportForCache:h.ignoreViewportForCache,cacheOptions:h.cacheOptions,queryId:h.queryId,executionType:1},t&&t.queryCancellationSource)}),this.createQuery(h,f);var m=u.bindCacheEntry(l,void 0,r.telemetryV2Enabled);return s.Binding&&s.Binding.DataReduction&&(a(s.Binding.DataReduction.Primary)||a(s.Binding.DataReduction.Secondary))||m.then(function(e){e&&e.dsr&&o(e.dsr,i.featureSwitches&&i.featureSwitches.dsrV2)&&(p.hasAllData=!0)},function(){}),m},t.prototype.clear=function(e){var t=this.getCache(e);t&&t.clearAllEntries()},t.prototype.rewrite=function(e,t){var r=this,i=this.getCache(e);if(i){var a={};t.rewriteCacheKey&&t.rewriteDataQueryCacheKey&&(a.rewriteKey=function(e){var a=JSON.parse(e),n=i.getEntryContext(e);if(n.compositeDataQuery){var o=a,s=t.rewriteDataQueryCacheKey(o);if(s&&s!==o){var u=c.createCacheItemContextForCompositeDataQuery(s,r.featureSwitches);_.assign(n,u)}}else{var l=a,p=t.rewriteCacheKey(l);if(p&&p!==l){var u=c.createCacheItemContextForNonCompositeDataQuery(p,r.featureSwitches);_.assign(n,u)}}return n.key}),t.rewriteCacheResult&&(a.rewriteResult=function(e){var r=e,i=t.rewriteCacheResult({descriptor:r.descriptor,dsr:r.dsr});return i?{descriptor:i.descriptor,dsr:i.dsr}:{descriptor:r.descriptor,dsr:r.dsr}}),i.rewriteAllEntries(a)}},t.prototype.put=function(e,t,r){var i=this.ensureCache(e),a=t,n=c.generateCacheKeyDataQuery(a);if(i.hasCacheEntry(n))i.putCacheResult(n,r,this.rewriteCacheDataWithoutExecutionMetrics);else{var o=c.createCacheItemContext(a,this.featureSwitches,n);i.createCacheEntry(n,o,this.rewriteCacheDataWithoutExecutionMetrics).deferred.resolve(r)}},t.allowCacheOrDefault=function(e){return e.allowCache!==!1},t.prototype.findEquivalentCache=function(e,r,i){if(t.allowCacheOrDefault(e))if(i.compositeDataQuery){if(e.ignoreViewportForCache)for(var a=0,n=r.keys();a<n.length;a++){var o=n[a],s=r.getEntryContext(o);if(s&&s.keyWithoutViewport&&s.keyWithoutViewport===i.keyWithoutViewport)return r.bindCacheEntry(s.key,void 0,e.telemetryV2Enabled)}}else for(var u=e.command,c=u.Commands[0].SemanticQueryDataShapeCommand.Binding,l=!!(c&&c.DataReduction&&c.DataReduction.Primary&&c.DataReduction.Primary.TopNPerLevel),d=0,f=r.keys();d<f.length;d++){var o=f[d],s=r.getEntryContext(o);if(s){if(!l&&s.hasAllData&&s.keyWithoutReduction===i.keyWithoutReduction)return r.bindCacheEntry(s.key,void 0,e.telemetryV2Enabled);var h=p.tryReuseCacheWithClientSideFilters(r,s,e,i,e.telemetryV2Enabled);if(h)return h}}},t.prototype.getCache=function(e){return this.cacheByModel[this.generateModelKey(e)]},t.prototype.ensureCache=function(t){var r=this.generateModelKey(t),i=this.cacheByModel,a=i[r];return void 0===a&&(a=i[r]=new e.RejectablePromiseCache(this.promiseFactory)),a},t.prototype.generateModelKey=function(e){if(!_.isEmpty(e))return JSON.stringify(_.map(e,function(e){return{dbName:e.dbName,vsName:e.vsName,schemaName:e.schemaName}}))},t.prototype.rewriteCacheDataWithoutExecutionMetrics=function(e){if(e){var t=__assign({},e);return delete t.metrics,t.fromClientCache=!0,t}return e},t}();!function(e){function t(e,t,r){return n(e)?i(e,t,r):a(e.Commands[0].SemanticQueryDataShapeCommand,t,r)}function r(e){return n(e)?v(e):o(e.Commands[0].SemanticQueryDataShapeCommand)}function i(e,t,r){return{key:r||v(e),keyWithoutReduction:y(e),keyWithoutViewport:g(e),keyWithoutFilter:void 0,queryFilters:void 0,compositeDataQuery:!0,queryId:c(t)}}function a(e,t,r){var i=p.isDataShapeCommandSuitableForClientSideFiltering(e);return{key:r||o(e),keyWithoutReduction:h(e),keyWithoutViewport:void 0,keyWithoutFilter:i?m(e):void 0,queryFilters:i?S(e):void 0,compositeDataQuery:!1,queryId:c(t)}}function n(e){return e.Commands.length>1}function o(e){if(e)return JSON.stringify(e)}function c(e){return e&&e.queryCancellation?u.generateGuid():""}function l(e){e&&e.Binding&&"object"==typeof e.Binding&&(e.Binding.DataReduction=void 0,e.Binding.Limits=void 0)}function d(e){e&&(e.ViewportHeightPx=void 0,e.ViewportWidthPx=void 0)}function f(e){e&&e.Query&&e.Query.Where&&(e.Query.Where=void 0)}function h(e){if(e){var t=_.cloneDeep(e);return l(t),JSON.stringify(t)}}function m(e){if(e){var t=_.cloneDeep(e);return f(t),JSON.stringify(t)}}function v(e){if(e)return JSON.stringify(e)}function y(e){if(e){var t=_.cloneDeep(e);return l(t.Commands[0].SemanticQueryDataShapeCommand),JSON.stringify(t)}}function g(e){if(e){var t=_.cloneDeep(e);return d(t.Commands[1].ScriptVisualCommand),JSON.stringify(t)}}function S(e){var t=e&&e.Query;if(t&&!_.isEmpty(t.Where)){var r=s(t),i=r&&r.where();if(!_.isEmpty(i))return i}}e.createCacheItemContext=t,e.generateCacheKeyDataQuery=r,e.createCacheItemContextForCompositeDataQuery=i,e.createCacheItemContextForNonCompositeDataQuery=a}(c||(c={}));var p;!function(e){function r(e){if(!e)return!1;var t=e.Binding&&e.Binding.DataReduction,r=t&&t.Primary,i=t&&t.Secondary;return!(!n(r)||!n(i))&&(!a(r)&&!a(i))}function i(e,t,r,i,a){if(void 0===a&&(a=!1),r.allowClientSideFilters){var n=o(t,i);return _.isEmpty(n)?void 0:e.bindCacheEntry(t.key,function(e){return p(e,n)},a)}}function o(e,t){if(!t.compositeDataQuery&&!!t.keyWithoutFilter&&!e.compositeDataQuery&&e.keyWithoutFilter&&e.hasAllData&&e.keyWithoutFilter===t.keyWithoutFilter&&l(u(e.queryFilters,t.queryFilters),t.queryFilters)){var r=u(t.queryFilters,e.queryFilters);if(!_.isEmpty(r))return c(t,r)}}function u(e,r){return _.isEmpty(r)?e:_.filter(e,function(e){return!t.SQFilter.contains(r,e)})}function c(e,r){var i=JSON.parse(e.key),a=s(i&&i.Query);if(a){return t.ClientSideFilter.tryConvertToClientSideFilters(a.select(),r)}}function l(e,r){return _.every(e,function(e){return _.some(r,function(r){return t.ClientSideFilter.isMoreRestrictiveFilter(r,e)})})}function p(e,t){var r=__assign({},e);return r.clientSideFilters=t,r}e.isDataShapeCommandSuitableForClientSideFiltering=r,e.tryReuseCacheWithClientSideFilters=i,e.tryComputeClientSideFilters=o}(p||(p={}))}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,i=jsCommon.DateExtensions;!function(r){function a(e){return c(e)}function n(e){return c(e,!0)}function o(e){if(!e)return null;if(_.startsWith(e,d)){return e.substring(d.length,e.length-1)}return null}function s(e,t){if(null===e)return null;switch(t){case 4:return"number"==typeof e?e:parseInt(e,10);case 2:case 3:return"number"==typeof e?e:l(e);case 7:case 6:if("number"==typeof e){var r=new Date(e),a=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),n=new Date(r.getTime()+6e4*a.getTimezoneOffset());return n.epochTimeStamp=e,n}return i.parseIsoDate(e);case 1:return e;case 5:return"number"==typeof e?1===e:e;case 13:return c(e)}}function u(r,i,a){if(null===r)return t.SQExprBuilder.nullConstant();switch(a){case 4:return"number"==typeof i?t.SQExprBuilder.integer(+r):t.SQExprBuilder.fromRawValue(260,+r,i.toString());case 2:return"number"==typeof i?t.SQExprBuilder.decimal(+r):t.SQExprBuilder.fromRawValue(258,+r,i.toString());case 3:return"number"==typeof i?t.SQExprBuilder.double(+r):t.SQExprBuilder.fromRawValue(259,+r,i.toString());case 7:case 6:return"number"==typeof i?new t.SQConstantExpr(e.ValueType.fromExtendedType(519),r):t.SQExprBuilder.fromRawValue(519,r,i.toString());case 1:return t.SQExprBuilder.text(r.toString());case 5:return t.SQExprBuilder.boolean(!!r);case 13:return c(i,!0)}}function c(e,r){var a=typeof e;if("string"===a){if(_.endsWith(e,"L")){var n=parseInt(e,10);return r?t.SQExprBuilder.integer(n,e):n}if(_.endsWith(e,"D")){var o=l(e);return r?t.SQExprBuilder.double(o,e):o}if(_.endsWith(e,"M")){var s=l(e);return r?t.SQExprBuilder.decimal(s,e):s}if(_.endsWith(e,"'")){if("'"===e.charAt(0)){var u=e.substring(1,e.length-1).replace(p,"'");return r?t.SQExprBuilder.text(u,e):u}if(0===e.indexOf("datetime'")){var c=e.replace(f,"'"),d=e.substring(9,c.length-1),h=i.parseIsoDate(d);return r?t.SQExprBuilder.dateTime(h,c):h}}if("null"===e)return r?t.SQExprBuilder.nullConstant():null;if("true"===e)return!r||t.SQExprBuilder.boolean(!0);if("false"===e)return!!r&&t.SQExprBuilder.boolean(!1)}return"boolean"===a?r?t.SQExprBuilder.boolean(e):e:null===e?r?t.SQExprBuilder.nullConstant():null:e}function l(e){var t=parseFloat(e);return isNaN(t)?parseFloat(e.replace("INF","Infinity")):t}var p=/''/g,d="base64'",f=/\.000'$/;r.parseValue=a,r.parseValueToSQExpr=n,r.parseBinary=o,r.parseOptimizedValue=s,r.parseOptimizedValueToSQExpr=u,r.parseTypeEncodedValue=c}(r=t.PrimitiveValueEncoding||(t.PrimitiveValueEncoding={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e){for(var t=[],o=0,s=e.length;o<s;o++){var u=e[o];u.measureMove&&t.push(r(u.measureMove)),u.entityRename&&t.push(i(u.entityRename)),u.propertyRename&&t.push(a(u.propertyRename)),u.hierarchyLevelRename&&t.push(n(u.hierarchyLevelRename))}return t}function r(e){return new s(e)}function i(e){return new o(e)}function a(e){return new u(e)}function n(e){return new c(e)}e.createSchemaChangeRewriters=t,e.createMoveMeasureRewriter=r,e.createEntityRenameRewriter=i,e.createPropertyRenameRewriter=a,e.createHierarchyLevelRenameRewriter=n;var o=function(t){function r(e){var r=this;return r=t.call(this)||this,r.change=e,r}return __extends(r,t),r.prototype.visitEntity=function(t){var r=this.change;return t.schema===r.schema&&t.entity===r.before?new e.SQEntityExpr(t.schema,r.after,t.variable):t},r}(e.SQExprRewriter),s=function(t){function r(e){var r=this;return r=t.call(this)||this,r.change=e,r}return __extends(r,t),r.prototype.visitMeasureRef=function(t){var r=this.change,i=e.FieldExprPattern.toFieldExprEntityItemPattern(e.SQExprConverter.asFieldPattern(t));if(i.schema===r.schema&&i.entity===r.source&&t.ref===r.property){var a=new e.SQEntityExpr(i.schema,r.destination);return new e.SQMeasureRefExpr(a,r.property)}return t},r}(e.SQExprRewriter),u=function(t){function r(e){var r=this;return r=t.call(this)||this,r.change=e,r}return __extends(r,t),r.prototype.visitColumnRef=function(t){var r=this.change;return this.matches(r,t)?new e.SQColumnRefExpr(t.source,r.after):t},r.prototype.visitMeasureRef=function(t){var r=this.change;return this.matches(r,t)?new e.SQMeasureRefExpr(t.source,r.after):t},r.prototype.visitGroupRef=function(t){var r=this,i=t,a=this.change;this.matches(a,t)&&(i=new e.SQGroupRefExpr(a.after,t.source,t.groupedExprs));var n=_.map(t.groupedExprs,function(e){return e.accept(r)});return e.SQExprUtils.sequenceEqual(n,t.groupedExprs)||(i=new e.SQGroupRefExpr(i.ref,i.source,n)),i},r.prototype.visitHierarchy=function(t){var r=t.arg.accept(this);if(r!==t.arg)return new e.SQHierarchyExpr(r,t.hierarchy);var i=this.change;return this.hierarchyMatches(i,t)?new e.SQHierarchyExpr(t.arg,i.after):t},r.prototype.visitPropertyVariationSource=function(t){var r=this.change;return this.variationMatches(r,t)?new e.SQPropertyVariationSourceExpr(t.arg,t.name,r.after):t},r.prototype.variationMatches=function(e,t){var r=t.arg;return r.schema===e.schema&&r.entity===e.entity&&t.property===e.before},r.prototype.hierarchyMatches=function(t,r){var i=r.arg;if(e.SQExpr.isEntity(i))return"Hierarchy"===t.objectType&&i.schema===t.schema&&i.entity===t.entity&&r.hierarchy===t.before},r.prototype.matches=function(t,r){var i=e.FieldExprPattern.toFieldExprEntityItemPattern(e.SQExprConverter.asFieldPattern(r));return i.schema===t.schema&&i.entity===t.entity&&r.ref===t.before},r}(e.SQExprRewriter),c=function(t){function r(e){var r=this;return r=t.call(this)||this,r.change=e,r}return __extends(r,t),r.prototype.visitHierarchyLevel=function(t){var r=this.change;return this.matches(r,t)?new e.SQHierarchyLevelExpr(t.arg,r.after):t},r.prototype.matches=function(t,r){var i=e.SQExprConverter.asFieldPattern(r);if(!i.columnHierarchyLevelVariation){var a=e.FieldExprPattern.toFieldExprEntityItemPattern(i),n=r.arg;return a.schema===t.schema&&a.entity===t.entity&&n.hierarchy===t.hierarchy&&r.level===t.before}},r}(e.SQExprRewriter)}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e){this.clauses={from:e,select:[]}}return t.prototype.addWhere=function(e){var t=this.clauses;t.where||(t.where=[]),t.where.push(e)},t.prototype.addOrderBy=function(e){var t=this.clauses;t.orderBy||(t.orderBy=[]),t.orderBy.push(e)},t.prototype.addSelect=function(e){this.clauses.select.push(e)},t.prototype.addGroupBy=function(e){var t=this.clauses;t.groupBy||(t.groupBy=[]),t.groupBy.push(e)},t.prototype.addTransform=function(e){var t=this.clauses;t.transforms||(t.transforms=[]),t.transforms.push(e)},t.prototype.setTop=function(e){this.clauses.top=e},t.prototype.toQuery=function(){return e.SemanticQuery.createWith(this.clauses,!0)},t.prototype.toFilter=function(){var t=this.clauses;if(t.from&&t.where)return new e.SemanticFilter(t.from,t.where)},t}();e.SemanticQueryBuilder=t}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){e[e.Version0=0]="Version0",e[e.Version1=1]="Version1",e[e.Version2=2]="Version2"}(t=e.SemanticQueryVersions||(e.SemanticQueryVersions={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(e,t){return e.accept(new i(t))}t.run=r;var i=function(t){function r(e){var r=t.call(this)||this;return r.schema=e,r}return __extends(r,t),r.prototype.visitPropertyVariationSource=function(t){var r=t.arg.getTargetEntity();if(!r)return t;var i=r.schema,a=this.schema.schema(i).findTargetEntityOfVariation(r.entity,t.property,t.name);return a?e.SQExprBuilder.entity(i,a.name):t},r}(e.SQExprRewriter)}(t=e.VariationRewriter||(e.VariationRewriter={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){function i(r){for(var i={Version:0,Sources:[],GroupedColumns:[]},a=new e.SQFrom,o=0,s=r.groupedColumns;o<s.length;o++){var u=s[o],c=e.SQExprRewriterWithSourceRenames.rewrite(u,void 0,a);i.GroupedColumns.push(t.SemanticQuerySerializer.serializeExprWithRef(c))}if(r.groupItems){i.GroupItems=[];for(var l=0,p=r.groupItems;l<p.length;l++){var d=p[l],f={DisplayName:d.name};if(d.expression){var c=e.SQExprRewriterWithSourceRenames.rewrite(d.expression,void 0,a);f.Expression=t.SemanticQuerySerializer.serializeExprWithRef(c)}d.blankDefaultPlaceholder&&(f.BlankDefaultPlaceholder=!0),i.GroupItems.push(f)}}r.binItem&&(i.BinItem={Expression:t.SemanticQuerySerializer.serializeExprWithRef(e.SQExprRewriterWithSourceRenames.rewrite(r.binItem,void 0,a))}),t.SemanticQuerySerializer.serializeFrom(a,i.Sources);var h=r.partitionTable;if(h){i.PartitionTable={Definition:{TableDefinition:t.SemanticQuerySerializer.serializeQuery(h.mappingTable),ItemIdColumns:h.itemIdColumns,PartitionIdColumn:h.partitionIdColumn}};var m=h.partitions;m&&(i.PartitionTable.Definition.Partitions=n(m));var v=r.partitionTableResult;v&&(i.PartitionTable.Result={TableName:v.tableName,PartitionIdColumn:v.partitionIdColumn});var y=r.partitionTable.defaultPartitionPrefix;y&&(i.PartitionTable.Definition.DefaultPartitionPrefix=y)}return i}function a(e){if(0===e.Version){for(var r={groupedColumns:[]},i=t.SemanticQuerySerializer.deserializeFrom(e.Sources),a=0,n=e.GroupedColumns;a<n.length;a++){var o=n[a];r.groupedColumns.push(t.SemanticQuerySerializer.deserializeExprWithRef(o,i))}if(e.GroupItems){r.groupItems=[];for(var s=0,u=e.GroupItems;s<u.length;s++){var c=u[s],l={name:c.DisplayName};c.Expression&&(l.expression=t.SemanticQuerySerializer.deserializeExprWithRef(c.Expression,i)),c.BlankDefaultPlaceholder&&(l.blankDefaultPlaceholder=!0),r.groupItems.push(l)}}if(e.BinItem&&(r.binItem=t.SemanticQuerySerializer.deserializeExprWithRef(e.BinItem.Expression,i)),e.PartitionTable){var p=e.PartitionTable.Definition,d=p.TableDefinition;r.partitionTable={mappingTable:t.SemanticQuerySerializer.deserializeQuery(d),itemIdColumns:p.ItemIdColumns,partitionIdColumn:p.PartitionIdColumn};var f=p.Partitions;f&&(r.partitionTable.partitions=_.map(f,function(e){return{displayName:e.DisplayName,partitionIds:_.map(e.PartitionIds,t.SemanticQuerySerializer.deserializeExpr)}}));var h=e.PartitionTable.Result;h&&(r.partitionTableResult={tableName:h.TableName,partitionIdColumn:h.PartitionIdColumn});var m=p.DefaultPartitionPrefix;m&&(r.partitionTable.defaultPartitionPrefix=m)}return r}}function n(e){return _.map(e,function(e){return{DisplayName:e.displayName,PartitionIds:_.map(e.partitionIds,t.SemanticQuerySerializer.serializeExpr)}})}function o(t,r){for(var i=s(t),a=new e.SQFrom,n=i.groupedColumns,o=0;o<n.length;o++)n[o]=e.SQExprRewriterWithSourceRenames.rewrite(n[o],a,r);for(var u=i.groupItems,c=0,l=u;c<l.length;c++){var p=l[c];p.expression&&(p.expression=e.SQExprRewriterWithSourceRenames.rewrite(p.expression,a,r))}var d=i.binItem;return d&&(i.binItem=e.SQExprRewriterWithSourceRenames.rewrite(d,a,r)),i}function s(e){return a(i(e))}r.serialize=i,r.deserialize=a,r.serializePartitions=n,r.normalizeFromRefs=o}(r=t.SemanticGroupingSerializer||(t.SemanticGroupingSerializer={}))}(t=e.services||(e.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.ClientErrorStrings,i=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"RealTimeLongPollError"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("Realtime_longPollErrorValue"),displayableErrorInfo:[{errorInfoKey:e.get("Realtime_longPollErrorKey"),errorInfoValue:e.get("Realtime_longPollErrorValue")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.RealTimeLongPollError=i;var a=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"RealTimeGetHistory"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("Realtime_retrieveHistoryValue"),displayableErrorInfo:[{errorInfoKey:e.get("Realtime_retrieveHistoryKey"),errorInfoValue:e.get("Realtime_retrieveHistoryValue")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.RealTimeGetHistoryClientError=a;var n=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"RTMessageExceedLimit"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("Realtime_MessageExceedLimitValue"),displayableErrorInfo:[{errorInfoKey:e.get("Realtime_MessageExceedLimitKey"),errorInfoValue:e.get("Realtime_MessageExceedLimitValue")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.MessageExceedLimitClientError=n;var o=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"FailedRealTimeUpdate"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("Realtime_UpdateFailedValue"),displayableErrorInfo:[{errorInfoKey:e.get("Realtime_UpdateFailedKey"),errorInfoValue:e.get("Realtime_UpdateFailedValue")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.FailedRealTimeUpdateClientError=o;var s=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"RealTimePubNubCredentials"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("Realtime_PubNubGetCredentialsFailedValue"),displayableErrorInfo:[{errorInfoKey:e.get("Realtime_PubNubGetCredentialsFailedKey"),errorInfoValue:e.get("Realtime_PubNubGetCredentialsFailedValue")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.RealTimePubNubGetCredentialsClientError=s;var u=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"EmptyData"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataFormat_DataFormatIsInvalid")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.EmptyDataClientError=u;var c=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"InvalidDataResponse"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignorable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataResponse_ServerError")}],debugErrorInfo:[{errorInfoKey:r.ClientErrorCode,errorInfoValue:this.code}]}},e}();t.InvalidDataResponseClientError=c}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function r(e,t,r){return new n(e,t,r)}function i(e,t,r){return new o(e,t,r)}var a=jsCommon.JsonComparer;t.createDataProxy=r,t.createSingleExecutableDataProxy=i;var n=function(){function e(e,t,r){this.promiseFactory=e,this.dataReaderProvider=t,this.dataReaders={},this.telemetryService=r}return e.prototype.execute=function(e){return this.getReader(e.type).execute(e.query,e.kinds,e.perfId)},e.prototype.getReader=function(e){var t=this.dataReaders[e];if(t)return t;var r=this.dataReaderProvider.reader(e);return this.dataReaders[e]=new s(e,r,this.promiseFactory,this.telemetryService)},e.prototype.stopCommunication=function(e){this.getReader(e).stopCommunication()},e.prototype.resumeCommunication=function(e){this.getReader(e).resumeCommunication()},e.prototype.clearCache=function(e,t){this.getReader(e).clearCache(t)},e.prototype.rewriteCacheEntries=function(e,t,r){this.getReader(e).rewriteCacheEntries(t,r)},e.prototype.setLocalCacheResult=function(e,t){return this.getReader(e.type).setLocalCacheResult(e.query,t)},e}(),o=function(){function t(e,t,r){this.proxy=e,this.promiseFactory=t,this.timeoutService=r}return t.prototype.execute=function(t){var r=this,i=this.lastExecute;if(i&&i.promise.pending()){if(a.equals(t,i.query)){var n=e.createRejectablePromise2(i.deferred);return n.matchesLastExecuteQuery=!0,n}this.lastExecute.promise.reject(new e.QueryCancellationClientError("NewQuery"))}var o,s=t&&t.query&&t.query.telemetryV2Enabled,u=this.promiseFactory.defer(s),c=e.createRejectablePromise2(u),l=this.lastExecute={query:t,deferred:u,promise:c};return this.queuedExecution||(this.queuedExecution=!0,o=this.timeoutService.setTimeout(0,s),o.promise.then(function(){r.queuedExecution=!1;var e=r.lastExecute,t=r.proxy.execute(e.query);t.then(function(t){return e.deferred.resolve(t)},function(t){return e.deferred.reject(t)}),e.promise.catch(function(e){return t.reject(e)})}).catch(function(){})),c.finally(function(){l===r.lastExecute&&(o&&o.reject(),r.lastExecute=void 0)}).catch(function(){}),c},t.prototype.cancelQuery=function(t){var r=this.lastExecute;r&&r.promise.pending()&&r.promise.reject(new e.QueryCancellationClientError(t))},t}(),s=function(){function r(e,t,r,i){this.name=e,this.reader=t,this.promiseFactory=r,this.telemetryService=i}return r.prototype.execute=function(r,i,a){var n=this,o=this.promiseFactory.defer(r.telemetryV2Enabled),s=this.reader;if(s.execute){var u=s.execute(r,a);u.then(function(s){if(s){var u=n.transform(s,i,a,r.performanceActivity),c=u.error;if(c)return o.reject(c),void n.telemetryService.logEvent(e.telemetry.DataExecuteQuery,s.requestId,void 0,!0,"PowerBI",c.code);o.resolve({dataReaderResult:u,dataViewSource:{data:s}})}else o.reject(new t.EmptyDataClientError),n.telemetryService.logEvent(e.telemetry.DataExecuteQuery,void 0,void 0,!0,"PowerBI","DataProxy_EmptyData")},function(t){o.reject(t),t&&t.ignorable||n.telemetryService.logEvent(e.telemetry.DataExecuteQuery,t?t.requestId:void 0,void 0,!0,"PowerBI",t?t.code:"DataProxy_ProviderError")});var c=e.createRejectablePromise2(o);return c.catch(function(r){r=r||new t.InvalidDataResponseClientError,u.reject(r),r.ignorable||n.telemetryService.logEvent(e.telemetry.DataExecuteQuery,r.requestId,void 0,!0,"PowerBI",r.code)}),c}return r.command?o.resolve({dataReaderResult:this.transform(r.command,i,a)}):o.reject(),e.createRejectablePromise2(o)},r.prototype.stopCommunication=function(){var e=this.reader;e.stopCommunication&&e.stopCommunication()},r.prototype.resumeCommunication=function(){var e=this.reader;e.resumeCommunication&&e.resumeCommunication()},r.prototype.clearCache=function(e){var t=this.reader.cache;t&&t.clear(e)},r.prototype.rewriteCacheEntries=function(e,t){var r=this.reader.cache;r&&r.rewrite(e,t)},r.prototype.setLocalCacheResult=function(e,t){var r=this.reader;r.setLocalCacheResult&&r.setLocalCacheResult(e,t)},r.prototype.transform=function(e,t,r,i){var a=this.reader;if(a.transform)return a.transform(e,t||31,r,i);var n={metadata:{columns:[]}};return n[this.name]=e,{dataView:n}},r}()}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function r(e,t,r,i){return new n(e,t,r,i)}function i(e){return _.groupBy(e,function(e){return t.DataReaderUtils.readerType(e)})}var a=e.data.FederatedConceptualSchema;t.createConceptualSchemaProxy=r;var n=function(){function r(e,t,r,i){this.promiseFactory=e,this.dataReaderProvider=t,this.featureSwitchService=r,this.validator=i,this.individualConceptualSchemaCache={},this.mergedConceptualSchemaCache={}}return r.prototype.get=function(e){var r=this,n=this.featureSwitchService&&this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.telemetryV2;if(!e)return this.promiseFactory.reject({clientError:{code:t.DataSourcesUndefined}},n);var o=this.generateSchemaKey(e),s=this.mergedConceptualSchemaCache[o];if(this.isSchemaPaused(s))return this.promiseFactory.reject(this.getPauseReason(s),n);if(s&&s.promise)return s.promise;var u=this.promiseFactory.defer(n),c={deferred:u,promise:u.promise};this.mergedConceptualSchemaCache[o]=c,c.promise.then(function(){return delete c.deferred},function(){return delete r.mergedConceptualSchemaCache[o]});var l=[],p=i(e),d=function(e){var i=p[e],a=f.generateSchemaKey(i),o=f.individualConceptualSchemaCache[a];if(f.isSchemaPaused(o))return l.push(f.promiseFactory.reject(f.getPauseReason(o),n)),"continue";if(o)return l.push(o.promise),"continue";var s=f.promiseFactory.defer(n),u=s.promise;l.push(u),f.individualConceptualSchemaCache[a]={deferred:s,promise:u},u.finally(function(){r.individualConceptualSchemaCache[a]&&delete r.individualConceptualSchemaCache[a].deferred});var c=f.dataReaderProvider.schemaReader(e);return c?void c.execute({dataSources:i}).then(function(e){return r.onSuccess(c,e,a,s)},function(e){return r.onError(c,e,a,s)}):(s.reject({clientError:{code:t.SchemaReaderUndefined}}),"continue")},f=this;for(var h in p)d(h);return this.promiseFactory.all(l,n).then(function(e){var t=a.merge(e);r.validator&&r.validator.validate(t),c.result=t,u.resolve(t)}).catch(function(e){u.reject(e)}),c.promise},r.prototype.getWithWireContract=function(e){var r=this;return e&&_.uniqBy(e,function(e){return t.DataReaderUtils.readerType(e)}).length>1?this.promiseFactory.reject():this.get(e).then(function(t){var i=r.individualConceptualSchemaCache[r.generateSchemaKey(e)];if(i)return{data:i.data,contract:t}})},r.prototype.getLatestCapabilities=function(e,t){var r=i(e);for(var a in r){var n=r[a],o=this.generateSchemaKey(n),s=this.individualConceptualSchemaCache[o];if(s&&s.result){
var u=s.result.schema(t);if(u)return u.capabilities}}},r.prototype.clearCache=function(e,t){var r=this;if(!t)return this.rejectPendingDeferred(e),this.individualConceptualSchemaCache={},void(this.mergedConceptualSchemaCache={});var a=i(t);for(var n in a){var o=a[n],s=this.generateSchemaKey(o);this.rejectPendingDeferred(e,s),delete this.individualConceptualSchemaCache[s],this.forMergedSchemasContainingKey(s,function(e,t){delete r.mergedConceptualSchemaCache[e]})}},r.prototype.stopCommunication=function(e,t){var r,a,n={clientError:e};if(t){var o=i(t);for(var s in o){var u=o[s];r=this.generateSchemaKey(u),a=this.individualConceptualSchemaCache[r],a||(a={},this.individualConceptualSchemaCache[r]=a),a.pauseReason=n,this.rejectPendingDeferred(n,r)}}else{var c={clientError:null};this.pauseAllSchemasReason=n||c,this.rejectPendingDeferred(n)}},r.prototype.resumeCommunication=function(e){var t,r=this;e?t=_.map(i(e),function(e){return r.generateSchemaKey(e)}):(this.pauseAllSchemasReason=void 0,t=Object.keys(this.individualConceptualSchemaCache));for(var a=0,n=t;a<n.length;a++){var o=n[a],s=this.individualConceptualSchemaCache[o];this.isSchemaPaused(s)&&(delete this.individualConceptualSchemaCache[o],this.forMergedSchemasContainingKey(o,function(e){return delete r.mergedConceptualSchemaCache[e]}))}},r.prototype.isSchemaPaused=function(e){return!!this.pauseAllSchemasReason||e&&!e.promise},r.prototype.getPauseReason=function(e){return e&&e.pauseReason?e.pauseReason:this.pauseAllSchemasReason},r.prototype.rejectPendingDeferred=function(e,t){var r,i;t?(r={},r[t]=null):r=this.individualConceptualSchemaCache;for(var a in r)i=this.individualConceptualSchemaCache[a],i&&(i.deferred&&i.deferred.reject(e),delete i.promise,delete i.deferred,this.forMergedSchemasContainingKey(a,function(t,r){r.deferred&&r.deferred.reject(e),delete r.promise,delete r.deferred}))},r.prototype.onSuccess=function(e,t,r,i){var a=e.transform(t);if(a.error)return void this.onErrorCore(a,r,i);var n=this.individualConceptualSchemaCache[r];n&&(n.result=a.schema,n.data=t.data),i.resolve(a.schema)},r.prototype.onError=function(e,t,r,i){var a=e.transform(t);this.onErrorCore(a,r,i)},r.prototype.onErrorCore=function(t,r,i){var a=this;delete this.individualConceptualSchemaCache[r],t.error&&t.error.serviceError&&(t.error.clientError=new e.ServiceErrorToClientError(t.error.serviceError),t.error.clientError.requestId=t.error.requestId),i.reject(t.error),this.forMergedSchemasContainingKey(r,function(e){delete a.mergedConceptualSchemaCache[e]})},r.prototype.forMergedSchemasContainingKey=function(e,t){for(var r=_.map(JSON.parse(e),function(e){return JSON.stringify(e)}),i=0,a=r;i<a.length;i++){var n=a[i];for(var o in this.mergedConceptualSchemaCache)_.includes(o,n)&&t(o,this.mergedConceptualSchemaCache[o])}},r.prototype.generateSchemaKey=function(e){return JSON.stringify(_.chain(e).map(function(e){return{id:e.id,name:e.name,type:t.DataReaderUtils.readerType(e)}}).orderBy(["type","name","id"]).value())},r}()}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=jsCommon.EnumExtensions,i=function(){function e(){}return e.getDataPointsDescription=function(e,t){if(e&&!_.isEmpty(t)){var r=0;if(e.matrix)r=2;else if(e.table)r=8;else{if(!e.categorical)return;r=1}for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a],s=this.query([e],o,r,[],!0);i.push({selector:o,values:s})}return i}},e.query=function(e,i,u,c,l){if(_.isEmpty(e)||!i)return[];if(_.some(i.data,function(e){return!t.Selector.isScopeIdentity(e)}))return[];var p;p=c&&!l?c:i.metadata?[i.metadata]:void 0;var d=[];if(r.hasFlag(u,8))for(var f=0,h=e;f<h.length;f++){var m=h[f],v=new s(i,p,l);a.visitTable(m.table,v),d.push.apply(d,v.valueDetails)}else if(r.hasFlag(u,1))for(var y=0,g=e;y<g.length;y++){var m=g[y],v=new n(i,p,l);a.visitCategorical(m,v),d.push.apply(d,v.valueDetails)}else if(r.hasFlag(u,2))for(var S=0,C=e;S<C.length;S++){var m=C[S],v=new o(i);a.visitMatrix(m.matrix,v),d.push.apply(d,v.valueDetails)}return d},e}();t.DataViewQueryEngine=i;var a,n=function(){function t(e,t,r){this.ignoreQueryName=r,this.requestedValues=t,this.identities=e.data,this.valueDetails=[]}return t.prototype.visitCategoryColumns=function(t,r){if(!_.isEmpty(t))for(var i=function(t){if(a.ignoreQueryName||_.includes(a.requestedValues,t.source.queryName))for(var i=0;i<t.identity.length;i++){var n=t.identity[i];if(_.includes(a.identities,n)){var o=_.find(r.columns,function(e){return e.index===t.source.index});a.valueDetails.push({identity:n,value:t.values[i],expr:o.expr,formattedValue:e.visuals.valueFormatter.format(t.values[i],t.source.format)});break}}},a=this,n=0,o=t;n<o.length;n++){var s=o[n];i(s)}},t.prototype.visitValueColumnGroups=function(t,r){if(!_.isEmpty(t)&&r&&(this.ignoreQueryName||_.includes(this.requestedValues,r.queryName)))for(var i=0,a=t;i<a.length;i++){var n=a[i];if(_.includes(this.identities,n.identity))return void this.valueDetails.push({value:n.name,formattedValue:e.visuals.valueFormatter.format(n.name,r.format),expr:r.expr,identity:n.identity})}},t.prototype.visitValueColumn=function(e){return!!_.isEmpty(this.requestedValues)||_.includes(this.requestedValues,e.source.queryName)},t.prototype.visitValue=function(t,r,i,n,o){a.isIdentityFilteredOut(this.identities,r.data)||this.valueDetails.push({expr:i.expr,value:t,formattedValue:e.visuals.valueFormatter.format(t,i.format),identity:_.head(r.data)})},t}(),o=function(){function r(e){this.valueDetails=[],this.identitiesToSearch=t.Selector.toScopeIdentities(e)}return r.prototype.visitHierarchy=function(e){for(var t=e.root;t&&t.children&&this.identitiesToSearch.length>0;)t=this.searchNode(t,e.levels)},r.prototype.searchNode=function(t,r){for(var i=0,a=this.identitiesToSearch;i<a.length;i++)for(var n=a[i],o=0,s=t.children;o<s.length;o++){var u=s[o];if(u.identity===n){var c=u.levelValues,l=r[u.level||0];if(!_.isEmpty(c))for(var p=0,d=c;p<d.length;p++){var f=d[p],h=l.sources[f.levelSourceIndex||0];this.valueDetails.push({expr:h.expr,identity:n,value:f.value,formattedValue:e.visuals.valueFormatter.format(f.value,h.format)})}return _.remove(this.identitiesToSearch,n),u}}},r}(),s=function(){function t(e,t,r){this.ignoreQueryName=r,this.requestedValues=t,this.identities=e.data,this.valueDetails=[],this.requestedColumnsIndices=[]}return t.prototype.visitColumn=function(e,t){(this.ignoreQueryName||e.isMeasure&&(_.isEmpty(this.requestedValues)||_.includes(this.requestedValues,e.queryName)))&&this.requestedColumnsIndices.push(t)},t.prototype.visitRow=function(t,r){t.rows[r];if(!t.identity||!a.isIdentityFilteredOut(this.identities,[t.identity[r]]))for(var i=0,n=this.requestedColumnsIndices;i<n.length;i++){var o=n[i],s=t.rows[r][o],u=t.columns[o];this.valueDetails.push({expr:u.expr,value:s,formattedValue:e.visuals.valueFormatter.format(s,u.format),identity:t.identity&&t.identity[r]})}},t}();!function(r){function i(t,r){if(t)for(var i=function(t){if(!_.some(r,function(r){return e.DataViewScopeIdentity.equals(t,r)}))return{value:!0}},a=0,n=t;a<n.length;a++){var o=n[a],s=i(o);if("object"==typeof s)return s.value}return!1}function a(e,r){var i=e.categorical;if(i&&!_.isEmpty(i.values)){var a=t.DataViewConcatenateCategoricalColumns.getUntransformedCategories(i);r.visitCategoryColumns(a,e.metadata);var n=_.head(i.categories),o=n&&_.clone(n.identity),s=i.values.grouped();r.visitValueColumnGroups(s,i.values.source);for(var u=0,c=s;u<c.length;u++)for(var l=c[u],p=l.identity,d=0,f=l.values;d<f.length;d++){var h=f[d];if(r.visitValueColumn(h))for(var m=Object.keys(h.values),v=0;v<m.length;v++){var y=m[v],g=h.values[y],S=h.source,C={data:o?[o[v]]:[],metadata:S.queryName};p&&C.data.push(p),r.visitValue(g,C,h.source,i.categories,v)}}}}function n(e,t){if(e&&!_.isEmpty(e.rows)){for(var r=e.columns,i=0;i<r.length;i++)t.visitColumn(r[i],i);for(var a=0;a<e.rows.length;a++)t.visitRow(e,a)}}function o(e,t){e.rows&&t.visitHierarchy(e.rows),e.columns&&t.visitHierarchy(e.columns)}r.isIdentityFilteredOut=i,r.visitCategorical=a,r.visitTable=n,r.visitMatrix=o}(a=t.DataViewScan||(t.DataViewScan={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(){return{validate:_.noop}}e.createDefaultFederatedSchemaValidator=t}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){function i(r,i){if(!_.isEmpty(r.levels)&&0!==i){var o=n(r.root,-1,i,r.levels);if(o){for(var s=i<r.levels.length?i:r.levels.length,u=new Array(s),c=new e.SQFrom(null),l=0;l<s;l++)u[l]=a(r.levels[l],c);var p=[];return t.SemanticQuerySerializer.serializeFrom(c,p),{From:p,Levels:u,Instances:o}}}}function a(r,i){return{Expressions:_.map(r.identityKeys,function(r){var a=e.SQExprRewriterWithSourceRenames.rewrite(r,i,i);return t.SemanticQuerySerializer.serializeExprWithRef(a)}),Default:r.isCollapsed?0:1}}function n(e,r,i,a){var o=r===-1,s=r+1===i,u=!o&&!!a[r].isCollapsed;if(e.isToggled||!(u||s||_.isEmpty(e.children))){var c,l=!o&&!u&&e.isToggled,p=!s&&!_.isEmpty(e.children)&&!l;if(p){c=[];for(var d=0,f=e.children;d<f.length;d++){var h=f[d],m=n(h,r+1,i,a);m&&c.push(m)}}if(e.isToggled||!_.isEmpty(c)){var v={};return _.isEmpty(e.identityValues)||(v.Values=_.map(e.identityValues,function(e){return t.SemanticQuerySerializer.serializeExpr(e)})),_.isEmpty(c)||(v.Children=c),v}}}r.serializeExpansionState=i,r.serializeLevelExpansionState=a}(r=t.DataShapeBindingExpansionStateSerializer||(t.DataShapeBindingExpansionStateSerializer={}))}(t=e.services||(e.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r,i=e.data.ExpansionState;!function(r){function a(e){return _.filter(_.map(e,function(e){return n(e)}),function(e){return e})}function n(t){if(e.data.ExpansionState.hasNodes(t)||e.data.ExpansionState.hasPinnedLevels(t)){var r={roles:t.roles};return _.isEmpty(t.levels)||(r.levels=_.map(t.levels,function(e){return o(e)}),r.root=s(t.root)),r}}function o(e){if(e){var r={queryRefs:_.clone(e.queryRefs)};return e.isCollapsed&&(r.isCollapsed=!0),e.identityKeys&&(r.identityKeys=_.map(e.identityKeys,function(e){return t.SemanticQuerySerializer.serializeExpr(e)})),e.isPinned&&(r.isPinned=e.isPinned),e.isLocked&&(r.isLocked=e.isLocked),e.AIInformation&&(r.AIInformation=_.cloneDeep(e.AIInformation)),r}}function s(e){var r={identityValues:e.identityValues?_.map(e.identityValues,function(e){return t.SemanticQuerySerializer.serializeExpr(e)}):null};if(e.isToggled&&(r.isToggled=!0),!_.isEmpty(e.children)){r.children=[];for(var i=0,a=e.children;i<a.length;i++){var n=a[i],o=s(n);r.children.push(o)}}return r}function u(e,t,r){if(e){for(var a=[],n=0,o=e;n<o.length;n++){var s=o[n];if(s){var u=new i(s.roles,t,r);_.isEmpty(s.levels)||(u.levels=_.map(s.levels,function(e){return c(e)}),u.root=l(s.root,-1,null,u.levels,r)),a.push(u)}}return a}}function c(e){var r={queryRefs:_.clone(e.queryRefs),isCollapsed:!!e.isCollapsed,toggledNodes:[],isPinned:e.isPinned,isLocked:e.isLocked,AIInformation:_.cloneDeep(e.AIInformation)};return e.identityKeys&&(r.identityKeys=_.map(e.identityKeys,function(e){return t.SemanticQuerySerializer.deserializeExpr(e)})),r}function l(e,r,i,a,n){var o={identityValues:e.identityValues?_.map(e.identityValues,function(e){return t.SemanticQuerySerializer.deserializeExpr(e)}):null,parent:i,children:[]};if(e.isToggled&&(o.isToggled=!0,r>=0&&a[r].toggledNodes.push(o)),!_.isEmpty(e.children)){var s=r+1;o.children=_.map(e.children,function(e){return l(e,s,o,a,n)})}return o}r.serializeExpansionStates=a,r.deserializeExpansionStates=u}(r=t.ExpansionStateSerializer||(t.ExpansionStateSerializer={}))}(r=t.services||(t.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i;!function(e){var t;!function(e){function t(e,t){var r=e&&e[t];if(r){for(var i,a=0,n=r.length;a<n;a++){var o=r[a];if(null==o.selector){i=o;break}}if(i)return i.properties}}e.getObjectDefinitionProperties=t}(t=e.DataViewObjectDefinitions||(e.DataViewObjectDefinitions={}))}(i=r.wireContracts||(r.wireContracts={}));var a;!function(i){function a(e,t){if(e){var r={};for(var i in e){var a=void 0;if(!t||(a=t[i]))for(var n=e[i],o=r[i]=[],s=0,u=n.length;s<u;s++)o.push(c(n[s],a,!t))}return r}}function n(e){if(e)return _.map(e,l)}function o(e){if(e)return _.map(e,M)}function s(e){if(e)return{category:e.categoryString,underlyingType:e.extendedType}}function u(t){if(t)return new e.ValueType(t.underlyingType,t.category)}function c(e,t,r){if(e){var i={properties:h(e.properties,t?t.properties:null,r)},a=l(e.selector);return a&&(i.selector=a),i}}function l(e){if(null===e)return null;if(e){var t={};return e.data&&(t.data=_.chain(e.data).map(function(e){return f(e)}).filter(function(e){return null!=e}).value()),e.metadata&&(t.metadata=e.metadata),e.id&&(t.id=e.id),t}}function p(e){if(e){var t={};if(e.dataMap){t.dataMap={};for(var r in e.dataMap)t.dataMap[r]=_.chain(e.dataMap[r]).map(function(e){return f(e)}).filter(function(e){return null!=e}).value()}return e.metadata&&(t.metadata=e.metadata),e.id&&(t.id=e.id),t}}function d(e){if(e)return _.map(e,function(e){return{objectName:e.objectName,selectorsByColumn:p(e.selectorsByColumn)}})}function f(e){return e.scopeId?w(e):e.wildcard?t.DataViewScopeWildcard.fromExprs(_.map(e.wildcard,r.SemanticQuerySerializer.deserializeExpr)):e.roles?t.DataViewRoleWildcard.fromRoles(e.roles):e.total?t.DataViewScopeTotal.fromExprs(_.map(e.total,r.SemanticQuerySerializer.deserializeExpr)):e.dataViewWildcard?t.DataViewWildcard.create(e.dataViewWildcard.matchingOption):void 0}function h(e,t,r){if(e){var i={};for(var a in e){var n=m(e[a],t?t[a]:null,r);void 0!==n&&(i[a]=n)}return i}}function m(e,t,i){if(t){var a=L(t.type);return a.value?v(e,a.value):y(e,a.structural)}if(i&&e){if(e.expr)return r.SemanticQuerySerializer.deserializeExpr(e.expr);if(e.solid)return y(e,J);if(e.filter)return r.SemanticQuerySerializer.deserializeFilter(e.filter)}}function v(e,t){if(void 0!==t.primitiveType&&e.expr)return r.SemanticQuerySerializer.deserializeExpr(e.expr)}function y(t,i){if(!(i.fill&&i.fill.solid&&i.fill.solid.color&&t)){if(i.fillRule){var a=t,n=O(a,v);if(n)return n}var o=t;return i.filter&&o&&o.filter?r.SemanticQuerySerializer.deserializeFilter(o.filter):i.image&&o&&o.image?g(o.image):i.geoJson&&o&&o.geoJson?S(o.geoJson):i.paragraphs&&t?C(t):i.queryTransform&&t?x(t):i.dataBars&&t?D(t):i.icon&&t&&"Icon"===t.kind?E(t):void 0}var s=t;if(s.solid&&s.solid.color)return{solid:{color:v(s.solid.color,e.ValueType.fromPrimitiveTypeAndCategory(1))}}}function g(t){var r={name:v(t.name,H),url:v(t.url,e.ValueType.fromDescriptor(e.ImageDefinition.urlType))};return t.scaling&&(r.scaling=v(t.scaling,H)),r}function S(e){return{type:v(e.type,H),name:v(e.name,H),content:v(e.content,H)}}function C(e){return _.map(e,function(e){var t={textRuns:_.map(e.textRuns,function(e){var t={value:v(e.value,H)||e.value};return e.textStyle&&(t.textStyle=e.textStyle),e.url&&(t.url=e.url),t})};return e.horizontalTextAlignment&&(t.horizontalTextAlignment=e.horizontalTextAlignment),t})}function x(e){return{algorithm:e.algorithm,parameters:_.map(e.parameters,function(e){return{name:e.Name,expr:r.SemanticQuerySerializer.deserializeExpr(e)}})}}function D(e){return{minValue:e.minValue?v(e.minValue,U):void 0,maxValue:e.maxValue?v(e.maxValue,U):void 0,positiveColor:y(e.positiveColor,J),negativeColor:y(e.negativeColor,J),axisColor:y(e.axisColor,J),reverseDirection:v(e.reverseDirection,W),hideText:v(e.hideText,W)}}function E(e){var t={kind:"Icon"};return e.layout&&(t.layout=v(e.layout,H)),e.verticalAlignment&&(t.verticalAlignment=v(e.verticalAlignment,W)),e.value&&(t.value=v(e.value,H)),t}function w(e){if(e.scopeId){var i=r.SemanticQuerySerializer.deserializeExpr(e.scopeId);if(i)return t.createDataViewScopeIdentity(i)}}function b(e,t){if(e){var r={};for(var i in e){var a=void 0;if(!t||(a=t[i]))for(var n=e[i],o=r[i]=[],s=0,u=n.length;s<u;s++)o.push(I(n[s],a,!t))}return r}}function I(e,t,r){if(e){var i=A(e.properties,t?t.properties:null,r);if(i){var a={properties:i},n=M(e.selector);return n&&(a.selector=n),a}}}function M(e){if(null===e)return null;if(e){var t={};return e.data&&(t.data=_.chain(e.data).map(function(e){return T(e)}).filter(function(e){return null!=e}).value()),e.metadata&&(t.metadata=e.metadata),e.id&&(t.id=e.id),t}}function V(e){if(e){var t={};if(e.dataMap){t.dataMap={};for(var r in e.dataMap){var i=jsCommon.ArrayExtensions.ensureArray(e.dataMap[r]);t.dataMap[r]=_.chain(i).map(function(e){return T(e)}).filter(function(e){return null!=e}).value()}}return e.metadata&&(t.metadata=e.metadata),e.id&&(t.id=e.id),t}}function R(e){if(e)return _.map(e,function(e){return{objectName:e.objectName,selectorsByColumn:V(e.selectorsByColumn)}})}function T(e){return t.Selector.isScopeIdentity(e)&&e.expr?P(e):t.Selector.isScopeWildcard(e)&&e.exprs?{wildcard:_.map(e.exprs,r.SemanticQuerySerializer.serializeExpr)}:t.Selector.isRoleWildcard(e)&&e.roles?{roles:e.roles}:t.Selector.isScopeTotal(e)&&e.exprs?{total:_.map(e.exprs,r.SemanticQuerySerializer.serializeExpr)}:t.Selector.isWildcard(e)?{dataViewWildcard:N(e)}:void 0}function P(e){return{scopeId:r.SemanticQuerySerializer.serializeExpr(e.expr)}}function N(e){return{matchingOption:e.matchingOption}}function A(e,t,r){if(e){var i={};for(var a in e){var n=t?t[a]:null;if(r||n){var o=F(e[a],n,r);void 0===o||(i[a]=o)}}return i}}function F(e,i,a){if(i){var n=L(i.type);return n.value?Q(e,n.value):B(e,n.structural)}if(a&&e){if(e instanceof t.SQExpr)return{expr:r.SemanticQuerySerializer.serializeExpr(e)};if(e instanceof t.SemanticFilter)return{filter:r.SemanticQuerySerializer.serializeFilter(e)};if(e.solid)return B(e,J)}}function Q(e,i){if(void 0!==i.primitiveType&&e instanceof t.SQExpr)return{expr:r.SemanticQuerySerializer.serializeExpr(e)}}function B(t,i){if(t){if(i.fill&&i.fill.solid&&i.fill.solid.color){return{solid:{color:Q(t.solid.color,e.ValueType.fromPrimitiveTypeAndCategory(1))}}}if(i.fillRule){var a=t,n=O(a,Q);if(n)return n}if(i.filter)return{filter:r.SemanticQuerySerializer.serializeFilter(t)};if(i.image)return{image:z(t)};if(i.geoJson)return{geoJson:q(t)};if(i.paragraphs){return k(t)}return i.queryTransform?G(t):i.dataBars?K(t):i.icon&&"Icon"===t.kind?j(t):void 0}}function z(t){var r={name:Q(t.name,H),url:Q(t.url,e.ValueType.fromDescriptor(e.ImageDefinition.urlType))};return t.scaling&&(r.scaling=Q(t.scaling,H)),r}function q(e){return{type:Q(e.type,H),name:Q(e.name,H),content:Q(e.content,H)}}function k(e){return _.map(e,function(e){var t={textRuns:_.map(e.textRuns,function(e){var t={value:Q(e.value,H)||e.value};return e.textStyle&&(t.textStyle=e.textStyle),e.url&&(t.url=e.url),t})};return e.horizontalTextAlignment&&(t.horizontalTextAlignment=e.horizontalTextAlignment),t})}function G(e){return{algorithm:e.algorithm,parameters:_.map(e.parameters,function(e){var t=r.SemanticQuerySerializer.serializeExpr(e.expr);return t.Name=e.name,t})}}function K(e){return{minValue:Q(e.minValue,U),maxValue:Q(e.maxValue,U),positiveColor:B(e.positiveColor,J),negativeColor:B(e.negativeColor,J),axisColor:B(e.axisColor,J),reverseDirection:Q(e.reverseDirection,W),hideText:Q(e.hideText,W)}}function j(e){var t={kind:"Icon"};return e.layout&&(t.layout=Q(e.layout,H)),e.verticalAlignment&&(t.verticalAlignment=Q(e.verticalAlignment,W)),e.value&&(t.value=Q(e.value,H)),t}function L(t){var r=e.ValueType.fromDescriptor(t);return 0!==r.primitiveType?{value:r}:{structural:t}}function O(t,r){if(t.linearGradient2){var i=t.linearGradient2,a={min:{color:r(i.min.color,e.ValueType.fromPrimitiveTypeAndCategory(1))},max:{color:r(i.max.color,e.ValueType.fromPrimitiveTypeAndCategory(1))}};return i.min.value&&(a.min.value=r(i.min.value,e.ValueType.fromPrimitiveTypeAndCategory(3))),i.max.value&&(a.max.value=r(i.max.value,e.ValueType.fromPrimitiveTypeAndCategory(3))),i.nullColoringStrategy&&(a.nullColoringStrategy={strategy:r(i.nullColoringStrategy.strategy,e.ValueType.fromPrimitiveTypeAndCategory(1))},i.nullColoringStrategy.color&&(a.nullColoringStrategy.color=r(i.nullColoringStrategy.color,e.ValueType.fromPrimitiveTypeAndCategory(1)))),{linearGradient2:a}}if(t.linearGradient3){var i=t.linearGradient3,a={min:{color:r(i.min.color,e.ValueType.fromPrimitiveTypeAndCategory(1))},mid:{color:r(i.mid.color,e.ValueType.fromPrimitiveTypeAndCategory(1))},max:{color:r(i.max.color,e.ValueType.fromPrimitiveTypeAndCategory(1))}};return i.min.value&&(a.min.value=r(i.min.value,e.ValueType.fromPrimitiveTypeAndCategory(3))),i.mid.value&&(a.mid.value=r(i.mid.value,e.ValueType.fromPrimitiveTypeAndCategory(3))),i.max.value&&(a.max.value=r(i.max.value,e.ValueType.fromPrimitiveTypeAndCategory(3))),i.nullColoringStrategy&&(a.nullColoringStrategy={strategy:r(i.nullColoringStrategy.strategy,e.ValueType.fromPrimitiveTypeAndCategory(1))},i.nullColoringStrategy.color&&(a.nullColoringStrategy.color=r(i.nullColoringStrategy.color,e.ValueType.fromPrimitiveTypeAndCategory(1)))),{linearGradient3:a}}return null}var W=e.ValueType.fromDescriptor({bool:!0}),U=e.ValueType.fromDescriptor({numeric:!0}),H=e.ValueType.fromDescriptor({text:!0}),J={fill:{solid:{color:!0}}};i.deserializeObjects=a,i.deserializeSelectors=n,i.serializeSelectors=o,i.serializeValueType=s,i.deserializeValueType=u,i.deserializeSelector=l,i.deserializeSelectorsByColumn=p,i.deserializeVisualObjects=d,i.deserializeObjectProperty=m,i.deserializeScopeIdentity=w,i.serializeObjects=b,i.serializeSelector=M,i.serializeSelectorsByColumn=V,i.serializeVisualObjects=R,i.serializeScopeIdentity=P,i.serializeObjectProperty=F}(a=r.DataViewObjectSerializer||(r.DataViewObjectSerializer={}))}(r=t.services||(t.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i,a=e.data.services.ExpansionStateSerializer;!function(i){function n(e){return r.DataViewTransformActionsUpgrade.V1.upgradeDataViewSelectTransform(e),_.map(e,function(e){var t={displayName:e.displayName,format:e.format,kpi:e.kpi,queryName:e.queryName,roles:e.roles,sort:e.sort,sortOrder:e.sortOrder,type:r.DataViewObjectSerializer.deserializeValueType(e.type)};return e.expr&&(t.expr=r.SemanticQuerySerializer.deserializeExpr(e.expr)),e.aggregateSources&&(t.aggregateSources=e.aggregateSources),t})}function o(e){return _.map(e,function(e){var t={displayName:e.displayName,format:e.format,kpi:e.kpi,queryName:e.queryName,roles:e.roles,sort:e.sort,sortOrder:e.sortOrder,type:r.DataViewObjectSerializer.serializeValueType(e.type)};return e.expr&&(t.expr=r.SemanticQuerySerializer.serializeExpr(e.expr)),e.aggregateSources&&(t.aggregateSources=e.aggregateSources),t})}function s(e,t){e=e||{};var n={objects:e.objects,projectionOrdering:e.roles&&e.roles.ordering,projectionActiveItems:e.roles&&e.roles.activeItems,splits:e.splits,queryMetadata:null,visualElements:null};return e&&e.objects&&(n.objects=r.DataViewObjectSerializer.serializeObjects(e.objects,t)),e&&e.selects&&(n.selects=i.serializeDataViewSelectTransforms(e.selects)),e&&!_.isEmpty(e.expansionStates)&&(n.expansionStates=a.serializeExpansionStates(e.expansionStates)),n}function u(e,t){var n=t&&t.objects,o=e.objects?r.DataViewObjectSerializer.deserializeObjects(e.objects,n):null,s=i.createTransformActions(e.queryMetadata,e.visualElements,n,o)||{},u=e&&e.projectionActiveItems;if(_.isEmpty(u)||l(u),s.roles={ordering:e.projectionOrdering,activeItems:u},s.splits=e.splits,e.selects&&(s.selects=i.deserializeDataViewSelectTransforms(e.selects)),e.expansionStates){var c=t&&t.expandCollapse&&t.expandCollapse.supportsMerge,d=t&&t.noDefaultProjections;s.expansionStates=a.deserializeExpansionStates(e.expansionStates,c,d)}return p(s),s}function c(e){return _.isString(e[0])}function l(e){for(var t in e){var r=e[t],i=void 0;if(!_.isEmpty(r)&&c(r)){var a=r;i=_.map(a,function(e){return{queryRef:e}})}e[t]=i||r}}function p(e){var t,r="Y",i="Y2",a=e.roles&&e.roles.ordering;if(a){var n=a[r]&&1===a[r].length&&_.includes(a[i],a[r][0])?a[r][0]:void 0;if(void 0!==n){var o=e.splits&&2===e.splits.length&&!e.splits[0].selects[n]&&e.splits[1].selects[n]?e.splits[0]:void 0;if(o){var s=_.chain(Object.keys(o.selects)).filter(function(e){return o.selects[e]}).map(function(e){return parseInt(e,10)}).maxBy(function(e){return e}).value();if(s!==Number.NEGATIVE_INFINITY){if(e.selects&&e.selects.length===s){var u=e.selects[n];if(u&&u.roles[r]&&u.roles[i]){delete u.roles[r];var c=__assign({},u);c.roles=(t={},t[r]=!0,t),c.queryName=u.queryName,e.selects[s]=c,e.roles.ordering[r]=[s]}}}}}}}function d(e){return JSON.stringify(e)}function f(e,r,i,a){if(e&&!_.isEmpty(e.Select)||!_.isEmpty(r)||a){var n={};if(e){var o=e.Select;if(o)for(var s=n.selects=[],u=0,c=o.length;u<c;u++){var l=o[u];if(l){var p=h(l,u);if(s.push(p),p.format&&i){var d=t.DataViewObjectDescriptors.findFormatString(i);d&&(a||(a={}),t.DataViewObjectDefinitions.setValue(a,d,{metadata:p.queryName},t.SQExprBuilder.text(p.format)))}}else s.push(null)}}if(r){r=_.unionBy(r,function(e){return JSON.stringify(e)});var f=r.length;f>1&&(n.splits=[]);for(var u=0;u<f;u++){var m=r[u];m.Settings&&0===u&&(a=S(m.Settings,a)),m.DataRoles&&(n.selects||(n.selects=[]),n.roles||(n.roles={ordering:{}}),v(m.DataRoles,n.selects,n.roles.ordering)),n.splits&&n.splits.push(g(m.DataRoles))}}return a&&(n.objects=a),n}}function h(t,r){var i={};return t.Restatement&&(i.displayName=t.Restatement),t.Name?i.queryName=t.Name:i.queryName||(i.queryName="$select"+r),t.Format&&(i.format=t.Format),t.Type&&(i.type=m(t.Type,e.data.conceptualDataCategoryToString(t.DataCategory))),t.kpi&&(i.kpi=t.kpi),t.kpiStatusGraphic&&(i.kpi={graphic:t.kpiStatusGraphic}),i}function m(t,r){t=t||0;var i=0;switch(t){case 2048:i=1;break;case 1:i=3;break;case 3:i=4;break;case 4096:i=5;break;case 20:i=6;break;case 4:i=7;break;case 8:i=9;break;case 67:i=4,r="Year";break;case 35:i=4,r="Month"}return e.ValueType.fromPrimitiveTypeAndCategory(i,r)}function v(e,t,r){for(var i=0,a=e.length;i<a;i++){var n=e[i],o=n.Projection,s=n.Name,u=t[o];void 0===u&&(y(t,o),u=t[o]={});var c=u.roles;void 0===u.roles&&(c=u.roles={}),c[s]=!0;var l=r[s];void 0===l&&(l=r[s]=[]),l.push(o)}}function y(e,t){for(var r=e.length;r<t;r++)e[r]={}}function g(e){var t={},r={selects:t};if(e)for(var i=0,a=e.length;i<a;i++){var n=e[i];t[n.Projection]=!0}return r}function S(e,r){if(e){r||(r={});for(var i in e){var a=e[i],n=i,o=a,s="general";switch(i){case"hasScalarCategoryAxis":s="categoryAxis",n="axisType",o=t.SQExprBuilder.text(a?"Scalar":"Categorical");break;case"Totals":n="totals",o=t.SQExprBuilder.boolean(!!a);break;case"textboxSettings":n="paragraphs",a&&a.paragraphs&&(o=a.paragraphs);break;case"VisualType1":n="visualType1",o=t.SQExprBuilder.text(a);break;case"VisualType2":n="visualType2",o=t.SQExprBuilder.text(a);break;case"imageVisualSettings":n="imageUrl",a&&a.imageUrl&&(o=t.SQExprBuilder.text(a.imageUrl));break;default:continue}C(r,s,n,o)}return r}}function C(e,t,r,i){var a=e[t];void 0===a&&(a=e[t]=[]);var n=a[0];void 0===n&&(n=a[0]={properties:{}}),n.properties[r]=i}i.deserializeDataViewSelectTransforms=n,i.serializeDataViewSelectTransforms=o,i.serializeDataViewTransformActions=s,i.deserializeDataViewTransformActions=u,i.serializeTransformActions=d,i.createTransformActions=f,i.upgradeSettingsToObjects=S}(i=r.DataViewTransformActionsSerializer||(r.DataViewTransformActionsSerializer={}))}(r=t.services||(t.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i,a={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};!function(r){function i(e,t){var r={};for(var i in e)r[i]=o(e[i],t||a);return r}function n(e){var t={};for(var r in e)t[r]=s(e[r]);return t}function o(e,r){if(e){var i={properties:{}};e.displayName&&(i.displayName=t.getDisplayName(e.displayName,r)),e.description&&(i.description=t.getDisplayName(e.description,r));for(var a in e.properties)i.properties[a]=u(e.properties[a],r);return i}}function s(e){var r={properties:{}};e.displayName&&(r.displayName=t.createDisplayNameGetter(e.displayName)),e.description&&(r.description=t.createDisplayNameGetter(e.description));for(var i in e.properties)r.properties[i]=c(e.properties[i]);return r}function u(e,r){var i={type:l(e.type,r)};return e.rule&&(i.rule=e.rule),e.displayName&&(i.displayName=t.getDisplayName(e.displayName,r)),e.description&&(i.description=t.getDisplayName(e.description,r)),e.placeHolderText&&(i.placeHolderText=t.getDisplayName(e.placeHolderText,r)),i}function c(e){var r={type:p(e.type)};return e.displayName&&(r.displayName=t.createDisplayNameGetter(e.displayName)),e.description&&(r.description=t.createDisplayNameGetter(e.description)),e.placeHolderText&&(r.placeHolderText=t.createDisplayNameGetter(e.placeHolderText)),e.rule&&(r.rule=e.rule),r}function l(t,r){var i,a=e.ValueType.fromDescriptor(t);return i=a&&a.enum?{enumeration:f(a.enum,r)}:t}function p(t){var r;return r=e.ValueType.fromDescriptor(t)?d(t):t}function d(e){var t;if(e.enumeration){t={enumeration:h(e.enumeration)}}else{t={};for(var r in e)t[r]=e[r]}return t}function f(e,t){return _.map(e.members(),function(e){return m(e,t)})}function h(t){return e.createEnumType(t)}function m(e,r){return{displayName:t.getDisplayName(e.displayName,r),value:e.value}}r.serialize=i,r.deserialize=n,r.serializePropertyDescriptor=u,r.deserializePropertyDescriptor=c}(i=r.DataViewObjectDescriptorSerializer||(r.DataViewObjectDescriptorSerializer={}))}(r=t.services||(t.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e){if(e)for(var t=0,r=e;t<r.length;t++){var i=r[t];i.kpiStatusGraphic&&(i.kpi={graphic:i.kpiStatusGraphic})}}e.upgradeDataViewSelectTransform=t}(t=e.V1||(e.V1={}))}(t=e.DataViewTransformActionsUpgrade||(e.DataViewTransformActionsUpgrade={}))}(t=e.services||(e.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){e.type="tabular"}(t=e.tabular||(e.tabular={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(){return new s}function r(e){var t=[];e=a(e);for(var r in e)if(e.hasOwnProperty(r)){var n=e[r],o=void 0;if(!n)continue;_.isDate(n)||null!=i(n.toString().substr(0,26))?o={dateTime:!0}:isNaN(+n)?_.isString(n)&&(o={text:!0}):o={numeric:!0},o&&t.push({name:r,type:o})}return t}function i(e){var t=null,r=+e;if(isNaN(r))t=jsCommon.DateExtensions.parseIsoDate(e.toString());else{var i=new Date;i.setDate(i.getDate()-o);var a=i.getTime();i=new Date,i.setDate(i.getDate()+o);var n=i.getTime();r<a&&(r*=1e3),r>a&&r<n&&(t=new Date(r))}return t}function a(e){try{return n(e)}catch(e){}return e}function n(e,t,r){return t||(t={}),_.isObject(e)?_.forOwn(e,function(e,i){n(e,t,r?r+"."+i:i)}):t[r]=e,t}e.createTabularDataCache=t,e.getColumnsMetadata=r,e.parseDate=i,e.flattenJSON=a,e.MaxRealTimeDataWindowInMs=36e5;var o=7,s=function(){function t(){this.clear()}return t.prototype.add=function(e){var t=this.getKey(e.modelId,e.name);return this.tabularDataMap[t]=e,t},t.prototype.get=function(e){return this.tabularDataMap[e]},t.prototype.remove=function(e){delete this.tabularDataMap[e]},t.prototype.clear=function(){this.tabularDataMap={}},t.prototype.getKey=function(e,t){return e+"_"+t},t.prototype.mergeRows=function(e,t,r,i){var a=this.getKey(e,t),n=this.get(a);if(!n||!n.rowGroups){var o={modelId:e,name:t,rowGroups:r,lastVersion:i,columns:n&&n.columns};return this.constructColumnsMetadataIfNeeded(o),this.fixUpValues(o.rowGroups,o.columns),void this.add(o)}var s=[],u=n.rowGroups||[],c=r||[];for(this.fixUpValues(c,n.columns);;){if(_.isEmpty(u)&&_.isEmpty(c))break;var l=_.head(u),p=_.head(c);l&&!p?(this.appendRow(s,l,i),u.shift()):!l&&p?(this.appendRow(s,p,i),c.shift()):l.version<p.version?(this.appendRow(s,l,i),u.shift()):p&&(c.shift(),l.version===p.version&&u.shift(),this.appendRow(s,p,i));
}n.rowGroups=s,n.lastVersion=i},t.prototype.constructColumnsMetadataIfNeeded=function(e){if(!e.columns){var t=_.last(e.rowGroups);if(t){var i=_.last(t.rows);i&&(e.columns=r(i))}}},t.prototype.fixUpValues=function(e,t){if(!_.isEmpty(e)){for(var r={},n={},o=0,s=t;o<s.length;o++){var u=s[o];r[u.name]=u.type&&u.type.dateTime,n[u.name]=u.type&&u.type.numeric}for(var c=0,l=e;c<l.length;c++){var p=l[c];if(p.rows)for(var d=0;d<p.rows.length;d++){var f=p.rows[d]=a(p.rows[d]);for(var h in f)if(f.hasOwnProperty(h)){var m=f[h];if(m)if(r[h]){var v=i(m);v&&(f[h]=v)}else if(n[h]){var y=parseFloat(m.toString());isNaN(y)||(f[h]=y)}}}}}},t.prototype.appendRow=function(t,r,i){i-r.version>e.MaxRealTimeDataWindowInMs||t.push(r)},t}()}(t=e.tabular||(e.tabular={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(){return new i(e.services.SemanticQuerySerializer)}t.createQueryGenerator=r;var i=function(){function t(e){this.serializer=e}return t.prototype.execute=function(t){var r=t.query,i={Query:this.serializer.serializeQuery(r),Binding:null},a={SemanticQueryDataShapeCommand:i},n=e.SQExprUtils.getActiveTablesNames(r),o=n[0];return{command:{dataWindow:t.dataWindow,tableName:o,mappings:t.mappings,Commands:[a]}}},t.prototype.produceIdentities=function(e,t){return[e]},t}()}(t=e.tabular||(e.tabular={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(e){var t=_.indexOf(e,".");return t<0||t>=e.length-1?e:e.substr(t+1)}var a=e.data.createDataViewScopeIdentity,n="UndefinedData";r.normalizedName=i;var o=function(){function r(e,t){this.promiseFactory=e.promiseFactory(),this.tabularDataCache=t,this.columnToIndexMap={}}return r.prototype.execute=function(t){var r=_.head(t.dataSources),i=t.command,a=this.buildDataView(i,r.modelId),n=this.promiseFactory.defer();return n.resolve(a),e.createRejectablePromise(n)},r.prototype.transform=function(e,t,r){return null==e?{dataView:{metadata:{columns:[]},error:{code:n}}}:{dataView:e}},r.prototype.buildDataView=function(e,t){var a=this,n=e.mappings[0],o=this.tabularDataCache,s=o.get(o.getKey(t,e.tableName)),u=r.getLastVersion(s)-e.dataWindow;if(s.rowGroups){var c=e&&_.head(e.Commands);if(c){var l=c.SemanticQueryDataShapeCommand;l&&l.Query&&l.Query.Select&&l.Query.Select.map(function(e,t){a.columnToIndexMap[i(e.Name)]=t})}var p=this.filterTabularDataRowGroups(s.rowGroups,u),d=this.createDataView({rowGroups:p,columns:s.columns,modelId:s.modelId,name:s.name},n);return e.dataWindow&&(d.metadata.objects={categoryAxis:{duration:e.dataWindow}}),d}},r.prototype.filterTabularDataRowGroups=function(e,t){return _.filter(e,function(e){return e.version>=t})},r.prototype.createDataView=function(e,t){var r={metadata:{columns:[]}},i=this.extractColumns(t),a=[];if(t.categorical){var n=this.getCategoricalDataViewInfo(i.categorical,e);r.categorical=n.dataView,_.isEmpty(r.categorical.values)&&(r.categorical.values=void 0),a.push.apply(a,n.columns)}if(t.table){var o=this.getSingleDataViewInfo(i.table,e);r.single=o.dataView;var s=o.columns[0];null==_.find(a,s)&&a.push(s)}return r.metadata.columns=a,r},r.prototype.getCategoricalDataViewInfo=function(e,r){var i=t.createCategoricalDataViewBuilder();if(!_.isEmpty(e.categories)){var a=this.getCategoryColumnOption(e.categories,r);i.withCategory(a)}var n=this.getValueColumnOptions(e.categories,e.values,r);_.isEmpty(e.groupedValues)||e.groupedValues===e.categories?i.withValues({columns:n}):this.addGroupValues(e,r,i,n);var o=i.build();return{dataView:o.categorical,columns:o.metadata.columns}},r.prototype.addGroupValues=function(e,t,a,n){for(var o=i(e.groupedValues),s=this.getCategoryColumnOption(o,t),u=this.extractColumnValues(o,t),c=r.getUniqueValues(u),l=this.getValueToIndicesMap(u),p={},d=e.values,f=0,h=d;f<h.length;f++)for(var m=h[f],v=i(m),y=this.extractColumnValues(v,t),g=0,S=c;g<S.length;g++){var C=S[g],x=r.valueToString(C);null==p[x]&&(p[x]=[]);var D=l[x],E=_.at(y,D);p[x].push({values:E})}var w=_.values(p);if(!_.isEmpty(w)){var b={groupColumn:s,valueColumns:n,data:w};a.withGroupedValues(b)}},r.prototype.getValueToIndicesMap=function(e){for(var t={},i=0,a=e.length;i<a;i++){var n=r.valueToString(e[i]),o=t[n];o?o.push(i):t[n]=[i]}return t},r.prototype.getSingleDataViewInfo=function(e,t){var r=this.getColumnMetadataAndValues(e,t),i=r.values.length-1;return{dataView:{value:r.values[i],column:r.metadataColumn},columns:[r.metadataColumn]}},r.prototype.extractColumns=function(e){var r=function(e,t){var r=e.items;if(r)for(var i=0,a=r;i<a.length;i++){var n=a[i];t.push(n.queryName)}},i={},a=e.categorical;if(a){var n=[];t.CompiledDataViewMapping.visitCategoricalCategories(a.categories,{visitRole:function(e){r(e,n)}});var o=[];t.CompiledDataViewMapping.visitCategoricalValues(a.values,{visitRole:function(e){r(e,o)}});var s=[];t.CompiledDataViewMapping.visitGrouped(a.values,{visitRole:function(e){r(e,s)}}),i.categorical={categories:n[0],groupedValues:s[0],values:o}}var u=e.table;if(u){var c=[];t.CompiledDataViewMapping.visitTable(u,{visitRole:function(e){r(e,c)}}),i.table=c[0]}return i},r.prototype.getCategoryColumnOption=function(e,i){var n=this.getColumnMetadataAndValues(e,i),o=r.getUniqueValues(n.values),s=t.SQExprBuilder.columnRef(t.SQExprBuilder.entity(null,i.name),e),u=_.map(o,function(e){return a(t.SQExprBuilder.equal(s,t.SQExprBuilder.text(e.toString())))});return{source:n.metadataColumn,values:o,identityFrom:{fields:[s],identities:u}}},r.prototype.getValueColumnOptions=function(e,t,r){for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a],s=this.getColumnMetadataAndValues(o,r,e),u=s.values;e||_.isEmpty(u)||(u=[_.last(u)]);var c={source:s.metadataColumn,values:u,minLocal:_.min(u),maxLocal:_.max(u)};i.push(c)}return i},r.prototype.getColumnMetadataAndValues=function(t,a,n){var o,s=a.columns,u=i(t),c=this.columnToIndexMap[u];if(n){var l=i(n);o=this.extractUniqueColumnValues(u,a,l)}else o=this.extractColumnValues(u,a);var p=_.find(s,function(e){return e.name===u});return{metadataColumn:r.createMetadataColumn(u,c,e.ValueType.fromDescriptor(p.type)),values:o}},r.prototype.extractColumnValues=function(e,t){for(var r=t.rowGroups,i=[],a=0,n=r;a<n.length;a++)for(var o=n[a],s=0,u=o.rows;s<u.length;s++){var c=u[s];i.push(c[e])}return i},r.prototype.extractUniqueColumnValues=function(e,t,i){for(var a=t.rowGroups,n={},o=0,s=a;o<s.length;o++)for(var u=s[o],c=0,l=u.rows;c<l.length;c++){var p=l[c],d=p[i],f=r.valueToString(d);n[f]=p[e]}return _.values(n)},r.getLastVersion=function(e){if(_.isEmpty(e.rowGroups))return e.lastVersion?e.lastVersion:Number.NEGATIVE_INFINITY;var t=Number.NEGATIVE_INFINITY;if(!e.rowGroups)return t;for(var r=0,i=e.rowGroups;r<i.length;r++){var a=i[r];a.version>t&&(t=a.version)}return t},r.createMetadataColumn=function(e,t,r){var i={displayName:e,queryName:e,index:t,isMeasure:!1};return null!=r&&(i.type=r,i.isMeasure=!!r.numeric),i},r.getUniqueValues=function(e){return _.uniqBy(e,function(e){return r.valueToString(e)})},r.valueToString=function(e){return _.isDate(e)?e.getTime().toString():e?e.toString():""},r}();r.TabularDataReader=o}(r=t.tabular||(t.tabular={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){e.right="right",e.left="left",e.center="center"}(t=e.alignment||(e.alignment={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){e.DataSourcesUndefined="DataSourcesUndefined",e.SchemaReaderUndefined="SchemaReaderUndefined"}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e){return e.Commands[0].SemanticQueryDataShapeCommand}function r(t,r,i,a,n,o,s,u,c,l){var p=_.map(t,function(e,t){var r={Query:e,CacheKey:n?JSON.stringify(e):void 0,CacheOptions:a?a:void 0,QueryId:s&&s[t]};return l&&l[t]&&(r.ApplicationContext=l[t]),_.isEmpty(c)||null==c[t]||(r.RequestPriority=c[t]),r}),d=_.map(u,function(e){return{QueryId:e}}),f=e.single(r),h={version:e.executeSemanticQueryRequestVersion1,queries:p,cancelQueries:d,modelId:f.modelId,userPreferredLocale:i.getUserPreferredLocale()};if(o&&o.impersonating){var m=o.getImpersonationState();m.modelId===h.modelId&&_.extend(h,m)}return h}e.transformDataQueryToSemanticQueryDataShapeCommand=t,e.generateSemanticQueryRequest=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){function r(e,t){var r=e.table;if(!r)return"";var n=r.columns,o="";o+=i(n)+"\r\n",(null==t||t>r.rows.length)&&(t=r.rows.length);for(var s=0;s<t;s++){for(var u=r.rows[s],l=[],p=0,d=u.length;p<d;p++){var f=n[p],h=f&&f.type,m=f&&f.format;l.push(a(u[p],h,m))}l.length>0&&(o+=l.join(c)+"\r\n")}return o}function i(e){for(var t=[],r=0,i=e;r<i.length;r++){var a=i[r];t.push(o(a.displayName))}return t.join(c)}function a(t,r,i){if(null==t)return"";r||(r=n(t));var a="";return a=r.dateTime?e.formattingService.formatValue(t,l):r.bool||r.numeric&&!i?t.toString():r.numeric?e.formattingService.formatValue(t,s(i)):t.toString(),o(a)}function n(t){return _.isDate(t)?e.ValueType.fromPrimitiveTypeAndCategory(6):_.isBoolean(t)?e.ValueType.fromPrimitiveTypeAndCategory(5):_.isNumber(t)?e.ValueType.fromPrimitiveTypeAndCategory(3):e.ValueType.fromPrimitiveTypeAndCategory(1)}function o(e){return null==e?"":(e=e.replace(/\"/g,'""'),_.includes(e,"\n")||_.includes(e,u)||_.includes(e,c)||_.includes(e,"\r")||0===e.length?u+e+u:e)}function s(e){return e.replace(/(\r\n|\n|\r|,)/g,"")}var u='"',c=",",l="yyyy-MM-dd HH:mm:ss";t.fromDataView=r}(r=t.CsvWriter||(t.CsvWriter={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){var i,a=jsCommon.ArrayExtensions,n=t.ConceptualSchema,o=jsCommon.StringExtensions,s=jsCommon.Utility;!function(r){function i(e){return{kpiGoalFmt:e.get("KpiGoalDisplayName"),kpiStatusFmt:e.get("KpiStatusDisplayName"),kpiTrendFmt:e.get("KpiTrendDisplayName")}}function u(e,t,r){var i=new n;i.name=t,i.entities=a.createWithName(),e.canEdit&&(e.Capabilities||(e.Capabilities={}),e.Capabilities.CanEdit=e.canEdit),i.capabilities=V(e.Capabilities);for(var o=0,s=e.Entities;o<s.length;o++){var u=s[o];i.entities.push(c(u,i.capabilities,r))}for(var l=0,p=e.Entities.length;l<p;++l)w(i.entities[l],e.Entities[l],i.entities);return i}function c(e,t,r){for(var i=e.Capabilities,n=e.Source,o={name:e.Name,displayName:e.DisplayName||e.Name,description:e.Description,visibility:E(e.Hidden,e.ShowAsVariationsOnly,e.Private),calculated:e.Calculated,queryable:e.Queryable,properties:a.createWithName(),hierarchies:a.createWithName(),displayFolders:a.createWithName(),navigationProperties:a.createWithName(),errorMessage:e.ErrorMessage,isDateTable:e.IsDateTable===!0,source:{mode:n&&n.Mode,refreshedTime:n&&n.RefreshedTime,directQuerySourceType:n&&n.DirectQuerySourceType,directQuerySourceName:n&&n.DirectQuerySourceName},capabilities:{canRefresh:!i||i.CanRefresh!==!1,canEditSource:t.canEdit&&(!i||i.CanEditSource!==!1),canRename:t.canEdit&&(!i||i.CanRename!==!1),canDelete:t.canEdit&&(!i||i.CanDelete!==!1),canEditStorageMode:t.canEdit&&(!i||i.CanEditStorageMode!==!1),supportsClustering:t.canEdit&&(!i||i.SupportsClustering!==!1),supportsBinByCount:t.canEdit&&(!i||i.SupportsBinByCount!==!1),limitOnNumberOfGroups:i&&i.LimitOnNumberOfGroups||null,dataView:i&&i.DataView||null}},s=0,u=e.Properties;s<u.length;s++){var c=u[s];o.properties.push(v(c))}for(var d=0,y=e.Properties.length;d<y;++d){var g=o.properties[d],S=e.Properties[d];g.canDelete=t.canEdit&&S.CanDelete!==!1;var C=S.Column;if(C){var x=g.column=g.column||{};C.Keys&&(x.keys=f(C.Keys,o.properties)),C.OrderBy&&(x.orderBy=f(C.OrderBy,o.properties))}var D=S.Measure;if(D){var w=g.measure=g.measure||{};if(w.canEdit=D.canEdit!==!1,D.Kpi){var b=w.kpi=h(D.Kpi,o.properties,t);m(b.goal,g,1,r),m(b.status,g,0,r),m(b.trend,g,3,r)}D.Template&&(w.template={name:D.Template.DaxTemplateName}),D.ChangeDetectionMetadata&&(w.changeDetectionMetadata={refreshInterval:D.ChangeDetectionMetadata.RefreshInterval}),null!=D.DistributiveAggregate&&(w.distributiveAggregate=D.DistributiveAggregate)}}if(e.Hierarchies)for(var I=0,M=e.Hierarchies;I<M.length;I++){var V=M[I];o.hierarchies.push(p(V,o.properties))}if(e.DisplayFolders)for(var R=0,T=e.DisplayFolders;R<T.length;R++){var P=T[R];o.displayFolders.push(l(P,o.properties,o.hierarchies))}return e.DefaultLabelColumnRef&&(o.defaultLabel=o.properties.withName(e.DefaultLabelColumnRef)),e.DefaultFieldPropertyRefs&&(o.defaultFields=_.map(e.DefaultFieldPropertyRefs,function(e){return o.properties.withName(e)})),o}function l(e,t,r){var i={name:e.Name,displayName:e.DisplayName||e.Name,description:e.Description,properties:a.createWithName(),hierarchies:a.createWithName(),displayFolders:a.createWithName()};if(e.DisplayItems)for(var n=0,o=e.DisplayItems;n<o.length;n++){var s=o[n];s.PropertyRef&&t?i.properties.push(t.withName(s.PropertyRef)):s.HierarchyRef&&r?i.hierarchies.push(r.withName(s.HierarchyRef)):s.DisplayFolder&&i.displayFolders.push(l(s.DisplayFolder,t,r))}return i}function p(e,t){for(var r={name:e.Name,displayName:e.DisplayName||e.Name,description:e.Description,hidden:e.Hidden,levels:a.createWithName(),canDelete:e.CanDelete!==!1},i=0,n=e.Levels;i<n.length;i++){var o=n[i];r.levels.push(d(o,t))}return r}function d(e,t){return{name:e.Name,displayName:e.DisplayName||e.Name,description:e.Description,column:t.withName(e.Column),canDelete:e.CanDelete!==!1}}function f(e,t){for(var r=a.createWithName(),i=0,n=e;i<n.length;i++){var o=n[i];r.push(t.withName(o))}return r}function h(e,t,r){var i=r.normalizedFiveStateKpiRange,a={statusMetadata:{graphic:e.StatusGraphic,normalizedFiveStateKpiRange:i},status:t.withName(e.Status),goal:t.withName(e.Goal),trend:t.withName(e.Trend)};return e.TrendGraphic&&(a.trendMetadata={graphic:e.TrendGraphic,normalizedFiveStateKpiRange:i}),a}function m(e,t,r,i){if(e){var a=t.displayName;switch(r){case 1:a=o.format(i.kpiGoalFmt,a);break;case 0:a=o.format(i.kpiStatusFmt,a);break;case 3:a=o.format(i.kpiTrendFmt,a)}e.displayName=a,e.hidden=!1,e.kpiValue=t}}function v(t){return{displayName:t.DisplayName||t.Name,description:t.Description,name:t.Name,type:e.ValueType.fromPrimitiveTypeAndCategory(t.DataType,t.DataCategory),column:t.Column?y(t.Column):null,kind:D(t),format:t.FormatString,hidden:t.Hidden,queryable:t.Queryable,errorMessage:t.ErrorMessage}}function y(e){var r={defaultAggregate:e.DefaultAggregate,idOnEntityKey:e.IdOnEntityKey,calculated:e.Calculated,variations:a.createWithName(),aggregateBehavior:e.AggregateBehavior};return void 0!==e.DefaultValue&&(r.defaultValue=t.PrimitiveValueEncoding.parseValueToSQExpr(e.DefaultValue)),r}function g(e,t){return{}}function S(e,t){var r={groupedColumns:_.map(e.GroupedColumns,function(e){return e.ColumnRef&&!e.LevelRef?t.properties.withName(e.ColumnRef):e.LevelRef&&!e.ColumnRef?t.hierarchies.withName(e.LevelRef.Hierarchy).levels.withName(e.LevelRef.Level):void 0})};return e.BinningMetadata&&(r.binningMetadata=C(e.BinningMetadata)),r}function C(e){var t={};return e.BinSize&&(t.binSize=x(e.BinSize)),t}function x(e){return{value:e.Value,unit:e.Unit}}function D(e){return e.Measure?1:0}function E(e,t,r){var i=0;return e&&(i=1|i),t&&(i=2|i),r&&(i=4|i),i}function w(e,t,r){if(t.NavigationProperties)for(var i=0,a=t.NavigationProperties;i<a.length;i++){var n=a[i];e.navigationProperties.push(b(n,e,r))}if(t.Properties)for(var o=0,s=t.Properties.length;o<s;++o){var u=t.Properties[o],c=u.Column;c&&c.Variations&&I(e.properties[o].column,c,e),c&&c.GroupingMetadata&&(e.properties[o].column.groupingMetadata=S(c.GroupingMetadata,e)),c&&c.ParameterMetadata&&(e.properties[o].column.parameterMetadata=g(c.ParameterMetadata,e));var l=u.Measure;l&&!_.isEmpty(l.DistributiveBy)&&(e.properties[o].measure.distributiveBy=_.map(l.DistributiveBy,function(e){return r.withName(e)}))}}function b(e,t,r){var i={name:e.Name,isActive:e.Active,sourceColumn:null,targetEntity:r.withName(e.TargetEntity),sourceMultiplicity:e.SourceMultiplicity,targetMultiplicity:e.TargetMultiplicity,behavior:e.Behavior||0,crossFilterDirection:s.valueOrDefault(e.CrossFilterDirection,0)};if(e.SourceColumn){var a=t.properties.withName(e.SourceColumn);a&&(i.sourceColumn=a.column)}return i}function I(e,t,r){for(var i=0,a=t.Variations;i<a.length;i++){var n=a[i];e.variations.push(M(n,r))}}function M(e,t){var r={name:e.Name,isDefault:e.Default,navigationProperty:null,defaultHierarchy:null,defaultProperty:null},i=t;return e.NavigationProperty&&(r.navigationProperty=t.navigationProperties.withName(e.NavigationProperty),i=r.navigationProperty.targetEntity),e.DefaultHierarchy&&(r.defaultHierarchy=i.hierarchies.withName(e.DefaultHierarchy)),e.DefaultProperty&&(r.defaultProperty=i.properties.withName(e.DefaultProperty)),r}function V(e){return{canEdit:e&&e.CanEdit||!1,discourageQueryAggregateUsage:e&&e.DiscourageQueryAggregateUsage||!1,isExtendable:e&&e.IsExtendable||!1,normalizedFiveStateKpiRange:e&&e.NormalizedFiveStateKpiRange||!1,supportsMedian:e&&e.SupportsMedian||!1,supportsPercentile:e&&e.SupportsPercentile||!1,supportsScopedEval:e&&e.SupportsScopedEval||!1,supportsStringMinMax:e&&e.SupportsStringMinMax||!1,supportsMultiTableTupleFilters:e&&e.SupportsMultiTableTupleFilters||!1,supportsTimeIntelligenceQuickMeasures:e&&e.SupportsTimeIntelligenceQuickMeasures||!1,supportsCalculatedColumns:e&&e.SupportsCalculatedColumns!==!1||!1,supportsGrouping:e&&e.SupportsGrouping!==!1||!1,limitMultiColumnFiltersToQueryGroupColumns:e&&e.LimitMultiColumnFiltersToQueryGroupColumns||!1,supportsBinnedLineSample:e&&e.SupportsBinnedLineSample||!1,supportsOverlappingPointsSample:e&&e.SupportsOverlappingPointsSample||!1,supportsQna:e&&e.SupportsQna||!1,supportsInstanceFilters:e&&e.SupportsInstanceFilters||!1,supportsDataSourceVariables:e&&e.SupportsDataSourceVariables||!1,insights:e?R(e.Insights):{},supportsFastRefresh:e&&e.SupportsFastRefresh||!1,supportsSubqueryRegrouping:e&&e.SupportsSubqueryRegrouping||!1,supportsTopNPerLevel:e&&e.SupportsTopNPerLevel||!1,supportsExtensionColumns:e&&e.SupportsExtensionColumns||!1}}function R(e){return e?{supportsDistributionFactors:e.SupportsDistributionFactors||!1,supportsExplainChange:e.SupportsExplainChange||!1,supportsExplore:e.SupportsExplore||!1,supportsKeyDrivers:e.SupportsKeyDrivers||!1,supportsRelatedInsights:e.SupportsRelatedInsights||!1,supportsDecomposition:e.SupportsDecomposition||!1}:{}}r.createLocOptions=i,r.convertSchema=u,r.convertEntity=c,r.convertDisplayFolder=l,r.convertHierarchy=p,r.convertHierarchyLevel=d,r.convertProperty=v,r.convertColumn=y,r.convertVisibility=E,r.convertCapabilities=V,r.convertInsightsCapabilities=R}(i=r.ConceptualSchemaFactory||(r.ConceptualSchemaFactory={}))}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(e,t,r,i,a,n){return new p(e,t,r,i,a,n)}function a(e,t,r,i){return new l(e,t,r,i)}var n,o=e.telemetry.DataGetConceptualSchemaEventName,s=e.fillTelemetryEvent,u=jsCommon.HttpUtils,c=e.MonitorWith;!function(e){var t=function(){function e(){}return e}();e.InsightsCapabilities=t}(n=r.wireContracts||(r.wireContracts={})),r.createConceptualSchemaReader=i,r.createConceptualSchemaProxyHttpCommunication=a;var l=function(){function e(e,t,r,i){this.httpService=e,this.promiseFactory=t,this.uri=r,this.featureSwitches=i}return e.prototype.execute=function(e,t){var r=this,i=this.featureSwitches&&this.featureSwitches().telemetryV2,a=this.promiseFactory.defer(i);return t.event.info.endPoint=this.uri,this.httpService.post(this.uri,e,this.httpService.powerbiRequestOptions(t.event,"GetConceptualSchema")).then(function(e){r.setTelemetryEventInfo(t.event,e),a.resolve({requestId:e.responseRequestId||e.requestId,schemas:e.data.schemas})},function(e){var i=e||{};r.setTelemetryEventInfo(t.event,i),a.reject({requestId:i.responseRequestId||i.requestId,error:i.error,status:i.status,schemas:void 0})}),a.promise},e.prototype.setTelemetryEventInfo=function(e,t){e.info.clientAndServerRequestIdMatch=u.clientAndServerRequestIdMatch(t),e.info.responseRequestId=u.getResponseRequestId(t),e.info.requestId=t.requestId},e}(),p=function(){function i(e,t,r,i,a,n){this.promiseFactory=e,this.telemetryService=t,this.localeProvider=r,this.conceptualSchemaProxyCommunication=i,this.locOptions=a,this.featureSwitches=n}return i.prototype.execute=function(t){var r=this,i=t.dataSources,a=this.featureSwitches&&this.featureSwitches().telemetryV2;if(!i||i.length>1)return this.promiseFactory.reject({},a);var n=this.promiseFactory.defer(a),u=_.map(i,function(e){return e.name}),c={modelIds:_.map(i,function(e){return e.id}),userPreferredLocale:this.localeProvider.getUserPreferredLocale()},l=JSON.stringify(c.modelIds);a&&s(o,{datasetIds:l});var p=this.telemetryService.startEvent(e.telemetry.DataGetConceptualSchema,"",!0,null,null,l,null);return this.conceptualSchemaProxyCommunication.execute(c,p).then(function(e){return r.onSuccess(e,u,n,p)},function(e){return r.onError(e,n,p)}),n.promise},i.prototype.transform=function(e){var i=e;if(!i.data)return{schema:null,error:i.error};for(var a=i.data,n=a.schemas,o=i.schemaNames,s={},u=0,c=n.length;u<c;u++){var l=o[u];s[l]=r.ConceptualSchemaFactory.convertSchema(n[u].schema,l,this.locOptions)}return{schema:new t.FederatedConceptualSchema({schemas:s})}},i.prototype.onSuccess=function(t,r,i,a){if(_.isEmpty(t.schemas))return void this.onError(t,i,a);for(var n=0,o=t.schemas;n<o.length;n++){var s=o[n],u=s.error;if(u){i.reject({data:null,error:{requestId:t.requestId,serviceError:u,clientError:null,ignorable:!0}});var c=e.errorDetailsHelper.getTelemetryErrorDetailsFromServiceError(u);return c.asErrorCode=u.parameters&&u.parameters.ASErrorCode,void a.reject(c)}}i.resolve({data:t,schemaNames:r,error:null}),a.resolve()},i.prototype.onError=function(t,r,i){var a=t.error;r.reject({data:null,error:{requestId:t.requestId,clientError:new e.PowerBIAPIErrorToClientError(t.error)}}),i.reject(e.errorDetailsHelper.getTelemetryErrorDetails(a,t.status))},__decorate([c(o)],i.prototype,"execute",null),i}()}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){e.queryGenerator={execute:function(e){return{command:{query:e.query,mappings:e.mappings}}},produceIdentities:function(e,t){return[e]}}}(t=e.fake||(e.fake={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(r){var i;!function(i){function a(e,t,r,i){if(t)return t.categorical?n(e,t.categorical,r,i):void 0}function n(e,t,i,a){var n,s=e.select(),u=r.createCategoricalDataViewBuilder();r.CompiledDataViewMapping.visitCategoricalCategories(t.categories,{visitRole:function(e){if(!_.isEmpty(e.items))for(var t=0,r=e.items;t<r.length;t++){var c=r[t],l=s.withName(c.queryName),p=l.expr,d=i.generate(p,a.rowCount);u.withCategory({source:o(l,_.indexOf(s,l)),values:d,identityFrom:{fields:[p]}}),n=!0}}});var c=[];return r.CompiledDataViewMapping.visitCategoricalValues(t.values,{visitRole:function(e){if(!_.isEmpty(e.items))for(var t=0,r=e.items;t<r.length;t++){var u=r[t],l=s.withName(u.queryName);c.push({source:o(l,_.indexOf(s,l)),values:i.generate(l.expr,n?a.rowCount:1)})}}}),_.isEmpty(c)||u.withValues({columns:c}),u.build()}function o(e,t){return{displayName:"",queryName:e.name,index:t,type:{}}}var s=t.SQExpr,u=t.SQExprUtils,c=function(){function t(e,t){this.promiseFactory=e.promiseFactory(),this.schemaProvider=t}return t.prototype.execute=function(t){var r=this.promiseFactory.defer();return this.schemaProvider.get().then(function(e){var i=t.command;i.schema=e,r.resolve(i)},function(){r.reject()}),e.createRejectablePromise2(r)},t.prototype.transform=function(e){var t=e.schema,r=e.query,i=e.mappings,n={rowCount:10},o=a(r,_.head(i),new l(t),n);if(o)return{dataView:o}},t}();i.FakeDataReader=c;var l=function(){function e(e){this.schema=e}return e.prototype.generate=function(e,t){if(s.isConstant(e)){for(var r=[],i=0;i<t;i++)r.push(e.value);return r}var a=e.getMetadata(this.schema);if(a){if(a.aggregate)return _.range(10,11*t,10);var n=a.type;if(n){if(n.integer||n.numeric)return _.range(1,1+t);if(n.text){var o=u.defaultName(e,"value ")+" ";return _.range(1,1+t).map(function(e){return o+e})}}}return _.range(1,1+t)},e}()}(i=r.fake||(r.fake={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t="noQueryName",r=function(){function e(e,t){this.measures=t?t:[],this.dataMap=e?e:null}return e.prototype.withCategory=function(e,r){var i,a;return e&&e.source&&e.identity&&e.identity[r]&&(i=e.identity[r],a=e.source.queryName||t),this.addItemToDataMap(a,i),this},e.prototype.withSeries=function(e,r){var i,a;return e&&e.source&&r&&(i=r.identity,a=e.source.queryName||t),this.addItemToDataMap(a,i),this},e.prototype.withMeasure=function(e){return this.measures.push(e),this},e.prototype.withMatrixNode=function(e,r){var i,a;return e&&e.identity&&r&&r[e.level]&&r[e.level].sources&&r[e.level].sources[0]&&(i=e.identity,a=r[e.level].sources[0].queryName||t),this.addItemToDataMap(a,i),this},e.prototype.withTable=function(e,r){var i,a;return e&&e.identity&&null!==r&&void 0!==r&&(i=e.identity[r],a=i?JSON.stringify(i):t),this.addItemToDataMap(a,i),this},e.prototype.equals=function(e){var t=e;return!!(this.compareMeasures(this.measures,t.measures)&&this.compareMetadata(this.getSelector(),t.getSelector())&&this.compareMetadata(t.getSelector(),this.getSelector()))},e.prototype.createSelectionId=function(e){return this.key=JSON.stringify(this.dataMap)+JSON.stringify(this.measures),this},e.prototype.getKey=function(){return this.key},e.prototype.includes=function(e,t){void 0===t&&(t=!1);var r=e;return!(this.dataMap||!this.compareMeasures(this.measures,r.measures))||!!(this.dataMap&&r.dataMap&&this.compareMetadata(this.getSelector(),r.getSelector()))},e.prototype.hasIdentity=function(){return!!this.dataMap},e.prototype.compareMeasures=function(e,t){if(e.length!==t.length)return!1;for(var r=0,i=t;r<i.length;r++){var a=i[r];if(e.indexOf(a)===-1)return!1}return!0},e.prototype.compareMetadata=function(e,t){if(!e.data&&t.data||e.data&&!t.data)return!1;if(!e.data&&!t.data)return!0;for(var r=function(e){if(!t.data.some(function(t){return JSON.stringify(t)===JSON.stringify(e)}))return{value:!1}},i=0,a=e.data;i<a.length;i++){var n=a[i],o=r(n);if("object"==typeof o)return o.value}return!0},e.prototype.addItemToDataMap=function(e,t){if(t){this.dataMap||(this.dataMap={});var r=this.dataMap,i=r[e];return null==i?void(r[e]=[t]):void i.push(t)}},e.prototype.getSelector=function(){var e={data:void 0,metadata:_.head(this.measures)};if(this.dataMap){e.data=[];for(var t in this.dataMap)e.data.push(this.dataMap[t][0])}return e},e.prototype.getSelectorsByColumn=function(){return null},e}();e.CustomVisualSelectionId=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e){switch(e){case"Binary":return 11;case"Boolean":return 5;case"Currency":return 2;case"Number":return 3;case"Date":return 6;case"DateTime":return 7;case"Time":return 9;case"WholeNumber":return 4;case"Text":return 1}}e.primitiveTypeFromDataType=t}(t=e.contracts||(e.contracts={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(t,i){var a=r(i.reader.communication)?e.createExecuteSemanticQueryProxyHttpCommunication(i.reader.communication.httpService,i.telemetryService,i.localeProvider,i.promiseFactory,i.reader.communication.uri,i.reader.communication.impersinationStateProvider,i.reader.featureSwitches,i.reader.directToMwcConnectionInfoService):i.reader.communication,n=r(i.schemaReader.communication)?e.createConceptualSchemaProxyHttpCommunication(i.schemaReader.communication.httpService,i.promiseFactory,i.schemaReader.communication.uri,i.reader.featureSwitches):i.schemaReader.communication,o="dsr";t[o]={name:o,reader:function(t){return new e.DsrDataReader(t,a,i.telemetryService,i.reader.featureSwitches(),i.reader.timeoutService,i.reader.delayedQueryResultResolver,i.reader.preferredMaxConnections)},queryGenerator:function(){return e.createQueryGenerator(i.reader.featureSwitches())},schemaReader:function(){return e.createConceptualSchemaReader(i.promiseFactory,i.telemetryService,i.localeProvider,n,i.schemaReader.localizationOptions,i.reader.featureSwitches)},queryExtensionProvider:e.createQueryExtensionProvider()}}function r(e){return _.isPlainObject(e)}e.registerDsrPlugin=t}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){function t(e){for(var t=new Array(e.calcCount()),r=0;e.nextCalc();r++)t[r]={Id:e.calcId(),Value:e.calcValue()};return t}function r(e){for(var t=e.limits(),r=t.count(),i=new Array(r),a=0;a<r;a++)t.next(),i[a]={Id:t.id()};return i}e.toDsrV1Calc=t,e.toDsrV1Limit=r}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function i(){return a}function a(e){return function(e,t,r){var i={query:e,extensions:void 0,queryRewrites:t},a=new c(t,r);return i.query=e.rewrite(a),i.extensions=a.extensionSchema,i.queryRewrites=a.queryRewrites,i}}var n=e.data.SQExprRewriter,o=jsCommon.StringExtensions;r.createQueryExtensionProvider=i,r.nativeMeasureFlexibleEntityName="NativeMeasures_778a1d25-9ebf-4f33-a1c3-827ad532874e",r.extensionSchemaName="NativeExpressionExtensions";var s="NativeMeasure",u="NativeColumn",c=function(e){function i(t,r){var i=e.call(this)||this;return i.queryRewrites=t,i.extensionSchema=r,i.existingEntityNames={},i.existingExtensionFieldNames={},i}return __extends(i,e),i.prototype.visitNativeMeasure=function(e){this.ensureSchemaInitialized(),this.nativeMeasuresTargetEntity||(this.nativeMeasuresTargetEntity={Name:o.findUniqueName(this.existingEntityNames,r.nativeMeasureFlexibleEntityName),NamingBehavior:1,Measures:[]},this.extensionSchema.Entities.push(this.nativeMeasuresTargetEntity));var i=_.find(this.nativeMeasuresTargetEntity.Measures,function(t){return t.DataType===e.dataType&&t.Expression===e.expression});if(i)return t.SQExprBuilder.measureRef(t.SQExprBuilder.entity(this.extensionSchema.Name,this.nativeMeasuresTargetEntity.Name),i.Name);var a=o.findUniqueName(this.existingExtensionFieldNames,e.proposedName||s);this.existingExtensionFieldNames[a]=!0;var n=t.SQExprBuilder.measureRef(t.SQExprBuilder.entity(this.extensionSchema.Name,this.nativeMeasuresTargetEntity.Name),a);return this.nativeMeasuresTargetEntity.Measures.push({Name:a,DataType:e.dataType,Expression:e.expression}),n},i.prototype.visitNativeColumn=function(e){this.ensureSchemaInitialized();var r=e.source,i=r.getTargetEntity(),a=_.find(this.extensionSchema.Entities,function(e){return e.Name===i.entity});a||(a={Name:i.entity,Extends:i.entity,Columns:[]},this.extensionSchema.Entities.push(a)),a.Columns||(a.Columns=[]);var n=_.find(a.Columns,function(t){return t.DataType===e.dataType&&t.Expression===e.expression});if(n)return t.SQExprBuilder.columnRef(t.SQExprBuilder.entity(this.extensionSchema.Name,a.Name),n.Name);var s=o.findUniqueName(this.existingExtensionFieldNames,e.proposedName||u);this.existingExtensionFieldNames[s]=!0;var c=t.SQExprBuilder.columnRef(t.SQExprBuilder.entity(this.extensionSchema.Name,a.Name),s);return a.Columns.push({Name:s,DataType:e.dataType,Expression:e.expression,NamingBehavior:1}),this.queryRewrites||(this.queryRewrites=[]),this.queryRewrites.push({selectExprReplaced:{originalExpr:e,replacedExpr:c}}),c},i.prototype.ensureSchemaInitialized=function(){if(!this.schemaInitialized){this.extensionSchema?this.extensionSchema.Version=Math.max(this.extensionSchema.Version,1):this.extensionSchema={Name:r.extensionSchemaName,Version:1,Extends:r.DefaultSchemaName},this.extensionSchema.Entities||(this.extensionSchema.Entities=[]),this.existingExtensionFieldNames={};for(var e=0,t=this.extensionSchema.Entities;e<t.length;e++){var i=t[e];
if(this.existingEntityNames[i.Name]=!0,i.Measures)for(var a=0,n=i.Measures;a<n.length;a++){var o=n[a];this.existingExtensionFieldNames[o.Name]=!0}if(i.Columns)for(var s=0,u=i.Columns;s<u.length;s++){var c=u[s];this.existingExtensionFieldNames[c.Name]=!0}}this.schemaInitialized=!0}},i}(n)}(r=t.dsr||(t.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.restartValuesCount=e.length,this.calcIdToRestartIdentityIndex={};for(var t=0;t<this.restartValuesCount;t++)this.calcIdToRestartIdentityIndex[e[t]]=t}return e.prototype.getRestartValues=function(e){var t=new Array(this.restartValuesCount);for(e.restartCalcs();e.nextCalc();){var r=this.calcIdToRestartIdentityIndex[e.calcId()];void 0!==r&&(t[r]=e.calcValueAsExpr())}return t},e}();e.RestartValuesBuilder=t}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.elements=e,this.currentIndex=-1}return e.prototype.reset=function(e){this.currentIndex=-1,e&&(this.elements=e)},e.prototype.count=function(){return _.size(this.elements)},e.prototype.current=function(){return this.elements[this.currentIndex]},e.prototype.done=function(){return this.currentIndex===_.size(this.elements)-1},e.prototype.next=function(){return!this.done()&&(this.currentIndex++,!0)},e.prototype.index=function(){return this.currentIndex},e}();e.Iterator=t}(t=e.reader||(e.reader={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){var i;!function(i){function a(e){return new n(e)}i.createDsrParser=a;var n=function(){function e(e){this.parser=new s(e.DataShapes)}return e.prototype.dataShapes=function(){return this.parser},e.prototype.reset=function(){this.parser.reset()},e.prototype.lockCache=function(){},e}(),o=function(){function t(){}return t.prototype.setCalculations=function(e){this.calcIt?this.calcIt.reset(e):this.calcIt=new r.Iterator(e),this.calcExpr=void 0},t.prototype.restartCalcs=function(){this.calcIt.reset(),this.calcExpr=void 0},t.prototype.nextCalc=function(){var t=this.calcIt.next();return t&&(this.calcExpr=e.PrimitiveValueEncoding.parseValueToSQExpr(this.calcIt.current().Value)),t},t.prototype.calcId=function(){return this.calcIt.current().Id},t.prototype.calcValue=function(){return this.calcValueAsExpr().value},t.prototype.calcValueAsExpr=function(){return this.calcExpr||(this.calcExpr=e.PrimitiveValueEncoding.parseValueToSQExpr(this.calcIt.current().Value)),this.calcExpr},t.prototype.calcCount=function(){return this.calcIt.count()},t}(),s=function(e){function t(t){var i=e.call(this)||this;return i.it=new r.Iterator(t),i}return __extends(t,e),t.prototype.reset=function(){this.it.reset()},t.prototype.index=function(){return this.it.index()},t.prototype.count=function(){return this.it.count()},t.prototype.next=function(){this.primaryHierarchyParser=this.secondaryHierarchyParser=this.messageParser=void 0;var e=this.it.next();if(e){var t=this.it.current();this.setCalculations(t.Calculations)}return e},t.prototype.primaryHierarchy=function(){if(!this.primaryHierarchyParser){var e=this.it.current().PrimaryHierarchy;this.primaryHierarchyParser=e&&new l(e,0)}return this.primaryHierarchyParser},t.prototype.secondaryHierarchy=function(){if(!this.secondaryHierarchyParser){var e=this.it.current().SecondaryHierarchy;this.secondaryHierarchyParser=e&&new l(e,1)}return this.secondaryHierarchyParser},t.prototype.messages=function(){return!this.messageParser&&_.size(this.it.current().DataShapeMessages)>0&&(this.messageParser=new c(this.it.current().DataShapeMessages)),this.messageParser},t.prototype.hasRestartTokens=function(){return _.size(this.restartTokens())>0},t.prototype.restartTokens=function(){return this.it.current().RestartTokens},t.prototype.complete=function(){return this.it.current().IsComplete},t.prototype.hasAllData=function(){},t.prototype.limitsExceeded=function(){return _.size(this.it.current().DataLimitsExceeded)>0},t.prototype.limits=function(){return this.limitsParser||(this.limitsParser=new u(this.it.current().DataLimitsExceeded)),this.limitsParser},t}(o),u=function(){function e(e){this.it=new r.Iterator(e)}return e.prototype.next=function(){return this.it.next()},e.prototype.id=function(){return this.it.current().Id},e.prototype.count=function(){return this.it.count()},e}(),c=function(){function e(e){this.it=new r.Iterator(e)}return e.prototype.next=function(){return this.it.next()},e.prototype.code=function(){return this.it.current().Code},e.prototype.severity=function(){return this.it.current().Severity},e.prototype.dsrMessage=function(){return new t.DsrMessage(this.it.current())},e}(),l=function(){function e(e,t){this.hierarchy=t,this.it=new r.Iterator(e)}return e.prototype.count=function(){return this.it.count()},e.prototype.reset=function(){this.it.reset()},e.prototype.next=function(){return this.instancesParser&&(this.instancesParser=void 0),this.it.next()},e.prototype.id=function(){return this.it.current().Id},e.prototype.instances=function(){if(!this.instancesParser){var e=this.it.current().Instances;this.instancesParser=e&&new p(e,this.hierarchy)}return this.instancesParser},e}(),p=function(e){function t(t,i){var a=e.call(this)||this;return a.hierarchy=i,a.it=new r.Iterator(t),a}return __extends(t,e),t.prototype.next=function(){var e=this.it.next();if(e){var t=this.it.current();this.setCalculations(t.Calculations),this.dataMemberIt=void 0,this.intersectionParserDirty=!0,1===this.hierarchy}return e},t.prototype.count=function(){return this.it.count()},t.prototype.currentIndex=function(){return this.it.index()},t.prototype.intersections=function(){if(!this.intersectionParser){this.intersectionParserDirty=!1;var e=this.it.current().Intersections;return this.intersectionParser=e&&new d(e)}return this.intersectionParserDirty?(this.intersectionParser.reset(this.it.current().Intersections),this.intersectionParser):this.intersectionParser},t.prototype.restartFlagKind=function(){return this.it.current().RestartFlag},t.prototype.restartKind=function(){return 0},t.prototype.members=function(){if(!this.dataMemberIt){var e=this.it.current().Members;this.dataMemberIt=e&&new l(e,this.hierarchy)}return this.dataMemberIt},t}(o),d=function(e){function t(t){var i=e.call(this)||this;return i.it=new r.Iterator(t),i}return __extends(t,e),t.prototype.reset=function(e){this.it.reset(e)},t.prototype.next=function(){var e=this.it.next();return e&&this.setCalculations(this.it.current().Calculations),e},t}(o)}(i=r.V1||(r.V1={}))}(r=t.reader||(t.reader={}))}(t=e.dsr||(e.dsr={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(r){function i(r){if(r&&r.root){var i=a(r.root),s=n(i),u=new e.SQFrom(null),c=_.take(r.levels,s),l=_.map(c,function(e){return o(e,u)}),p=[];return t.SemanticQuerySerializer.serializeFrom(u,p),{From:p,Levels:l,WindowInstances:i}}}function a(e){return{Values:_.map(e.identityValues,function(e){return t.SemanticQuerySerializer.serializeExpr(e)}),WindowExpansionInstanceWindowValue:_.map(e.windowValues,function(e){return{Values:_.map(e.restartValues,function(e){return t.SemanticQuerySerializer.serializeExpr(e)}),WindowStartKind:e.windowKind}}),Children:_.map(e.children,function(e){return a(e)})}}function n(e){return!e||_.isEmpty(e.Children)?0:Math.max.apply(Math,_.map(e.Children,function(e){return n(e)}))+1}function o(r,i){return{Expressions:_.map(r.identityKeys,function(r){var a=e.SQExprRewriterWithSourceRenames.rewrite(r,i,i);return t.SemanticQuerySerializer.serializeExprWithRef(a)}),Default:0}}r.serializeWindowExpansionState=i}(r=t.DataShapeBindingWindowExpansionStateSerializer||(t.DataShapeBindingWindowExpansionStateSerializer={}))}(t=e.services||(e.services={}))}(t=e.data||(e.data={}))}(powerbi||(powerbi={}));