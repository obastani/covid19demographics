"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function s(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,s)}u((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return o([e,t])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){u.label=i[1];break}if(6===i[0]&&u.label<a[1]){u.label=a[1],a=i;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(i);break}a[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!function(e){var t;!function(t){function i(){return window.resourceLoaderUrl||"/explore/resourcePackageItem/"}function o(e){return new n(e)}var r=window;t.getResourceLoaderUrl=i,t.createJQueryResourceItemProxy=o;var n=function(){function t(e){this.promiseFactory=e}return t.prototype.get=function(e,t,o){var n=this.promiseFactory.defer(),a=r.clusterUri,s=window.powerBIAccessToken;top&&top.powerBIAccessToken&&(s=top.powerBIAccessToken);var u=i(),c={authorization:"Bearer "+s};window.isAnonymousEmbed&&(a=window.clusterApiUri,u=window.resourceLoaderUrl+e+"/",c["X-PowerBI-ResourceKey"]=window.powerBIResourceKey);var l=a+u+encodeURIComponent(o),p={url:l,headers:c,dataType:"string"};return $.ajax(p).then(function(e){return n.resolve(e)},function(e){return n.reject(e)}),n.promise},t.prototype.getBlob=function(t,i,o){return e.createJQueryPromiseFactory().reject()},t}()}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(){var t=e.createJQueryPromiseFactory(),i={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};return new n({messageProxy:o.createWindowMessageProxy(t,window.parent),promiseFactory:t,resourceProvider:i})}var o=e.visualHost,r=e.contracts.ResourcePackageItemType;t.createResourceLoaderHost=i;var n=function(){function t(e){var t=this;this.messageProxy=e.messageProxy,this.promiseFactory=e.promiseFactory,this.resourceProvider=e.resourceProvider,this.messageProxy.on(o.events.WindowMessageProxyMessageEvent,function(e){return t.onMessageReceived(e)})}return t.prototype.onMessageReceived=function(e){switch(e.message.eventName){case"loadVisualPluginWithContent":return this.loadVisualPluginWithContent.apply(this,e.message.arguments)}},t.prototype.loadVisualPluginWithContent=function(t){var i=this.promiseFactory.defer(),n=t.pluginName,a=t.mappedPluginContent,s=a[r.CustomVisualJavascript].content,u=a[r.CustomVisualsCss].content;try{o.resourceInjector.injectJsCode(n,s),o.resourceInjector.injectCssCode(n,u);var c=e.visuals.plugins[n];c.iconUrl=o.visualPluginServiceHelpers.getPluginIconUrl(n),c.content={js:s,css:u,iconBase64:c.iconUrl},e.extensibility.visualPluginAdapter.transformPlugin(c),c.capabilities.objects=e.data.services.DataViewObjectDescriptorSerializer.serialize(c.capabilities.objects,this.resourceProvider),i.resolve(c)}catch(e){i.reject(e)}return i.promise},t}();t.ResourceLoaderHost=n}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(i,r){void 0===r&&(r=!1);var n=e.createJQueryPromiseFactory(),a=e.visualHost.createWindowMessageProxy(n,window.parent),s={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};t.SandboxVisualHostServices.initialize();var u={promiseFactory:n},c=t.createSandboxTelemetryProxyService(a),l=new f,p=t.createVisualHostServices(a,l);return new h({$element:i,hostServices:p,hostServicesControl:p,dataProxy:o(n),promiseFactory:n,messageProxy:a,resourceLoader:e.visualHost.createResourceLoader(u,null),resourceProvider:s,telemetryProxyService:c,instanceId:"",sandboxPromiseHandler:l},r)}function o(i){var o=t.createSandboxNoOpTelemetryProxyService(),r={dsr:{name:"dsr",reader:function(t){return new e.data.dsr.DsrDataReader(t,{execute:function(){return i.reject()}},o,{enableCellLevelFormatting:!1,dsrV2:!1},null,(void 0),(void 0))}}},n={promiseFactory:function(){return i}},a=e.data.createDataReaderProvider(e.data.createDataReaderFactory(r,{}),n);return e.data.createDataProxy(i,a,o)}function r(t,i,o){var r=t.content,n=t.hasBeenInjected||e.visuals&&e.visuals.plugins&&e.visuals.plugins.hasOwnProperty(t.name)&&e.visuals.plugins[t.name].hasBeenInjected;i&&n||(e.visualHost.resourceInjector.injectJsCode(t.name,r.js,o,t.apiVersion),e.visualHost.resourceInjector.injectCssCode(t.name,r.css));var a,s={major:3,minor:0,patch:0};return a=!t.apiVersion||d.lt(t.apiVersion,s)?e.visuals.plugins[t.name]:window[t.name].default,t.apiVersion&&(a.iconUrl=t.iconUrl,a.capabilities=t.capabilities,a.localizationResources=t.localizationResources),i&&(a.hasBeenInjected=!0,a.approvedForNoIframe=!0,e.visuals.plugins[t.name]=a),a}var n=e.data.segmentation.DataViewMerger,a=e.data.services.DataViewObjectSerializer,s=e.data.services.DataViewObjectDescriptorSerializer,u=e.visualHost.services.VisualObjectInstanceSerializer,c=e.visualHost.services.VisualObjectRepetitionSerializer,l=e.visualHost.VisualStyleSerializer,p=e.extensibility.createVisualApiAdapter,d=jsCommon.Version;t.relayMouseEvents=["click","mouseup","MSPointerUp","pointerup"],t.relayTouchEvents=["tap","touchend","touchcancel"],t.relayUIEvents=t.relayMouseEvents.concat(t.relayTouchEvents),t.relayUIEventProps=["type","bubbles","which","buttons","button","ctrlKey","altKey","metaKey","shiftKey","x","y","clientX","clientY","pageX","pageY","movementX","movementY","layerX","layerY","changedTouches"];var g=104857600,y=function(){function e(t){this.id=++e.counter,this.deferred=t}return e.getLastId=function(){return e.counter},e.counter=0,e}();t.SandboxPromise=y;var v=function(){function e(t){this.id=++e.counter,this.deferred=t}return e.getLastId=function(){return e.counter},e.counter=0,e}();t.SandboxPromise2=v;var f=function(){function e(){this.promises={},this.promises2={}}return e.prototype.CreatePromise=function(e){var t=new y(e);return this.promises[t.id]=t,t},e.prototype.ResolvePromise=function(e,t){var i=this.promises[e];i&&(i.deferred.resolve(t),this.promises[e]=null)},e.prototype.RejectPromise=function(e,t){var i=this.promises[e];i&&(i.deferred.reject(t),this.promises[e]=null)},e.prototype.CreatePromise2=function(e){var t=new v(e);return this.promises2[t.id]=t,t},e.prototype.ResolvePromise2=function(e,t){var i=this.promises2[e];i&&(i.deferred.resolve(t),this.promises2[e]=null)},e.prototype.RejectPromise2=function(e,t){var i=this.promises2[e];i&&(i.deferred.reject(t),this.promises2[e]=null)},e}();t.SandboxPromiseHandler=f,t.createSandboxHost=i,t.injectCustomVisual=r;var h=function(){function i(i,o){var r=this;void 0===o&&(o=!1),this.isolate=o,this.isVisualInitialized=!1,this.messageQueue=[],this.relayUIEventListener=function(e){var i=_.pick(e.originalEvent,t.relayUIEventProps),o={eventName:"onRelayUIEvent",arguments:[i]};r.messageProxy.postMessage(o)},this.container=i.$element,this.hostServices=i.hostServices,this.hostServicesControl=i.hostServicesControl,this.dataProxy=i.dataProxy,this.promiseFactory=i.promiseFactory,this.messageProxy=i.messageProxy,this.resourceLoader=i.resourceLoader,this.resourceProvider=i.resourceProvider,this.telemetryProxyService=i.telemetryProxyService,this.sandboxPromiseHandler=i.sandboxPromiseHandler,this.aggregatedDataViewSize=0,this.dataViewSerializer=new t.SandboxDataViewSerializer,this.messageProxy.on(e.visualHost.events.WindowMessageProxyMessageEvent,function(e){return r.onMessageReceived(e)})}return Object.defineProperty(i.prototype,"visual",{get:function(){return this._visual},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.hostServices.initInstanceId(e.instanceId),this.hostServicesControl.initInstanceId(e.instanceId),this.style=l.deserializeVisualStyle(e.style);var t={animation:e.animation,element:this.container,host:this.hostServices,interactivity:e.interactivity,style:this.style,viewport:e.viewport,localizationResources:this.plugin.localizationResources,hostEnv:e.hostEnv,dataMultiSelectMode:e.dataMultiSelectMode};this.attachRelayUIEventListener(),this.attachWindowResizeListener(),this.featureSwitches=e.featureSwitches,this.visual.init(t)},i.prototype.destroy=function(){this.detachRelayUIEventListener(),this.detachWindowResizeListener(),this.messageProxy.off(e.visualHost.events.WindowMessageProxyMessageEvent),this.messageProxy.destroy(),this.visual&&this.visual.destroy&&this.visual.destroy()},i.prototype.categoriesExists=function(e){return!!(e&&e.dataViews&&e.dataViews.length>0&&e.dataViews[0].categorical&&e.dataViews[0].categorical.categories&&e.dataViews[0].categorical.categories.length>0&&e.dataViews[0].categorical.categories[0]&&e.dataViews[0].categorical.categories[0].values)},i.prototype.getHostCategoriesValues=function(e,t,i){try{if(e){if(i)for(var o=0;o<e.length;o++)e[o]&&(e[o]=new Date(e[o]));t.dataViews[0].categorical.categories[0].values=e}}catch(e){this.sendError(e)}return t},i.prototype.update=function(t){var i,o=this,r=t.message.arguments[0];if(this.plugin&&this.plugin.apiVersion&&!d.lt(this.plugin.apiVersion,"2.0.0")){this.stringifiedDataView=r.serializedDataView?r.serializedDataView.stringifiedDataView:null;var n=r.serializedDataView?[this.dataViewSerializer.deserializeDataView(r.serializedDataView)]:[],a=this.lastVisualUpdateOptions={dataViews:n,suppressAnimations:r.suppressAnimations,viewMode:r.viewMode,editMode:r.editMode,viewport:r.viewport,type:r.type,operationKind:e.VisualDataChangeOperationKind.Create,resizeMode:r.resizeMode,isInFocus:r.isInFocus,jsonFilters:r.jsonFilters?r.jsonFilters:null};this.fixUpdateOptionsAndUpdateVisual(a,t,r),this.onRestoreCvSelectionIds(r.selections,!d.gt(this.plugin.apiVersion,"2.4.0"))}else r.dataTransforms&&(i=e.data.services.DataViewTransformActionsSerializer.deserializeDataViewTransformActions(r.dataTransforms,this.plugin.capabilities||{})),this.transformDataViewSource(r.dataViewSource,i,!0).then(function(i){var n=o.lastVisualUpdateOptions={dataViews:i.dataViews,suppressAnimations:r.suppressAnimations,viewMode:r.viewMode,editMode:r.editMode,viewport:r.viewport,type:r.type,operationKind:e.VisualDataChangeOperationKind.Create,resizeMode:r.resizeMode,isInFocus:r.isInFocus,jsonFilters:r.jsonFilters?r.jsonFilters:null};o.fixUpdateOptionsAndUpdateVisual(n,t,r)}).catch(function(e){return o.sendError(e)})},i.prototype.updateWithCachedData=function(t){var i,o,r,n=t.message.arguments[0];if(this.plugin&&this.plugin.apiVersion&&!d.lt(this.plugin.apiVersion,"2.0.0")){if(this.lastVisualUpdateOptions.dataViews&&this.lastVisualUpdateOptions.dataViews[0]&&this.lastVisualUpdateOptions.dataViews[0].metadata){var a=this.lastVisualUpdateOptions.dataViews[0].metadata.segment;this.lastVisualUpdateOptions.dataViews[0].metadata=n.dataViewMetadata?JSON.parse(n.dataViewMetadata):void 0,this.lastVisualUpdateOptions.dataViews[0].metadata.segment=a}o=this.lastVisualUpdateOptions.dataViews,r=!0}else n.dataTransforms&&(i=e.data.services.DataViewTransformActionsSerializer.deserializeDataViewTransformActions(n.dataTransforms,this.plugin.capabilities||{})),this.lastDataViewTransformApplyOptions.transforms=i,o=e.data.DataViewTransform.apply(this.lastDataViewTransformApplyOptions).dataViews;var s=this.lastVisualUpdateOptions={dataViews:o,suppressAnimations:n.suppressAnimations,viewMode:n.viewMode,editMode:n.editMode,viewport:n.viewport,type:n.type,operationKind:e.VisualDataChangeOperationKind.Create,resizeMode:n.resizeMode,isInFocus:n.isInFocus,jsonFilters:n.jsonFilters?n.jsonFilters:null};this.fixUpdateOptionsAndUpdateVisual(s,t,n,r)},i.prototype.loadResourcePackage=function(e){var t=this;this.resourceLoader.loadVisualPlugin(e).then(function(e){t.plugin=e,t.createAdapter()}).catch(function(){var i=new Error("Unable to load plugin, resource package id: "+e.id);return t.sendError(i)})},i.prototype.createAdapter=function(){var e=this.plugin;if(this.container.addClass("visual-"+e.name),this._visual=p(e,e.create,this.promiseFactory,this.telemetryProxyService),!e||!this.visual){var t=new Error("Unable to create visual from plugin "+e.name);return this.sendError(t)}this.flushQueue(),this.isVisualInitialized=!0,this.sendSandboxReady()},i.prototype.loadWithoutResourcePackage=function(t){var i="3.0.0",o=t.apiVersion?this.isolate&&d.lt(t.apiVersion,i):this.isolate;this.plugin=r(t,!1,o),e.extensibility.visualPluginAdapter.transformPlugin(this.plugin),this.createAdapter()},i.prototype.enumerateObjectInstances=function(e){if(this.visual.enumerateObjectInstances){var t=this.visual.enumerateObjectInstances(e);if(t){var i=t,o=this.plugin&&this.plugin.apiVersion&&!d.lt(this.plugin.apiVersion,"2.0.0");return i&&i.instances?o?{instances:i.instances,containers:i.containers}:{instances:u.serialize(i.instances),containers:i.containers?u.serializeContainers(i.containers,this.resourceProvider):null}:o?t:u.serialize(t)}}},i.prototype.enumerateObjectRepetition=function(){if(this.visual.enumerateObjectRepetition){var e=this.visual.enumerateObjectRepetition();return e?c.serialize(e):void 0}},i.prototype.sendUpdateResult=function(){var e=this.container.children("*").length,t={eventName:"onUpdateResult",arguments:[e]};this.messageProxy.postMessage(t)},i.prototype.sendSandboxReady=function(){var e=this.plugin.capabilities;e.objects&&(e.objects=s.serialize(this.plugin.capabilities.objects,this.resourceProvider));var t={name:this.plugin.name,watermarkKey:this.plugin.watermarkKey,capabilities:e,class:this.plugin.class,iconUrl:this.plugin.iconUrl,custom:!0,create:function(){return null}},i={eventName:"onPluginReady",arguments:[t]};this.messageProxy.postMessage(i)},i.prototype.flushQueue=function(){for(;this.messageQueue.length>0;){var e=this.messageQueue.shift();this.executeMessage(e)}},i.prototype.sendError=function(e,t){var i={eventName:"onError",arguments:[],error:{id:t?t.id:null,eventName:t?t.eventName:null,name:e.name,message:e.message,pluginName:this.plugin.name}};this.messageProxy.postMessage(i)},i.prototype.onMessageReceived=function(e){return this.isVisualInitialized||"loadResourcePackage"===e.message.eventName||"loadWithoutResourcePackage"===e.message.eventName?this.executeMessage(e):void this.messageQueue.push(e)},i.prototype.executeMessage=function(e){var t=e.message;try{if($.isFunction(this[t.eventName]))return"update"===t.eventName||"updateWithCachedData"===t.eventName||"handleLoadMoreDataResult"===t.eventName?this[t.eventName].call(this,e):this[t.eventName].apply(this,t.arguments);if(this.visual&&$.isFunction(this.visual[t.eventName]))return this.visual[t.eventName].apply(this.visual,t.arguments)}catch(e){this.sendError(e,t)}},i.prototype.transformDataViewSource=function(t,i,o){var r=this,n=this.promiseFactory.defer();return(t?this.createDataView(t):this.promiseFactory.resolve({dataView:null})).then(function(t){var a=e.data.DataViewTransform.apply(r.lastDataViewTransformApplyOptions={prototype:t.dataView,objectDescriptors:r.plugin.capabilities?r.plugin.capabilities.objects:void 0,dataViewMappings:r.plugin.capabilities?r.plugin.capabilities.dataViewMappings:void 0,dataRoles:r.plugin.capabilities?r.plugin.capabilities.dataRoles:void 0,drillCapabilities:r.plugin.capabilities&&r.plugin.capabilities.drilldown,expandCollapseCapabilties:r.plugin.capabilities&&r.plugin.capabilities.expandCollapse,transforms:i,colorAllocatorFactory:e.visuals.createColorAllocatorFactory(),bypassConcatenation:o,visualStyle:r.style,keepAllMetadataColumnsCapability:!!r.plugin.capabilities&&r.plugin.capabilities.keepAllMetadataColumns,featureSwitches:r.featureSwitches}).dataViews;n.resolve({dataViews:a})}).catch(function(e){return r.sendError(e)}),n.promise},i.prototype.createDataView=function(t){var i=this,o=this.promiseFactory.defer(),r={type:t.type,query:{dataSources:null,command:t.data}};return this.dataProxy.execute(r).then(function(t){var r=t&&t.dataReaderResult?t.dataReaderResult.dataView:null,n=e.DataViewAnalysis.validateAndReshape(r,i.plugin.capabilities?i.plugin.capabilities.dataViewMappings:null);o.resolve({dataView:n.dataView})}).catch(function(e){return i.sendError(e)}),o.promise},i.prototype.attachWindowResizeListener=function(){$(window).on("resize",this.windowResizeListener.bind(this)),$(window).trigger("resize")},i.prototype.detachWindowResizeListener=function(){$(window).off("resize")},i.prototype.windowResizeListener=function(){if(this.lastVisualUpdateOptions){var t=$(window).height(),i=$(window).width(),o=e.Prototype.inherit(this.lastVisualUpdateOptions);o.viewport={width:i,height:t},o.type=e.VisualUpdateType.Resize,o.resizeMode=1,this.visual.update(o)}},i.prototype.attachRelayUIEventListener=function(){this.container.on(t.relayUIEvents.join(" "),this.relayUIEventListener)},i.prototype.detachRelayUIEventListener=function(){this.container.off(t.relayUIEvents.join(" "),this.relayUIEventListener)},i.prototype.handleLoadMoreDataResult=function(t){return __awaiter(this,void 0,e.Promise,function(){var i,o,r,a,s;return __generator(this,function(u){switch(u.label){case 0:return this.plugin&&this.plugin.apiVersion&&!d.lt(this.plugin.apiVersion,"2.0.0")?(i=t.message.arguments[0],i&&this.stringifiedDataView!==i.stringifiedDataView?(this.stringifiedDataView=i.stringifiedDataView,o=[this.dataViewSerializer.deserializeDataView(i)],n.mergeDataViews(this.lastVisualUpdateOptions.dataViews[0],o[0]),this.lastVisualUpdateOptions.operationKind=e.VisualDataChangeOperationKind.Append,[4,this.aggregateDataViewSizeAndUpdateVisual(t.packedSize)]):[3,2]):[3,3];case 1:u.sent(),u.label=2;case 2:return[3,5];case 3:return r=t.message.arguments[0],a=r?r.dataReaderResult.dataView:null,a&&(n.mergeDataViews(this.lastDataViewTransformApplyOptions.prototype,a),this.lastVisualUpdateOptions.dataViews=e.data.DataViewTransform.apply(this.lastDataViewTransformApplyOptions).dataViews,this.lastVisualUpdateOptions.operationKind=e.VisualDataChangeOperationKind.Append),[4,this.aggregateDataViewSizeAndUpdateVisual(t.packedSize)];case 4:u.sent(),u.label=5;case 5:return s={eventName:"stopProgressBar",arguments:[]},this.messageProxy.postMessage(s),[2]}})})},i.prototype.aggregateDataViewSizeAndUpdateVisual=function(t){return __awaiter(this,void 0,e.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.aggregatedDataViewSize+=t,this.aggregatedDataViewSize>=g?this.hostServicesControl.enableLoadMoreData(!1):this.hostServicesControl.enableLoadMoreData(!0),[4,this.visual.update(this.lastVisualUpdateOptions)];case 1:return e.sent(),[2]}})})},i.prototype.handleGetAADTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.payload)},i.prototype.handleGetWACTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise2(e.promiseId,e.payload?e.payload:""):this.sandboxPromiseHandler.ResolvePromise2(e.promiseId,e.wacToken)},i.prototype.handleGetStorageData=function(e){e.data?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},i.prototype.handleSetStorageData=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.freeSpace)},i.prototype.onRestoreSelection=function(t){var i=this.hostServices.selectionManager;if(i)if(t&&t.selection){var o=t.selection.map(function(t){return e.visuals.SelectionId.fromSelectorsByColumn(a.deserializeSelectorsByColumn(t))});i.setSelectionIds(o),i.invokeOnSelectCallback(o)}else i.setSelectionIds([]),i.invokeOnSelectCallback([])},i.prototype.onRestoreCvSelectionIds=function(t,i){void 0===i&&(i=!0);var o=this.hostServices.selectionManager;if(o){var r=[];t?(r=_.map(t,function(t){return new e.visuals.CustomVisualSelectionId(t.serializedDataMap,t.measures)}),o.setSelectionIds(r)):o.setSelectionIds([]),i&&o.invokeOnSelectCallback(r)}},i.prototype.fixUpdateOptionsAndUpdateVisual=function(e,t,i,o){void 0===o&&(o=!1),o||(e=this.categoriesExists(e)?this.getHostCategoriesValues(i.categoriesValues,e,i.isCategoryDate):e,this.hostServicesControl.enableLoadMoreData(!0),this.aggregatedDataViewSize=t.packedSize),this.visual.update(e),this.sendUpdateResult()},i}();t.SandboxHost=h}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e){return new a(e)}var o=e.data.services,r=o.DataViewObjectSerializer,n=e.visuals.CustomVisualSelectionId;t.createSandboxVisualHostTooltipService=i;var a=function(){function e(e){this.messageProxy=e,this.rootElement=window.document.body}return e.prototype.serializeIdentities=function(e){return e&&e[0]instanceof n?e:e&&_(e).map(function(e){return r.serializeSelectorsByColumn(e)}).compact().value()},e.prototype.show=function(e){var t=e&&{coordinates:e.coordinates,dataItems:e.dataItems,identities:this.serializeIdentities(e.identities),isTouchEvent:e.isTouchEvent},i={eventName:"showTooltip",arguments:[t]};this.messageProxy.postMessage(i)},e.prototype.move=function(e){var t=e&&{coordinates:e.coordinates,dataItems:e.dataItems,identities:this.serializeIdentities(e.identities),isTouchEvent:e.isTouchEvent},i={eventName:"moveTooltip",arguments:[t]};this.messageProxy.postMessage(i)},e.prototype.hide=function(e){var t={eventName:"hideTooltip",arguments:[e]};this.messageProxy.postMessage(t)},e.prototype.visible=function(){return!1},e.prototype.container=function(){return this.rootElement},e.prototype.enabled=function(){return!0},e}()}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e,t){return new r(e,t)}var o=e.extensibility.convertVisualEventType;t.createSandboxVisualHostTelemetryService=i;var r=function(){function e(e,t){this.messageProxy=e,this.instanceId=t}return e.prototype.trace=function(e,t){this.messageProxy.postMessageAsync({eventName:"logVisualEvent",arguments:[o(e),this.instanceId,t]})},e}()}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e,t,o){return new i(e,t,o)}e.createSandboxVisualHostLocalStorageService=t;var i=function(){function e(e,t,i){this.messageProxy=e,this.promiseFactory=t,this.sandboxPromiseHandler=i}return e.prototype.getStorageData=function(e){var t=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer()),i={eventName:"getStorageData",arguments:[e,t.id]};return this.messageProxy.postMessage(i),t.deferred.promise},e.prototype.setStorageData=function(e,t){var i=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer()),o={eventName:"setStorageData",arguments:[e,t,i.id]};return this.messageProxy.postMessage(o),i.deferred.promise},e.prototype.removeStorageData=function(e){var t={eventName:"removeStorageData",arguments:[e]};this.messageProxy.postMessage(t)},e}();e.SandboxVisualHostLocalStorageService=i}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e,t){return new i(e,t)}e.createSandboxVisualHostEventService=t;var i=function(){function e(e,t){this.messageProxy=e,this.instanceId=t}return e.prototype.renderingStarted=function(e){var t={eventName:"renderingStarted",arguments:[this.instanceId,e.updateId]};this.messageProxy.postMessage(t)},e.prototype.renderingFinished=function(e){var t={eventName:"renderingFinished",arguments:[this.instanceId,e.updateId]};this.messageProxy.postMessage(t)},e.prototype.renderingFailed=function(e,t){var i={eventName:"renderingFailed",arguments:[this.instanceId,e.updateId,t]};this.messageProxy.postMessage(i)},e}();e.SandboxVisualHostEventService=i}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e){return new r(e)}var o;!function(e){e.VisualApiUsage="VisualApiUsage",e.VisualException="VisualException"}(o=t.proxiedTelemetryEventType||(t.proxiedTelemetryEventType={})),t.createSandboxTelemetryProxyService=i;var r=function(){function t(e){this.windowMessageProxy=e}return t.prototype.setLogToConsole=function(e){},t.prototype.setLogAllEvents=function(e){},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.flush=function(){},t.prototype.restart=function(){},t.prototype.stopActivity=function(e,t,i){},t.prototype.startPerfEventDeprecated=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var r;return r=new n({info:{}})},t.prototype.logEvent=function(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=null;return t===e.telemetry.VisualApiUsage?n=o.VisualApiUsage:t===e.telemetry.VisualException&&(n=o.VisualException),i.unshift(n),this.windowMessageProxy.postMessageAsync({eventName:"logEvent",arguments:i}),null},t.prototype.logTelemetryData=function(e,t,i){return null},t.prototype.logChildEvent=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o]},t.prototype.startActivity=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var r;return r=new n({info:{}})},t.prototype.startChildActivity=function(e,t,i){for(var o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r]},t.prototype.startEvent=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o;return o=new n({info:{}})},t.prototype.startMonitoredActivity=function(e,t,i){var o,r={info:{}};return o=new n(r),{activityEvent:r,activityDeferred:o}},t.prototype.startChildEvent=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var r;return r=new n({info:{}})},t.prototype.logTrace=function(e){},Object.defineProperty(t.prototype,"sessionId",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){},enumerable:!0,configurable:!0}),t.prototype.setHostInfo=function(e,t){},t}(),n=function(){function t(t){var i=this;this.event=t,this.promise=new e.Promise(function(e,t){i.onResolve=e,i.onReject=t})}return t.prototype.resolve=function(){this.onResolve()},t.prototype.reject=function(e){this.onReject()},t}();t.EmptyDeferredTelemetryEvent=n}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(){return new i}e.createSandboxNoOpTelemetryProxyService=t;var i=function(){function t(){}return t.prototype.setLogToConsole=function(e){},t.prototype.setLogAllEvents=function(e){},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.flush=function(){},t.prototype.restart=function(){},t.prototype.stopActivity=function(e,t,i){},t.prototype.startPerfEventDeprecated=function(t,i){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var n,a={info:{}};return n=new e.EmptyDeferredTelemetryEvent(a)},t.prototype.logEvent=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return null},t.prototype.logTelemetryData=function(e,t,i){return null},t.prototype.logChildEvent=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o]},t.prototype.startActivity=function(t,i){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var n,a={info:{}};return n=new e.EmptyDeferredTelemetryEvent(a)},t.prototype.startChildActivity=function(e,t,i){for(var o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r]},t.prototype.startEvent=function(t){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var r,n={info:{}};return r=new e.EmptyDeferredTelemetryEvent(n)},t.prototype.startMonitoredActivity=function(t,i,o){var r,n={info:{}};return r=new e.EmptyDeferredTelemetryEvent(n),{activityEvent:n,activityDeferred:r}},t.prototype.startChildEvent=function(t,i){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var n,a={info:{}};return n=new e.EmptyDeferredTelemetryEvent(a)},t.prototype.logTrace=function(e){},Object.defineProperty(t.prototype,"sessionId",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){},enumerable:!0,configurable:!0}),t.prototype.setHostInfo=function(e,t){},t}()}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e,t){return new c(e,t)}var o=e.data.services.DataViewObjectSerializer,r=e.visualHost.services.VisualObjectInstanceSerializer,n=e.extensibility.SelectionManager,a=jsCommon.Version,s={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},u={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",Restatement_Comma:"{0}, {1}",Restatement_CompoundAnd:"{0} and {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Decrease:"Decrease",Increase:"Increase",Waterfall_TotalLabel:"Total",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"},c=function(){function i(e,o){this.messageProxy=e,this.loadMoreDataEnabled=!0,this.visualHostTooltipService=t.createSandboxVisualHostTooltipService(e),this.queryDictionary=i.parseUrlParameters(),this.authService=t.createSandboxVisualHostAuthenticationService(e,this.promiseFactory(),o),this.storageService=t.createSandboxVisualHostLocalStorageService(e,this.promiseFactory(),o)}return i.prototype.initInstanceId=function(e){this._instanceId=e,this.telemetryService=t.createSandboxVisualHostTelemetryService(this.messageProxy,e),this.eventsService=t.createSandboxVisualHostEventService(this.messageProxy,e)},i.initialize=function(){e.visuals.TooltipManager&&e.visuals.TooltipManager.setLocalizedStrings(i.createTooltipLocaleOptions())},i.createLocaleOptions=function(){return{null:u.NullValue,true:u.BooleanTrue,false:u.BooleanFalse,
NaN:u.NaNValue,infinity:u.InfinityValue,negativeInfinity:u.NegativeInfinityValue,beautify:function(e){return i.beautify(e)},describe:function(e){return i.describeUnit(e)},restatementComma:u.Restatement_Comma,restatementCompoundAnd:u.Restatement_CompoundAnd,restatementCompoundOr:u.Restatement_CompoundOr}},i.createTooltipLocaleOptions=function(){return{highlightedValueDisplayName:u.Tooltip_HighlightedValueDisplayName}},i.prototype.getLocalizedString=function(e){return u[e]},i.prototype.onSelecting=function(e){e.action=0},i.prototype.onSelect=function(t){var i;if(e.extensibility.legacy.isOldSelectEventArgs(t)){var r=t;i={data:o.serializeSelectors(r.data),data2:o.serializeSelectorsByColumn(r.data2),selectors:o.serializeSelectors(t.selectors)}}else i={visualObjects:o.serializeVisualObjects(t.visualObjects)};var n={eventName:"onSelect",arguments:[i]};this.messageProxy.postMessage(n)},i.prototype.customVisualOnContextMenu=function(e){var t={eventName:"onCustomVisualContextMenu",arguments:[e]};this.messageProxy.postMessage(t)},i.prototype.switchFocusModeState=function(e){var t={eventName:"onSwitchFocusModeState",arguments:[e]};this.messageProxy.postMessage(t)},i.prototype.persistProperties=function(e){var t,i=e;t=this.apiVersion&&(a.gt(this.apiVersion,"2.0.0")||a.eq(this.apiVersion,"2.0.0"))?e:i.merge||i.remove||i.replace?{merge:i.merge?r.serialize(i.merge):null,replace:i.replace?r.serialize(i.replace):null,remove:i.remove?r.serialize(i.remove):null}:r.serialize(e);var o={eventName:"persistProperties",arguments:[t]};this.messageProxy.postMessage(o)},i.prototype.sendSelectionIdsToHost=function(e){var t={eventName:"transformCvSelectionIdsAndSelect",arguments:[e]};this.messageProxy.postMessage(t)},i.prototype.loadMoreData=function(){this.fetchMoreData()},i.prototype.fetchMoreData=function(){if(!this.loadMoreDataEnabled)return!1;var e={eventName:"loadMoreData",arguments:null};return this.messageProxy.postMessage(e),!0},i.prototype.launchUrl=function(e){var t={eventName:"launchUrl",arguments:[e]};this.messageProxy.postMessage(t)},i.prototype.tooltips=function(){return this.visualHostTooltipService},i.prototype.telemetry=function(){return this.telemetryService},i.prototype.authenticationService=function(){return this.authService},i.prototype.localStorageService=function(){return this.storageService},i.prototype.eventService=function(){return this.eventsService},i.prototype.visualTimeSynchronization=function(){return this.visualTimeSynchronizationService},i.prototype.locale=function(){var e=this.queryDictionary&&this.queryDictionary.locale;return e||navigator.language},i.prototype.loader=function(){var e=this;return{require:function(){return e.promiseFactory().reject()}}},i.prototype.applyJsonFilter=function(e,t,i,o){var r=[e,t,i];o&&r.push(o);var n={eventName:"applyJsonFilter",arguments:r};return this.messageProxy.postMessage(n),!0},i.prototype.getJSONFilter=function(e){return this.promiseFactory().reject()},i.parseUrlParameters=function(e){void 0===e&&(e=window.location.search);var t={},i=e;if(i&&"?"===i.substr(0,1))for(var o=i.substr(1).split("&"),r=0,n=o;r<n.length;r++){var a=n[r],s=a&&a.split("=");s&&2===s.length&&(t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]))}return t},i.prototype.destroy=function(){this.messageProxy.destroy(),this.messageProxy=null},i.prototype.refreshHostData=function(){var e={eventName:"refreshHostData",arguments:null};this.messageProxy.postMessage(e)},i.prototype.createSelectionIdBuilder=function(){return new e.visuals.CustomVisualSelectionId},i.prototype.createTooltipService=function(){return e.extensibility.createTooltipService({hostServices:this})},i.prototype.createSelectionManager=function(e){return new n({hostServices:this,apiVersion:e})},i.prototype.requestFocus=function(){},i.prototype.setShouldDeferData=function(){},i.prototype.onDragStart=function(){},i.prototype.onContextMenu=function(){},i.prototype.onSwitchFocusModeState=function(){},i.prototype.getVisualLinkProperties=function(){},i.prototype.canSelect=function(){return!1},i.prototype.canExpandCollapse=function(e){return!1},i.prototype.setNodeExpansionState=function(e){},i.prototype.onCustomSort=function(e){},i.prototype.getViewMode=function(){return 0},i.prototype.getEditMode=function(){return 0},i.prototype.setWarnings=function(e){},i.prototype.setToolbar=function(e){},i.prototype.shouldRetainSelection=function(){return!1},i.prototype.geocoder=function(){return e.visuals.services.createGeocoder()},i.prototype.geolocation=function(){return e.visuals.services.createGeolocation()},i.prototype.promiseFactory=function(){return e.createJQueryPromiseFactory()},i.prototype.ignoreDefaultFilter=function(){return!1},i.prototype.getIdentityDisplayNames=function(e){},i.prototype.setIdentityDisplayNames=function(e){},i.prototype.setFilterExpressionMetadata=function(){},i.prototype.getFilterExpressionMetadata=function(){},i.prototype.getUIComponentFactory=function(){},i.prototype.onHyperlinkClick=function(e,t){},i.prototype.isVisualEnabled=function(){return this.promiseFactory().resolve(!0)},i.prototype.dataMultiSelectMode=function(){return 0},i.prototype.dropdown=function(){},Object.defineProperty(i.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),i.beautify=function(e){var t=s[e];return t?u[t]||e:e},i.describeUnit=function(e){var t=e===-1?"Auto":e.toString(),i=u["DisplayUnitSystem_E"+t+"_Title"],o=e<=0?"{0}":u["DisplayUnitSystem_E"+t+"_LabelFormat"];if(i||o)return{title:i,format:o}},i.prototype.enableLoadMoreData=function(e){this.loadMoreDataEnabled=e},i}();t.SandboxVisualHostServices=c,t.createVisualHostServices=i}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e,t,i){return new r(e,t,i)}var o=e.extensibility.SelectionManager,r=function(){function t(e,t,i){this.loadMoreDataEnabled=!0,this.powerbiHost=e,this.visualHostTooltipService=i,this.tooltipService=new n(t,this.visualHostTooltipService)}return t.prototype.onSelecting=function(e){e.action=0},t.prototype.onSelect=function(e){this.powerbiHost&&this.powerbiHost.onSelect(e)},t.prototype.persistProperties=function(e){this.powerbiHost&&this.powerbiHost.persistProperties(e)},t.prototype.tooltips=function(){return this.visualHostTooltipService},t.prototype.applyJsonFilter=function(e,t,i,o){this.powerbiHost.applyJsonFilter(e,t,i,o)},t.prototype.getJSONFilter=function(e){return this.promiseFactory().reject()},t.prototype.createSelectionIdBuilder=function(){return new e.visuals.SelectionIdBuilder},t.prototype.createTooltipService=function(){return this.tooltipService},t.prototype.createSelectionManager=function(e){return new o({hostServices:this,apiVersion:e},(!0))},t.prototype.getLocalizedString=function(e){return null},t.prototype.locale=function(){return navigator.language},t.prototype.loader=function(){var e=this;return{require:function(){return e.promiseFactory().reject()}}},t.prototype.onSwitchFocusModeState=function(e){this.powerbiHost&&this.powerbiHost.onSwitchFocusModeState(e)},t.prototype.loadMoreData=function(){},t.prototype.setShouldDeferData=function(){},t.prototype.fetchMoreData=function(){return!0},t.prototype.launchUrl=function(e){},t.prototype.destroy=function(){},t.prototype.refreshHostData=function(){},t.prototype.onContextMenu=function(){},t.prototype.authenticationService=function(){return null},t.prototype.telemetry=function(){return null},t.prototype.localStorageService=function(){return null},t.prototype.eventService=function(){return null},t.prototype.visualTimeSynchronization=function(){return null},t.prototype.requestFocus=function(){},t.prototype.onDragStart=function(){},t.prototype.getVisualLinkProperties=function(){},t.prototype.canSelect=function(){return!1},t.prototype.canExpandCollapse=function(){return!1},t.prototype.setNodeExpansionState=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return e.visuals.services.createGeocoder()},t.prototype.geolocation=function(){return e.visuals.services.createGeolocation()},t.prototype.promiseFactory=function(){return e.createJQueryPromiseFactory()},t.prototype.ignoreDefaultFilter=function(){return!1},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.setFilterExpressionMetadata=function(){},t.prototype.getFilterExpressionMetadata=function(){},t.prototype.getUIComponentFactory=function(){},t.prototype.onHyperlinkClick=function(e,t){},t.prototype.isVisualEnabled=function(){return this.promiseFactory().resolve(!0)},t.prototype.dataMultiSelectMode=function(){return 0},t.prototype.dropdown=function(){},t.prototype.enableLoadMoreData=function(e){this.loadMoreDataEnabled=e},t}();t.NonSandboxVisualHostServices=r;var n=function(){function e(e,t){this.tooltipService=t,this.element=e}return e.prototype.enabled=function(){return this.tooltipService&&this.tooltipService.enabled()},e.prototype.show=function(e){if(this.enabled()){var t={coordinates:this.fixCoordinates(e.coordinates),dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:o.getSelectorsByColumn(e.identities)};this.tooltipService.show(t)}},e.prototype.move=function(e){if(this.enabled()){var t={coordinates:this.fixCoordinates(e.coordinates),dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:o.getSelectorsByColumn(e.identities)};this.tooltipService.move(t)}},e.prototype.hide=function(e){this.enabled()&&this.tooltipService.hide(e)},e.prototype.fixCoordinates=function(e){var t=this.element.offset();return e[0]=e[0]+t.left,e[1]=e[1]+t.top,e},e}();t.createNonSandboxVisualHostServices=i}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=e.data.services.DataViewObjectSerializer,o=function(){function t(){this.identitiesArray=[]}return t.prototype.serializeDataViewForCv=function(e,t,i){var o=this;if(i||(this.identitiesArray=[]),e){e=this.filterDataViewsType(e,t);return{valueSource:this.getValueSource(e),valueGroups:this.getValueGroups(e),stringifiedDataView:JSON.stringify(e,function(e,t){return o.replacer(e,t)})}}},t.prototype.serializeDataViewMetadata=function(e){var t=this;return e.metadata?JSON.stringify(e.metadata,function(e,i){return t.replacer(e,i)}):null},t.prototype.deserializeDataView=function(e){var t=JSON.parse(e.stringifiedDataView);return this.reconstructValuesGroups(t,e),this.reconstructValuesSource(t,e),t},t.prototype.convertCVSelectionIdToPowerbiSelctionId=function(t){var i=this,o=JSON.parse(JSON.stringify(t),function(e,t){return i.replaceOpaqueIdentitiesWithDataViewScopeIdentities(e,t)});return e.visuals.SelectionId.createWithSelectorForColumnAndMeasures(o.dataMap,o.measures)},t.prototype.getIndexOfIdentity=function(t){return _.findIndex(this.identitiesArray,function(i){return e.DataViewScopeIdentity.equals(i,t)})},t.prototype.deserializeVisualObjectInstance=function(e){var t=this;return JSON.parse(JSON.stringify(e,function(e,i){return t.replaceOpaqueIdentities(e,i)}))},t.prototype.flushIdentitiesArray=function(){this.identitiesArray&&0!==this.identitiesArray.length&&this.identitiesArray.forEach(function(e){return e.opaqueIdentity=void 0})},t.prototype.getValueGroups=function(e){var t=this;if(e&&e.categorical&&e.categorical.values&&e.categorical.values.grouped){var i=e.categorical.values.grouped();return JSON.stringify(i,function(e,i){return t.replacer(e,i)})}return null},t.prototype.getValueSource=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.source?e.categorical.values.source:null},t.prototype.replacer=function(e,t){if(t){if(this.isDataViewScopeIdentity(t))return t.opaqueIdentity?{identityIndex:t.opaqueIdentity.identityIndex}:(t.opaqueIdentity={identityIndex:this.identitiesArray.length},this.identitiesArray.push(t),t.opaqueIdentity);if(t instanceof Array){var i=[];return i.push.apply(i,t),i}if("object"==typeof t&&!this.dontNeedToClone(t)){var o={};for(var r in t)o[r]=t[r];return o}}return t},t.prototype.replaceOpaqueIdentities=function(e,t){return t&&void 0!==t.identityIndex?i.serializeScopeIdentity(this.identitiesArray[t.identityIndex]):t},t.prototype.replaceOpaqueIdentitiesWithDataViewScopeIdentities=function(e,t){return t&&void 0!==t.identityIndex?this.identitiesArray[t.identityIndex]:t},t.prototype.filterDataViewsType=function(e,t){return t.dataViewMappings?(t.dataViewMappings[0].categorical||(e.categorical=null),t.dataViewMappings[0].matrix||(e.matrix=null),t.dataViewMappings[0].table||(e.table=null),t.dataViewMappings[0].tree||(e.tree=null),t.dataViewMappings[0].single||(e.single=null),e):e},t.prototype.dontNeedToClone=function(e){return e._proto_===Object.prototype||e instanceof Date},t.prototype.isDataViewScopeIdentity=function(e){return!!(e&&e.expr&&e.key&&e.kind)},t.prototype.reconstructValuesSource=function(e,t){t&&t.valueSource&&(e.categorical.values.source=t.valueSource)},t.prototype.reconstructValuesGroups=function(e,t){e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&(e.categorical.values.grouped=function(){return JSON.parse(t.valueGroups)})},t}();t.SandboxDataViewSerializer=o}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(e,t,o){return new i(e,t,o)}e.createSandboxVisualHostAuthenticationService=t;var i=function(){function e(e,t,i){this.messageProxy=e,this.promiseFactory=t,this.sandboxPromiseHandler=i}return e.prototype.getAADToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer()),t={eventName:"getAADToken",arguments:[e.id]};return this.messageProxy.postMessage(t),e.deferred.promise},e.prototype.getWACToken=function(e,t){var i=this.sandboxPromiseHandler.CreatePromise2(this.promiseFactory.defer()),o={resourceEtag:t,resourceSiteUrl:e,promiseId:i.id},r={eventName:"getWACToken",arguments:[o]};return this.messageProxy.postMessage(r),i.deferred.promise},e}();e.SandboxVisualHostAuthenticationService=i}(t=e.visualSandbox||(e.visualSandbox={}))}(powerbi||(powerbi={}));