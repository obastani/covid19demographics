"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},__assign.apply(this,arguments)},__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),powerbi;!function(e){var t;!function(e){var t=e.Units.FontSize;e.cartesianLegacyResponsiveViewportsBreakpoints={legendWidth:76,legendHeight:58,axesTitleWidth:128,axesTitleHeight:58,axesHeight:58,axesMedWidth:128,axesWidth:76,maxWidthForMediumFont:180,maxWidthForSmallFont:128};var a;!function(a){function i(e,t){o(e,t),r(e,t)}function r(a,i){var r=i.legendData.position,o=a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.legendWidth&&e.Legend.isLeftOrRight(r),n=a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.legendHeight&&e.Legend.isTopOrBottom(r);if((o||n)&&(i.legendData.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont){var s=i.legendData.fontProperties.size.pt,l=void 0;l=a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont?Math.min(s,e.Legend.LegendSmallFontSmallViewportInPt):Math.min(s,e.Legend.LegendMediumFontSmallViewportInPt),i.legendData.fontProperties=e.FontProperties.inherit(i.legendData.fontProperties,{size:t.createFromPt(l)})}}function o(a,i){var r=i.axesData;if(a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleHeight&&(r.x.showAxisTitle=!1,r.y.showAxisTitle=!1,r.y2.showAxisTitle=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleWidth&&(r.y.showAxisTitle=!1,r.y2.showAxisTitle=!1),a.height<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesHeight&&(r.x.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesWidth&&(r.y.show=!1,r.y2.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.axesMedWidth&&e.Legend.isLeftOrRight(i.legendData.position)&&(r.y.show=!1,r.y2.show=!1),a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont){var o={x:{tickLabels:e.CartesianChart.xAxisSmallFontSizeInPx,title:e.CartesianChart.xAxisSmallFontSizeInPx},y:{tickLabels:e.CartesianChart.yAxisMediumFontSizeInPx,title:e.CartesianChart.yAxisMediumFontSizeInPx},y2:{tickLabels:e.CartesianChart.yAxisMediumFontSizeInPx,title:e.CartesianChart.yAxisMediumFontSizeInPx}};a.width<=e.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont&&(o.y.tickLabels=e.CartesianChart.yAxisSmallFontSizeInPx,o.y.title=e.CartesianChart.yAxisSmallFontSizeInPx,o.y2.tickLabels=e.CartesianChart.yAxisSmallFontSizeInPx,o.y2.title=e.CartesianChart.yAxisSmallFontSizeInPx),r.x.titleFontProperties=e.FontProperties.inherit(r.x.titleFontProperties,{size:t.createFromPx(o.x.title)}),r.y.titleFontProperties=e.FontProperties.inherit(r.y.titleFontProperties,{size:t.createFromPx(o.y.title)}),r.y2.titleFontProperties=e.FontProperties.inherit(r.y2.titleFontProperties,{size:t.createFromPx(o.y2.title)}),r.x.labelFontProperties=e.FontProperties.inherit(r.x.labelFontProperties,{size:t.createFromPx(o.x.tickLabels)}),r.y.labelFontProperties=e.FontProperties.inherit(r.y.labelFontProperties,{size:t.createFromPx(o.y.tickLabels)}),r.y2.labelFontProperties=e.FontProperties.inherit(r.y2.labelFontProperties,{size:t.createFromPx(o.y2.tickLabels)})}}a.applyLegacyResponsiveChanges=i}(a=e.CartesianLegacyResponsiveApplier||(e.CartesianLegacyResponsiveApplier={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){e.cartesianResponsiveBreakpoints={legendPositionWidth:210,legendPositionHeight:100,legendHeight:70,legendWidth:80,xAxesHeight:100,yAxesTitleWidth:210,yAxesWidth:100,xAxesTitleHeight:145,iconWidth:50,iconHeight:50};var t=function(){function t(){this.responsiveFontHelper=new e.ResponsiveCartesianFontHelper}return t.prototype.applyChanges=function(t,a,i){var r=e.ViewModelAdapterUtils.getResponsiveVisualProperties(i,e.cartesianChartProps),o=r.responsive,n=r.responsiveLegacy;return(o||n)&&(a=this.applyResponsiveChanges(t,a,o,n)),a},t.prototype.enumerateObjectInstances=function(e,t,a){"general"===e.objectName&&this.enumerateGeneral(t,a)},t.prototype.createCartesianChartLayerViewModelAdapter=function(t){switch(t){case 5:return new e.ColumnChartLayerViewModelAdapter;case 0:return new e.LineChartLayerViewModelAdapter;case 2:return new e.ScatterChartLayerViewModelAdapter;case 3:return new e.WaterfallChartLayerViewModelAdapter}},t.prototype.enumerateGeneral=function(t,a){var i=e.ViewModelAdapterUtils.getResponsiveVisualProperties(a,e.cartesianChartProps);t.pushInstance({selector:null,properties:{responsive:i.responsive},objectName:"general"})},t.prototype.applyResponsiveChanges=function(a,i,r,o){var n=e.ViewModelAdapterUtils.cloneData(i),s=n.legendData.position;return r?(this.applyIconResponsiveChanges(a,n),this.applyLegendResponsiveChanges(a,s,n),this.applyAxesResponsiveChanges(a,n),this.applyFontSizesChanges(a,n),t.applyScrollbarChanges(a,n)):o&&e.CartesianLegacyResponsiveApplier.applyLegacyResponsiveChanges(a,n),this.updateResponsiveWarnings(n.warningObjectCollection,n,i),n},t.prototype.applyIconResponsiveChanges=function(t,a){(t.height<=e.cartesianResponsiveBreakpoints.iconHeight||t.width<=e.cartesianResponsiveBreakpoints.iconWidth)&&(a.showIcon=!0)},t.prototype.applyLegendResponsiveChanges=function(t,a,i){(t.width<e.cartesianResponsiveBreakpoints.legendPositionWidth||t.height<e.cartesianResponsiveBreakpoints.legendPositionHeight)&&e.Legend.isLeftOrRight(a)&&(i.legendData.position=e.LegendPosition.Top),(t.height<e.cartesianResponsiveBreakpoints.legendHeight||t.width<e.cartesianResponsiveBreakpoints.legendWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0},t.applyScrollbarChanges=function(e,a){a.scrollbarOptions=t.ScrollbarOptions},t.prototype.applyAxesResponsiveChanges=function(t,a){t.height<e.cartesianResponsiveBreakpoints.xAxesHeight&&(a.axesData.x.show=!1),t.width<e.cartesianResponsiveBreakpoints.yAxesTitleWidth&&(a.axesData.y.showAxisTitle=!1,a.axesData.y2.showAxisTitle=!1),t.width<e.cartesianResponsiveBreakpoints.yAxesWidth&&(a.axesData.y.show=!1,a.axesData.y2.show=!1),t.height<e.cartesianResponsiveBreakpoints.xAxesTitleHeight&&(a.axesData.x.showAxisTitle=!1)},t.prototype.applyFontSizesChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));var a=t.axesData;a.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.x.labelFontProperties),a.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.x.titleFontProperties),a.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y.labelFontProperties),a.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y.titleFontProperties),a.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y2.labelFontProperties),a.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,a.y2.titleFontProperties)},t.prototype.updateResponsiveWarnings=function(t,a,i){var r={},o=a.legendData,n=i.legendData;if(a.showIcon)r.legend=new e.LegendNotRenderedWarning,r.categoryAxis=new e.AxisAndAxisLabelsNotRenderedWarning,r.valueAxis=new e.AxisAndAxisLabelsNotRenderedWarning;else{o.show!==n.show?r.legend=new e.LegendNotRenderedWarning:o.position!==n.position?r.legend=new e.LegendLocationWarning:_.isEqual(o.fontProperties.size,n.fontProperties.size)||(r.legend=new e.LegendFontSizeWarning);var s=a.axesData,l=i.axesData;s.categoryAxis.show!==l.categoryAxis.show?r.categoryAxis=new e.AxisAndAxisLabelsNotRenderedWarning:s.categoryAxis.showAxisTitle!==l.categoryAxis.showAxisTitle?r.categoryAxis=new e.AxisLabelsNotRenderedWarning:_.isEqual(s.categoryAxis.labelFontProperties.size,l.categoryAxis.labelFontProperties.size)&&_.isEqual(s.categoryAxis.titleFontProperties.size,l.categoryAxis.titleFontProperties.size)||(r.categoryAxis=new e.AxisFontSizeWarning),s.valueAxis.show!==l.valueAxis.show?r.valueAxis=new e.AxisAndAxisLabelsNotRenderedWarning:s.valueAxis.showAxisTitle!==l.valueAxis.showAxisTitle?r.valueAxis=new e.AxisLabelsNotRenderedWarning:_.isEqual(s.valueAxis.labelFontProperties.size,l.valueAxis.labelFontProperties.size)&&_.isEqual(s.valueAxis.titleFontProperties.size,l.valueAxis.titleFontProperties.size)||(r.valueAxis=new e.AxisFontSizeWarning)}for(var c in r){var u=r[c],h={selector:null,warnings:[u]};t.addForVisualObject(c,h)}},t.ScrollbarOptions={scrollbarWidth:8,scrollbarRadius:4,scrollbarClass:"responsive"},t}();e.CartesianViewModelAdapter=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 5},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(t,a);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),this.applySeriesDataLabelFontSizeChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings),this.updateLabelSettings(t,a.dataLabelsSettings)},a.prototype.applySeriesDataLabelFontSizeChanges=function(t,a){for(var i=a.series=e.Prototype.inherit(a.series),r=0;r<i.length;r++)if(i[r].labelSettings){var o=i[r]=e.Prototype.inherit(i[r]);o.labelSettings=e.Prototype.inherit(o.labelSettings),this.updateLabelSettings(t,o.labelSettings)}},a.prototype.updateLabelSettings=function(e,t){var a=t.fontProperties;t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties),a!==t.fontProperties&&(t.labelOverflow=!0)},a}();t.ColumnChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 0},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(t,a);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),this.applySeriesDataLabelFontSizeChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings),this.updateLabelSettings(t,a.dataLabelsSettings)},a.prototype.applySeriesDataLabelFontSizeChanges=function(t,a){for(var i=a.series=e.Prototype.inherit(a.series),r=0;r<i.length;r++)if(i[r].labelSettings){var o=i[r]=e.Prototype.inherit(i[r]);o.labelSettings=e.Prototype.inherit(o.labelSettings),this.updateLabelSettings(t,o.labelSettings)}},a.prototype.updateLabelSettings=function(e,t){t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties)},a}();t.LineChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 2},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings);i&&e.addForVisualObject("categoryLabels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings);var i=a.dataLabelsSettings.fontProperties;a.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(t,i)},a}();t.ScatterChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper}return a.prototype.applyChanges=function(e,a,i){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,t.cartesianChartProps)?this.applyResponsiveChanges(e,a):a},a.prototype.getCartesianChartLayerType=function(){return 3},a.prototype.addWarnings=function(e,t,a){if(t&&a){var i=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings);i&&e.addForVisualObject("labels",i)}},a.prototype.applyResponsiveChanges=function(t,a){var i=e.Prototype.inherit(a);return this.applyDataLabelFontSizesChanges(t,i),i},a.prototype.applyDataLabelFontSizesChanges=function(t,a){a.dataLabelsSettings=e.Prototype.inherit(a.dataLabelsSettings);var i=a.dataLabelsSettings.fontProperties;a.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(t,i)},a}();t.WaterfallChartLayerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=t.AxisDataModel.AxesData,i=e.visuals.DataViewConcatenateUtil,r=e.visuals.controls.SvgScrollbar,o=6,n=function(){function n(e){var a=!1,i=!1,o=!1;this.trimOrdinalDataOnOverflow=!0,this.featureSwitches={},e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.type=e.chartType,this.isLabelInteractivityEnabled=e.isLabelInteractivityEnabled,this.featureSwitches=e.featureSwitches||{},void 0!==e.trimOrdinalDataOnOverflow&&(this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow),e.isScrollable&&(a=e.isScrollable),this.animator=e.animator,e.behavior&&(this.behavior=e.behavior),this.lassoSelectEnabled=e.lassoSelectEnabled,i=e.animateCategoryAxis,o=e.animateValueAxis,this.viewMode=0),this.isCartesianChartVisible=!0,this.axes=new t.CartesianAxes(a,c.ScrollbarWidth,this.trimOrdinalDataOnOverflow),this.svgAxes=new t.SvgCartesianAxes(this.axes),this.svgScrollbar=new r({scrollbarWidth:c.ScrollbarWidth}),this.scrollableAxes=new c(this.axes,this.svgScrollbar,i,o),this.viewModelAdapter=new t.CartesianViewModelAdapter,this.lassoSelectEnabled&&(this.lassoManager=new t.LassoManager),this.dataPointNavigationHelper=new s(this.scrollableAxes),this.axisNavigationHelper=new s(this.scrollableAxes)}return n.shouldYAxisBeCategorical=function(e){switch(e){case 6:case 5:case 7:return!0}return!1},n.prototype.init=function(i){this.visualInitOptions=i,this.layers=[];var r=this.element=i.element;this.visibilityHelper=e.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,n.IconClassName),this.currentViewport=i.viewport,this.hostServices=i.host;var o=this.chartAreaSvg=d3.select(r.get(0)).append("svg");o.classed(n.ClassName,!0),o.style("position","absolute"),this.behavior&&(this.clearCatcher=t.appendClearCatcher(o),this.interactivityService=t.createInteractivityService(this.hostServices),this.lassoSelectEnabled&&(this.lassoManager.init(o),this.lassoSelectionBehavior=new t.LassoSelectionBehavior(this.behavior),this.lassoManager.behaviors.push(this.lassoSelectionBehavior)),this.featureSwitches.axisInteractivity&&(this.axisBehavior=new t.AxisBehavior));var s=this.visualInitOptions.style,l=e.Prototype.inherit(s);l.colorPalette=e.Prototype.inherit(s.colorPalette),l.colorPalette.dataColors=new d(s.colorPalette.dataColors),this.layerStyle=l;var c=a.createDefault(s);this.axes.init({axesData:c,isYAxisCategorical:n.shouldYAxisBeCategorical(this.type),interactivityService:this.interactivityService}),this.svgAxes.init(o,c),this.svgScrollbar.init(o),this.legend=t.createLegend(r,i.interactivity&&i.interactivity.isInteractiveLegend,13!==this.type?this.interactivityService:void 0,this.axes.isScrollable,void 0,s,this.hostServices),this.isMobileChart=i.interactivity&&i.interactivity.isInteractiveLegend,this.tooltipService=t.createTooltipService(i.host),this.viewMode=i.host.getViewMode()},n.prototype.isPlayAxis=function(){if(!this.dataViews||!this.dataViews[0])return!1;var t=this.dataViews[0];return 10===this.type&&(this.animator||this.isMobileChart)&&e.data.DataRoleHelper.hasRoleInDataView(t,"Play")},n.populateObjectProperties=function(e,t,a,i){if(e&&e.length>0){var r=e[0],o=r.metadata;if(o){var s=n.supportsStaticReferenceLines(e,i);t.push.apply(t,n.getStaticReferenceLines(o,a,s))}}},n.getStaticReferenceLines=function(a,i,r){var o=t.ColorHelper.getDataColorByIndex(i,0,t.ForegroundColorName),n=[];if(r){var s=e.DataViewObjects.getUserDefinedObjects(a.objects,"xAxisReferenceLine");n.push.apply(n,t.ReferenceLineHelper.readDataView(s,o,"xAxisReferenceLine",0,i))}var l=e.DataViewObjects.getUserDefinedObjects(a.objects,"y1AxisReferenceLine");return n.push.apply(n,t.ReferenceLineHelper.readDataView(l,o,"y1AxisReferenceLine",1,i)),n},n.getDataBoundReferenceLines=function(a,i,r){var o=[],s=[];if(a)if(a.matrix&&a.matrix.valueSources){var l=a.matrix;if(l.valueSources&&s.push.apply(s,a.matrix.valueSources),l.rows&&l.rows.levels)for(var c=0,u=l.rows.levels;c<u.length;c++){var h=u[c];s.push.apply(s,h.sources)}}else if(a.categorical&&a.categorical.values){var d=_.head(a.categorical.values.grouped());if(d)for(var p=0,g=d.values;p<g.length;p++){var y=g[p];s.push(y.source)}}for(var m=0;m<s.length;m++){var v=s[m],f=t.ColorHelper.getDataColorByIndex(r,m,t.ForegroundColorName),x=e.DataViewObjects.getUserDefinedObjects(v.objects,"referenceLine"),C=n.getCartesianRoleKind(v,i);o.push.apply(o,t.ReferenceLineHelper.readDataView(x,f,"referenceLine",C,r,v))}return o},n.getCartesianRoleKind=function(e,t){var a=e.roles;if(t.getAxisLocationForRole&&a)for(var i in a)if(a[i])return t.getAxisLocationForRole(i);return 1},n.converter=function(i){var r,o=i.dataViews,s=i.layers,l=i.layerStyle,u=i.categoryAxisTitleOnByDefault,h=i.valueAxisTitleOnByDefault,d=i.chartType,p=i.hasDataChanged,g={scrollbarWidth:c.ScrollbarWidth},y=[],m=[],v=!1,f=n.getLayerDataViews(o),x=_.filter(o,t.ForecastHelper.isDataViewForForecast),C=[],S=s.length>1&&!!(o[0]&&o[0].categorical&&o[0].categorical.values),b=l.colorPalette.dataColors;b.clearPreferredScale();for(var D=_.filter(o,t.TrendLineHelper.isDataViewForRegression),w=new t.VisualWarningBuilder,P=0,L=s.length;P<L;P++){var A=f[P],V=s[P],M=A?[A]:[];null!=x[P]&&M.push(x[P]),s[P].setData(M);var I=n.getLegendDataForLayer(V,A,l,S);if(I&&C.push(I),m.push.apply(m,n.getDataBoundReferenceLines(A,s[P],l)),n.supportsTrendLines(o,s,P)){var k=D[P];if(k){var T=P>0,F=t.TrendLineHelper.readDataView(k,A,T,l);y.push.apply(y,F)}}L>1&&b.rotateScale()}r=C.length>1?t.Legend.mergeLegendData(C):1===C.length?C[0]:t.Legend.getDefaultLegendData(l);var N;if(_.isEmpty(o))N=a.createDefault(l);else{var O=o[0],H=o[1],R=O.metadata,B=!1;R&&O.categorical&&!_.isEmpty(O.categorical.categories)&&(B=!!t.ScalarUtils.getScalarKeys(O.categorical.categories[0]));var E=t.CartesianHelper.getCategoryAxisProperties(R,B||u);N=new a({valueAxisProperties:t.CartesianHelper.getValueAxisProperties(R,h),y2AxisProperties:t.CartesianHelper.getValueAxisProperties(R,h,"y2Axis"),categoryAxisProperties:E,isYCategorical:n.shouldYAxisBeCategorical(d),isValueAxisDisabled:!n.supportsValueAxis(o,s),isScatter:10===d,isComboChart:t.ComboChart.isComboChart(d),style:l,hasY2Role:e.data.DataRoleHelper.hasRoleInDataView(O,"Y2")||H&&e.data.DataRoleHelper.hasRoleInDataView(H,"Y2")}),p&&n.populateObjectProperties(o,m,l,s)}return{legendData:r,trendLines:y,referenceLines:m,axesData:N,warningObjectCollection:w,showIcon:v,scrollbarOptions:g}},n.getLegendDataForLayer=function(e,a,i,r){var o;return e.calculateCustomLegend?o=e.calculateCustomLegend():a&&(o=t.Legend.buildSeriesLegendData({dataView:a,showByDefault:!0,staticSeriesRole:e.getStaticSeriesRole(),style:i,allowLegendWithNoSeries:r})),o},n.prototype.updateInternal=function(a,r){var o=this.dataViews=a.dataViews;if(this.currentViewport=a.viewport,this.shouldResetLegendScrollPosition=null==a.resizeMode||a.isInFocus,o){0===this.layers.length&&(this.layers=this.createAndInitLayers());var s,c=this.layers,u=_.some(c,function(e){return e.categoryAxisTitleOnByDefault&&e.categoryAxisTitleOnByDefault()}),h=_.some(c,function(e){return e.valueAxisTitleOnByDefault&&e.valueAxisTitleOnByDefault()});if(null!=r){if(!_.isEmpty(o)){for(var d=n.getLayerDataViews(o),g=void 0,y=0,m=c.length;y<m;y++){var v=d[y];if(null!=v){var f=c[y],x=f.getCartesianVisualCapabilities();this.cartesianVisualCapabilities?this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis=this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis&&x.supportsHierarchicalCategoryAxis:this.cartesianVisualCapabilities=e.Prototype.inherit(x);var C=new l(v,x.supportsHierarchicalCategoryAxis).getRenderModes();g=g?_.intersection(g,C):C}}s=this.categoryAxisRenderMode=_.head(g),2===s&&(o=o.map(function(e){return i.concatenateCategories(e,t.columnChartProps.general.formatString,t.cartesianRoleNames.category)}))}this.cartesianData=this.originalCartesianData=n.converter({layerStyle:this.layerStyle,chartType:this.type,dataViews:o,categoryAxisTitleOnByDefault:u,valueAxisTitleOnByDefault:h,layers:c,featureSwitches:this.featureSwitches,hasDataChanged:null!=r})}if(this.viewModelAdapter&&!_.isEmpty(o)&&this.originalCartesianData&&(this.cartesianData=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalCartesianData,o[0])),null==r&&this.cartesianData&&this.cartesianData.axesData)this.axes.updateResize(this.cartesianData.axesData,this.cartesianData.scrollbarOptions.scrollbarWidth),this.svgAxes.update(this.cartesianData.axesData);else if(null!=r&&!_.isEmpty(o)){var S=o[0];S.metadata&&(this.background={image:e.DataViewObjects.getValue(S.metadata.objects,t.scatterChartProps.plotArea.image),transparency:e.DataViewObjects.getValue(S.metadata.objects,t.scatterChartProps.plotArea.transparency,t.visualBackgroundHelper.getDefaultTransparency())},0===s&&this.loadMoreDataHandler?this.loadMoreDataHandler=null:0===s||this.loadMoreDataHandler||(this.loadMoreDataHandler=new p(null,this.hostServices,n.LoadMoreThreshold))),this.axes.update(S.categorical?S.categorical.categories:null,this.cartesianData.axesData,s,this.cartesianData.scrollbarOptions.scrollbarWidth),this.svgAxes.update(this.cartesianData.axesData)}this.cartesianData&&this.svgScrollbar.updateScrollbarOptions(this.cartesianData.scrollbarOptions),this.loadMoreDataHandler&&null!=r&&this.loadMoreDataHandler.onLoadMoreDataCompleted(),this.render(!this.hasSetData||a.suppressAnimations,a.resizeMode,r),this.hasSetData=this.hasSetData||!_.isEmpty(o),this.cartesianData&&this.updateWarnings(this.cartesianData.warningObjectCollection)}},n.prototype.updateWarnings=function(e){var a;if(!_.isEmpty(this.dataViews)){var i=this.dataViews,r=t.getInvalidValueWarnings(i,!1,!1,!1,["Tooltips"],this.featureSwitches.scatterWithMatrixDV);if(_.isEmpty(r)||e.add.apply(e,r),this.axes.addWarnings(e),this.noLabelsCanBeRendered){var o={selector:null,warnings:[new t.DataLabelsNotRenderedWarning]};e.addForVisualObject("labels",o)}else{e.removeForVisualObject("labels");for(var n=0,s=this.layers;n<s.length;n++){var c=s[n];c.addWarnings&&c.addWarnings(e)}}for(var u=[],h=this.cartesianVisualCapabilities&&this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis,d=0,p=i;d<p.length;d++){new l(p[d],h).addObjectWarnings(u)}_.isEmpty(u)||(a=this.cartesianData.warningObjectCollection).addForVisualObject.apply(a,["categoryAxis"].concat(u)),this.hostServices.setWarnings(this.cartesianData.warningObjectCollection.complete())}},n.prototype.update=function(t){null!=t.resizeMode?this.updateInternal(t):this.updateInternal(t,null!=t.operationKind?t.operationKind:e.VisualDataChangeOperationKind.Create)},n.prototype.onViewModeChanged=function(e){this.viewMode=e},n.prototype.bindTouchEvents=function(e,t){var a=this,i={x:0,y:0};t.on("touchstart",function(){if(0===a.viewMode&&(e.isXScrollBarVisible||e.isYScrollBarVisible)){var t=d3.event,r=t.changedTouches[0];i.x=r.pageX,i.y=r.pageY}}),t.on("touchmove",function(){var t=a.hostServices&&a.hostServices.tooltips();if(!(0!==a.viewMode||!e.isXScrollBarVisible&&!e.isYScrollBarVisible||t&&t.isTouchScreenOptimizedEnabled()&&t.visible())){a.tooltipService.hide();var r=d3.event,o=r.changedTouches[0],n=i.x-o.pageX,s=i.y-o.pageY,l=e.isXScrollBarVisible?n:s;a.scrollableAxes.scrollDelta(l),i.x=o.pageX,i.y=o.pageY,r.preventDefault()}})},n.prototype.bindScrollWheelEvents=function(e,t){var a=this;t.on("wheel",function(){if(e.isXScrollBarVisible||e.isYScrollBarVisible){a.tooltipService.hide();var t=d3.event,i=t.deltaX,r=t.deltaY,o=Math.abs(i)>Math.abs(r)?i:r;a.scrollableAxes.scrollDelta(o),t.preventDefault()}})},n.prototype.scrollTo=function(e){this.scrollableAxes.scrollTo(e)},n.prototype.enumerateObjectInstances=function(e){var a=new t.ObjectEnumerationBuilder,i=this.layers?this.layers.length:0;if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;for(var r={enumeration:a,legendData:this.originalCartesianData.legendData},o=0,s=this.layers;o<s.length;o++){var l=s[o];l.enumerateCustomLegend?l.enumerateCustomLegend(r):t.Legend.enumerate(r)}}else"categoryAxis"===e.objectName&&this.axes.hasCategoryAxis()?this.enumerateCategoryAxis(a):"valueAxis"===e.objectName?this.enumerateValueAxis(a):"y2Axis"===e.objectName?this.featureSwitches.lineChartDualAxis&&this.enumerateValueAxis(a,"y2Axis"):"y1AxisReferenceLine"===e.objectName?this.enumerateReferenceLines(a,e.objectName):"xAxisReferenceLine"===e.objectName?n.supportsStaticReferenceLines(this.dataViews,this.layers)&&this.enumerateReferenceLines(a,e.objectName):"referenceLine"===e.objectName?n.supportsDataBoundReferenceLines(this.dataViews,this.layers)&&this.enumerateReferenceLines(a,e.objectName):"trend"===e.objectName?n.supportsTrendLines(this.dataViews,this.layers)&&t.TrendLineHelper.enumerateObjectInstances(a,this.originalCartesianData.trendLines,this.layerStyle):"plotArea"===e.objectName&&t.visualBackgroundHelper.enumeratePlot(a,this.background);if("dataPoint"===e.objectName&&t.ComboChart.isComboChart(this.type))t.ComboChart.enumerateDataPoints(a,e,this.layers);else for(var c=0,u=i;c<u;c++){var l=this.layers[c];l.enumerateObjectInstances&&l.enumerateObjectInstances(a,e)}if(this.dataViews&&this.dataViews[0]){var h=this.dataViews[0];this.viewModelAdapter.enumerateObjectInstances(e,a,h)}return a.complete()},n.prototype.enumerateReferenceLines=function(e,a){var i=t.ColorHelper.getDataColorByIndex(this.layerStyle,0,t.ForegroundColorName),r=_.filter(this.originalCartesianData.referenceLines,function(e){return e.type===a});t.ReferenceLineHelper.enumerateObjectInstances(e,r,i,a,this.originalCartesianData.axesData.isValueAxisDisabled)},n.supportsTrendLines=function(e,t,a){return n.allLayerSupports(function(e){return e.supportsTrendLine&&e.supportsTrendLine()},e,t,a)},n.supportsValueAxis=function(e,t,a){return n.allLayerSupports(function(e){var t=e.getCartesianVisualCapabilities().supportsValueAxis;return void 0===t||t},e,t,a)},n.supportsDataBoundReferenceLines=function(e,t,a){return n.allLayerSupports(function(e){return!e.isStacked||!e.isStacked()},e,t,a)},n.supportsStaticReferenceLines=function(e,t,a){return n.allLayerSupports(function(e){return!e.supportsStaticReferenceLines||e.supportsStaticReferenceLines()},e,t,a)},n.allLayerSupports=function(e,t,a,i){var r=n.getLayerDataViews(t);if(_.isEmpty(a))return!1;var o=null==i?a:[a[i]];return _.every(o,function(t,a){return!r[a]||e(t)})},n.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var a=e.length,i=0,r=0;r<a;r++){if(e[r].hasLegend())return!0;var o=t[r];if(o&&o.categorical&&o.categorical.values&&o.categorical.values.length>0&&(i++,i>1))return!0}return!1},n.prototype.getAxisScaleOptions=function(e,a){void 0===e&&(e=!1),void 0===a&&(a=!1);var i,r=this.axes.isYAxisCategorical;i=e?r?0:a?2:1:r?1:0;var o=[t.DEFAULT_AXIS_SCALE_TYPE];return this.axes.isLogScaleAllowed(i)&&o.push(t.axisScale.log),o},n.prototype.enumerateCategoryAxis=function(e){if(this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isCategoryAxisSet){var a=this.originalCartesianData.axesData.categoryAxis,i=t.cartesianChartProps.categoryAxis,r=3===this.categoryAxisRenderMode,o=r?t.axisType.categorical:t.axisType.both,n=!1,s=this.getAxisScaleOptions(!1);o===t.axisType.both&&this.layers&&this.layers[0].getSupportedCategoryAxisType&&(o=this.layers[0].getSupportedCategoryAxisType(),o===t.axisType.scalar?n=!0:(n=t.CartesianHelper.isScalar(o===t.axisType.both,a),n&&(n=this.layers&&this.layers[0].getVisualCategoryAxisIsScalar?this.layers[0].getVisualCategoryAxisIsScalar():0===this.categoryAxisRenderMode)));var l={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s,axisStyle:this.axes.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]},propertyTypes:{}};if(l.properties[i.show.propertyName]=a.show,this.axes.isYAxisCategorical&&(l.properties[i.position.propertyName]=a.position),o===t.axisType.both&&(l.properties[i.axisType.propertyName]=n?t.axisType.scalar:t.axisType.categorical),n&&(l.properties[i.axisScale.propertyName]=a.axisScale,l.properties[i.start.propertyName]=a.start,l.properties[i.end.propertyName]=a.end),l.properties[i.labelColor.propertyName]=t.AxisDataModel.toColorFill(a.labelFontProperties.color),l.properties[i.fontSize.propertyName]=a.labelFontProperties.size.pt,l.properties[i.fontFamily.propertyName]=a.labelFontProperties.family,n){l.properties[i.labelDisplayUnits.propertyName]=a.labelDisplayUnits,l.properties[i.labelPrecision.propertyName]=a.labelPrecision;var c={numberRange:{min:0,max:t.dataLabelUtils.MaxLabelPrecision}};l.validValues[i.labelPrecision.propertyName]=c}if(this.axes.isCategoryAxisDateTime()?(l.propertyTypes[i.start.propertyName]={dateTime:!0},l.propertyTypes[i.end.propertyName]={dateTime:!0}):(l.propertyTypes[i.start.propertyName]={numeric:!0},l.propertyTypes[i.end.propertyName]={numeric:!0}),n||(l.properties[i.preferredCategoryWidth.propertyName]=a.preferredCategoryWidth,l.properties[i.maxMarginFactor.propertyName]=Math.round(100*a.maxMarginFactor),l.validValues[i.maxMarginFactor.propertyName]={numberRange:{min:15,max:50},unitSymbol:"Slider_Percent"},9!==this.type&&(l.properties[i.innerPadding.propertyName]=Math.round(100*a.innerPadding),l.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:"Slider_Percent"})),this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis&&!n){var u=i.concatenateLabels.propertyName;l.properties[u]=a.concatenateLabels}l.properties[i.showAxisTitle.propertyName]=a.showAxisTitle,l.properties[i.showAxisTitle.propertyName]&&(l.properties[i.axisStyle.propertyName]=a.axisStyle,l.properties[i.titleColor.propertyName]=t.AxisDataModel.toColorFill(a.titleFontProperties.color),l.properties[i.titleText.propertyName]=a.titleText,l.properties[i.titleFontSize.propertyName]=a.titleFontProperties.size.pt,l.properties[i.titleFontFamily.propertyName]=a.titleFontProperties.family),(n||r)&&(l.properties[i.gridlineShow.propertyName]=a.gridlineShow,a.gridlineShow&&(l.properties[i.gridlineColor.propertyName]=t.AxisDataModel.toColorFill(a.gridlineColor),l.properties[i.gridlineThickness.propertyName]=a.gridlineThickness,l.validValues.gridlineThickness=["1","2","3","4"],l.properties[i.gridlineStyle.propertyName]=a.gridlineStyle)),
e.pushInstance(l)}},n.prototype.enumerateValueAxis=function(e,a){if(void 0===a&&(a="valueAxis"),this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isValueAxisSet&&!this.originalCartesianData.axesData.isValueAxisDisabled&&("y2Axis"!==a||2!==this.type)){var i={numberRange:{min:0,max:t.dataLabelUtils.MaxLabelPrecision}},r=this.originalCartesianData.axesData.valueAxis,o="y2Axis"===a,n=t.cartesianChartProps.valueAxis,s=this.getAxisScaleOptions(!0),l=this.getAxisScaleOptions(!0,!0),c={selector:null,properties:{},objectName:a,validValues:{axisScale:s,secAxisScale:l,axisStyle:this.axes.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly],secAxisStyle:this.axes.secondaryValueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]},propertyTypes:{}};o||(c.properties[n.show.propertyName]=r.show,c.properties[n.axisLabel.propertyName]=r.axisLabel,this.axes.isYAxisCategorical||(c.properties[n.position.propertyName]=r.position),c.properties[n.axisScale.propertyName]=r.axisScale,c.properties[n.start.propertyName]=r.start,c.properties[n.end.propertyName]=r.end,c.propertyTypes[n.start.propertyName]={numeric:!0},c.propertyTypes[n.end.propertyName]={numeric:!0},c.properties[n.labelColor.propertyName]=t.AxisDataModel.toColorFill(r.labelFontProperties.color),c.properties[n.fontSize.propertyName]=r.labelFontProperties.size.pt,c.properties[n.fontFamily.propertyName]=r.labelFontProperties.family,7!==this.type&&8!==this.type&&(c.properties[n.labelDisplayUnits.propertyName]=r.labelDisplayUnits,c.properties[n.labelPrecision.propertyName]=r.labelPrecision,c.validValues[n.labelPrecision.propertyName]=i),c.properties[n.showAxisTitle.propertyName]=r.showAxisTitle,c.properties[n.showAxisTitle.propertyName]&&(c.properties[n.axisStyle.propertyName]=r.axisStyle,c.properties[n.titleColor.propertyName]=t.AxisDataModel.toColorFill(r.titleFontProperties.color),c.properties[n.titleText.propertyName]=r.titleText,c.properties[n.titleFontSize.propertyName]=r.titleFontProperties.size.pt,c.properties[n.titleFontFamily.propertyName]=r.titleFontProperties.family),c.properties[n.gridlineShow.propertyName]=r.gridlineShow,r.gridlineShow&&(c.properties[n.gridlineColor.propertyName]=t.AxisDataModel.toColorFill(r.gridlineColor),c.properties[n.gridlineThickness.propertyName]=r.gridlineThickness,c.validValues.gridlineThickness=["1","2","3","4"],c.properties[n.gridlineStyle.propertyName]=r.gridlineStyle));var u=this.originalCartesianData.axesData.y2;o?c.properties[n.show.propertyName]=u.show:c.properties[n.secShow.propertyName]=u.show,(o||t.ComboChart.isComboChart(this.type)&&u.show)&&(o||(c.properties[n.alignZeros.propertyName]=r.alignZeros,c.properties.secAxisLabel="",c.properties[n.secPosition.propertyName]=u.position),c.properties[n.secAxisScale.propertyName]=u.axisScale,c.properties[n.secStart.propertyName]=u.start,c.properties[n.secEnd.propertyName]=u.end,c.propertyTypes[n.secStart.propertyName]={numeric:!0},c.propertyTypes[n.secEnd.propertyName]={numeric:!0},c.properties[n.secLabelColor.propertyName]=t.AxisDataModel.toColorFill(u.labelFontProperties.color),c.properties[n.secFontSize.propertyName]=u.labelFontProperties.size.pt,c.properties[n.secFontFamily.propertyName]=u.labelFontProperties.family,c.properties[n.secLabelDisplayUnits.propertyName]=u.labelDisplayUnits,c.properties[n.secShowAxisTitle.propertyName]=u.showAxisTitle,c.properties[n.secLabelPrecision.propertyName]=u.labelPrecision,c.validValues[n.secLabelPrecision.propertyName]=i,c.properties[n.secShowAxisTitle.propertyName]&&(c.properties[n.secAxisStyle.propertyName]=u.axisStyle,c.properties[n.secTitleColor.propertyName]=t.AxisDataModel.toColorFill(u.titleFontProperties.color),c.properties[n.secTitleText.propertyName]=u.titleText,c.properties[n.secTitleFontSize.propertyName]=u.titleFontProperties.size.pt,c.properties[n.secTitleFontFamily.propertyName]=u.titleFontProperties.family)),e.pushInstance(c)}},n.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;e<t;e++){var a=this.layers[e];a.onClearSelection(),a.render(!0)}},n.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},n.prototype.createAndInitLayers=function(){var t=this,a=new h(this.viewModelAdapter),i=a.createLayers({type:this.type,interactivityService:this.interactivityService,animator:this.animator,isScrollable:this.axes.isScrollable,tooltipsEnabled:this.tooltipsEnabled,featureSwitches:this.featureSwitches}),r=e.Prototype.inherit(this.visualInitOptions);r.svg=this.svgAxes.getScrollableRegion(),r.labelsContext=this.svgAxes.getLabelsRegion(),r.cartesianHost={updateLegend:function(e){return t.legend.drawLegend(e,t.currentViewport,t.shouldResetLegendScrollPosition)},triggerRender:function(e){return t.render(e)}},r.chartType=this.type,r.services={tooltips:this.tooltipService},r.style=this.layerStyle;for(var o=0,n=i.length;o<n;o++)i[o].init(r);return i},n.prototype.renderLegend=function(){var a=e.Prototype.inherit(this.cartesianData.legendData);null!=a.position?this.legend.changeOrientation(a.position):this.legend.changeOrientation(t.LegendPosition.Top),1!==a.dataPoints.length||a.grouped||(a.dataPoints=[]),this.legend.drawLegend(a,this.currentViewport,this.shouldResetLegendScrollPosition)},n.prototype.isSideLegendExists=function(){return this.legend.isVisible()&&t.Legend.isLeftOrRight(this.legend.getOrientation())},n.prototype.render=function(e,t,a){this.cartesianData&&(this.cartesianData.showIcon?this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon,viewport:this.currentViewport}):(this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon}),this.renderCartesianChart(e,t,a)))},n.prototype.renderCartesianChart=function(a,i,r){var o=this;this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend();var s,l=this.legendMargins=this.legend.getMargins(),c=this.legend.getOrientation(),u=this.showAxisTitles(this.cartesianData.axesData),h=this.shouldRenderAxis(this.cartesianData.axesData),d=this.getAxesFontProperties(),p={height:this.currentViewport.height-l.height,width:this.currentViewport.width-l.width},g=e.Prototype.inherit(t.SvgCartesianAxes.AxisPadding);this.isPlayAxis()&&(p.height-=n.PlayAxisBottomMargin,s={left:t.Legend.isLeft(c)?l.width:0,top:t.Legend.isTop(c)?l.height+p.height:p.height,height:n.PlayAxisBottomMargin,width:p.width}),this.chartAreaSvg.attr({width:p.width,height:p.height}),t.Legend.positionChartArea(this.chartAreaSvg,this.legend);var y=this.calculateInteractivityRightMargin(),m=this.getMinimumDomainExtents(),v=m[0],f=m[1],x=m[2],C=!this.renderedPlotArea||this.renderedPlotArea.height!==p.height||this.renderedPlotArea.width!==p.width;a=a||C;var S=this.axes.negotiateAxes(this.layers,p,g,s,u,h,d,y,v,f,x),b=S.axes.x.isCategoryAxis?S.axes.x:S.axes.y1;if(this.loadMoreDataHandler&&this.loadMoreDataHandler.setScale(b.scale),this.lassoSelectionBehavior&&this.lassoSelectionBehavior.update(S),this.renderedPlotArea=p,!(S.plotArea.width<1||S.plotArea.height<1)){var D=this.layers,w=function(e,t,a,r,n){return o.renderPlotArea(e,t,a,l,d,i,r,n)},P=this.loadMoreDataHandler,L=r===e.VisualDataChangeOperationKind.Append||null!=i;this.scrollableAxes.render(S,D,a,w,P,L),this.bindScrollWheelEvents(S,this.chartAreaSvg),this.bindTouchEvents(S,this.chartAreaSvg)}},n.prototype.getMinimumDomainExtents=function(){var e=[],a=[],i=[];return t.ReferenceLineHelper.gatherDomainExtents(this.cartesianData.referenceLines,e,a,i),[{min:d3.min(e),max:d3.max(e)},{min:d3.min(a),max:d3.max(a)},{min:d3.min(i),max:d3.max(i)}]},n.prototype.getPlotAreaRect=function(e,a){var i={left:e.margin.left,top:e.margin.top,width:e.plotArea.width,height:e.plotArea.height};if(this.legend){var r=this.legend.getOrientation();t.Legend.isTop(r)?i.top+=a.height:t.Legend.isLeft(r)&&(i.left+=a.width)}return i},n.prototype.renderBackgroundImage=function(e){t.visualBackgroundHelper.renderBackgroundImage(this.background,this.element,e)},n.prototype.showAxisTitles=function(e){return{x:e.x.showAxisTitle,y:e.y.showAxisTitle,y2:e.y2.showAxisTitle}},n.prototype.shouldRenderAxis=function(e){return{x:e.x.show,y:e.y.show,y2:e.y2.show||t.ComboChart.isComboChart(this.type)&&e.y2.show!==!1}},n.prototype.getAxesFontProperties=function(){var e=this.cartesianData.axesData.x,t={tickLabels:e.labelFontProperties,title:e.titleFontProperties},a=this.cartesianData.axesData.y,i={tickLabels:a.labelFontProperties,title:a.titleFontProperties},r=this.cartesianData.axesData.y2;return{x:t,y:i,y2:{tickLabels:r.labelFontProperties,title:r.titleFontProperties}}},n.prototype.calculateInteractivityRightMargin=function(){return this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend&&!this.trimOrdinalDataOnOverflow?o:0},n.prototype.renderPlotArea=function(e,a,i,r,o,n,s,l){i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});var c=a.axes,u=a.plotArea,h=this.getPlotAreaRect(a,r),d=t.AnimatorCommon.GetAnimationDuration(this.animator,i),p=this.animator&&this.animator.getEasing();this.renderBackgroundImage(h);var g=this.svgAxes.renderAxes({axesLayout:a,duration:d,axesFontProperties:o,animateCategoryAxis:s,animateValueAxis:l,easing:_.isEmpty(p)?void 0:p});if(g&&g.navigationOptions&&this.axisBehavior){var y=g.navigationOptions;this.axisNavigationHelper.clearNavigationLayers(),this.axisNavigationHelper.addNavigationLayer(y.helper);var m={isAxis:!0,navigationOptions:{helper:this.axisNavigationHelper,navigationStrategy:y.navigationStrategy}};this.axisNavigationHelper.getPendingFocusElement&&(m.navigationOptions.focusElement=this.axisNavigationHelper.getPendingFocusElement(),this.axisNavigationHelper.getPendingFocusElement=void 0),this.interactivityService.bind(g.dataPoints,this.axisBehavior,g.behaviorOptions,m),this.axisBehavior.renderSelection(this.interactivityService.hasSelection())}this.renderReferenceLines(a),this.renderLayers(e,u,c,i,n),this.renderTrendLines(a)},n.prototype.renderTrendLines=function(e){var a=this.svgAxes.getScrollableRegion();t.TrendLineHelper.render(this.cartesianData.trendLines,a,e.axes,e.plotArea)},n.prototype.renderReferenceLines=function(e){var a={graphicContext:this.svgAxes.getScrollableRegion(),axes:e.axes,viewport:e.plotArea,referenceLines:this.cartesianData.referenceLines};t.ReferenceLineHelper.render(a)},n.prototype.getReferenceLineLabels=function(e,a){var i={axes:e,viewport:a,referenceLines:this.cartesianData.referenceLines,hostServices:this.hostServices,style:this.layerStyle};return t.ReferenceLineHelper.createLabelDataPoint(i)},n.prototype.renderDataLabels=function(a,i,r,o,n,s){var l=this.svgAxes.getLabelBackground(),c=this.svgAxes.getLabelsRegion(),u=[];if(this.behavior){var h=t.LabelUtils.getDataLabelLayoutOptions(this.type),d=new e.LabelLayout(h);u=d.layout(a,r);var p=void 0,g=this.animator;if(g&&!o&&s){var y=this.isPlayAxis(),m=y?t.PlayChart.FrameAnimationDuration:g.getDuration();p=t.NewDataLabelUtils.animateLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),duration:m,numeric:i,easeType:y?"linear":g.getEasing(),backgroundContext:l})}else p=t.NewDataLabelUtils.drawLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),numeric:i,backgroundContext:l});if(h.allowLeaderLines){var v=_.filter(u,function(e){return null!=e.leaderLinePoints&&!_.isEmpty(e.leaderLinePoints)&&null!=e.identity});t.LabelUtils.drawLabelLeaderLines(c,v,function(e){return e.identity.getKey()})}if(this.interactivityService&&this.isLabelInteractivityEnabled){var f={labelItems:p};this.interactivityService.bind(u,new t.LabelsBehavior,f,{isLabels:!0})}}else{var d=new e.LabelLayout({maximumOffset:t.LabelUtils.maxLabelOffset,startingOffset:t.LabelUtils.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0});u=d.layout(a,r),t.NewDataLabelUtils.drawLabelsAndBackgrounds({labelContext:c,dataLabels:t.LabelUtils.downgradeToOldLabels(u),numeric:i,backgroundContext:l})}for(var x,C=0,S=a;C<S.length;C++){var b=S[C];if(!_.isEmpty(b.labelDataPoints)){x=!0;break}}return!_.isEmpty(u)||!x},n.prototype.renderLayers=function(e,a,i,r,o){var n,s=[],l=[],c=[],u=!0;r=r||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});for(var h=!0,d=0,p=e;d<p.length;d++){var g=p[d],y=g.render(r,o);if(y){if(y.animateLabels||(h=!1),this.behavior&&(l=l.concat(y.dataPoints),c.push(y.behaviorOptions),y.navigationOptions&&(n?n.navigationOptions.navigationStrategy=t.DataPointNavigationStrategy.CategoryFirst:(n={navigationOptions:{navigationStrategy:y.navigationOptions.navigationStrategy,helper:this.dataPointNavigationHelper}},this.dataPointNavigationHelper.clearNavigationLayers()),this.dataPointNavigationHelper.addNavigationLayer(y.navigationOptions.helper))),y.labelDataPointGroups)for(var m=y.labelDataPointGroups,v=0,f=m;v<f.length;v++){var x=f[v];x&&s.push({labelDataPoints:t.LabelUtils.removeDuplicates(x.labelDataPoints||[]),maxNumberOfLabels:x.maxNumberOfLabels,labelOrientation:y.labelOrientation})}else{var C=y.labelDataPoints||[];s.push({labelDataPoints:t.LabelUtils.removeDuplicates(C),maxNumberOfLabels:C.length,labelOrientation:y.labelOrientation})}u=u&&y.labelsAreNumeric}}var S=this.getReferenceLineLabels(i,a);if(_.isEmpty(S)||s.unshift({labelDataPoints:S,maxNumberOfLabels:S.length}),this.noLabelsCanBeRendered=!this.renderDataLabels(s,u,a,r,t.ComboChart.isComboChart(this.type),h),this.dataPointNavigationHelper.getPendingFocusElement&&n&&(n.navigationOptions.focusElement=this.dataPointNavigationHelper.getPendingFocusElement(),this.dataPointNavigationHelper.getPendingFocusElement=void 0),this.interactivityService){var b={layerOptions:c,clearCatcher:this.clearCatcher,root:this.chartAreaSvg};this.interactivityService.bind(l,this.behavior,b,n)}},n.getPreferredPlotArea=function(e,t,a,i,r,o,s){o||(o={top:0,right:0,bottom:0,left:0});var l={height:a.height-o.top-o.bottom,width:a.width-o.left-o.right};if(!r&&i){var c=n.getPreferredCategorySpan(e,t,s);l.width=Math.max(c,l.width)}return l},n.getPreferredCategorySpan=function(e,t,a){return t*e+t*(a||0)*2},n.getLayout=function(t,a){var i=a.categoryCount,r=a.availableWidth,o=!!a.isScalar,s=!!a.isScrollable,l=n.getCategoryWidth(t?t.series:null,a),c=n.getCustomizedCategoryWidthInfo(l,a),u=c.categoryWidth,h=c.outerPaddingRatio,d=u*h*2,p=e.Double.floorWithPrecision((r-d)/u),g=Math.min(p,i),y=g<i&&s;if(!o&&!y){var m=(r-u*g)/2;h=Math.max(0,m/u),h=e.Double.equalWithPrecision(h,0)?0:h}return!o&&s&&(g=i),{categoryCount:g,categoryThickness:u,outerPaddingRatio:h,innerPaddingRatio:a.innerPaddingRatio,isScalar:o}},n.getCustomizedCategoryWidthInfo=function(e,t){var a=e,i=t.categoryCount,r=t.availableWidth,o=t.isScalar,n=t.preferredCategoryWidth,s=t.outerPaddingRatio;if(o||null==n||n<e)return{categoryWidth:a,outerPaddingRatio:s};var l=Math.floor((r-n*s*2)/n);return l<=0?a=r/(1+2*s):l<i?(s=(r-n*l)/(2*n),a=n):a=Math.min(n,r),{categoryWidth:a,outerPaddingRatio:s}},n.getCategoryWidth=function(e,a){var i,r=a.categoryCount,o=a.availableWidth,s=a.domain,l=a.isScalar,c=a.trimOrdinalDataOnOverflow,u=a.outerPaddingRatio;if(r<2)i=o*(1-u);else if(l&&s&&s.length>1){var h=n.getMinInterval(e),d=s[s.length-1]-s[0],p=h/(d+h*u*2);i=o*p,i=Math.max(i,n.MinScalarRectThickness)}else i=o/(r+2*u),c&&(i=Math.max(i,t.CartesianHelper.MinOrdinalRectThickness));var g=o/(3+2*u);return i=Math.min(i,g),!l&&r>=3&&c?Math.max(i,t.CartesianHelper.MinOrdinalRectThickness):i},n.getMinInterval=function(e){var t=Number.MAX_VALUE;if(e.length>0)for(var a=e[0].data.filter(function(e){return!e.highlight}),i=0,r=a.length-1;i<r;i++)t=Math.min(t,Math.abs(a[i+1].categoryValue-a[i].categoryValue));return t},n.getLayerDataViews=function(e){return _.isEmpty(e)?[]:_.filter(e,function(e){return!t.TrendLineHelper.isDataViewForRegression(e)&&!t.ForecastHelper.isDataViewForForecast(e)})},n.MinScalarRectThickness=2,n.LoadMoreThreshold=1,n.xAxisSmallFontSizeInPx=9,n.yAxisSmallFontSizeInPx=9,n.yAxisMediumFontSizeInPx=11,n.ClassName="cartesianChart",n.IconClassName="cartesianChartResponsiveIcon",n.PlayAxisBottomMargin=80,n}();t.CartesianChart=n;var s=function(){function e(e){this.scrollableAxes=e,this.navigationLayers=[],this.currentNavigationLayerIndex=0}return e.prototype.clearNavigationLayers=function(){this.navigationLayers=[]},e.prototype.addNavigationLayer=function(e){this.navigationLayers.push(e)},e.prototype.getFirstElement=function(){return this.currentNavigationLayerIndex=0,this.navigationLayers[this.currentNavigationLayerIndex].getFirstElement()},e.prototype.getNextDataPoint=function(e,a,i){var r=this,o=this.navigationLayers[this.currentNavigationLayerIndex],n=o.getNextDataPoint(e,a,i),s=this.navigationLayers.length;if(s>1&&n.targetCategoryIndex!==e){var l=e,c=0;do switch(i){case t.DataDirection.NextSeries:case t.DataDirection.PreviousSeries:var u=i===t.DataDirection.NextSeries,h=u?1:-1;this.currentNavigationLayerIndex+=h,this.currentNavigationLayerIndex>=s||this.currentNavigationLayerIndex<0?(this.currentNavigationLayerIndex=this.currentNavigationLayerIndex<0?s-1:0,o=this.navigationLayers[this.currentNavigationLayerIndex],n.element=o.getFirstElement(n.targetCategoryIndex,!u),l=n.targetCategoryIndex,c++):(o=this.navigationLayers[this.currentNavigationLayerIndex],n.element=o.getFirstElement(l,!u));break;case t.DataDirection.NextCategory:case t.DataDirection.PreviousCategory:c=s;break;default:debug.assertNever(i)}while(!n.element&&c<s)}if(!n.element&&null!=n.targetCategoryIndex){this.getPendingFocusElement=function(){var t=o.getNextDataPoint(e,a,i).element;if(!t){var n=r.currentNavigationLayerIndex;do r.currentNavigationLayerIndex++,r.currentNavigationLayerIndex>=r.navigationLayers.length&&(r.currentNavigationLayerIndex=0),t=r.navigationLayers[r.currentNavigationLayerIndex].getNextDataPoint(e,a,i).element;while(!t&&r.currentNavigationLayerIndex!==n)}return t};var d=n.targetCategoryIndex-e;d<0?this.scrollableAxes.scrollTo(n.targetCategoryIndex):this.scrollableAxes.scrollBy(d)}return n},e}();t.CartesianChartNavigationHelper=s;var l=function(){function a(e,t){this.processDataView(e,t)}return a.prototype.processDataView=function(i,r){if(this.renderModes=[],!i||!i.metadata||!i.categorical||_.isEmpty(i.categorical.categories))return void this.renderModes.push(2);var o=i.metadata,n=i.categorical.categories,s=_.head(n),l=t.ScalarUtils.getScalarKeys(s),c=t.CartesianHelper.hasCategoryHierarchy(i),u=t.ScalarUtils.shouldDrawScalar(o.objects,t.columnChartProps.categoryAxis.axisType,s.source.type,l,c);if(c){var h=a.areNonLeafLevelsFilteredToUniqueValue(n),d=e.DataViewObjects.getValue(o.objects,t.cartesianChartProps.categoryAxis.concatenateLabels,t.CartesianHelper.DefaultConcatenateLabelsValue);if(h&&d)this.renderModes.unshift(1);else{var p=a.isSortedByCategoryFirst(i),g=_.some(i.categorical.categories,function(e){return e.source&&e.source.identityExprs}),y=r&&!d&&g&&(p||h);this.renderModes.unshift(2),y&&this.renderModes.unshift(3),d||g||(this.warnings=[{selector:null,warnings:[new t.NoIdentityExprWarning]}])}u&&this.renderModes.unshift(0)}else this.renderModes.unshift(1),u&&this.renderModes.unshift(0)},a.prototype.getRenderMode=function(){return _.head(this.renderModes)},a.prototype.getRenderModes=function(){return this.renderModes},a.prototype.addObjectWarnings=function(e){this.warnings&&e.push.apply(e,this.warnings)},a.isSortedByCategoryFirst=function(e){return!(!e||!e.categorical||_.isEmpty(e.categorical.categories)||!e.metadata||_.isEmpty(e.metadata.columns))&&_.every(e.categorical.categories,function(e,t){var a=e.source;return a&&null!=a.sort&&a.sortOrder===t})},a.areNonLeafLevelsFilteredToUniqueValue=function(a){if(_.isEmpty(a))return!1;for(var i=a.length-1,r=0;r<i;r++){var o=a[r].source;if(!o||!e.DataViewObjects.getValue(o.objects,t.cartesianChartProps.filters.filteredToUniqueValue,!1))return!1}return!0},a}();t.CartesianAxisRenderModeSelector=l;var c=function(){function a(e,t,a,i){this.cartesianAxes=e,this.scrollbar=t,this.animateCategoryAxis=a,this.animateValueAxis=i}return a.filterDataToViewport=function(e){if(e&&e.scrollScale){var i,r=e.scrollScale,o=e.mainAxisScale,n=t.AxisHelper.invertOrdinalScale(r,e.extent.start),s=n+e.visibleCategoryCount;if(i=r.domain().slice(n,s),!_.isEqual(i,o.domain())){if(i&&i.length>0){for(var l=e.layers,c=0,u=l;c<u.length;c++){u[c].setFilteredData(i[0],i[i.length-1]+1)}o.domain(i);var h=e.axesLayout.axes,d=void 0;d=e.axesLayout.isXScrollBarVisible?h.x:h.y1,d.axis.scale(o),d.scale(o),d.axis.ticks(i.length),d.axis.tickValues(i);var p=t.SvgCartesianAxes.getTickFormatter(d.axis);if(d.values=_.map(i,function(e){return p(e)}),!_.isEmpty(h.xStack))for(var g=e.axesLayout.tickLabelMargins,y=t.CartesianAxes.getLeafHeight(g.xMax,g.stackHeight,h.xStack.length),m=function(e){var r=h.xStack[e],o=t.AxisHelper.getCategoryThickness(r.scale),n=r.values,s=a.setLabelsAtEdges(i,n);if(r.axis.ticks(i.length).tickValues(i).tickFormat(function(e){var a=n[s[i.indexOf(e)]];return a===t.CartesianAxes.hierarchyPlaceholder?"":_.isString(a)?a:a+""}),0===e)return"continue";for(var l=[],c=[],u=[],d=void 0,p=0;p<s.length;p++){var m=i[p],v=s[p];if(r.values[v]!==t.CartesianAxes.hierarchyPlaceholder){if(null!=d){var f=m-d;l[d]=t.CartesianAxes.getMaxCategoryWidth(f,o),c[d]=t.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:g.stackHeight,leafHeight:y,categorySpanCount:f,categoryWidth:o})}u[m]=n[v],d=m}else u[m]=t.CartesianAxes.hierarchyPlaceholder}if(null!=d){var f=i[s.length-1]-d+1;l[d]=t.CartesianAxes.getMaxCategoryWidth(f,o),c[d]=t.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:g.stackHeight,leafHeight:y,categorySpanCount:f,categoryWidth:o})}r.xLabelMaxWidths=l,r.lineStyleInfo=c,r.adjustedValues=u},v=0;v<h.xStack.length;v++)m(v)}return{startIndex:n,endIndex:s-1}}}},a.prototype.render=function(t,i,r,o,n,s){var l=this,c=t.plotArea;this.axisScale=null;var h,d,p,g,y,m,v,f,x=t.isXScrollBarVisible||t.isYScrollBarVisible;if(n||x)if(this.cartesianAxes.isYAxisCategorical){this.axisScale=t.axes.y1.scale,h=t.viewport.width,d=t.margin.top,y=t.axes.y1.categoryThickness,m=t.axes.y1.outerPaddingRatio,v=t.axes.y1.innerPaddingRatio;var C=y*m;f=c.height,g=Math.max(1,e.Double.floorWithPrecision((f-2*C)/y)),p=f}else{this.axisScale=t.axes.x.scale,h=t.margin.left,d=t.viewport.height,y=t.axes.x.categoryThickness,m=t.axes.x.outerPaddingRatio,v=t.axes.x.innerPaddingRatio;var C=y*m;f=c.width,g=Math.max(1,e.Double.floorWithPrecision((f-2*C)/y)),p=f}if(!x)return n&&(n.viewportDataRange={startIndex:0,endIndex:g},n.shouldLoadMoreData()&&n.loadMoreData()),this.scrollbar.remove(),void o(i,t,r,this.animateCategoryAxis,this.animateValueAxis);this.scrollScale=this.axisScale.copy(),this.scrollScale.rangeBands([0,p],.1,0),this.extentLength=this.scrollScale(g-1)+this.scrollScale.rangeBand(),this.scrollHandler=new u({visibleScale:this.axisScale,fullScale:this.scrollScale,onScroll:function(e){var t=l.scrollScale(e),a={start:t,end:null};l.scrollbar.setExtent(a),l.scrollbar.refreshExtentAndVisual()}}),this.axisScale.rangeBands([0,f],v,m),this.scrollbar.setOrientation(t.isXScrollBarVisible),this.scrollbar.setScale(this.scrollScale),this.scrollbar.scrollBarLength=p,this.scrollbar.setExtentLength(this.extentLength),s||this.scrollbar.setExtent({start:0,end:null}),this.renderVisualOptions={axesLayout:t,layers:i,loadMoreDataHandler:n,mainAxisScale:this.axisScale,renderDelegate:o,scrollScale:this.scrollScale,visibleCategoryCount:g,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis};var S=function(){return l.onRefreshVisual(function(e,t){return a.renderVisual(l.renderVisualOptions,e,t)})};if(this.scrollbar.render(h,d,S),s&&n){var b=n.viewportDataRange?n.viewportDataRange.startIndex:0;this.scrollTo(b)}else a.renderVisual(this.renderVisualOptions,this.scrollbar.getExtent(),r)},a.prototype.scrollDelta=function(e){this.scrollHandler.scrollDelta(e)},a.prototype.scrollTo=function(e){this.scrollHandler.scrollTo(e)},a.prototype.scrollBy=function(e){var t=this.axisScale.domain();_.isEmpty(t)||this.scrollHandler.scrollTo(t[0]+e)},a.prototype.onRefreshVisual=function(e){e(this.scrollbar.getExtent(),!0)},a.setLabelsAtEdges=function(e,a){if(e.length<=1||a[e[0]]!==t.CartesianAxes.hierarchyPlaceholder)return e;var i=e[0],r=e.slice();if(i<a.length&&i>=0){for(;a[i]===t.CartesianAxes.hierarchyPlaceholder&&i>=0;i--);r[0]=i}return r},a.renderVisual=function(e,t,i){var r=a.filterDataToViewport({mainAxisScale:e.mainAxisScale,layers:e.layers,scrollScale:e.scrollScale,extent:t,visibleCategoryCount:e.visibleCategoryCount,axesLayout:e.axesLayout,animateCategoryAxis:e.animateCategoryAxis,animateValueAxis:e.animateValueAxis});if(r){if(e.loadMoreDataHandler){var o=e.loadMoreDataHandler;o.viewportDataRange=r,o.shouldLoadMoreData()&&o.loadMoreData()}e.renderDelegate(e.layers,e.axesLayout,i,e.animateCategoryAxis,e.animateValueAxis)}},a.ScrollbarWidth=10,a}();t.ScrollableAxes=c;var u=function(){function e(t){this.visibleScale=t.visibleScale,this.fullScale=t.fullScale,this.onScroll=t.onScroll;var a=jsCommon.Utility.valueOrDefault(t.timeout,e.defaultTimeoutMs);this.extendScrollTimeout=_.debounce(this.onTimeout,a),this.totalScrollDistance=0}return e.prototype.scrollDelta=function(t){if(!_.isEmpty(this.visibleScale.domain())){this.totalScrollDistance<0&&t>0||this.totalScrollDistance>0&&t<0?this.totalScrollDistance=t:this.totalScrollDistance+=t;var a=e.getStepSize(this.visibleScale);if(Math.abs(this.totalScrollDistance)>=a){this.extendScrollTimeout&&this.extendScrollTimeout.cancel();var i=this.getNewStartIndex(this.totalScrollDistance);this.scrollTo(i),this.totalScrollDistance=0}else this.extendScrollTimeout()}},e.prototype.scrollTo=function(e){var t=this.clampIndex(e);this.onScroll(t)},e.getStepSize=function(e){var t=e.range();if(t.length>1)return t[1]-t[0];var a=e.rangeExtent();return a[1]-a[0]},e.prototype.getNewStartIndex=function(e){var a=e>=0;e=a?e:-e;var i,r=this.visibleScale,o=r.range(),n=r.domain(),s=n[0],l=o[0],c=l+e,u=r.rangeExtent()[1];if(c>u){i=n.length}else{i=t.AxisHelper.invertOrdinalScale(r,c)-s}return(a?1:-1)*i+s},e.prototype.clampIndex=function(e){var t=this.fullScale.domain(),a=_.head(t),i=_.last(t);return Math.max(a,Math.min(i,e))},e.prototype.onTimeout=function(){this.totalScrollDistance=0},e.defaultTimeoutMs=1e3,e}();t.AxisScrollHandler=u;var h=function(){function e(e){this.layerViewModelAdapterFactory=e,this.layerViewModelAdapterFactory||(this.layerViewModelAdapterFactory={createCartesianChartLayerViewModelAdapter:function(e){}})}return e.prototype.createLayers=function(e){var t=null!=e.isScrollable&&e.isScrollable,a=[],i={isScrollable:t,animator:e.animator,interactivityService:e.interactivityService,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches};switch(e.type){case 1:a.push(this.createLineChartLayer(2,!1,i));break;case 0:a.push(this.createLineChartLayer(1,!1,i));break;case 2:a.push(this.createLineChartLayer(16,!1,i));break;case 18:a.push(this.createRealTimeLayer(i));break;case 10:a.push(this.createScatterChartLayer(i));break;case 13:a.push(this.createWaterfallChartLayer(i));break;case 12:a.push(this.createDataDotChartLayer(i));break;case 4:a.push(this.createColumnChartLayer(20,i));break;case 3:a.push(this.createColumnChartLayer(12,i));break;case 8:a.push(this.createColumnChartLayer(52,i));break;case 6:a.push(this.createColumnChartLayer(18,i));break;case 5:a.push(this.createColumnChartLayer(10,i));break;case 7:a.push(this.createColumnChartLayer(50,i));break;case 9:a.push(this.createColumnChartLayer(68,i));break;case 11:var r=this.getComboColumnType();a.push(this.createColumnChartLayer(r,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 14:a.push(this.createColumnChartLayer(12,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 15:a.push(this.createColumnChartLayer(20,i)),a.push(this.createLineChartLayer(1,!0,i));break;case 16:a.push(this.createColumnChartLayer(12,i)),a.push(this.createDataDotChartLayer(i));break;case 17:a.push(this.createColumnChartLayer(20,i)),a.push(this.createDataDotChartLayer(i));break;case 19:a.push(this.createHistogramLayer(i))}return a},e.prototype.createLineChartLayer=function(e,a,i){var r={animator:i.animator,interactivityService:i.interactivityService,isScrollable:i.isScrollable,tooltipsEnabled:i.tooltipsEnabled,chartType:e,featureSwitches:i.featureSwitches,viewModelAdapter:this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(0)};return a&&(r.chartType=8|r.chartType),new t.LineChart(r)},e.prototype.createRealTimeLayer=function(e){return e.isScrollable=!1,new t.RealTimeLineChart(e)},e.prototype.createScatterChartLayer=function(e){var a=__assign({},e);return a.viewModelAdapter=this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(2),new t.ScatterChart(a)},e.prototype.createWaterfallChartLayer=function(e){var a=__assign({},e);return a.viewModelAdapter=this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(3),new t.WaterfallChart(a)},e.prototype.createDataDotChartLayer=function(e){return new t.DataDotChart(e)},e.prototype.createColumnChartLayer=function(e,a){var i={animator:a.animator,interactivityService:a.interactivityService,isScrollable:a.isScrollable,tooltipsEnabled:a.tooltipsEnabled,featureSwitches:a.featureSwitches,chartType:e,viewModelAdapter:this.layerViewModelAdapterFactory.createCartesianChartLayerViewModelAdapter(5)};return new t.ColumnChart(i)},e.prototype.createHistogramLayer=function(e){return new t.Histogram(e)},e.prototype.getComboColumnType=function(e){var t=12;if(e){var a=e.general;if(a){switch(a.visualType1){case"Column":t=12;break;case"ColumnStacked":t=20}a.visualType2}}return t},e}(),d=function(){function e(e){this.palette=e,this.clearPreferredScale()}return e.prototype.getAllColors=function(){return this.palette.getAllColors()},e.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},e.prototype.getNewColorScale=function(){return this.preferredScale},e.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},e.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},e.prototype.getGradientColors=function(){return this.palette.getGradientColors()},e.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},e.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},e.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},e.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))},e}();t.SharedColorPalette=d;var p=function(){function e(e,t,a){void 0===a&&(a=0),this.loadMoreThreshold=a,this.hostServices=t,this.setScale(e)}return e.prototype.setScale=function(e){e&&(this.loadMoreThresholdIndex=e.domain().length-1-this.loadMoreThreshold)},e.prototype.isLoadingMoreData=function(){return this.loadingMoreData},e.prototype.onLoadMoreDataCompleted=function(){this.loadingMoreData=!1},e.prototype.shouldLoadMoreData=function(){var e=this.viewportDataRange;return!(!e||this.isLoadingMoreData())&&e.endIndex>=this.loadMoreThresholdIndex},e.prototype.loadMoreData=function(){this.isLoadingMoreData()||(this.loadingMoreData=!0,this.hostServices.loadMoreData())},e}();t.CartesianLoadMoreDataHandler=p}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function e(e){this.behaviors=e}return e.prototype.bindEvents=function(e,a,i){for(var r=this.behaviors,o=0,n=r.length;o<n;o++)r[o].bindEvents(e.layerOptions[o],a,i);this.selectionHandler=a,e.clearCatcher.on("click",function(){t.isCtrlOrMeta(d3.event)||a.handleClearSelection()}),i&&!i.isEmpty()&&this.registerFocusKeyHandler(e.root,e.layerOptions);
},e.prototype.renderSelection=function(e){for(var t=0,a=this.behaviors;t<a.length;t++){a[t].renderSelection(e)}},e.prototype.renderFocus=function(e){for(var t=0,a=this.behaviors;t<a.length;t++){a[t].renderFocus(e)}},e.prototype.hoverLassoRegion=function(e,t){for(var a=0,i=this.behaviors;a<i.length;a++){var r=i[a];r.hoverLassoRegion&&r.hoverLassoRegion(e,t)}},e.prototype.lassoSelect=function(e,t){for(var a=0,i=this.behaviors;a<i.length;a++){var r=i[a];r.lassoSelect&&r.lassoSelect(e,t)}},e.prototype.registerFocusKeyHandler=function(e,a){e.on("keydown.cartesian",function(){if(27===d3.event.keyCode&&_.some(a,function(e){return $.contains(e.root.node(),d3.event.target)})){d3.event.preventDefault(),d3.event.stopPropagation();var e=_.find(a,function(e){return $(e.root.node()).is(":tabbable")});t.focus(e.root.node())}})},e}();e.CartesianChartBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.EnumExtensions,i=e.data.DataRoleHelper,r=e.data.Selector,o=jsCommon.CssConstants.createClassAndSelector,n=function(){function n(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.axisInteractivity=e.featureSwitches.axisInteractivity,this.ribbonChart=68===this.chartType,this.viewModelAdapter=e.viewModelAdapter}return n.prototype.init=function(e){if(this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.isComboChart=t.ComboChart.isComboChart(e.chartType),this.element=e.element,this.tooltipService=e.services.tooltips,this.svg=e.svg,this.svg.classed(n.ColumnChartClassName,!0),this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService){var a=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(t.SetFocusRingClassName,!a)}},n.prototype.getCategoryLayout=function(e,a){var i;i=n.isBar(this.chartType)?this.currentViewport.height-(this.margin.top+this.margin.bottom):this.currentViewport.width-(this.margin.left+this.margin.right),i=Math.max(0,i);var r=this.data?this.data.preferredCategoryWidth:null,o=this.data?this.data.categoryMetadata:void 0,s=t.AxisHelper.getCategoryValueType(o),l=this.getVisualCategoryAxisIsScalar(),c=t.AxisHelper.createDomain(this.data.series,s,l,a.forcedXDomain,a.ensureXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:i,categoryCount:e,preferredCategoryWidth:r,domain:c,isScalar:l,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},n.getDefaultColumnLabelSettings=function(e,a){void 0===a&&(a=!1);var i=t.LabelUtils.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",noColor:!0});return i.position=null,i.labelDensity=t.LabelUtils.defaultLabelDensity,i.labelOrientation=1,a?(i.enableBackground=!0,i.backgroundColor=t.ColorHelper.getThemeColor(e,t.BackgroundColorName),i.backgroundTransparency=t.LabelUtils.defaultComboChartLabelBackgroundOpacity):i.enableBackground=!1,i},n.converter=function(e,a,i,r,o,l,c,u,h,d,p,g,y){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===o&&(o=null),void 0===u&&(u=!0);var m=t.CartesianHelper.getCategoryAxisProperties(o,!1),v=t.CartesianHelper.getPreferredCategoryWidth(m);r=t.CartesianHelper.isScalar(r,m);var f=e.categorical,x=new s(e,a),C=t.converterHelper.getPivotedCategories(f,t.columnChartProps.general.formatString,y),S=C.categories,b=C.categoryFormatter,D=t.CartesianHelper.getScalarKeyinfo(f,r),w=D.category.source,P=n.getDefaultColumnLabelSettings(a,p);if(o&&o.objects){var L=o.objects,A=L.labels;t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(A,P,!n.isBar(l),a,p)}var V;d&&(V=n.getRibbonsUtils().getRibbonOptionsFromDataviewObjects(o,t.columnChartProps));var M=x.getLegend(),I=M.legend.dataPoints,k=M.seriesSources,T=n.createDataPoints({dataView:e,categories:S,legend:I,converterStrategy:x,defaultDataLabelsSettings:P,is100PercentStacked:i,isScalar:r,isCombo:!!p,style:a,chartType:l,categoryMetadata:w,tooltipsEnabled:u,ribbonChart:d,hostServices:h,ribbonOptions:V,axisInteractivity:g}),F=T.series;this.canSupportOutsidePosition(l,F.length)?null!=P.position&&_.includes(this.clusteredValidLabelPositionOptions,P.position)||(P.position=t.labelPosition.auto):null!=P.position&&_.includes(this.stackedValidLabelPositionOptions,P.position)||(P.position=t.labelPosition.auto);for(var N=[],O=0,H=I.length;O<H;O++)N.push(k[O]);if(c){for(var R=0,B=F;R<B.length;R++){var E=B[R];c.applySelectionStateToData(E.data)}c.applySelectionStateToData(M.legend.dataPoints)}var U;return a.isHighContrast&&(U={visible:!0,color:t.ColorHelper.getThemeColor(a,t.ForegroundColorName),width:t.CartesianHelper.defaultLineStrokeWidth}),{categories:S,categoryIdentities:T.categoryIdentities,categoryFormatter:b,preferredCategoryWidth:v,series:F,valuesMetadata:N,legendData:M.legend,hasHighlights:T.hasHighlights,categoryMetadata:w,scalarCategoryAxis:r,dataLabelsSettings:P,hasDynamicSeries:T.hasDynamicSeries,isMultiMeasure:T.isMultiMeasure,ribbonChartData:d?{ribbonChartDataPoints:T.ribbonChartDataPoints,ribbonOptions:V}:void 0,strokeSettings:U}},n.canSupportOutsidePosition=function(e,t){return!n.isStacked(e)&&!n.isRibbon(e)||1===t},n.createDataPoints=function(a){var r=a.dataView,o=r.categorical,s=e.data.createDataViewCategoricalReaderAdvanced(r,{staticSeriesRole:t.cartesianRoleNames.y,colorOptions:{valueRole:t.cartesianRoleNames.y,visualStyle:a.style}}),l=o&&o.values?o.values.grouped():void 0,c="Y",u=a.categories.length,h=s.data.hasValues(c)?s.data.getSeriesCount():void 0,d=[];if(h<1||u<1)return{series:d,categoryIdentities:[],ribbonChartDataPoints:null,hasHighlights:!1,hasDynamicSeries:!1,isMultiMeasure:!1};var p=o.categories,g=a.categoryMetadata;g=_.isEmpty(p)?null:_.last(p).source;for(var y=t.AxisHelper.getCategoryValueType(g),m=t.AxisHelper.isDateTime(y),v=[],f=[],x=[],C=[],S=[],b=!(!o.values||!o.values.source),D=!b&&h>1,w=!1,P=s.data.hasHighlights(),L=a.converterStrategy,A=0;A<h;A++){for(var V=[],M=[],I=0;I<u;I++){var k=L.getValueBySeriesAndCategory(A,I);if(V[I]=k,P){var T=L.getHighlightBySeriesAndCategory(A,I);M[I]=T,k>=0&&T>=0&&e.Double.greaterOrEqualWithPrecision(k,T)||k<=0&&T<=0&&e.Double.lessOrEqualWithPrecision(k,T)||(w=!0)}}x.push(V),P&&C.push(M)}var F=a.chartType;w&&!n.canSupportOutsidePosition(F,h)&&(w=!1,P=!1,x=C);for(var N=t.columnChartProps.general.formatString,O=function(p){var g=[],y=a.legend[p],C=void 0;if(s.data.hasSeries()||a.isCombo){var D=void 0;D=a.isCombo&&!s.data.hasSeries()?s.objects.getValueMetadataObjects(c,p):s.objects.getSeriesDataObjects(p);var L=D&&D.labels;L&&(C=e.Prototype.inherit(a.defaultDataLabelsSettings),t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(L,C,void 0,a.style,a.isCombo))}var A=s.columns.getValueMetadataColumn(c,p),V={displayName:y.label,key:"series"+p,index:p,data:g,identity:y.identity,color:y.color,labelSettings:C,type:A.type};d.push(V);for(var M=t.GradientUtils.getGradientMeasureIndex(o),I=t.GradientUtils.getGradientValueColumn(o),k=i.getMeasureIndexOfRole(l,c),T=t.valueFormatter.getLocalizedString("Percentage"),O=function(e){0===p&&(v.push(0),f.push(0));var i=t.AxisHelper.normalizeNonFiniteNumber(x[p][e]);if(null==i&&p>0)return"continue";var y=i,C=a.categories[e];if(m&&null!=C&&!(C instanceof Date))return"continue";if(m&&C&&(C=C.getTime()),a.isScalar&&(null==C||isNaN(C)))return"continue";var D=void 0,L=a.is100PercentStacked;L&&(D=t.StackedUtil.getStackedMultiplier(x,e));var V=i,O=i<0;D&&(i*=O?D.neg:D.pos);var R=Math.abs(i),B=void 0;O?(B=f[e],isNaN(R)||(f[e]-=R)):(isNaN(R)||(v[e]+=R),B=v[e]);var E=l&&l.length>p&&l[p].values?l[p].values[k]:null,U=_.isEmpty(o.categories)?null:o.categories[0],z=t.SelectionIdBuilder.builder().withCategory(U,e).withSeries(o.values,E).withMeasure(A.queryName).createSelectionId();a.axisInteractivity&&!S[e]&&(S[e]=function(){return t.CartesianHelper.getCategoryIdentity(e,U,A.queryName)});var G=s.colors.createBySeries(p,e),j=0===M?null:I,W=void 0,X=void 0,Y=void 0,q=void 0,K=void 0,Z=void 0;if(P){W=s.data.getHighlight(c,e,p),X=W;var $=!0;null===W&&(W=0,$=!1),L&&(W*=W>0?D.pos:D.neg),Y=Math.abs(W),K=B,W>0?K-=R-Y:0===W&&i>0&&(K-=R),Z=t.SelectionId.createWithHighlight(z);var J=void 0,Q=void 0;if($&&null!=X&&null!=W){var ee=t.valueFormatter.format(W,T);Q=t.converterHelper.formatFromMetadataColumn(X,A,N,!1),J=Q+" ("+ee+")"}q=L?J:Q}var te=void 0;if(a.tooltipsEnabled){if(te=[],U){var ae=t.CategoryLevelUtils.getCategoryLevels(r.categorical.categories,e,N),ie=t.CategoryLevelUtils.concatenateCategoryLevels(ae);132===F&&(ie=t.Histogram.buildTooltipCategories(ae,e,u)),te.push({displayName:ie.displayName,value:ie.value})}if(b&&(U&&U.source===o.values.source||te.push({displayName:o.values.source.displayName,value:t.converterHelper.formatFromMetadataColumn(l[p].name,o.values.source,N)})),null!=y){var re=void 0,oe=t.converterHelper.formatFromMetadataColumn(y,A,N,!1);if(L){re=oe+" ("+t.valueFormatter.format(R,T)+")"}else re=oe;te.push({displayName:A.displayName,value:re})}null!=q&&te.push({displayName:t.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:q}),j&&null!=j.values[e]&&te.push({displayName:j.source.displayName,value:t.converterHelper.formatFromMetadataColumn(j.values[e],j.source,N,!1)}),t.TooltipBuilder.addTooltipMeasures(s,te,e,b?p:void 0,N)}var ne=d[p],se=ne.labelSettings?ne.labelSettings:a.defaultDataLabelsSettings,le=se.fontProperties.color,ce=void 0;n.isStacked(F)&&(ce=H.getStackedLabelColor(O,p,h,e,x),le=ce||p===h-1&&!O?le:t.ColorHelper.getThemeColor(a.style,t.LabelUtils.DefaultInsideLabelColorName));var ue={categoryValue:C,value:i,position:B,valueAbsolute:R,valueOriginal:V,seriesIndex:p,labelSettings:se,categoryIndex:e,color:G,selected:!1,originalValue:i,originalPosition:B,originalValueAbsolute:R,identity:z,key:z.getKey(),tooltipInfo:te,formattedTooltip:t.tooltipUtils.formatTooltipInfo(te),labelFill:le,labelFormatString:A.format,lastSeries:ce,chartType:F};if(g.push(ue),P){var he={categoryValue:C,value:W,position:K,valueAbsolute:Y,valueOriginal:X,seriesIndex:p,labelSettings:se,categoryIndex:e,color:G,selected:!1,highlight:!0,originalValue:i,originalPosition:B,originalValueAbsolute:R,drawThinner:w,identity:Z,key:Z.getKey(),tooltipInfo:te,formattedTooltip:t.tooltipUtils.formatTooltipInfo(te),labelFormatString:A.format,labelFill:le,lastSeries:ce,chartType:F};g.push(he)}},R=0;R<u;R++)O(R)},H=this,A=0;A<h;A++)O(A);var R;return h>1&&u>1&&a.ribbonChart&&(R=n.getRibbonsUtils().createRibbonChartDataPoints({dataView:r,columnSeries:d,hasHighlights:P,hasDynamicSeries:b,ribbonChartDataPoints:R,categoryCount:u,formatStringProp:N,reader:s,hostServices:a.hostServices,ribbonOptions:a.ribbonOptions})),{series:d,categoryIdentities:S,ribbonChartDataPoints:R,hasHighlights:P,hasDynamicSeries:b,isMultiMeasure:D}},n.getStackedLabelColor=function(e,a,i,r,o){for(var n=!(e&&a===i-1&&1!==i),s=a+1;s<i;s++){var l=t.AxisHelper.normalizeNonFiniteNumber(o[s][r]);if(null!==l&&((!e||e&&0===a)&&l>0||e&&0!==a)){n=!1;break}}return n},n.sliceSeries=function(t,a,i){void 0===i&&(i=0);var r=[];if(t&&t.length>0)for(var o=0,n=t.length;o<n;o++){var s=r[o]=e.Prototype.inherit(t[o]);s.data=t[o].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<a})}return r},n.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},n.prototype.setData=function(e){var a=n.isStacked100(this.chartType);if(this.data=this.originalData={categories:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,dataLabelsSettings:n.getDefaultColumnLabelSettings(this.style),hasDynamicSeries:!1,isMultiMeasure:!1},e.length>0){var i=this.dataView=e[0];if(i&&i.categorical){var r=i.categorical.categories,o=r&&r.length>0?r[0].source:null,s=t.AxisHelper.getCategoryValueType(o),l=t.CartesianHelper.hasCategoryHierarchy(i),c=t.ScalarUtils.shouldDrawScalar(i.metadata?i.metadata.objects:null,t.columnChartProps.categoryAxis.axisType,s,void 0,l);this.data=this.originalData=n.converter(i,this.style,a,c,i.metadata,this.chartType,this.interactivityService,this.tooltipsEnabled,this.hostService,this.ribbonChart,this.isComboChart,this.axisInteractivity)}}this.setChartStrategy()},n.prototype.setChartStrategy=function(){switch(this.chartType){case 10:this.columnChart=new t.ClusteredBarChartStrategy;break;case 12:this.columnChart=new t.ClusteredColumnChartStrategy;break;case 18:case 50:this.columnChart=new t.StackedBarChartStrategy;break;case 20:case 52:case 68:this.columnChart=new t.StackedColumnChartStrategy;break;default:this.columnChart=new t.StackedColumnChartStrategy}if(n.isStacked(this.chartType)&&1===this.data.series.length)switch(this.chartType){case 18:this.columnChart=new t.ClusteredBarChartStrategy;break;case 20:this.columnChart=new t.ClusteredColumnChartStrategy}},n.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},n.prototype.enumerateObjectInstances=function(e,a){switch(a.objectName){case"dataPoint":this.dataView&&!t.GradientUtils.hasGradientRole(this.dataView.categorical)&&this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"ribbonChart":n.getRibbonsUtils().enumerateRibbonChart(e,this.data.ribbonChartData,this.ribbonChart)}},n.prototype.enumerateDataLabels=function(e){var a,i=this.originalData,o=i.dataLabelsSettings,s=i.series.length,l=s>1||!i.categoryMetadata||this.isComboChart,c=i.dataLabelsSettings.position!==t.labelPosition.outsideEnd;if(a=n.canSupportOutsidePosition(this.chartType,i.series.length)?n.clusteredValidLabelPositionOptions:n.stackedValidLabelPositionOptions,t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,o,null,l,a,c)),l&&o.showLabelPerSeries)for(var u=0;u<s;u++){var h=i.series[u],d=h.labelSettings?h.labelSettings:i.dataLabelsSettings,p=h.identity.getSelector();i.hasDynamicSeries&&(p=r.normalizeSelector(p)),e.pushContainer({displayName:h.displayName}),t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,d,p,void 0,a)),e.popContainer()}},n.prototype.getLabelSettingsOptions=function(e,t,a,i,r,o){var s=!!a;return{enumeration:e,dataLabelsSettings:t,show:!0,position:!_.isEmpty(r),positionObject:r,labelOrientation:!n.isBar(this.chartType)&&!s,displayUnits:!n.isStacked100(this.chartType),precision:!0,selector:a,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data&&this.data.scalarCategoryAxis,labelOverflow:!s&&o,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style}},n.prototype.enumerateDataPoints=function(t){var a=this.originalData;if(a){var i=a.series.length;0!==i&&(a.hasDynamicSeries||i>1||!a.categoryMetadata?e.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:t,dataPoints:a.series}):e.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:t,dataView:this.dataView,style:this.style,dataPoints:_.map(a.series[0].data,function(e){return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:e.identity}}),fillInstanceKind:3}))}},n.prototype.getValueDomain=function(e,a){var i,r=n.isStacked100(this.chartType);if(this.isStacked()){var o=t.StackedUtil.calcValueDomain(this.data.series,r);i=[o.min,o.max]}else i=t.AxisHelper.createValueDomain(this.data.series,!0)||t.emptyDomain;return t.AxisHelper.combineDomain(e.forcedYDomain,i,e.ensureYDomain)},n.prototype.calculateAxesProperties=function(a){this.currentViewport=a.viewport,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var i=this.data,r=this.margin=a.margin,o=this.ribbonChart?n.ribbonChartInnerPaddingRatio:a.innerPaddingRatio,s=e.Prototype.inherit(a);s.innerPaddingRatio=o;var l=i&&i.categories?i.categories.length:0,c=i?this.getCategoryLayout(l,s):{categoryCount:0,categoryThickness:t.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:o,isScalar:!1};if(this.categoryAxisType=c.isScalar?t.axisType.scalar:null,this.scrolledData=void 0,i&&!c.isScalar&&!this.isScrollable&&a.trimOrdinalDataOnOverflow){var u=Math.min(l,c.categoryCount);u!==l&&(i=this.scrolledData=e.Prototype.inherit(i),i.series=n.sliceSeries(i.series,u),i.categories=i.categories.slice(0,u))}this.columnChart.setData(i);var h=this.getPreferredPlotArea(c.isScalar,c.categoryCount,c.categoryThickness,c.outerPaddingRatio),d=n.isStacked100(this.chartType),p={height:h.height,width:h.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,margin:this.margin,layout:c,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(r.top+r.bottom),viewportWidth:this.currentViewport.width-(r.left+r.right),is100Pct:d,isComboChart:this.isComboChart};this.ApplyInteractivity(p),this.columnChart.setupVisualProps(p);var g,y,m=n.isBar(this.chartType);if(m){var v=a.forcedXDomain;a.forcedXDomain=a.forcedYDomain,a.forcedYDomain=v;var f=a.preventNiceX;a.preventNiceX=a.preventNiceY,a.preventNiceY=f,g=a.ensureYDomain}else y=a.ensureYDomain;return this.xAxisProperties=this.columnChart.setXScale({is100Pct:d,forcedTickCount:a.forcedTickCount,forcedXDomain:a.forcedXDomain,axisScaleType:m?a.valueAxisScaleType:a.categoryAxisScaleType,axisDisplayUnits:m?a.valueAxisDisplayUnits:a.categoryAxisDisplayUnits,axisPrecision:m?a.valueAxisPrecision:a.categoryAxisPrecision,ensureXDomain:g,outerPaddingRatio:m?0:c.outerPaddingRatio,margin:r,preventNice:a.preventNiceX,innerPaddingRatio:o,axisInteractivity:this.axisInteractivity}),this.yAxisProperties=this.columnChart.setYScale({is100Pct:d,forcedTickCount:a.forcedTickCount,forcedYDomain:a.forcedYDomain,axisScaleType:m?a.categoryAxisScaleType:a.valueAxisScaleType,axisDisplayUnits:m?a.categoryAxisDisplayUnits:a.valueAxisDisplayUnits,axisPrecision:m?a.categoryAxisPrecision:a.valueAxisPrecision,ensureYDomain:y,outerPaddingRatio:m?c.outerPaddingRatio:0,margin:r,preventNice:a.preventNiceY,innerPaddingRatio:o,axisInteractivity:this.axisInteractivity}),[this.xAxisProperties,this.yAxisProperties]},n.prototype.getPreferredPlotArea=function(e,a,i,r){var o={height:this.currentViewport.height-this.margin.top-this.margin.bottom,width:this.currentViewport.width-this.margin.left-this.margin.right};if(this.isScrollable&&!e){var s=t.CartesianChart.getPreferredCategorySpan(a,i,r);n.isBar(this.chartType)?o.height=Math.max(s,o.height):o.width=Math.max(s,o.width)}return o},n.prototype.ApplyInteractivity=function(e){var t=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(e.onDragStart=function(e){e.identity&&t.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var i=function(){var e=d3.mouse(t.mainGraphicsContext[0][0]),a=e[0],i=e[1],r=t.columnChart.getClosestColumnIndex(a,i);t.selectColumn(r)},r=n.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",i),d3.select(r).on("click",i).style("touch-action","none");var o=d3.behavior.drag().origin(Object).on("drag",i);this.svg.call(o),d3.select(r).call(o)}},n.prototype.selectLastSelectedColumnOrDefault=function(e){void 0===e&&(e=!1);var a=void 0===this.lastInteractiveSelectedColumnIndex,i=a?t.CartesianHelper.findMaxCategoryIndex(this.data.series):this.lastInteractiveSelectedColumnIndex;this.selectColumn(i,e)},n.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var a=this.createInteractiveLegendDataPoints(e);this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex,t),this.cartesianVisualHost.updateLegend(a),this.lastInteractiveSelectedColumnIndex=e}},n.prototype.createInteractiveLegendDataPoints=function(e){var a=this.data,i=t.Legend.getDefaultLegendData(this.style);if(!a||_.isEmpty(a.series))return i;for(var r=t.columnChartProps.general.formatString,o=[],n=a.categories&&a.categories[e],l=a.series,c=a.legendData&&a.legendData.dataPoints,u=new s(this.dataView,this.style),h=0,d=l.length;h<d;h++){var p=u.getValueBySeriesAndCategory(h,e),g=a.valuesMetadata[h],y=t.converterHelper.getFormattedLegendLabel(g,this.dataView.categorical.values,r),m=void 0;if(1===l.length){var v=l[0];m=v.data.length>e&&v.data[e].color}else m=c.length>h&&c[h].color;o.push({color:m,icon:t.LegendIcon.Box,label:y,category:a.categoryFormatter?a.categoryFormatter.format(n):n,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(g,r)),identity:t.SelectionId.createNull(),selected:!1,index:h})}return i.dataPoints=o,i},n.prototype.overrideXScale=function(e){this.xAxisProperties=e},n.prototype.render=function(e){var a=this.columnChart.drawColumns(!e,this.style),i=this.data,r=this.margin,o=this.currentViewport,n=o.height-(r.top+r.bottom),s=o.width-(r.left+r.right);this.mainGraphicsContext.attr("height",n).attr("width",s),this.tooltipsEnabled&&this.tooltipService.addTooltip(a.eventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity}),this.tooltipsEnabled&&a.ribbonChartEventGroup&&this.tooltipService.addTooltip(a.ribbonChartEventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return t.SelectionId.createNull()});var l,c,u=[];if(this.interactivityService){for(var h=0,d=i.series.length;h<d;h++)u=u.concat(i.series[h].data);l={datapoints:u,columnChartDrawInfo:a,hasHighlights:i.hasHighlights,root:this.mainGraphicsContext,showLabel:i.dataLabelsSettings.show,bandsTransparency:this.data.ribbonChartData?this.data.ribbonChartData.ribbonOptions.bandsTransparency:30,visualInstanceId:this.hostService.instanceId},c={navigationStrategy:i.series.length>1?t.DataPointNavigationStrategy.CategoryFirst:t.DataPointNavigationStrategy.CategoryOnly,helper:this}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.selectLastSelectedColumnOrDefault(!0),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:u,behaviorOptions:l,navigationOptions:c,labelDataPoints:[],labelDataPointGroups:a.labelDataPointGroups,labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:a.animateLabels}},n.prototype.getFirstElement=function(e,t){void 0===t&&(t=!1);var a=(this.scrolledData||this.data).series;if(_.isEmpty(a))return null;var i=null!=e?e:a[0].data[0].categoryIndex,r=t?this.findSeriesIndex(a.length-1,i,!1):this.findSeriesIndex(0,i,!0);return this.getDataPointElement(r,i)},n.prototype.getNextDataPoint=function(e,a,i){switch(i){case t.DataDirection.NextCategory:e=this.findCategoryIndex(this.data.series[a].data,e,!0);break;case t.DataDirection.PreviousCategory:e=this.findCategoryIndex(this.data.series[a].data,e,!1);break;case t.DataDirection.NextSeries:a=this.findSeriesIndex(a+1,e,!0),a<0&&(e=this.loopIndex(e+1,this.data.categories.length),a=this.findSeriesIndex(0,e,!0));break;case t.DataDirection.PreviousSeries:a=a>0?this.findSeriesIndex(a-1,e,!1):-1,a<0&&(e=this.loopIndex(e-1,this.data.categories.length),a=this.findSeriesIndex(this.data.series.length-1,e,!1))}return{element:this.getDataPointElement(a,e),targetCategoryIndex:e}},n.prototype.getDataPointElement=function(e,t){var a=n.isColumn(this.chartType)?".column":".bar";return this.mainGraphicsContext.selectAll(a).filter(function(a){return a.categoryIndex===t&&a.seriesIndex===e}).node()},n.prototype.findSeriesIndex=function(e,t,a){return(a?_.findIndex:_.findLastIndex)(this.data.series,function(e){return _.some(e.data,function(e){return e.categoryIndex===t&&null!=e.value})},e)},n.prototype.findCategoryIndex=function(e,t,a){var i=a?1:-1,r=_.findIndex(e,function(e){return e.categoryIndex===t});return r=this.loopIndex(r+i,e.length),e[r].categoryIndex},n.prototype.loopIndex=function(e,t){return e>=t?0:e<0?t-1:e},n.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},n.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},n.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,a=t.AxisHelper.getCategoryValueType(e);return t.AxisHelper.isOrdinal(a)?t.axisType.categorical:t.axisType.both},n.prototype.setFilteredData=function(t,a){var i=this.scrolledData=e.Prototype.inherit(this.data);return i.series=n.sliceSeries(i.series,a,t),i.categories=i.categories.slice(t,a),this.columnChart.setData(i),i},n.prototype.supportsTrendLine=function(){var t=this.dataView,a=e.data.createDataViewCategoricalReader(t),i=this.getVisualCategoryAxisIsScalar();return 12===this.chartType&&i&&a.data.hasValues("Y")},n.prototype.supportsStaticReferenceLines=function(){return 68!==this.chartType},n.prototype.supportsValueAxis=function(){return 68!==this.chartType},n.prototype.isStacked=function(){return n.isStacked(this.chartType)},n.isBar=function(e){return a.hasFlag(e,2)},n.isColumn=function(e){return a.hasFlag(e,4)},n.isClustered=function(e){return a.hasFlag(e,8)},n.isStacked=function(e){return a.hasFlag(e,16)},n.isStacked100=function(e){return a.hasFlag(e,48)},n.isRibbon=function(e){return a.hasFlag(e,64)},n.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:n.isColumn(this.chartType),supportsValueAxis:this.supportsValueAxis()}},n.prototype.getStaticSeriesRole=function(){return"Y"},n.getRibbonsUtils=function(){return e.ribbonChartUtilsModuleFactory()},n.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},n.ColumnChartClassName="columnChart",n.AutoLabelPosition="Auto",n.clusteredValidLabelPositionOptions=[n.AutoLabelPosition,t.labelPosition.outsideEnd,t.labelPosition.insideEnd,t.labelPosition.insideCenter,t.labelPosition.insideBase],n.stackedValidLabelPositionOptions=[n.AutoLabelPosition,t.labelPosition.insideCenter,t.labelPosition.insideEnd,t.labelPosition.insideBase],n.RibbonChartItemClasses=o("ribbonChartArea"),n.RibbonChartLayerClasses=o("ribbonChartLayer"),n.ribbonChartInnerPaddingRatio=.6,n}();t.ColumnChart=n;var s=function(){function a(t,a){this.visualStyle=a,this.dataView=t&&t.categorical,this.reader=e.data.createDataViewCategoricalReaderAdvanced(t,{staticSeriesRole:"Y",colorOptions:{valueRole:"Y",visualStyle:a}})}return a.prototype.getLegend=function(){var e,a=[],r=[],o=[],n=!1,s=this.reader;if(this.dataView&&this.dataView.values){for(var l=this.dataView.values,c=l.grouped(),u=t.columnChartProps.general.formatString,h=0,d=c.length;h<d;h++)for(var p=c[h],g=p.values,y=0,m=g.length;y<m;y++){var v=g[y],f=v.source;if(!i.hasRole(f,"Gradient")&&!i.hasRole(f,"Tooltips")||i.hasRole(f,"Y")){r.push(f),o.push(v.objects);var x=new t.SelectionIdBuilder;x=x.withMeasure(f.queryName),s.columns.hasDynamicSeries()&&(x=x.withSeries(s.columns.getSeriesValueColumns(),s.columns.getSeriesValueColumnGroup(h)));var C=x.createSelectionId(),S=t.converterHelper.getFormattedLegendLabel(f,l,u),b=s.colors.createBySeries(s.columns.hasDynamicSeries()?h:y);a.push({icon:t.LegendIcon.Box,color:b,label:S,identity:C,selected:!1,index:s.columns.hasDynamicSeries()?h:y}),v.identity&&void 0!==f.groupName&&(n=!0)}}var D=this.dataView.values;e=D&&D.source?D.source.displayName:""}var w=t.Legend.getDefaultLegendData(this.visualStyle);return w.title=e,w.dataPoints=a,w.grouped=n,{legend:w,seriesSources:r,seriesObjects:o}},a.prototype.getValueBySeriesAndCategory=function(e,t){return this.reader.data.getValue("Y",t,e)},a.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.reader.data.getHighlight("Y",t,e)},a}()}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(t){function a(e){return t.call(this,e)||this}return __extends(a,t),a.prototype.animate=function(t){var a={failed:!0,shapes:null},i=t.viewModel,r=this.previousViewModel;return i.categories.length*i.series.length>e.AnimatorCommon.MaxDataPointsToAnimate||r&&r.categories.length!==i.categories.length?a:(r&&(i.hasHighlights&&!r.hasHighlights?a=this.animateNormalToHighlighted(t):i.hasHighlights&&r.hasHighlights?a=this.animateHighlightedToHighlighted(t):!i.hasHighlights&&r.hasHighlights&&(a=this.animateHighlightedToNormal(t))),this.previousViewModel=i,a)},a.prototype.animateNormalToHighlighted=function(t){var a=t.viewModel,i=t.itemCS,r=t.series.selectAll(i.selector),o=r.data(function(e){return e.data},function(e){return e.key}),n=t.interactivityService&&t.interactivityService.hasSelection(),s=a.hasHighlights;return o.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).attr(t.layout.shapeLayoutWithoutHighlights),o.style("fill",function(e){return e.color}).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,n,s)}).transition().duration(this.animationDuration).attr(t.layout.shapeLayout),o.exit().remove(),{failed:!1,shapes:o}},a.prototype.animateHighlightedToHighlighted=function(e){return{failed:!1,shapes:this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS,e.interactivityService&&e.interactivityService.hasSelection())}},a.prototype.animateHighlightedToNormal=function(t){var a=t.itemCS,i=t.series.selectAll(a.selector),r=i.data(function(e){return e.data},function(e){return e.key}),o=t.interactivityService&&t.interactivityService.hasSelection();return r.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}),r.style("fill",function(e){return e.color}).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,t.selected,!t.selected)}).transition().duration(this.animationDuration).attr(t.layout.shapeLayout).transition().duration(0).delay(this.animationDuration).style("fill-opacity",function(t){return e.ColumnUtil.getFillOpacity(t.selected,t.highlight,o,!1)}),r.exit().transition().duration(this.animationDuration).attr(o?t.layout.zeroShapeLayout:t.layout.shapeLayoutWithoutHighlights).remove(),{failed:!1,shapes:r}},a.prototype.animateDefaultShapes=function(t,a,i,r,o){var n=a.selectAll(r.selector),s=n.data(function(e){return e.data},function(e){return e.key});return s.enter().append("rect").attr("class",function(e){return r.class.concat(e.highlight?" highlight":"")}),s.style("fill",function(e){return e.color}).style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,o,t.hasHighlights)}).transition().duration(this.animationDuration).attr(i.shapeLayout),s.exit().remove(),s},a}(e.BaseAnimator);e.WebColumnChartAnimator=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function a(){}return a.prototype.bindEvents=function(a,i,r){var o=this;this.options=a;var n=a.columnChartDrawInfo.eventGroup;if(r&&!r.isEmpty()){var s=a.root;e.InteractivityUtils.appendUseElementForFocus(s,a.visualInstanceId),e.InteractivityUtils.registerEnterPlotAreaHandler(s,r),e.InteractivityUtils.registerDataPointNavigationHandler(s,r),e.InteractivityUtils.registerClearCatcherShortcut(s,i)}n.on("click",function(){return o.handleSelection(i)}).on("keydown.select",function(){var e=d3.event.keyCode;32!==e&&13!==e||(d3.event.preventDefault(),d3.event.stopPropagation(),o.handleSelection(i))},!0),n.on("contextmenu",function(){if(!t.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var a=e.InteractivityUtils.getPositionOfLastInputEvent();e.InteractivityUtils.tryToSelectD3Target(function(e){
return i.handleContextMenu(e,a)})}})},a.prototype.renderSelection=function(t){var a=this.options;if(a.columnChartDrawInfo.ribbonChartEventGroup){var i=(100-a.bandsTransparency)/100,r=e.ColumnUtil.getFillOpacity(!1,!1,t,a.hasHighlights,i);a.columnChartDrawInfo.ribbonChartEventGroup.style("fill-opacity",r).style("stroke-opacity",r)}a.columnChartDrawInfo.shapesSelection.style("fill-opacity",function(i){return e.ColumnUtil.getFillOpacity(i.selected,i.highlight,t,a.hasHighlights)}).style("stroke-opacity",function(i){return e.ColumnUtil.getFillOpacity(i.selected,i.highlight,t,a.hasHighlights)})},a.prototype.renderFocus=function(a){var i=e.CurrentFocusDataPointId+"-"+this.options.visualInstanceId;this.options.root.select("#"+i).attr("id",null),a&&(a.setAttribute("id",i),t.focus(a))},a.prototype.handleSelection=function(a){var i=e.InteractivityUtils.getPositionOfLastInputEvent();e.InteractivityUtils.tryToSelectD3Target(function(e){return a.handleSelection(e,t.isCtrlOrMeta(d3.event),i)})},a}();e.ColumnChartWebBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setXScale=function(t){var a,i,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureXDomain,c=t.margin,u=this.width;r&&2===r.length&&(a=r[0],i=r[1]);var h=this.xProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!1,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio,t.axisInteractivity),d=this.data.series.length,p=this.categoryLayout.categoryThickness*(1-t.innerPaddingRatio)/d;return this.seriesOffsetScale=d3.scale.ordinal().domain(this.data.series.map(function(e){return e.index})).rangeBands([0,d*p]),h},t.prototype.setYScale=function(t){var a=(t.is100Pct,t.forcedTickCount),i=t.forcedYDomain,r=t.axisScaleType,o=t.axisDisplayUnits,n=t.axisPrecision,s=t.ensureYDomain,l=t.outerPaddingRatio,c=t.margin,u=this.viewportHeight,h=e.AxisHelper.createValueDomain(this.data.series)||e.emptyDomain,d=e.AxisHelper.combineDomain(i,h,s),p=e.AxisHelper.scaleShouldClamp(d,h),g=!(i&&2===i.length&&(i[0]>0||i[1]<0));return this.yProps=e.AxisHelper.createAxis({pixelSpan:u,dataDomain:d,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:e.valueFormatter.getFormatString(this.data.valuesMetadata[0],e.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:o,axisPrecision:n,shouldClamp:p,outerPaddingRatio:l,margin:c,preventNice:t.preventNice,includeZero:g}),this.yProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!0,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.columnsCenters=null;var o,n=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),s=n/r.series.length,l={columnWidth:s,categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin},c=this.layout=t.getLayout(r,l),u=r.dataLabelsSettings;u&&u.show&&(o=this.createLabelDataPoints(i));var h,d,p=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,l);return this.animator&&a&&(h=this.animator.animate({viewModel:r,series:p,layout:c,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),d=h.shapes),this.animator&&a&&!h.failed||(d=e.ColumnUtil.drawDefaultShapes(r,p,c,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(d,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:d,viewport:{height:this.height,width:this.width},axisOptions:l,labelDataPointGroups:o,animateLabels:h&&!h.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(t,this.getColumnsCenters())},t.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.columnsCenters=i.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.columnsCenters},t.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({x1:i,x2:i}),r.select("circle").attr({cx:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),r.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(t,a){var i=a.columnWidth,r=.5*i,o=r/2,n=a.isScalar,s=a.xScale,l=a.yScale,c=a.seriesOffsetScale,u=l(0),h=0;return n&&(h=a.categoryWidth/2),{shapeLayout:{width:function(e){return e.drawThinner?r:i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},y:function(t){return u+e.AxisHelper.diffScaled(l,Math.max(0,t.value),0)},height:function(t){return Math.abs(e.AxisHelper.diffScaled(l,0,t.value))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h},y:function(t){return u+e.AxisHelper.diffScaled(l,Math.max(0,t.originalValue),0)},height:function(t){return Math.abs(e.AxisHelper.diffScaled(l,0,t.originalValue))}},zeroShapeLayout:{width:function(e){return e.drawThinner?r:i},x:function(e){return s(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},y:function(e){return u},height:function(e){return 0}}}},t.classes={item:{class:"column",selector:".column"}},t}();e.ClusteredColumnChartStrategy=t;var a=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setYScale=function(t){var a,i,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.margin,u=this.height;r&&2===r.length&&(a=r[0],i=r[1]);var h=this.yProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!0,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio,t.axisInteractivity),d=this.data.series.length,p=this.categoryLayout.categoryThickness*(1-t.innerPaddingRatio)/d;return this.seriesOffsetScale=d3.scale.ordinal().domain(this.data.series.map(function(e){return e.index})).rangeBands([0,d*p]),h},t.prototype.setXScale=function(t){var a=(t.is100Pct,t.forcedTickCount),i=t.forcedXDomain,r=t.axisScaleType,o=t.axisDisplayUnits,n=t.axisPrecision,s=t.ensureXDomain,l=t.outerPaddingRatio,c=t.margin,u=this.width,h=e.AxisHelper.createValueDomain(this.data.series)||e.emptyDomain,d=e.AxisHelper.combineDomain(i,h,s),p=e.AxisHelper.scaleShouldClamp(d,h),g=!(i&&2===i.length&&(i[0]>0||i[1]<0));return this.xProps=e.AxisHelper.createAxis({pixelSpan:u,dataDomain:d,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:e.valueFormatter.getFormatString(this.data.valuesMetadata[0],e.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:o,axisPrecision:n,shouldClamp:p,outerPaddingRatio:l,margin:c,preventNice:t.preventNice,includeZero:g}),this.xProps.axis.tickSize(-this.viewportHeight,0),this.xProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!0,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.barsCenters=null;var o,n=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),s=n/r.series.length,l={columnWidth:s,categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin},c=this.layout=t.getLayout(r,l),u=r.dataLabelsSettings;u&&u.show&&(o=this.createLabelDataPoints(i));var h,d,p=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,l);return this.animator&&a&&(h=this.animator.animate({viewModel:r,series:p,layout:c,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),d=h.shapes),this.animator&&a&&!h.failed||(d=e.ColumnUtil.drawDefaultShapes(r,p,c,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(d,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:d,viewport:{height:this.height,width:this.width},axisOptions:l,labelDataPointGroups:o,animateLabels:h&&!h.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(a,this.getBarsCenters())},t.prototype.getBarsCenters=function(){var e=this;if(!this.barsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.barsCenters=i.data.map(function(t){return e.yProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.barsCenters},t.prototype.moveHandle=function(e){var t=this.getBarsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({y1:i,y2:i}),r.select("circle").attr({cy:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:0,x2:this.width,y1:i,y2:i}),r.append("circle").attr({cx:0,cy:i,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(t,a){var i=a.columnWidth,r=.5*i,o=r/2,n=a.isScalar,s=a.xScale,l=a.yScale,c=a.seriesOffsetScale,u=s(0),h=0;return n&&(h=a.categoryWidth/2),{shapeLayout:{width:function(t){return Math.abs(e.AxisHelper.diffScaled(s,0,t.value))},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.value),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},height:function(e){return e.drawThinner?r:i}},shapeLayoutWithoutHighlights:{width:function(t){return Math.abs(e.AxisHelper.diffScaled(s,0,t.originalValue))},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.originalValue),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(t){return u+e.AxisHelper.diffScaled(s,Math.min(0,t.value),0)},y:function(e){return l(n?e.categoryValue:e.categoryIndex)+c(e.seriesIndex)-h+(e.drawThinner?o:0)},height:function(e){return e.drawThinner?r:i}}}},t.classes={item:{class:"bar",selector:".bar"}},t}();e.ClusteredBarChartStrategy=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setXScale=function(t){var a,i,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.xReferenceLineValue,c=t.margin,u=this.width;return r&&2===r.length&&(a=r[0],i=r[1]),this.xProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!1,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio,t.axisInteractivity)},t.prototype.setYScale=function(t){var a=t.is100Pct,i=t.forcedTickCount,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.outerPaddingRatio,u=t.margin,h=this.viewportHeight,d=e.StackedUtil.calcValueDomain(this.data.series,a),p=[d.min,d.max],g=e.AxisHelper.combineDomain(r,p,l),y=e.AxisHelper.scaleShouldClamp(g,p),m=this.data.valuesMetadata[0],v=a?this.graphicsContext.hostService.getLocalizedString("Percentage"):e.valueFormatter.getFormatString(m,e.columnChartProps.general.formatString);return this.yProps=e.AxisHelper.createAxis({pixelSpan:h,dataDomain:g,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:v,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,axisDisplayUnits:n,axisPrecision:s,is100Pct:a,shouldClamp:y,margin:u,preventNice:t.preventNice}),this.yProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!1,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.columnsCenters=null;var o,n={columnWidth:this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},s=this.layout=t.getLayout(r,n),l=r.dataLabelsSettings;l&&l.show&&(o=this.createLabelDataPoints(i));var c,u,h=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,n);this.animator&&a&&(c=this.animator.animate({viewModel:r,series:h,layout:s,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),u=c.shapes),this.animator&&a&&!c.failed||(u=e.ColumnUtil.drawDefaultShapes(r,h,s,t.classes.item,!this.animator,this.interactivityService));var d,p,g=this.data.ribbonChartData;if(g&&g.ribbonChartDataPoints){var y=e.ColumnChart.getRibbonsUtils().getRibbonChartAreaLayout(this.layout,g.ribbonChartDataPoints,!0);d={graphicsContext:this.graphicsContext.mainGraphicsContext,layout:y,ribbonChartAreaSelector:e.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:e.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:g.ribbonOptions.colorBands,bandsTransparency:g.ribbonOptions.bandsTransparency,showBorder:g.ribbonOptions.showBorder,style:i},p=e.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(d)}else d={graphicsContext:this.graphicsContext.mainGraphicsContext,layout:[],ribbonChartAreaSelector:e.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:e.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:!1,bandsTransparency:t.defaultBandsTransparency,showBorder:!1,style:i},p=e.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(d);return e.ColumnUtil.applyInteractivity(u,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,ribbonChartEventGroup:p,shapesSelection:u,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:o,animateLabels:c&&!c.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(t,this.getColumnsCenters())},t.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.columnsCenters=i.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.columnsCenters},t.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({x1:i,x2:i}),r.select("circle").attr({cx:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),r.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},t.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,n=0;return i&&(n=a/2),{shapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.position)},height:function(e){return o(e.position-e.valueAbsolute)-o(e.position)}},shapeLayoutWithoutHighlights:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.originalPosition)},height:function(e){return o(e.originalPosition-e.originalValueAbsolute)-o(e.originalPosition)}},zeroShapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(e.value>=0?e.position-e.valueAbsolute:e.position)},height:function(e){return 0}}}},t.classes={item:{class:"column",selector:".column"},highlightItem:{class:"highlightColumn",selector:".highlightColumn"}},t.defaultBandsTransparency=30,t}();e.StackedColumnChartStrategy=t;var a=function(){function t(){}return t.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.isComboChart=e.isComboChart},t.prototype.setData=function(e){this.data=e},t.prototype.setYScale=function(t){var a,i,r=t.forcedYDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureYDomain,c=t.margin,u=this.height;return r&&2===r.length&&(a=r[0],i=r[1]),this.yProps=e.ColumnUtil.getCategoryAxis(this.data,u,this.categoryLayout,!0,a,i,o,n,s,l,c,t.preventNice,t.innerPaddingRatio,t.axisInteractivity)},t.prototype.setXScale=function(t){var a=t.is100Pct,i=t.forcedTickCount,r=t.forcedXDomain,o=t.axisScaleType,n=t.axisDisplayUnits,s=t.axisPrecision,l=t.ensureXDomain,c=t.outerPaddingRatio,u=t.margin,h=this.width,d=e.StackedUtil.calcValueDomain(this.data.series,a),p=[d.min,d.max],g=e.AxisHelper.combineDomain(r,p,l),y=e.AxisHelper.scaleShouldClamp(g,p),m=this.data.valuesMetadata[0],v=a?this.graphicsContext.hostService.getLocalizedString("Percentage"):e.valueFormatter.getFormatString(m,e.columnChartProps.general.formatString);return this.xProps=e.AxisHelper.createAxis({pixelSpan:h,dataDomain:g,zeroScalarDomain:[0,1],metaDataColumn:this.data.valuesMetadata,formatString:v,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!1,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,axisDisplayUnits:n,axisPrecision:s,is100Pct:a,shouldClamp:y,margin:u,preventNice:t.preventNice}),this.xProps.axis.tickSize(-this.viewportHeight,0),this.xProps},t.prototype.createLabelDataPoints=function(t){return e.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!1,t)},t.prototype.drawColumns=function(a,i){var r=this.data;this.barsCenters=null;var o,n={columnWidth:this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},s=this.layout=t.getLayout(r,n),l=r.dataLabelsSettings;l&&l.show&&(o=this.createLabelDataPoints(i));var c,u,h=e.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,n);return this.animator&&a&&(c=this.animator.animate({viewModel:r,series:h,layout:s,itemCS:t.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),u=c.shapes),this.animator&&a&&!c.failed||(u=e.ColumnUtil.drawDefaultShapes(r,h,s,t.classes.item,!this.animator,this.interactivityService)),e.ColumnUtil.applyInteractivity(u,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:u,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:o,animateLabels:c&&!c.failed}},t.prototype.selectColumn=function(a,i,r){e.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,t.classes.item.selector,a,i,r),this.moveHandle(a)},t.prototype.getClosestColumnIndex=function(t,a){return e.ColumnUtil.getClosestColumnIndex(a,this.getBarsCenters())},t.prototype.getBarsCenters=function(){var e=this;if(!this.barsCenters){var t=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=t/2);var i=this.data.series[0];this.barsCenters=i.data.map(function(t){return e.yProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a})}}return this.barsCenters},t.prototype.moveHandle=function(e){var t=this.getBarsCenters(),a=d3.select(".interactive-hover-line");if(a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentNode)),!t||t.length<=1)return void(this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove());var i=t[e];if(this.columnSelectionLineHandle){var r=this.columnSelectionLineHandle;r.select("line").attr({y1:i,y2:i}),r.select("circle").attr({cy:i})}else{var r=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g");r.append("line").classed("interactive-hover-line",!0).attr({x1:0,x2:this.width,y1:i,y2:i}),r.append("circle").classed("drag-handle",!0).attr({cx:0,cy:i,r:"6px"})}},t.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,n=0;return i&&(n=a/2),{shapeLayout:{width:function(e){return r(e.position)-r(e.position-e.valueAbsolute)},x:function(e){return r(e.position-e.valueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},shapeLayoutWithoutHighlights:{width:function(e){return r(e.originalPosition)-r(e.originalPosition-e.originalValueAbsolute)},x:function(e){return r(e.originalPosition-e.originalValueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},zeroShapeLayout:{width:function(e){return 0},x:function(e){return r(e.value>=0?e.position-e.valueAbsolute:e.position)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}}}},t.classes={item:{class:"bar",selector:".bar"},highlightItem:{class:"highlightBar",selector:".highlightBar"}},t}();e.StackedBarChartStrategy=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function a(t,a,i){if(i){for(var r,o=i.length,n=0;n<o;n++){var s=i[n];if(s.enumerateObjectInstances){if(s instanceof e.ColumnChart){r=n;continue}s.enumerateObjectInstances(t,a)}}void 0!==r&&i[r].enumerateObjectInstances(t,a)}}function i(e){return 11===e||14===e||15===e||16===e||17===e}t.enumerateDataPoints=a,t.isComboChart=i}(t=e.ComboChart||(e.ComboChart={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=function(){function a(e){this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return a.prototype.init=function(e){this.options=e,this.svg=e.svg,this.svg.classed(a.ClassName,!0),this.mainGraphicsG=this.svg.append("g").classed("dataDotChartMainGraphicsContext",!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.currentViewport=e.viewport,this.hostService=e.host,this.cartesianVisualHost=e.cartesianHost,this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.interactivity=e.interactivity,this.element=e.element},a.prototype.setData=function(i){if(this.data={series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1},i.length>0){var r=i[0];if(r&&r.categorical){var o=this.dataViewCategorical=r.categorical,n=o.categories,s=e.ValueType.fromDescriptor({text:!0});n&&n.length>0&&n[0].source&&n[0].source.type&&(s=n[0].source.type),this.data=a.converter(r,t.valueFormatter.format(null),this.interactivityService)}}},a.prototype.setFilteredData=function(t,a){var i=this.clippedData=e.Prototype.inherit(this.data);return i&&i.series&&i.series.data&&(i.series={data:i.series.data.slice(t,a),xCol:i.series.xCol,yCol:i.series.yCol}),i},a.prototype.calculateAxesProperties=function(i){var r=this;this.currentViewport=i.viewport,this.margin=i.margin;var o=this.clippedData=this.data,n=this.currentViewport,s=this.margin,l=o?o.series:null,c=l&&l.data&&l.data.length>0?[l]:[],u=l&&l.data?l.data.length:0;o.hasHighlights&&(u/=2);var h,d,p=n.width-(s.left+s.right),g=n.height-(s.top+s.bottom);a.hasDataPoint(l)&&(h=l.xCol,d=l.yCol);var y=t.CartesianChart.getLayout(null,{availableWidth:p,categoryCount:u,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:i.trimOrdinalDataOnOverflow,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:i.innerPaddingRatio}),m=y.categoryThickness*y.outerPaddingRatio;this.isScrollable||(this.clippedData=a.createClippedDataIfOverflowed(o,y.categoryCount));var v=t.AxisHelper.createValueDomain(c),f=t.AxisHelper.combineDomain(i.forcedYDomain,v,i.ensureYDomain);this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:f,metaDataColumn:d,formatString:t.valueFormatter.getFormatString(d,a.formatStringProp),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,margin:s,preventNice:i.preventNiceY,includeZero:!0});var x=this.xAxisProperties?this.xAxisProperties.axisType:e.ValueType.fromDescriptor({text:!0}),C=t.AxisHelper.createDomain(c,x,!1,i.forcedXDomain,i.ensureXDomain);return this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:p,dataDomain:C,metaDataColumn:h,formatString:t.valueFormatter.getFormatString(h,a.formatStringProp),outerPadding:m,isScalar:!1,isVertical:!1,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,categoryThickness:y.categoryThickness,getValueFn:function(e,t){return r.lookupXValue(e,t)},isCategoryAxis:!0,margin:s,preventNice:i.preventNiceX,innerPaddingRatio:i.innerPaddingRatio}),[this.xAxisProperties,this.yAxisProperties]},a.createClippedDataIfOverflowed=function(t,a){var i=t.hasHighlights?Math.min(t.series.data.length,2*a):Math.min(t.series.data.length,a);if(i>=t.series.data.length)return t;var r=e.Prototype.inherit(t);return r.series=e.Prototype.inherit(t.series),r.series.data=r.series.data.slice(0,i),r},a.hasDataPoint=function(e){return e&&e.data&&e.data.length>0},a.prototype.lookupXValue=function(e,a){var i=this.data;if(t.AxisHelper.isDateTime(a))return new Date(e);if(i&&i.series){var r=i.series.data;if(r){var o=r[e];if(o)return o.categoryValue}}return e},a.prototype.overrideXScale=function(e){this.xAxisProperties=e},a.prototype.render=function(i){var r=this;if(this.clippedData){var o=this.clippedData,n=o.series.data,s=o.hasHighlights,l=this.margin,c=this.currentViewport,u=c.width-(l.left+l.right),h=c.height-(l.top+l.bottom),d=this.xAxisProperties.scale,p=this.yAxisProperties.scale,g=this.xAxisProperties.categoryThickness*(1-this.xAxisProperties.innerPaddingRatio),y=g/2,m=this.style.colorPalette.dataColors.getNewColorScale().getColor(a.DotColorKey),v=!!this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsContext.attr("width",u).attr("height",h);var f=this.mainGraphicsContext.selectAll(a.DotClassSelector).data(n,function(e){return e.identity.getKey()});f.enter().append("circle").classed(a.DotClassName,!0),f.style({fill:m.value}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,v,s)}).classed("null-value",function(e){return null===e.value}).attr({r:function(e){return y},cx:function(e){return d(e.categoryIndex)+y},cy:function(e){return p(e.value)}}),f.exit().remove();var x=this.mainGraphicsContext.selectAll(a.DotLabelClassSelector).data(n,function(e){return e.identity.getKey()});x.enter().append("text").classed(a.DotLabelClassName,!0).attr({"text-anchor":a.DotLabelTextAnchor,dy:a.DotLabelVerticalOffset}),x.classed("null-value",function(e){return null===e.value}).classed("overflowed",!1).attr({x:function(e){return d(e.categoryIndex)+y},y:function(e){return p(e.value)}}).text(function(e){return r.yAxisProperties.formatter.format(e.value)});var C=!1;x.each(function(){if(!C&&!$("<div>").addClass($(this).attr("class")).hasClass("null-value")){e.TextMeasurementService.measureSvgTextElementWidth(this)>g&&(x.classed("overflowed",!0),C=!0)}}),x.exit().remove();var S;return this.interactivityService&&(S={dots:f,dotLabels:x,datapoints:n}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:S,labelDataPoints:[],labelsAreNumeric:!0,animateLabels:!1}}},a.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},a.prototype.createLegendDataPoints=function(i){var r=this.data;if(!r)return null;var o,n=r.series,s=n.data,l=t.Legend.getDefaultLegendData(this.style),c=[],u=this.xAxisProperties?this.xAxisProperties.axisType:e.ValueType.fromDescriptor({text:!0});if(r.series&&r.series.data){var h=r.series.data[0];o=h&&this.lookupXValue(h.categoryValue,u)}if(n.yCol){var d=a.formatStringProp,p=s[i],g=p&&p.value,y=t.converterHelper.getFormattedLegendLabel(n.yCol,this.dataViewCategorical.values,d),m=this.style.colorPalette.dataColors.getNewColorScale().getColor(a.DotColorKey),v=this.dataViewCategorical.values,f=v&&v.length>i?t.SelectionId.createWithIdAndMeasure(v[i].identity,v[i].source.queryName):t.SelectionId.createWithMeasure(v.source.queryName);c.push({color:m.value,icon:t.LegendIcon.Line,label:y,category:t.valueFormatter.format(o,t.valueFormatter.getFormatString(n.xCol,d)),measure:t.valueFormatter.format(g,t.valueFormatter.getFormatString(n.yCol,d)),identity:f,selected:!1,index:0})}return l.dataPoints=c,l},a.prototype.onClearSelection=function(){
this.interactivityService&&this.interactivityService.clearSelection()},a.converter=function(e,a,i){var r=e.categorical,o=r.categories&&r.categories.length>0?r.categories[0]:{source:void 0,values:[a],identity:void 0},n=t.AxisHelper.getCategoryValueType(o.source),s=t.AxisHelper.isDateTime(n),l=o.values;if(!_.isEmpty(r.values)){for(var c=r.values[0],u=!!c.highlights,h=[],d=0,p=c.values.length;d<p;d++){var g=new t.SelectionIdBuilder;o.identity&&(g=g.withCategory(o,d));var y=g.withMeasure(c.source.queryName).createSelectionId(),m=l[d];if((!s||null==m||m instanceof Date)&&(h.push({categoryValue:s&&m?m.getTime():m,value:c.values[d],categoryIndex:d,seriesIndex:0,selected:!1,identity:y,highlight:!1}),u)){var v=t.SelectionId.createWithHighlight(y),f=c.highlights[d];h.push({categoryValue:s&&m?m.getTime():m,value:f,categoryIndex:d,seriesIndex:0,selected:!1,identity:v,highlight:!0})}}return i&&i.applySelectionStateToData(h),{series:{xCol:o.source,yCol:c.source,data:h},hasHighlights:u,hasDynamicSeries:!0}}return{series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1}},a.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},a.prototype.getStaticSeriesRole=function(){},a.formatStringProp={objectName:"general",propertyName:"formatString"},a.ClassName="dataDotChart",a.DotClassName="dot",a.DotClassSelector=".dot",a.DotColorKey="dataDot",a.DotLabelClassName="label",a.DotLabelClassSelector=".label",a.DotLabelVerticalOffset="0.4em",a.DotLabelTextAnchor="middle",a}();t.DataDotChart=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.bindEvents=function(t,a){var i=this.dots=t.dots,r=t.dotLabels;e.InteractivityUtils.registerStandardInteractivityHandlers(i,a),r&&e.InteractivityUtils.registerStandardInteractivityHandlers(r,a)},t.prototype.renderSelection=function(t){this.dots.style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)})},t}();e.DataDotChartWebBehavior=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.CssConstants.createClassAndSelector,i=e.data.DataViewTransform,r=(t.labelPosition.auto,t.histogramProps.general.formatString),o="histogram",n=function(){function n(e){this.chartType=132,this.categoryAxisType=null,this.isScrollable=!1,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.axisInteractivity=e.featureSwitches.axisInteractivity}return n.prototype.init=function(e){if(this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.cartesianVisualHost=e.cartesianHost,this.element=e.element,this.tooltipService=e.services.tooltips,this.svg=e.svg,this.svg.classed(o,!0),this.unclippedGraphicsContext=this.svg.append("g").classed("histogramUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService){var a=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(t.SetFocusRingClassName,!a)}},n.prototype.setData=function(e){if(this.data=this.originalData={categories:[],categoryFormatter:null,series:[],valuesMetadata:[],hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!0,dataLabelsSettings:null,legendData:null,hasDynamicSeries:!0,isMultiMeasure:!1,binType:t.binType.numOfBins,binSize:n.DefaultBinSize,numberOfBins:n.DefaultBinCount},e.length>0){var a=this.dataView=n.view;a&&a.categorical&&(this.data=this.originalData=n.converter(a,this.style,a.metadata,this.chartType,this.interactivityService,!0,this.hostService,!0))}},n.prototype.calculateAxesProperties=function(e){this.margin=e.margin,this.currentViewport=e.viewport,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var a=this.data,i=a.categories.length,r=this.getPreferredPlotArea(!0,i,t.CartesianHelper.MinOrdinalRectThickness,e.outerPaddingRatio),o=a?a.preferredCategoryWidth:null,s=t.CartesianChart.getLayout(null,{availableWidth:r.width,categoryCount:i,preferredCategoryWidth:o,domain:null,isScalar:!0,isScrollable:!1,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:0}),l=n.getXAxisCreationOptions(a,r.width,s,e),c=n.getYAxisCreationOptions(a,r.height,e),u=this.xAxisProperties=t.AxisHelper.createAxis(l),h=this.yAxisProperties=t.AxisHelper.createAxis(c);return this.xAxisProperties.outerPaddingRatio=s.outerPaddingRatio,[u,h]},n.getXAxisCreationOptions=function(e,a,i,o){var n=t.AxisHelper.getCategoryValueType(e.categoryMetadata,!0),s=t.AxisHelper.createDomain(e.series,n,!0,t.AxisHelper.createIntervalDomain(e.series),o.ensureXDomain),l=i.categoryThickness,c=l*i.outerPaddingRatio;return{pixelSpan:a,dataDomain:s,metaDataColumn:e.categoryMetadata,formatString:t.valueFormatter.getFormatString(e.categoryMetadata,r),isScalar:!0,outerPadding:c,categoryThickness:l,forcedTickCount:o.forcedTickCount,isCategoryAxis:!0,axisDisplayUnits:o.categoryAxisDisplayUnits,axisPrecision:o.categoryAxisPrecision,outerPaddingRatio:i.outerPaddingRatio,preventNice:o.preventNiceX,innerPaddingRatio:0}},n.prototype.getVisualCategoryAxisIsScalar=function(){return!0},n.getYAxisCreationOptions=function(e,a,i){return{pixelSpan:a,dataDomain:t.AxisHelper.combineDomain(i.forcedYDomain,t.AxisHelper.createValueDomain(e.series),i.ensureYDomain),isScalar:!0,isVertical:!0,metaDataColumn:e.valuesMetadata,formatString:t.valueFormatter.getFormatString(e.valuesMetadata[0],r),outerPadding:0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,axisDisplayUnits:i.valueAxisDisplayUnits,axisPrecision:i.valueAxisPrecision,outerPaddingRatio:0,preventNice:i.preventNiceY}},n.prototype.getPreferredPlotArea=function(e,a,i,r){return t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,!1,e,this.margin,r)},n.prototype.overrideXScale=function(e){this.xAxisProperties=e},n.prototype.render=function(e){var a=this,i=this.data;if(i){var r=this.margin,o=this.currentViewport,s=o.height-(r.top+r.bottom),l=o.width-(r.left+r.right),c=i.series;this.mainGraphicsContext.attr("height",s).attr("width",l),this.mainGraphicsContext.selectAll(n.SeriesSelector.selector).remove();var u=this.mainGraphicsContext.selectAll(n.SeriesSelector.selector).data(c).enter().append("g").classed("bar",!0),h=u.selectAll(n.BinsSelector.selector).data(function(e){return e.data});h.enter().append("rect").classed(n.BinsSelector.class,!0).attr("x",function(e){return a.xAxisProperties.scale(e.categoryValue.min)}).attr("y",function(e){return a.yAxisProperties.scale(e.value)}).attr("height",function(e){return s-a.yAxisProperties.scale(e.value)}).attr("width",function(e){return a.xAxisProperties.scale(e.categoryValue.max)-a.xAxisProperties.scale(e.categoryValue.min)}).style("fill",function(e){return e.color}),h.exit().remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(u,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity});var d=[];if(this.interactivityService)for(var p=0,g=i.series.length;p<g;p++)d=d.concat(i.series[p].data);return t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:d,behaviorOptions:void 0,navigationOptions:void 0,labelDataPoints:[],labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:!0}}},n.converter=function(a,i,r,o,s,l,c,u){return void 0===r&&(r=null),void 0===l&&(l=!0),void 0===u&&(u=!0),__assign({},t.ColumnChart.converter(a,i,!1,!0,r,o,s,l,c,!1,!1,!1,n.buildCategories),{binType:e.DataViewObjects.getValue(a.metadata.objects,t.histogramProps.binning.binType),numberOfBins:e.DataViewObjects.getValue(a.metadata.objects,t.histogramProps.binning.binCount,n.DefaultBinCount),binSize:e.DataViewObjects.getValue(a.metadata.objects,t.histogramProps.binning.binSize,n.DefaultBinSize)})},n.buildCategories=function(e){for(var t=new Array,a=e.categories[0].values.length,i=0;i<a;i++)t.push({min:e.categories[0].values[i],max:e.categories[1].values[i]});return t},n.buildTooltipCategories=function(e,t,a){return t+=1,t===a?{displayName:_.first(e).displayName,value:"["+_.map(e,function(e){return e.value}).join(", ")+"]"}:{displayName:_.first(e).displayName,value:"["+_.map(e,function(e){return e.value}).join(", ")+")"}},n.prototype.enumerateObjectInstances=function(e,t){if(this.originalData)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"binning":this.enumerateBinning(e,t.objectName)}},n.prototype.enumerateBinning=function(e,a){var i={selector:null,properties:{binType:this.data.binType===t.binType.binSize?t.binType.binSize:t.binType.numOfBins},validValues:{},objectName:a};this.data.binType===t.binType.binSize?i.properties[t.histogramProps.binning.binSize.propertyName]=this.data.binSize:i.properties[t.histogramProps.binning.binCount.propertyName]=this.data.numberOfBins,e.pushInstance(i)},n.prototype.enumerateDataPoints=function(t){var a=this.originalData;a&&a.series&&0!==a.series.length&&e.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:t,dataPoints:_.map(a.series,function(e){return{color:e.color,displayName:e.displayName,identity:e.identity}})})},n.prototype.hasLegend=function(){return!0},n.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},n.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1,supportsValueAxis:!0}},n.prototype.getStaticSeriesRole=function(){return"Y"},n.BinsSelector=a("bin"),n.SeriesSelector=a("bar"),n.DefaultBinCount=5,n.DefaultBinSize=10,n.view={metadata:{columns:[{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:"Max of HourOfDay",queryName:"Sum(commits5.HourOfDay)",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}}],objects:{categoryAxis:{axisType:"Categorical"},general:{formatString:"0"}}},categorical:{categories:[{source:{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},values:[0,4,8,12,16,20],identity:null,identityFields:null},{source:{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:null,queryName:"query",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}},values:[4,8,12,16,20,24]}],values:i.createValueColumns([{source:{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},values:[5272,5427,11478,15509,12732,5158],highlights:[null,null,null,null,1662,2519]}])}},n}();t.Histogram=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.BrowserUtils,i=jsCommon.CssConstants.createClassAndSelector,r=jsCommon.EnumExtensions,o=e.data.Selector,n=function(){function n(e){var t=this;this.pathXAdjustment=0,this.deferDragMoveOperation=jsCommon.DeferUtility.deferUntilNextFrame(function(){if(t.lastDragMoveXPosition&&t.data&&t.margin){var e=n.findCategoryIndex({pointX:t.lastDragMoveXPosition-t.margin.left,offsetX:0,categoryData:t.data.categoryData,scaleDetector:t.scaleDetector,scale:t.xAxisProperties.scale,categoryThickness:t.xAxisProperties.categoryThickness,isScalar:t.data.isScalar});t.selectColumn(e),t.lastDragMoveXPosition=void 0}}),this.isScrollable=!!e.isScrollable&&e.isScrollable,this.tooltipsEnabledOnHost=e.tooltipsEnabled,this.lineType=e.chartType?e.chartType:1,this.interactivityService=e.interactivityService,this.animator=e.animator,this.lineClassAndSelector=n.LineClassSelector,this.axisInteractivity=e.featureSwitches.axisInteractivity,this.lineChartLabelPositionEnabled=e.featureSwitches.lineChartLabelPosition,this.dualAxisEnabled=e.featureSwitches.lineChartDualAxis,this.viewModelAdapter=e.viewModelAdapter}return n.convertCategoryValue=function(e,t,a){return(t||a)&&e?e.getTime():e},n.getDefaultLineChartLabelSettings=function(e,a){void 0===a&&(a=!1);var i=t.ColorHelper.getThemeColor(e,t.LabelUtils.DefaultLabelColorName),r=t.LabelUtils.getDefaultLabelSettings({style:e,labelColor:i,textClassName:"smallLightLabel"}).fontProperties,o={show:!1,position:t.labelPosition.auto,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,fontProperties:r,labelDensity:t.LabelUtils.defaultLabelDensity};return a?(o.enableBackground=!0,o.backgroundColor=t.ColorHelper.getThemeColor(e,t.BackgroundColorName),o.backgroundTransparency=t.LabelUtils.defaultComboChartLabelBackgroundOpacity):o.enableBackground=!1,o},n.converter=function(a){var i=a.dataView,r=a.style,o=a.interactivityService,s=a.shouldCalculateStacked,l=a.isComboChart,c=a.forecastDataView,u=a.dualAxisEnabled,h=a.tooltipsEnabled;null==h&&(h=!0);var d=t.CartesianHelper.getCategoryAxisProperties(i.metadata),p=t.CartesianHelper.isScalar(a.isScalar,d),g=[];l||g.push("Y"),(l||u)&&g.push("Y2");var y,m=i.categorical,v=t.CartesianHelper.getScalarKeyinfo(m,p),f=v.category,x=v.useScalarKeys,C=v.scalarKeys;x&&(y=e.Prototype.inherit(f.source),y.type={dateTime:!0});var S,b=t.lineChartProps.general.formatString,D=t.AxisHelper.getCategoryValueType(f.source,p),w=t.AxisHelper.isDateTime(D),P=f.values,L=[],A=[],V=[],M=m.values,I=!(!M||!M.source),k=n.getDefaultLineChartLabelSettings(r,a.isComboChart);if(i.metadata&&i.metadata.objects){S=i.metadata.objects;var T=S.labels;t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity(T,k,void 0,r,l)}var F,N=!p&&e.DataViewObjects.getValue(S,t.lineChartProps.lineStyles.showMarker,!1);M&&(F=M.grouped());var O;s&&(O=M&&M.length>0?_.times(M[0].values.length,function(){return 0}):[]);var H,R,B,E,U=!1,z=0;g.forEach(function(c){var u=e.data.createDataViewCategoricalReaderAdvanced(i,{staticSeriesRole:c,colorOptions:{visualStyle:r,valueRole:c,ignoreDefaultColor:a.isComboChart,ignoreDefaultCategoryColor:!0}}),d=u.data,g=u.columns,m=d.hasCategories()?d.getCategoryCount():1,v=d.getSeriesCount();if(B||(B=u.objects.getStaticObjects()),E||(E=t.LineStyle.readFromStaticObjects(B,N,r)),H=H?H.concat(g.getAllValueMetadataColumnsForRole(c)):g.getAllValueMetadataColumnsForRole(c),d.hasValues(c)){U=!0,null==R&&(R=I?t.converterHelper.formatFromMetadataColumn(d.getSeriesDisplayName(),g.getSeriesMetadataColumn(),b):void 0);for(var D=0;D<v;D++){var T=g.getValueColumn(c,D),G=T.source,j=[],W=t.SelectionIdBuilder.builder().withSeries(M,T).withMeasure(g.getValueMetadataColumn(c,D).queryName).createSelectionId(),X=W.getKey(),Y=u.colors.createBySeries(D,void 0,t.ForegroundColorName),q=r.isHighContrast?t.ColorHelper.getThemeColor(r,t.BackgroundColorName):Y,K=void 0;if(u.data.hasSeries()||l){var Z=void 0;Z=l&&!u.data.hasSeries()?u.objects.getValueMetadataObjects(c,D):u.objects.getSeriesDataObjects(D);var $=Z&&Z.labels;$&&(K=e.Prototype.inherit(k),t.LabelUtils.updateLabelSettingsFromLabelsObjectWithLabelDensity($,K,void 0,r,l))}for(var J=K?K:k,Q=T.highlights&&T.highlights.length>0,ee=e.DataViewObjects.getValue(S,t.lineChartProps.lineStyles.showSeries,!1),te=!p&&ee,ae=t.LineStyle.readFromSeriesObjects(u,E,D,te,ee,r),ie=-1,re=0;re<m;re++){var oe=P[re],ne=x?C.values[re].min:oe,se=t.AxisHelper.normalizeNonFiniteNumber(Q?d.getHighlight(c,re,D):d.getValue(c,re,D));if(!(p&&(null==ne||null==se)||w&&null!=oe&&!(oe instanceof Date)||(ie++,null==se&&D>0))){var le=void 0,ce=void 0,ue=void 0;if(h){if(le=[],f.source){ue=t.CategoryLevelUtils.getCategoryLevels(i.categorical.categories,re,b);var he=t.CategoryLevelUtils.concatenateCategoryLevels(ue);le.push({displayName:he.displayName,value:he.value})}I&&(f.source&&f.source===M.source||le.push({displayName:M.source.displayName,value:t.converterHelper.formatFromMetadataColumn(F[D].name,M.source,b)})),null!=se&&le.push({displayName:G.displayName,value:t.converterHelper.formatFromMetadataColumn(se,G,b,!1)}),ce=[],t.TooltipBuilder.addTooltipMeasures(u,ce,re,I?D:void 0,b),ce=_.isEmpty(ce)?void 0:ce}var de=new t.SelectionIdBuilder;d.hasCategories()&&(de=de.withCategory(g.getCategoryColumn("Category"),re)),I&&(de=de.withSeries(M,g.getValueColumn(c,D)));var pe=de.withMeasure(g.getValueMetadataColumn(c,D).queryName).createSelectionId(),ge=f&&!_.isEmpty(f.identity)&&f.identity[re]?f.identity[re].key:re,ye={categoryValue:n.convertCategoryValue(ne,w,x),value:se,categoryIndex:re,seriesIndex:D+z,tooltipInfo:le,selected:!1,identity:pe,key:JSON.stringify({series:X,category:ge}),labelFill:J.fontProperties.color,labelFormatString:G.format,labelSettings:J,additionalTooltipItems:ce,hierarchyCategoryLevels:ue,lineStyle:ae,isY2:!l&&"Y2"===c};if(s&&(O[re]+=se,ye.stackedValue=O[re]),f.objects&&f.objects[re]){var me=t.ColorHelper.create(r);ye.pointColor=me.getColorForProperty(f.objects[re],t.lineChartProps.dataPoint.fill,void 0)}if(j[ie]=ye,L[re]||(L[re]=t.CartesianHelper.extractCategoryFromDataPoint(ye)),L[re]&&!L[re].hasData&&(L[re].hasData=null!=ye.value),!A[re]&&d.hasCategories()){var ve=new t.SelectionIdBuilder;A[re]=ve.withCategory(g.getCategoryColumn("Category"),re).withMeasure(g.getValueMetadataColumn(c,D).queryName).createSelectionId()}}}o&&o.applySelectionStateToData(_.filter(j,function(e){return null!=e}));var fe=void 0;fe=u.columns.hasDynamicSeries()?t.valueFormatter.format(u.data.getSeriesName(D),u.objects.getSeriesFormatString(D)):u.columns.hasStaticSeries()?u.data.getSeriesName(D):u.data.getValueDisplayName(c),j.length>0&&V.push({seriesName:fe,key:X,lineIndex:D+z,color:Y,areaColor:q,xCol:x?y:f.source,yCol:g.getValueMetadataColumn(c,D),data:j,identity:W,selected:!1,labelSettings:K,type:G.type,lineStyle:ae,isY2:!l&&"Y2"===c})}z=D}});var G;if(c&&p&&!s&&!l){G=t.ForecastHelper.readDataView(c,i,r);for(var j=_.last(L),W=0,X=G;W<X.length;W++)for(var Y=X[W],q=j.categoryIndex,K=0,Z=Y.points;K<Z.length;K++){var $=Z[K];$.point.x=n.convertCategoryValue($.point.x,w,x),$.upperBound.x=n.convertCategoryValue($.upperBound.x,w,x),$.lowerBound.x=n.convertCategoryValue($.lowerBound.x,w,x);var J=$.point.x;J<=j.categoryValue||(q++,L[q]||(L[q]={categoryIndex:q,categoryValue:J,hasData:null!=$.point.y}),A[q]||(A[q]=null))}}var Q=!1,ee=i.metadata&&i.metadata.dataReduction;ee&&ee.categorical&&(ee.categorical.metadata&&ee.categorical.metadata.binnedLineSample||ee.categorical.categories&&ee.categorical.categories.binnedLineSample||ee.categorical.values&&ee.categorical.values.binnedLineSample)&&(Q=!0),d=t.CartesianHelper.getCategoryAxisProperties(i.metadata);var te=t.CartesianHelper.getPreferredCategoryWidth(d);return o&&o.applySelectionStateToData(V),{series:V,forecastLines:G,isScalar:p,dataLabelsSettings:k,hasDynamicSeries:I,categoryMetadata:f.source,valuesMetadata:H,preferredCategoryWidth:te,scalarMetadata:y,scalarKeyCount:x?C.values.length:void 0,categories:P,categoryData:L,seriesDisplayName:R,hasValues:U,categoryIdentities:A,lineStyle:E,binnedLineSamplingApplied:Q,legendMarkerRendering:e.DataViewObjects.getValue(B,t.lineChartProps.legend.legendMarkerRendering,t.legendMarkerRendering.markerOnly),matchLineColor:e.DataViewObjects.getValue(B,t.lineChartProps.legend.matchLineColor,!0),defaultToCircle:e.DataViewObjects.getValue(B,t.lineChartProps.legend.defaultToCircle,!0)}},n.getInteractiveLineChartDomElement=function(e){return e.children("svg").get(0)},n.createStackedValueDomain=function(e){return 0===e.length?null:[d3.min(e,function(e){return d3.min(e.data,function(e){return e&&e.stackedValue})}),d3.max(e,function(e){return d3.max(e.data,function(e){return e&&e.stackedValue})})]},n.prototype.init=function(e){var i=this;this.options=e,this.element=e.element,this.cartesainSVG=e.svg,this.host=e.host,this.currentViewport=e.viewport,this.style=e.style,this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.scaleDetector=new t.SVGScaleDetector(this.cartesainSVG);var r=e.chartType;this.isComboChart=11===r||14===r||15===r;var o=e.svg;o.classed(n.ClassName,!0);var l=this.mainGraphicsSVG=o.append("svg").classed("lineChartSVG",!0);this.svgDefs=l.append("defs");var c=!this.isComboChart&&!this.isInteractiveChart;if(this.tooltipService=new s(e.services.tooltips,l,c),this.mainGraphicsContext=l.append("g").attr("aria-label",this.host.getLocalizedString("Visual_Plot")).classed(n.MainGraphicsContextClassName,!0),this.interactivityService)if(this.isComboChart)this.mainGraphicsContext.attr("skip-children-focus",!0);else{var u=a.isInternetExplorerOrEdge();this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0).classed(t.SetFocusRingClassName,!u)}this.hoverLineContext=o.append("g").classed("hover-line",!0),this.hoverLineContext.append(n.LineElementName).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0);var h=this.hoverLine=this.hoverLineContext.select(n.LineElementName);if(this.isInteractiveChart&&h.classed("interactive",!0),h.style("opacity",t.SVGUtil.AlmostZero),h.style("stroke",t.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")),this.selectionCircles=[],this.xAxisProperties={axis:null,scale:null,axisType:null,formatter:null,graphicsContext:null,values:null,axisLabel:null,isCategoryAxis:!0},this.isInteractiveChart){var d=n.getInteractiveLineChartDomElement(this.element),p=function(){i.lastDragMoveXPosition=d3.mouse(d)[0],i.deferDragMoveOperation()},g=d3.behavior.drag().origin(Object).on("drag",p);d3.select(d).style("touch-action","none").call(g).on("click",p)}this.markerRenderer=new t.MarkerRenderer},n.prototype.setData=function(e){if(this.data=this.originalData={series:[],dataLabelsSettings:n.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],categoryIdentities:[],lineStyle:t.LineStyle.getDefault(),binnedLineSamplingApplied:!1,legendMarkerRendering:t.legendMarkerRendering.markerOnly,matchLineColor:!1,defaultToCircle:!0},this.focusedDatum=void 0,e.length>0){var a=e[0],i=_.find(e,function(e){return t.ForecastHelper.isDataViewForForecast(e)});if(a&&a.categorical){this.dataView=a;var o=a.categorical,s=o.categories,l={text:!0},c=void 0;s&&!_.isEmpty(s)&&(s[0].source&&s[0].source.type&&(l=s[0].source.type),c=t.ScalarUtils.getScalarKeys(s[0]));var u=t.CartesianHelper.hasCategoryHierarchy(a),h=t.ScalarUtils.shouldDrawScalar(a.metadata?a.metadata.objects:null,t.lineChartProps.categoryAxis.axisType,l,c,u),d=this.host&&this.host.tooltips(),p=!(!d||!d.enabled()),g=this.tooltipsEnabled=this.tooltipsEnabledOnHost&&(!d||p);this.data=this.originalData=n.converter({dataView:a,style:this.style,isScalar:h,interactivityService:this.interactivityService,isComboChart:this.isComboChart,tooltipsEnabled:g,forecastDataView:i,shouldCalculateStacked:r.hasFlag(this.lineType,16),dualAxisEnabled:this.dualAxisEnabled});var y=this.previousCategoryIds,m=this.data.categoryIdentities;this.suppressAnimation=n.shouldSuppressAnimations(y,m),this.previousCategoryIds=m;var v=_.find(this.data.series,function(e){return e.data[0]});this.focusedDatum=v&&v.data[0]}}else this.dataView=void 0},n.shouldSuppressAnimations=function(e,a){var i;if(null!=e&&!(e.length>t.AnimatorCommon.MaxDataPointsToAnimate||a.length>t.AnimatorCommon.MaxDataPointsToAnimate))if(i=!1,0===e.length)i=!0;else for(var r=0,o=Math.min(e.length,a.length);r<o;r++)if(!t.SelectionId.isEqual(e[r],a[r])){i=!0;break}return i},n.prototype.getValueDomain=function(e,a){var i=this.data,o=this.ensureDomainsIncludeForecast(i.forecastLines,e.ensureXDomain,e.ensureYDomain).y,s=r.hasFlag(this.lineType,16)?n.createStackedValueDomain(i.series):t.AxisHelper.createValueDomain(i.series,a);return t.AxisHelper.combineDomain(e.forcedYDomain,s,o)},n.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},n.prototype.setFilteredData=function(t,a){var i=a-t,r=this.scrolledData=e.Prototype.inherit(this.data);return r.series=n.sliceSeries(r.series,i,t),r.categories=r.categories.slice(t,a),r},n.prototype.ensureDomainsIncludeForecast=function(e,t,a){if(_.isEmpty(e))return{x:t,y:a};for(var i=[t.min,t.max],r=[a.min,a.max],o=0,n=e;o<n.length;o++){var s=n[o];_.isEmpty(s.points)||(i.push.apply(i,_.map(s.points,function(e){return e.point.x})),r.push.apply(r,_.map(s.points,function(e){return e.point.y})),i.push.apply(i,_.map(s.points,function(e){return e.upperBound.x})),r.push.apply(r,_.map(s.points,function(e){return e.upperBound.y})),i.push.apply(i,_.map(s.points,function(e){return e.lowerBound.x})),r.push.apply(r,_.map(s.points,function(e){return e.lowerBound.y})))}return{x:{min:d3.min(i),max:d3.max(i)},y:{min:d3.min(r),max:d3.max(r)}}},n.prototype.calculateAxesProperties=function(a){var i=this,o=a.viewport;this.currentViewport=o,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var s=this.data,l=a.margin;this.margin=l;var c=s.series&&s.series.length>0?s.series[0].data.length:0,u=s?this.getCategoryLayout(c,a):{categoryCount:0,categoryThickness:t.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio,isScalar:!1},h=this.data.isScalar;this.trimOrdinalDataOnOverflow=a.trimOrdinalDataOnOverflow;var d=this.getPreferredPlotArea(u.isScalar,u.categoryCount,u.categoryThickness,u.outerPaddingRatio);if(this.scrolledData=void 0,s&&!h&&!this.isScrollable&&this.trimOrdinalDataOnOverflow){var p=Math.min(c,u.categoryCount);p!==c&&(s=this.scrolledData=e.Prototype.inherit(s),this.scrolledData.series=n.sliceSeries(s.series,p),this.scrolledData.categories=s.categories.slice(0,p))}var g=a.roleName,y=s.series,m=!1,v=this.data.valuesMetadata;_.some(y,function(e){return e.isY2})&&("Y2"===g?(y=_.filter(y,function(e){return e.isY2}),v=_.filter(v,{roles:{Y2:!0}}),m=!0):(y=_.filter(y,function(e){return!e.isY2}),v=_.filter(v,{roles:{Y:!0}})));var f,x;f=!_.isEmpty(s.series)&&s.series[0].xCol,y&&y.length>0&&(x=y[0].yCol);var C=this.ensureDomainsIncludeForecast(s.forecastLines,a.ensureXDomain,m?a.ensureY2Domain:a.ensureYDomain),S=C.x,b=C.y,D=r.hasFlag(this.lineType,16)?n.createStackedValueDomain(y):t.AxisHelper.createValueDomain(y),w=t.AxisHelper.combineDomain(a.forcedYDomain,D,b),P=t.AxisHelper.createAxis({pixelSpan:d.height,dataDomain:w,zeroScalarDomain:[-1,1],metaDataColumn:v,formatString:t.valueFormatter.getFormatString(x,t.lineChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:a.valueAxisScaleType,axisDisplayUnits:a.valueAxisDisplayUnits,axisPrecision:a.valueAxisPrecision,shouldClamp:!1,outerPaddingRatio:0,margin:l,preventNice:a.preventNiceY});m?this.y2AxisProperties=P:this.yAxisProperties=P;var L=s.scalarMetadata?s.scalarMetadata:s.categoryMetadata,A=t.AxisHelper.getCategoryValueType(L),V=t.AxisHelper.createDomain(s.series,A,this.data.isScalar,a.forcedXDomain,S);return this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:d.width,dataDomain:V,zeroScalarDomain:[-1,1],metaDataColumn:f,formatString:t.valueFormatter.getFormatString(f,t.lineChartProps.general.formatString),outerPadding:this.data.isScalar?n.ScalarOuterPadding:0,isScalar:this.data.isScalar,isVertical:!1,forcedTickCount:a.forcedTickCount,maxTickCount:s.scalarKeyCount,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,a){return t.CartesianHelper.lookupXValue(i.data,e,a,i.data.isScalar)},categoryThickness:u.categoryThickness,isCategoryAxis:!0,scaleType:a.categoryAxisScaleType,axisDisplayUnits:a.categoryAxisDisplayUnits,axisPrecision:a.categoryAxisPrecision,outerPaddingRatio:u.outerPaddingRatio,margin:l,allowSingleScalarTick:this.data.isScalar,preventNice:a.preventNiceX}),this.axisInteractivity&&this.interactivityService&&!this.data.isScalar&&(this.xAxisProperties.categoryIdentities=_.map(s.categoryIdentities,function(e){return function(){return e}})),[this.xAxisProperties,P]},n.prototype.getCategoryLayout=function(e,a){var i=this.getAvailableWidth(),r=this.data?this.data.preferredCategoryWidth:null,o=this.data?this.data.categoryMetadata:void 0,n=t.AxisHelper.getCategoryValueType(o),s=this.getVisualCategoryAxisIsScalar(),l=t.AxisHelper.createDomain(this.data.series,n,s,a.forcedXDomain,a.ensureXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:i,categoryCount:e,preferredCategoryWidth:r,domain:l,isScalar:s,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},n.prototype.enumerateObjectInstances=function(e,a){var i=this.originalData;if(i)switch(a.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case t.lineChartProps.lineStyles.strokeLineJoin.objectName:n.enumerateLineStyles(e,i,this.dataView);break;case t.ForecastHelper.forecastObjectName:this.supportsForecast()&&t.ForecastHelper.enumerateObjectInstances(e,i.forecastLines,this.style)}},n.prototype.enumerateDataPoints=function(t){var a=this.originalData;a&&a.series&&0!==a.series.length&&e.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:t,dataPoints:_.map(a.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}})})},n.prototype.enumerateDataLabels=function(e){var a,i=this.originalData,r=i.dataLabelsSettings,n=i.series.length,s=this.showLabelPerSeries();if(this.lineChartLabelPositionEnabled&&(a=[t.labelPosition.auto,t.labelPosition.above,t.labelPosition.under]),this.isStacked()&&(a=[t.labelPosition.auto,t.labelPosition.insideCenter,t.labelPosition.insideEnd],r.position&&a.indexOf(r.position)<0&&(r.position=t.labelPosition.auto)),t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,r,null,s,a)),s&&r.showLabelPerSeries)for(var l=0;l<n;l++){var c=i.series[l],u=c.labelSettings?c.labelSettings:i.dataLabelsSettings;e.pushContainer({displayName:c.seriesName});var h=c.identity.getSelector();i.hasDynamicSeries&&(h=o.normalizeSelector(h)),t.LabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,u,h,void 0,a)),e.popContainer()}},n.enumerateLineStyles=function(a,i,r){var o;i.series.length>1&&(o=e.DataViewObjects.getValue(r&&r.metadata&&r.metadata.objects,t.lineChartProps.lineStyles.showSeries,!1));var n=!i.isScalar;if(t.LineStyle.enumerate({enumeration:a,style:i.lineStyle,showSeries:o,enumerateMarkers:n}),o)for(var s=0,l=i.series.length;s<l;s++){var c=i.series[s];a.pushContainer({displayName:c.seriesName}),t.LineStyle.enumerate({enumeration:a,style:c.lineStyle,enumerateMarkers:n,selector:c.identity.getSelector()}),a.popContainer()}},n.prototype.supportsTrendLine=function(){var e=this.getVisualCategoryAxisIsScalar(),t=this.haveY2Data()&&!this.isComboChart;return!r.hasFlag(this.lineType,16)&&e&&this.data.hasValues&&!t},n.prototype.supportsForecast=function(){var e=this.getVisualCategoryAxisIsScalar();return!r.hasFlag(this.lineType,16)&&e&&this.data.hasValues&&1===this.data.series.length&&!this.hasLegend()},n.prototype.isStacked=function(){return r.hasFlag(this.lineType,16)},n.prototype.shouldSuppressAnimation=function(){return!!this.suppressAnimation},n.prototype.showLabelPerSeries=function(){var e=this.originalData;return e.series.length>1||!e.categoryMetadata||this.isComboChart},n.prototype.getLabelSettingsOptions=function(e,t,a,i,r){return{enumeration:e,dataLabelsSettings:t,show:!0,position:this.lineChartLabelPositionEnabled,
positionObject:r,displayUnits:!0,precision:!0,selector:a,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data.isScalar,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style}},n.prototype.overrideXScale=function(e){this.xAxisProperties=e},n.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},n.prototype.render=function(e){var a=t.AnimatorCommon.GetAnimationDuration(this.animator,e);this.suppressAnimation&&(a=0),this.previousCategoryCount=this.data.categoryData.length;var i,r=this.buildViewModel(a),o={hoverLine:this.hoverLine,hoverLineContext:this.hoverLineContext,mainGraphicsContext:this.mainGraphicsContext,svgDefs:this.svgDefs,mainGraphicsSVG:this.mainGraphicsSVG};if(this.isInteractiveChart){var s=$.extend(o,{dragHandle:this.dragHandle,selectionCircles:this.selectionCircles});i=n.renderOld(r,s,this.interactivityService,this,this,this.isInteractiveChart,e,this.markerRenderer,this.style),s.dragHandle&&(this.dragHandle=s.dragHandle)}else i=n.renderNew({viewModel:r,renderContext:o,interactivityService:this.interactivityService,plotAreaHelper:this,tooltipService:this.tooltipService,tooltipInteractivity:this,markerRenderer:this.markerRenderer,style:this.style});return this.interactivityService&&(i.navigationOptions={helper:this,navigationStrategy:r.data.isScalar?t.DataPointNavigationStrategy.SeriesFirst:t.DataPointNavigationStrategy.CategoryFirst}),t.ForecastHelper.render(this.data.forecastLines,o.mainGraphicsSVG,r.xAxisProperties.scale,r.yAxisProperties.scale,r.currentViewport,r.animationDuration),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),i},n.prototype.buildViewModel=function(e){return{currentViewport:this.currentViewport,data:this.scrolledData||this.data,allData:this.data,animationDuration:e,horizontalOffset:this.getXOfFirstCategory(),isComboChart:this.isComboChart,lineClassAndSelector:this.lineClassAndSelector,lineType:this.lineType,margin:this.margin,scale:this.scaleDetector.getScale(),tooltipsEnabled:this.tooltipsEnabled,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,y2AxisProperties:this.y2AxisProperties,focusedDatum:this.focusedDatum}},n.renderNew=function(e){var a=e.viewModel,i=e.renderContext,o=e.plotAreaHelper,s=e.tooltipService,l=e.tooltipInteractivity,c=e.viewModel.data,u=e.markerRenderer,h=e.style;if(c){u.ensureMarkers(e.renderContext.svgDefs,_.map(a.data.series,function(e){return e.lineStyle.markerProperties}));var d=r.hasFlag(a.lineType,16),p=a.margin,g=a.currentViewport,y=g.height-(p.top+p.bottom),m=g.width-(p.left+p.right),v=a.xAxisProperties.scale,f=a.yAxisProperties.scale,x=a.y2AxisProperties&&a.y2AxisProperties.scale,C=a.horizontalOffset,S=c.isScalar,b=a.focusedDatum,D=e.interactivityService&&e.interactivityService.hasSelection(),w=r.hasFlag(a.lineType,2)||r.hasFlag(a.lineType,16),P=w||c.lineStyle.shadeArea||_.some(c.series,function(e){return e.lineStyle.shadeArea}),L=a.animationDuration;(c.categories.length*c.series.length>t.AnimatorCommon.MaxDataPointsToAnimate||u.shouldDisableAnimations()&&_.some(a.data.series,function(e){return e.lineStyle.markerProperties.showMarker})||P)&&(L=0);var A,V,M=function(e){return v(n.getXValue(e,S))+C};d?(A=function(e){return f(e.stackedValue-e.value)},V=function(e){return f(e.stackedValue)}):(A=function(e){return e.isY2?x(0):f(0)},V=function(e){return e.isY2?x(e.value):f(e.value)});var I,k;P&&(I=n.getAreaGenerator(M,A,V),k=n.getAreaGenerator(M,A,V),k.interpolate("step"));var T=n.getLineGenerator(M,V),F=n.getLineGenerator(M,V);F.interpolate("step"),r.hasFlag(a.lineType,4)&&(T.interpolate("basis"),I&&I.interpolate("basis")),i.mainGraphicsSVG.attr("height",y).attr("width",m);var N;P?(N=i.mainGraphicsContext.selectAll(n.CategoryAreaSelector.selector).data(_.filter(c.series,function(e){return w||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()}),N.enter().append(n.PathElementName).classed(n.CategoryAreaSelector.class,!0),N.style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return D&&!e.selected?n.DimmedAreaFillOpacity:n.AreaFillOpacity}),L?N.transition().ease("linear").duration(L).attr("d",function(e){return e.lineStyle.stepped?k(e.data):I(e.data)}):N.attr("d",function(e){return e.lineStyle.stepped?k(e.data):I(e.data)}),N.exit().remove()):N=i.mainGraphicsContext.selectAll(n.CategoryAreaSelector.selector).remove();var O=i.mainGraphicsContext.selectAll(a.lineClassAndSelector.selector).data(c.series,function(e){return e.identity.getKey()});O.enter().append(n.PathElementName).classed(a.lineClassAndSelector.class,!0),O.style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("stroke-width",function(e){return e.lineStyle.strokeWidth}).style("stroke-linejoin",function(e){return e.lineStyle.lineJoin}).style("stroke-dasharray",function(e){return t.LineStyle.getStrokeDashArrayFromLineStyle(e.lineStyle.style)}),L?O.transition().ease("linear").duration(L).attr("d",function(e){return e.lineStyle.stepped?F(e.data):T(e.data)}):O.attr("d",function(e){return e.lineStyle.stepped?F(e.data):T(e.data)}),O.exit().remove();var H=i.mainGraphicsContext.selectAll(n.MarkerLineClassSelector.selector).data(_.filter(c.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()});H.enter().append(n.PathElementName).classed(n.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",t.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0);var R;L?R=H.transition().ease("linear").duration(L).attr("d",function(e){return T(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"):H.attr("d",function(e){return T(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"),u.renderMarkers(R||H),H.exit().remove();var B=i.mainGraphicsContext.selectAll(n.InteractivityLineClassSelector.selector).data(c.series,function(e){return e.identity.getKey()});B.enter().append(n.PathElementName).classed(n.InteractivityLineClassSelector.class,!0).style("stroke-width",n.interactivityStrokeWidth).style("stroke-linejoin",t.strokeLineJoin.round),B.attr("d",function(e){if(!S){var t=n.getFirstPathPointFromSeriesData(e);if(t){var a=_.find(e.data,function(e){return e&&null!=e.value});if(a&&a.categoryIndex!==t.categoryIndex){var i=e.data.slice(t.categoryIndex-a.categoryIndex);return e.lineStyle.stepped?F(i):T(i)}}}return e.lineStyle.stepped?F(e.data):T(e.data)}),B.exit().remove();var E=i.mainGraphicsContext.selectAll(n.CategorySelector.selector).data(c.series,function(e){return e.identity.getKey()});E.enter().append("g").classed(n.CategorySelector.class,!0),E.exit().remove();var U=E.selectAll(n.CategoryValuePoint.selector).data(function(e){return e.data.filter(function(t,a){return n.shouldDrawCircle(e,a)})},function(e){return e.key});U.enter().append(n.CircleElementName).classed(n.CategoryValuePoint.class,!0),U.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return e.lineStyle.markerProperties.showMarker?0:t.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}),L?U.transition().duration(L).attr({cx:function(e,t){return v(n.getXValue(e,S))+C},cy:function(e,t){return e.isY2?x(e.value):f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+n.CircleRadiusExtra}):U.attr({cx:function(e,t){return v(n.getXValue(e,S))+C},cy:function(e,t){return e.isY2?x(e.value):f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+n.CircleRadiusExtra}),U.exit().remove();var z=E.selectAll(n.CategoryPointSelector.selector).data(function(e){return!a.isComboChart&&S?_.filter(e.data,function(e){return e&&null!=e.pointColor}):[]},function(e){return e.key});z.enter().append(n.CircleElementName).classed(n.CategoryPointSelector.class,!0),z.style("fill",function(e){return e.pointColor}),L?z.transition().duration(L).attr({cx:function(e){return v(n.getXValue(e,S))},cy:function(e,t){return e.isY2?x(e.value):f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+n.PointRadiusExtra}):z.attr({cx:function(e){return v(n.getXValue(e,S))},cy:function(e,t){return e.isY2?x(e.value):f(d?e.stackedValue:e.value)},r:c.lineStyle.strokeWidth/2+n.PointRadiusExtra}),z.exit().remove();i.mainGraphicsContext.selectAll(n.SelectedMarkerLineClassSelector.selector).data([0]).enter().append("g").attr("class",n.SelectedMarkerLineClassSelector.class);var G=this.renderSelectedPointsGenerator(i.mainGraphicsContext,a);G();var j;e.interactivityService&&(j=this.updateFocusElement(i.mainGraphicsContext,b,a));var W;c.dataLabelsSettings.show&&(W=n.createLabelDataPoints(a,h));var X={width:m,height:y,interactivityLines:B,dots:U,explicitDots:z,isComboChart:a.isComboChart,binnedLineSamplingApplied:c.binnedLineSamplingApplied,hasDynamicSeries:c.hasDynamicSeries};s.removeTooltips(X,l),a.tooltipsEnabled&&s.applyTooltips(X,o,l);var Y,q;if(e.interactivityService){Y=[];for(var K=0,Z=a.allData.series;K<Z.length;K++){var $=Z[K],J=_.filter($.data,function(e){return e});Y.push.apply(Y,J)}q={lines:O,interactivityLines:B,root:i.mainGraphicsContext,focusMarker:j,selectedMarkersCallback:G,dots:U,areas:N,tooltipOverlay:s.getTooltipOverlayElement(),getCategoryIndex:function(e,t,a){return a=a&&!s.usingHoverLine,o.getCategoryIndexFromSeriesAndPointX(e,t,a)},categoryIdentities:c.categoryIdentities,markerPaths:H}}return{dataPoints:Y,behaviorOptions:q,labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:W,animateLabels:!1}}},n.getAreaGenerator=function(e,t,a){return d3.svg.area().x(e).y0(t).y1(a).defined(function(e){return e&&null!==e.value})},n.getLineGenerator=function(e,t){return d3.svg.line().x(e).y(t).defined(function(e){return e&&null!==e.value})},n.renderSelectedPointsGenerator=function(e,a){var i=a.data,o=i.series,s=i.isScalar,l=r.hasFlag(a.lineType,16),c=a.horizontalOffset,u=a.xAxisProperties.scale,h=a.yAxisProperties.scale,d=a.y2AxisProperties&&a.y2AxisProperties.scale,p=e.selectAll(n.SelectedMarkerLineClassSelector.selector);return function(){var i=_.flatten(_.map(o,function(e){return _.filter(e.data,function(e){return e&&e.selected})})),r=p.selectAll(n.PathElementName).data(i,function(e){return e.key}),g=_.map(i,function(e){return e.seriesIndex});return r.enter().append(n.PathElementName).attr("pointer-events","none"),r.attr("d",function(e){return e.lineStyle.markerProperties.showMarker?t.Markers.getPathWithRadius(e.lineStyle.markerProperties.shape,e.lineStyle.markerProperties.size*t.MarkerRenderer.sizeRatio):t.Markers.getPathWithRadius(t.markerShape.circle,e.lineStyle.strokeWidth/2+n.TooltipCircleRadiusExtra)}).attr("transform",function(e){return"translate("+(u(n.getXValue(e,s))+c)+","+(e.isY2?d(e.value):h(l?e.stackedValue:e.value))+")"}).style("stroke-width",function(e){return t.Markers.getStrokeWidth(e.lineStyle.markerProperties.shape)}).style("stroke-opacity",1).style("stroke",function(e){return e.lineStyle.markerProperties.color}).style("fill",function(e){return e.lineStyle.markerProperties.color}),r.exit().remove(),e.selectAll(a.lineClassAndSelector.selector).each(function(e){e.selected=g.indexOf(e.lineIndex)>-1||0===g.length}).style("stroke-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,!0,!1)}),r}},n.updateFocusElement=function(e,i,o){var s=o.xAxisProperties.scale,l=o.yAxisProperties.scale,c=o.y2AxisProperties&&o.y2AxisProperties.scale,u=o.data.isScalar,h=(o.data.lineStyle,o.horizontalOffset),d=r.hasFlag(o.lineType,16),p=a.isInternetExplorerOrEdge(),g=e.selectAll(n.FocusElementSelector.selector).data(i?[i]:[]);return g.enter().append(n.CircleElementName).attr("class",n.FocusElementSelector.class).attr("tabindex",0).attr("focusable",!0).classed(t.SetFocusRingClassName,!p),g.attr("aria-label",function(e){return t.tooltipUtils.formatTooltipInfo(e.tooltipInfo)}).attr("cx",function(e){return s(n.getXValue(e,u))+h||0}).attr("cy",function(e){return e.isY2?c(e.value):l(d?e.stackedValue:e.value)}).attr("r",function(e){var a=e.lineStyle.markerProperties;return a.showMarker?a.size*t.MarkerRenderer.sizeRatio:e.lineStyle.strokeWidth/2+n.TooltipCircleRadiusExtra}).style("fill","none"),g.exit().remove(),g},n.prototype.getFirstElement=function(e,t){if(void 0===t&&(t=!1),null!=e){var a,i=t?_.findLast:_.find;if(i(this.data.series,function(t){return a=i(t.data,function(t){return t&&t.categoryIndex===e&&null!=t.value})}),a&&this.scrolledData&&this.scrolledData.categories.indexOf(a.categoryValue)===-1)return null;this.focusedDatum=a;return n.updateFocusElement(this.mainGraphicsContext,a,this.buildViewModel(0)).node()}return this.mainGraphicsContext.select(n.FocusElementSelector.selector).node()},n.prototype.getNextDataPoint=function(e,a,i){var r=this.focusedDatum,o=!1;switch(i){case t.DataDirection.NextCategory:case t.DataDirection.PreviousCategory:var s=this.data.series[a].data,l=_.findIndex(s,function(t){return t&&t.categoryIndex===e});r=this.pickNextAvailableIndex(s,l,a,i);break;case t.DataDirection.NextSeries:case t.DataDirection.PreviousSeries:o=!0;var c=_.map(this.data.series,function(t){return _.find(t.data,function(t){return t&&t.categoryIndex===e})});r=this.pickNextAvailableIndex(c,a,e,i);break;default:debug.assertNever(i)}if(!r&&o){var u=i===t.DataDirection.NextSeries?1:-1,h=this.data.categories.length;return e=this.incrementIndex(e,u,h),{element:null,targetCategoryIndex:e}}if(r){if(this.scrolledData&&this.scrolledData.categories.indexOf(r.categoryValue)===-1)return{element:null,targetCategoryIndex:r.categoryIndex};this.focusedDatum=r;return{element:n.updateFocusElement(this.mainGraphicsContext,r,this.buildViewModel(0)).node(),targetCategoryIndex:r.categoryIndex}}},n.prototype.pickNextAvailableIndex=function(e,a,i,r){var o=r===t.DataDirection.NextCategory||r===t.DataDirection.PreviousCategory?this.rollToNextSeries:this.rollToNextCategory,n=r===t.DataDirection.NextSeries||r===t.DataDirection.NextCategory?1:-1,s=a;do{if(s+=n,s>=e.length||s<0)return o.call(this,i,r);if(s===a)break}while(!e[s]||null==e[s].value);return e[s]},n.prototype.rollToNextSeries=function(e,a){var i=a===t.DataDirection.PreviousCategory?-1:1,r=a===t.DataDirection.PreviousCategory?_.findLast:_.find,o=this.data.series.length;return e=this.incrementIndex(e,i,o),r(this.data.series[e].data,function(e){return e&&null!=e.value})},n.prototype.rollToNextCategory=function(e,a){var i=a===t.DataDirection.PreviousSeries?-1:1,r=a===t.DataDirection.PreviousSeries?_.findLast:_.find,o=this.data.categories.length;e=this.incrementIndex(e,i,o);var n=_.map(this.data.series,function(t){return _.find(t.data,function(t){return t&&t.categoryIndex===e})}),s=r(n,function(e){return e&&null!=e.value});return s||(s=r(n,function(e){return!!e})),s},n.prototype.incrementIndex=function(e,t,a){return e+=t,e>=a?e=0:e<0&&(e=a-1),e},n.renderOld=function(e,a,i,o,s,l,c,u,h){var d=e.data;if(d){var p=e.margin,g=e.currentViewport,y=g.height-(p.top+p.bottom),m=e.xAxisProperties.scale,v=e.yAxisProperties.scale,f=e.y2AxisProperties&&e.y2AxisProperties.scale,x=d.isScalar,C=e.animationDuration;u.shouldDisableAnimations()&&(C=0);var S,b=g.width-(p.left+p.right),D=g.height-(p.top+p.bottom),w=i&&i.hasSelection(),P=function(e){return e.isY2?f(e.value):v(e.value)},L=r.hasFlag(e.lineType,16)||r.hasFlag(e.lineType,2),A=L||d.lineStyle.shadeArea||_.some(d.series,function(e){return e.lineStyle.shadeArea});A&&(S=d3.svg.area().x(function(e){return m(n.getXValue(e,x))}).y0(y).y1(P).defined(function(e){return null!==e.value}));var V=d3.svg.line().x(function(e){return m(n.getXValue(e,x))}).y(P).defined(function(e){return!!e&&null!==e.value});r.hasFlag(e.lineType,4)&&(V.interpolate("basis"),S&&S.interpolate("basis"));var M=e.horizontalOffset;if(a.mainGraphicsContext.attr("transform",t.SVGUtil.translate(M,0)),a.mainGraphicsSVG.attr("height",D).attr("width",b),a.hoverLineContext.attr("transform",t.SVGUtil.translate(M,0)),A){var I=a.mainGraphicsContext.selectAll(n.CategoryAreaSelector.selector).data(_.filter(d.series,function(e){return L||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()});I.enter().append("g").classed(n.CategoryAreaSelector.class,!0).append(n.PathElementName);a.mainGraphicsContext.selectAll(n.CategoryAreaSelector.selector).select(n.PathElementName).transition().ease("linear").duration(C).attr("d",function(e){return S(e.data)}).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return w&&!e.selected?n.DimmedAreaFillOpacity:n.AreaFillOpacity}),I.exit().remove()}else a.mainGraphicsContext.selectAll(n.CategoryAreaSelector.selector).remove();var k=a.mainGraphicsContext.selectAll(n.CategorySelector.selector).data(d.series,function(e){return e.identity.getKey()}),T=k.enter().append("g").classed(n.CategorySelector.class,!0);if(T.append(n.PathElementName),T.selectAll(n.CategoryValuePoint.selector).data(function(e){return e.data}).enter().append(n.CircleElementName).classed(n.CategoryValuePoint.class,!0),k.exit().remove(),l&&!a.dragHandle){var F=D;a.dragHandle=a.hoverLineContext.append("circle").attr("cx",0).attr("cy",F).attr("r","6px").classed("drag-handle",!0)}for(var N=k.data().length;a.selectionCircles.length<N;){var O=a.hoverLineContext.append(n.CircleElementName).classed(n.CircleClassName,!0).attr("r",d.lineStyle.strokeWidth/2+n.CircleRadiusExtra).style("opacity",0);a.selectionCircles.push(O)}for(;a.selectionCircles.length>N;)a.selectionCircles.pop().remove();var H=a.mainGraphicsContext.selectAll(n.CategorySelector.selector);H.select(n.PathElementName).classed(e.lineClassAndSelector.class,!0).style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).style("stroke-width",d.lineStyle.strokeWidth).style("stroke-linejoin",d.lineStyle.lineJoin).transition().ease("linear").duration(C).attr("d",function(e){return V(e.data)}),u.ensureMarkers(a.svgDefs,_.map(e.data.series,function(e){return e.lineStyle.markerProperties}));var R=a.mainGraphicsContext.selectAll(n.MarkerLineClassSelector.selector).data(_.filter(d.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()});R.enter().append(n.PathElementName).classed(n.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",t.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0);var B=R.transition().ease("linear").duration(C).attr("d",function(e){return V(e.data)}).style("opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).style("pointer-events","none");u.renderMarkers(B),R.exit().remove();var E=this,U=H.selectAll(n.CategoryValuePoint.selector),z=U.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return t.ColumnUtil.getFillOpacity(e.selected,!1,w,!1)}).transition().duration(C).attr({cx:function(e,t){var a=d3.select(this.parentNode).datum();return E.shouldDrawCircle(a,t)?m(E.getXValue(e,x)):0},cy:function(e,t){var a=d3.select(this.parentNode).datum();return E.shouldDrawCircle(a,t)?P(e):0},r:function(e,t){var a=d3.select(this.parentNode).datum();return E.shouldDrawCircle(a,t)?d.lineStyle.strokeWidth/2+n.CircleRadiusExtra:0}});if(l&&n.hasDataPoint(d.series)){var G=U.size(),j=0;z.each("end",function(){j++,j===G&&s.selectColumn(t.CartesianHelper.findMaxCategoryIndex(d.series),!0)})}var W=null;if(d.dataLabelsSettings.show){W=[];for(var X=0,Y=d.series.length;X<Y;X++)Array.prototype.push.apply(W,d.series[X].data)}k.exit().remove();var q;return d.dataLabelsSettings.show&&(q=n.createLabelDataPoints(e,h)),null==W?null:{dataPoints:W,behaviorOptions:null,labelDataPoints:null,labelsAreNumeric:null,labelDataPointGroups:q,animateLabels:!c}}},n.getFirstPathPointFromSeriesData=function(e){return _.find(e.data,function(e,t,a){var i=a[t+1];return null!=e&&null!=e.value&&null!=i&&null!=i.value})},n.getSeriesTooltipInfo=function(e){if(!e)return null;var a=e.dataPoints;if(_.isEmpty(a))return null;var i="#000000",r="0",o=10,n=!_.isEmpty(a)&&a[0].seriesDisplayName,s=[],l=0,c=e.legendMarkerRendering,u=c!==t.legendMarkerRendering.markerOnly;if(_.some(a,function(e){return!_.isEmpty(e.additionalTooltipItems)}))for(var h=0,d=a;h<d.length;h++){var p=d[h];if(l>=o)break;if(null!=p.value&&(n&&(s.push({header:p.category,displayName:p.seriesDisplayName,value:p.seriesName,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++),s.push({header:p.category,color:p.color,displayName:p.measureDisplayName,value:p.measure,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++,!_.isEmpty(p.additionalTooltipItems)))for(var g=0,y=p.additionalTooltipItems;g<y.length;g++){var m=y[g];if(l>=o)break;s.push({header:p.category,color:i,displayName:m.displayName,value:m.value,opacity:r,markerShape:t.markerShape.none}),l++}}else for(var v=0,f=a;v<f.length;v++){var p=f[v];if(l>=o)break;null!=p.value&&(s.push({header:p.category,color:p.color,displayName:p.seriesName||p.measureDisplayName,value:p.measure,markerShape:p.markerShape,lineStyle:u?p.lineStyle:void 0,lineColor:p.lineColor}),l++)}if(!_.isEmpty(e.additionalTooltipItems))for(var x=0,C=e.additionalTooltipItems;x<C.length;x++){var m=C[x];if(l>=o)break;s.push({header:a[0].category,color:i,displayName:m.displayName,value:m.value,opacity:r,markerShape:t.markerShape.none}),l++}return 0===s.length?null:s},n.prototype.getTooltipInfoForPoint=function(e,t){var a,i=e.data,r=this.getCategoryIndexFromSeriesAndPointX(i,t,!0,e.context);if(i&&i.data&&i.data.length&&(a=_.find(i.data,function(e){return e&&e.categoryIndex===r})),a)return a.tooltipInfo},n.isDataPointData=function(e){return e&&null!=e.categoryIndex},n.isForecastPoint=function(e){return e&&null!=e.points},n.prototype.getCategoryIndexFromTooltipEvent=function(e,t){var a=e.data;if(!n.isForecastPoint(a))return n.isDataPointData(a)?a.categoryIndex:this.getCategoryIndexFromSeriesAndPointX(a,t,!1)},n.prototype.getCategoryIndexFromSeriesAndPointX=function(e,a,i,r){var o=0,s=this.data.categoryData;if(e&&!_.isEmpty(e.data)&&this.xAxisProperties){a=this.adjustPathXCoordinate(a,r);var l=n.getFirstPathPointFromSeriesData(e);l&&(o=this.xAxisProperties.scale(n.getXValue(l,this.data.isScalar))+this.getXOfFirstCategory()),i&&(s=_.map(e.data,function(e){return t.CartesianHelper.extractCategoryFromDataPoint(e)}))}return n.findCategoryIndex({pointX:a,offsetX:o,categoryData:s,scaleDetector:this.scaleDetector,scale:this.xAxisProperties.scale,categoryThickness:this.xAxisProperties.categoryThickness,isScalar:this.data.isScalar})},n.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.isScalar},n.prototype.getSupportedCategoryAxisType=function(){var e=this.dataView&&this.dataView.categorical?this.dataView.categorical.categories:void 0,a={text:!0};return _.isEmpty(e)&&t.AxisHelper.isOrdinal(a)?t.axisType.categorical:t.axisType.both},n.prototype.getPreferredPlotArea=function(e,a,i,r){return void 0===r&&(r=0),t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},n.prototype.getAvailableWidth=function(){var e=this.currentViewport.width-(this.margin.left+this.margin.right);return Math.max(0,e)},n.prototype.getAvailableHeight=function(){var e=this.currentViewport.height-(this.margin.top+this.margin.bottom);return Math.max(0,e)},n.sliceSeries=function(t,a,i){void 0===i&&(i=0);var r=[];if(t&&t.length>0)for(var o=0,n=t.length;o<n;o++){var s=t[o];r[o]=e.Prototype.inherit(s);for(var l=[],c=i,u=i+a;c<u;c++)l.push(s.data[c]);r[o].data=l}return r},n.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.xAxisProperties.scale;if(e.rangeBand)return e.rangeBand()/2}return 0},n.hasDataPoint=function(e){if(0===e.length)return!1;for(var t=0,a=e.length;t<a;t++)if(e[t].data.length>0)return!0;return!1},n.getXValue=function(e,t){return t?e.categoryValue:e.categoryIndex},n.shouldDrawCircle=function(e,t){var a=e.data[t];if(null==a||null===a.value)return!1;var i=e.data[t-1],r=null==i||null===i.value,o=e.data[t+1],n=null==o||null===o.value;return r&&n},n.prototype.getHoverLineDataForCategory=function(e,t){void 0===t&&(t=!1);var a=this.getChartX(e)+this.getXOfFirstCategory(),i=this.createTooltipData(e);if(i){var r=i.dataPoints;return i.dataPoints.length>0&&this.setHoverLineForTooltip(a),this.setDotsForTooltip(a,r,this.data.lineStyle.strokeWidth/2+n.TooltipCircleRadiusExtra),i}},n.prototype.getHoverLineIdentity=function(e){return this.data&&this.data.categoryIdentities&&this.data.categoryIdentities[e]},n.prototype.setHoverLineForTooltip=function(e){e=e||0,this.hoverLine.attr("x1",e).attr("x2",e).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1)},n.prototype.clearHoverLine=function(){this.hoverLine.style("opacity",t.SVGUtil.AlmostZero),this.hoverLineContext.selectAll(n.HoverLineCircleDot.selector).remove()},n.prototype.setDotsForTooltip=function(e,t,a){var i=this;void 0===a&&(a=3);var o=r.hasFlag(this.lineType,16),s=o?function(e){return i.yAxisProperties.scale(e.stackedValue)}:function(e){return e.isY2?i.y2AxisProperties.scale(e.value):i.yAxisProperties.scale(e.value)},l=this.hoverLineContext.selectAll(n.HoverLineCircleDot.selector).data(_.filter(t,function(e){return e.showDot}));l.enter().append(n.CircleElementName).classed(n.HoverLineCircleDot.class,!0),l.filter(function(e){return e.value}).attr("fill",function(e){return e.color}).attr("r",a).attr("cx",e).attr("cy",s),l.exit().remove()},n.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){this.lastInteractiveSelectedColumnIndex=e;var a=this.getChartX(e);this.setHoverLine(a,e);var i=this.createLegendDataPoints(e);i&&this.options.cartesianHost.updateLegend(i)}},n.prototype.setHoverLine=function(e,t){this.hoverLine.attr("x1",e).attr("x2",e).attr("y1",0).attr("y2",this.getAvailableHeight()).style("opacity",1);var a=this;this.mainGraphicsContext.selectAll(n.CategorySelector.selector).selectAll(n.PathElementName).each(function(i){var r=this,o=i.color,n=a.selectionCircles[i.lineIndex];n&&n.attr({cx:e,cy:function(){var t=d3.select(r).node();return a.getPosition(e,t).y}}).style({opacity:function(){return _.some(i.data,function(e){return!!e&&e.categoryIndex===t})?1:0},fill:o}),a.dragHandle&&a.dragHandle.attr("cx",e)})},n.prototype.getChartX=function(t){var a=0;this.data.isScalar?t>=0&&t<this.data.categoryData.length&&(a=Math.max(0,this.xAxisProperties.scale(this.data.categoryData[t].categoryValue))):a=Math.max(0,this.xAxisProperties.scale(t));var i=e.visuals.AxisHelper.extent(this.xAxisProperties.scale)[1];return a=Math.min(a,i),isNaN(a)?0:a},n.findCategoryIndex=function(a){var i=a.pointX,r=a.offsetX,o=a.categoryData,n=a.scale,s=a.scaleDetector.getScale().x;e.Double.equalWithPrecision(s,1,1e-5)||(i/=s),r&&(i+=r);var l=e.visuals.AxisHelper.invertScale(n,i);if(a.isScalar){var c=t.AxisHelper.findClosestXAxisIndex(l,o);return c>=0?o[c].categoryIndex:-1}if(o[l]&&!o[l].hasData){for(var u=-1,h=l;h>0&&u===-1&&o[--h].hasData;)u=h;for(var d=-1,p=l,g=o.length-1;p<g&&d===-1&&o[++p].hasData;)d=p;var y=Math.abs(u-l),m=Math.abs(d-l);if(y<m)l=u;else if(y>m)l=d;else if(y===m){var v=n(l)+a.categoryThickness/2;l=i>v?d:u}}return l},n.prototype.getPosition=function(e,a){for(var i,r,o=a.getTotalLength(),n=0,s=o;;){if(r=n+s>>1,i=a.getPointAtLength(r),t.SVGUtil.ensureValidSVGPoint(i),(r===s||r===n)&&i.x!==e)break;if(i.x>e)s=r;else{if(!(i.x<e))break;n=r}}return i},n.prototype.createTooltipData=function(e){var a=this.data;if(a&&0!==a.series.length&&a.categories&&a.categoryData){var i,r=[],o=a.categoryData[e];this.data.isScalar?o&&(i=t.AxisHelper.isDateTime(this.xAxisProperties.axisType)&&!a.scalarMetadata?t.CartesianHelper.lookupXValue(this.data,o.categoryValue,this.xAxisProperties.axisType,this.data.isScalar):a.categories[e]):i=t.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar);for(var n,s=t.lineChartProps.general.formatString,l=0,c=a.series;l<c.length;l++){var u=c[l],h=u.data,d=void 0;this.data.isScalar?o&&(d=h.filter(function(e){return e.categoryValue===o.categoryValue})[0]):d=h[e];var p=d&&d.value;if(null!=p){var g=t.CategoryLevelUtils.concatenateCategoryLevels(o.hierarchyCategoryLevels),y=u.lineStyle.markerProperties,m={color:t.Markers.resolveMarkerColor(y,u.color,a.legendMarkerRendering,a.matchLineColor),category:g.value,measureDisplayName:u.seriesName,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(u.yCol,s)),value:p,stackedValue:d.stackedValue,showDot:!y.showMarker,markerShape:t.Markers.resolveMarkerShape(y,a.legendMarkerRendering,a.defaultToCircle?t.markerShape.circle:t.markerShape.longDash),lineStyle:u.lineStyle.style,lineColor:u.color,isY2:d.isY2};a.hasDynamicSeries?(m.seriesDisplayName=a.seriesDisplayName,m.seriesName=u.seriesName,m.additionalTooltipItems=d.additionalTooltipItems):n||(n=d.additionalTooltipItems),r.push(m)}}if(!_.isEmpty(a.forecastLines))for(var u=_.head(a.series),v=0,f=a.forecastLines;v<f.length;v++){var x=f[v],C=_(x.points).filter(function(e){return e.point.x===o.categoryValue}).first(),p=C&&C.point.y;if(null!=p){var m={color:x.lineColor.solid.color,category:t.valueFormatter.format(i,t.valueFormatter.getFormatString(u.xCol,s)),measureDisplayName:x.displayName,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(u.yCol,s)),value:p,stackedValue:void 0,additionalTooltipItems:[{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Upper"),value:t.valueFormatter.format(C.upperBound.y,t.valueFormatter.getFormatString(u.yCol,s))},{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Lower"),value:t.valueFormatter.format(C.lowerBound.y,t.valueFormatter.getFormatString(u.yCol,s))}],showDot:!0,markerShape:t.markerShape.circle,lineStyle:void 0,lineColor:void 0};r.push(m)}}return{dataPoints:r,additionalTooltipItems:n,legendMarkerRendering:a.legendMarkerRendering}}},n.prototype.createLegendDataPoints=function(e){var a=this.data;if(a&&a.series&&!(a.series.length<1)){var i,r=[],o=a.categoryData[e];this.isInteractiveChart&&o&&(this.data.isScalar?(i=o.categoryValue,t.AxisHelper.isDateTime(this.xAxisProperties.axisType)&&(i=new Date(i))):i=t.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar));for(var n=t.lineChartProps.general.formatString,s=null,l=0,c=a.series.length;l<c;l++){var u=a.series[l],h=u.data,d=void 0;if(this.isInteractiveChart){var p=void 0;if(this.data.isScalar){if(o)for(var g=o.categoryValue,y=0;y<h.length;y++)if(h[y].categoryValue===g){p=h[y];break}}else p=h[e];d=p&&p.value}var m=t.converterHelper.getFormattedLegendLabel(u.yCol,this.dataView.categorical.values,n);s=u.yCol,r.push({color:u.color,icon:t.LegendIcon.Line,label:m,category:t.valueFormatter.format(i,t.valueFormatter.getFormatString(u.xCol,n)),measure:t.valueFormatter.format(d,t.valueFormatter.getFormatString(u.yCol,n)),identity:u.identity,selected:u.selected,index:l})}var v=this.dataView&&this.dataView.categorical?this.dataView.categorical.values:null,f=v&&v.source?v.source.displayName:"",x=t.Legend.getDefaultLegendData(this.style);return x.title=f,x.dataPoints=r,x.grouped=a.hasDynamicSeries,x}},n.createLabelDataPoints=function(a,i){for(var o,s,l=a.xAxisProperties.scale,c=a.yAxisProperties.scale,u=a.y2AxisProperties&&a.y2AxisProperties.scale,h=a.data,d=h.series,p=h.dataLabelsSettings,g=t.LabelUtils.createColumnFormatterCacheManager(),y=r.hasFlag(a.lineType,16),m=[],v=h.isScalar,f=function(r,h){s=d[r],o=s.labelSettings||p;var f=100===o.labelDensity,C=t.LabelUtils.getNumberOfLabelsToRender(a.currentViewport.width,o.labelDensity,x.minimumLabelsToRender,t.MinMaxLabelDataPointSorter.estimatedLabelWidth),S=!f&&v?C:s.data.length;if(!o.show)return m[r]={labelDataPoints:[],maxNumberOfLabels:0},"continue";
var b=s.isY2?a.y2AxisProperties:a.yAxisProperties,D=t.LabelUtils.getLabelUnitAndPrecisionForAxis(b,o),w=s.data,P=[],L=function(r,h,d){var p,m=h.labelFormatString,x=g.getOrCreate(m,o,D.units,D.getPrecision(!!m,r.type)),C=t.LabelUtils.getLabelFormattedText(x.format(h.value)),S=o.fontProperties,b=t.FontProperties.toTextProperties(S,C),w=e.TextMeasurementService.measureSvgTextWidth(b)+t.LabelUtils.LabelDensityPadding,P=e.TextMeasurementService.estimateSvgTextHeight(b,!0),L=!1,A=a.horizontalOffset,V=r.isY2?u:c;if(y){var M=Math.max(h.stackedValue-h.value,V.domain()[0]),I=a.currentViewport.width,k=o&&o.position,T=void 0;switch(k){case t.labelPosition.insideCenter:T=[1];break;case t.labelPosition.insideEnd:T=[4];break;case t.labelPosition.auto:default:T=n.validStackedLabelPositions}p={rect:{left:l(n.getXValue(h,v))+A-I/2,top:V(Math.max(h.stackedValue,h.stackedValue-h.value)),width:I,height:Math.abs(V(h.stackedValue)-V(M))},orientation:h.value>=0?1:2,validPositions:T},L=!0}else{var F=r.lineStyle.markerProperties,k=o&&o.position,T=void 0;switch(k){case t.labelPosition.above:T=[1];break;case t.labelPosition.under:T=[2];break;case t.labelPosition.auto:default:T=f?[1]:n.getValidLabelPositions(s,d)}p={point:{x:l(n.getXValue(h,v))+A,y:V(h.value)},radius:F.showMarker?F.size:0,validPositions:T}}return{isPreferred:!1,text:C,textSize:{width:w,height:P},outsideFill:S.color?S.color:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultLabelColorName),insideFill:S.color&&y?S.color:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultInsideLabelColorName),parentType:L?1:0,parentShape:p,fontProperties:S,identity:h.identity,key:h.key,hasBackground:o.enableBackground,backgroundColor:o.backgroundColor,backgroundTransparency:o.backgroundTransparency}};if(!_.isEmpty(w))for(var A=0,V=w.length;A<V;A++){var M=w[A];if(null!=M&&null!=M.value){var I=L(s,M,A);P.push(I)}}m[r]={labelDataPoints:P,maxNumberOfLabels:S}},x=this,C=0,S=d.length;C<S;C++)f(C,S);return new t.MinMaxLabelDataPointSorter({unsortedLabelDataPointGroups:m,series:d,viewport:a.currentViewport,yScale:c,y2Scale:u}).getSortedDataLabels()},n.prototype.adjustPathXCoordinate=function(t,a){jsCommon.BrowserUtils.isFirefox()&&null!=a&&(this.pathXAdjustment=this.getPathXAdjustmentForFirefox(a)),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&(this.pathXAdjustment=n.interactivityStrokeWidth/2);var i=this.scaleDetector.getScale().x;return t-=e.Double.equalWithPrecision(i,1,1e-5)?this.pathXAdjustment:this.pathXAdjustment*i},n.prototype.getPathXAdjustmentForFirefox=function(e){var a=e.getBoundingClientRect(),i=t.SVGUtil.tryGetBBox(e);if(i.height>0&&i.width>0)return(a.width/this.scaleDetector.getScale().x-i.width)/2},n.getValidLabelPositions=function(e,t){var a=e.data,i=a.length,r=t===i-1,o=0===t,n=a[t].value,s=a[t-1]&&a[t-1].value,l=a[t+1]&&a[t+1].value,c=1,u=1;if(null==s?c=0:s>n?c=3:s<n&&(c=2),null===l?u=0:l>n?u=3:l<n&&(u=2),o)switch(u){case 3:return[2,1];default:return[1,2]}if(r)switch(c){case 3:return[2,1];default:return[1,2]}switch(c){case 0:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[2,1,4,8];case 2:return[1,2,4,8]}case 1:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,8,4];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 3:switch(u){case 0:return[2,1,8,4];case 1:return[2,1,4,8];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 2:switch(u){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[1,2,8,4];case 2:return[1,2,8,4]}}},n.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!0}},n.prototype.getStaticSeriesRole=function(){return this.isComboChart?"Y2":"Y"},n.prototype.haveY2Data=function(){return this.data&&this.data.series&&_.some(this.data.series,function(e){return e&&e.isY2})},n.prototype.calculateCustomLegend=function(){if(!this.dataView)return t.Legend.getDefaultLegendData(this.style);var e=this.data;return t.Legend.buildSeriesLegendData({dataView:this.dataView,allowLegendWithNoSeries:this.isComboChart,showByDefault:!0,staticSeriesRole:this.isComboChart?"Y2":"Y",secondaryStaticSeriesRole:this.isComboChart?null:"Y2",style:this.style,ignoreDefaultColor:this.isComboChart,ignoreDefaultCategoryColor:!0,lineAndMarkerOptions:{renderMarkers:!e.isScalar,renderLineStyle:!0,legendMarkerRendering:e.legendMarkerRendering,matchSeriesColor:e.matchLineColor,defaultMarkerShape:e.defaultToCircle?t.markerShape.circle:t.markerShape.longDash}})},n.prototype.enumerateCustomLegend=function(e){var a=this.originalData,i=a.legendMarkerRendering,r=__assign({},e,{legendMarkerRendering:i,matchLineColor:i===t.legendMarkerRendering.markerOnly?a.matchLineColor:void 0,defaultToCircle:i===t.legendMarkerRendering.markerOnly?a.defaultToCircle:void 0});t.Legend.enumerate(r)},n.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},n.ClassName="lineChart",n.MainGraphicsContextClassName="mainGraphicsContext",n.CategorySelector=i("cat"),n.CategoryValuePoint=i("dot"),n.CategoryPointSelector=i("point"),n.CategoryAreaSelector=i("catArea"),n.HoverLineCircleDot=i("circle-item"),n.LineClassSelector=i("line"),n.MarkerLineClassSelector=i("marker-line"),n.InteractivityLineClassSelector=i("interactivity-line"),n.SelectedMarkerLineClassSelector=i("selected-markers"),n.FocusElementSelector=i("focus-element"),n.PointRadiusExtra=4,n.CircleRadiusExtra=3,n.TooltipCircleRadiusExtra=2,n.PathElementName="path",n.CircleElementName="circle",n.CircleClassName="selection-circle",n.LineElementName="line",n.ScalarOuterPadding=10,n.interactivityStrokeWidth=10,n.minimumLabelsToRender=4,n.AreaFillOpacity=.4,n.DimmedAreaFillOpacity=.2,n.defaultLineStrokeWidth=2,n.validStackedLabelPositions=[1,4],n}();t.LineChart=n;var s=function(){function e(e,t,a){this.tooltipService=e,this.mainGraphicsSVG=t,a&&(this.tooltipOverlay=t.append("rect").classed("tooltip-overlay",!0)),this.showHoverLine=!1}return Object.defineProperty(e.prototype,"usingHoverLine",{get:function(){return this.showHoverLine},enumerable:!0,configurable:!0}),e.prototype.getTooltipOverlayElement=function(){if(this.showHoverLine)return this.tooltipOverlay},e.prototype.applyTooltips=function(e,t,a){!this.tooltipOverlay||e.binnedLineSamplingApplied&&e.hasDynamicSeries?this.applyPointTooltip(e,t,a):this.applyHoverLineTooltip(e,t,a)},e.prototype.removeTooltips=function(e,t){this.removePointTooltip(e),this.removeHoverLineTooltip(t)},e.prototype.applyHoverLineTooltip=function(t,a,i){if(this.tooltipOverlay){this.showHoverLine||this.removePointTooltip(t),this.tooltipOverlay.attr({x:0,width:t.width,height:t.height});var r=function(e){var t=e.elementCoordinates[0],r=a.getCategoryIndexFromTooltipEvent(e,t),o=i.getHoverLineDataForCategory(r);return n.getSeriesTooltipInfo(o)};this.tooltipService.addTooltip(this.mainGraphicsSVG,r,function(t){return e.getCategoryIdentityForHoverLineTooltipEvent(a,i,t)},!0),this.mainGraphicsSVG.on("mouseout.hoverline",function(){return i.clearHoverLine()}),this.mainGraphicsSVG.on("touchmove.hoverline",function(){return i.clearHoverLine()}),this.showHoverLine=!0}},e.prototype.removeHoverLineTooltip=function(e){e.clearHoverLine(),this.tooltipService.removeTooltips(this.mainGraphicsSVG),this.mainGraphicsSVG.on(".hoverline",null),this.showHoverLine=!1},e.prototype.applyPointTooltip=function(t,a,i){this.showHoverLine&&this.removeHoverLineTooltip(i);var r,o=function(e){var t=e.elementCoordinates[0];return a.getTooltipInfoForPoint(e,t)};r=t.isComboChart?function(t){return e.getCategoryIdentityForHoverLineTooltipEvent(a,i,t)}:function(e){return e.data&&e.data.identity},this.tooltipService.addTooltip(t.interactivityLines,o,r,!0),this.tooltipService.addTooltip(t.dots,function(e){return e.data&&e.data.tooltipInfo},r,!0),t.explicitDots&&this.tooltipService.addTooltip(t.explicitDots,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity},!0),this.showHoverLine=!1},e.prototype.removePointTooltip=function(e){e.interactivityLines&&this.tooltipService.removeTooltips(e.interactivityLines),e.dots&&this.tooltipService.removeTooltips(e.dots),e.explicitDots&&this.tooltipService.removeTooltips(e.explicitDots)},e.getCategoryIdentityForHoverLineTooltipEvent=function(e,t,a){if(a){if(a.data&&n.isForecastPoint(a.data))return null;var i=a.elementCoordinates[0],r=e.getCategoryIndexFromTooltipEvent(a,i);return t.getHoverLineIdentity(r)}},e}()}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){function t(t,a,r,o,n){var s=t.getCategoryIndex(o,r,!0),l=e.InteractivityUtils.getPositionOfLastInputEvent(),c=_.find(o.data,function(e){return e&&e.categoryIndex===s});c?a.handleSelection(c,i.isCtrlOrMeta(d3.event),l):a.handleSelection({selected:o.selected,identity:o.identity,specificIdentity:t.categoryIdentities[s]},i.isCtrlOrMeta(d3.event),l)}function a(t,a,r,o,n){if(!i.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var s=e.InteractivityUtils.getPositionOfLastInputEvent(),l=t.getCategoryIndex(o,r,!0),c=_.find(o.data,function(e){return e&&e.categoryIndex===l});c?a.handleContextMenu(c,s):a.handleContextMenu({selected:o.selected,identity:o.identity,specificIdentity:t.categoryIdentities[l]},s)}}var i=jsCommon.BrowserUtils,r=function(){function r(){}return r.prototype.bindEvents=function(r,o,n){var s=this;this.lines=r.lines,this.markerPaths=r.markerPaths;var l=r.interactivityLines,c=this.dots=r.dots;this.areas=r.areas;var u=this.tooltipOverlay=r.tooltipOverlay,h=r.root,d=r.focusMarker;this.selectedMarkersCallback=r.selectedMarkersCallback;var p=function(e){return s.getPointX(e)};l.on("click",function(e,a){t(r,o,p(this),e,a)}),l.on("contextmenu",function(e,t){a(r,o,p(this),e,t)}),e.InteractivityUtils.registerStandardInteractivityHandlers(c,o),e.InteractivityUtils.registerClearCatcherShortcut(h,o),d&&e.InteractivityUtils.registerStandardInteractivityHandlers(d,o),n&&!n.isEmpty()&&($(h.node()).is(":tabbable")===!0&&e.InteractivityUtils.registerEnterPlotAreaHandler(h,n),d&&e.InteractivityUtils.registerDataPointNavigationHandler(h,n)),u&&(_.isEmpty(r.categoryIdentities)?u.on("click",function(){i.isCtrlOrMeta(d3.event)||o.handleClearSelection()}):(u.on("click",function(){var t=r.getCategoryIndex(void 0,p(this),!1),a=e.InteractivityUtils.getPositionOfLastInputEvent();o.handleSelection({selected:!1,identity:void 0,specificIdentity:r.categoryIdentities[t]},i.isCtrlOrMeta(d3.event),a)}),u.on("contextmenu",function(){if(!i.isCtrlOrMeta(d3.event)){d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event);var t=e.InteractivityUtils.getPositionOfLastInputEvent(),a=r.getCategoryIndex(void 0,p(this),!1);o.handleContextMenu({selected:!1,identity:void 0,specificIdentity:r.categoryIdentities[a]},t)}})))},r.prototype.renderSelection=function(t){this.lines.style("stroke-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.dots.style("fill-opacity",function(a){return a.lineStyle.markerProperties.showMarker?0:e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.markerPaths&&this.markerPaths.style("opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,!1,t,!1)}),this.areas&&this.areas.style("fill-opacity",function(a){return t&&!a.selected?e.LineChart.DimmedAreaFillOpacity:e.LineChart.AreaFillOpacity}),this.selectedMarkersCallback&&this.selectedMarkersCallback()},r.prototype.renderFocus=function(e){e&&i.focus(e)},r.prototype.getPointX=function(e){for(var t,a=d3.event;t=a.sourceEvent;)a=t;var i=e.getBoundingClientRect();return a.clientX-i.left-e.clientLeft},r}();e.LineChartWebBehavior=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.CssConstants.createClassAndSelector,i=e.data.createDataViewScopeIdentity,r=e.data.DataViewConcatenateCategoricalColumns,o=e.data.DataViewMatrixUtils,n=e.data.SQExprBuilder,s=e.data.ScopeIdentityExtractor,l="drag-resize-disabled",c=function(){function r(e){e&&(this.interactivityService=e.interactivityService)}return r.prototype.init=function(e){var t=this;this.element=e.element,this.svg=e.svg,this.host=e.host,this.style=e.style,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService&&(this.playControl=new h(this.element,function(e){return t.moveToFrameAndRender(e)},this.isMobileChart),this.playControl.onPlay(function(){return t.play()}))},r.prototype.setData=function(e,t){if(e){if(this.ridiculousFlagForPersistProperties&&e.metadata)return this.ridiculousFlagForPersistProperties=!1,this.playData;e.matrix||e.categorical?this.playData=u.converter(e,t,this.style):this.playData=u.getDefaultPlayData()}else this.playData=u.getDefaultPlayData();return this.lastViewport=void 0,this.playData},r.prototype.render=function(e,t,a,i){var r=this.playData,o=!this.lastViewport||this.lastViewport.height!==a.height||this.lastViewport.width!==a.width;if(this.lastViewport=a,o&&this.stop(),r){var n={data:this.playData,viewModel:t,viewport:a};if(this.interactivityService){var s=r.currentViewModel;this.interactivityService.applySelectionStateToData(s.dataPoints)}this.updateCallout(a,i),this.playControl&&o&&this.playControl.rebuild(r,a);var l=r.allViewModels.map(function(e){return e.dataPoints});return{allDataPoints:_.flatten(l),viewModel:n}}},r.prototype.updateCallout=function(a,i){var o=this.playData,n=o.frameData,s=o.currentFrameIndex,l=a.height,c=l-i.top-i.bottom,u=a.width,h=u-i.left-i.right,d=0,p=Math.min(l,1.3*u),g=Math.max(12,Math.round(p/7));g=Math.min(g,70);var y=[];if(s<n.length&&s>=0){var m={fontSize:jsCommon.PixelConverter.toString(g),text:n[s].text||"",fontFamily:t.Font.Family.regular.css};if(d=e.TextMeasurementService.estimateSvgTextHeight(m)-e.TextMeasurementService.estimateSvgTextBaselineDelta(m),d<c){var v=h-2*r.calloutOffsetMultiplier*d;y=[e.TextMeasurementService.getTailoredTextOrDefault(m,v)]}}var f=this.svg.selectAll(r.PlayCallout.selector).data(y);f.enter().append("text").classed(r.PlayCallout.class,!0),f.text(function(e){return e}).attr({x:h-r.calloutOffsetMultiplier*d,y:function(){return d}}).style({"font-size":g+"px","text-anchor":"end"}),f.exit().remove()},r.prototype.play=function(){var e=this.playData;if(this.isPlaying)this.stop();else if(this.playControl){this.isPlaying=!0,this.playControl.play();var t=this.playControl.getCurrentIndex();if(null==t)return;t=Math.round(t),t>=e.allViewModels.length-1?e.currentFrameIndex=-1:e.currentFrameIndex=t-1,this.playNextFrame(e)}},r.prototype.playNextFrame=function(e,t,a){var i=this;if(!this.isPlaying)return void this.stop();var r=e.currentFrameIndex+1;if(null!=t&&null!=a&&(r=Math.abs(a-t+1),t=r),r<e.allViewModels.length&&r>-1){var o=this.host.tooltips();o&&o.hide({immediately:!0,isTouchEvent:!1}),e.currentFrameIndex=r,e.currentViewModel=e.allViewModels[r],this.renderDelegate(e.currentViewModel),this.playControl.setFrame(r),r<e.allViewModels.length&&window.setTimeout(function(){i.playNextFrame(e,t,a)},u.FrameStepDuration)}else this.stop()},r.prototype.stop=function(){this.playControl&&this.playControl.pause(),this.isPlaying=!1},r.prototype.remove=function(){this.playControl&&this.playControl.remove(),d3.selectAll(r.PlayCallout.selector).remove()},r.prototype.setRenderFunction=function(e){this.renderDelegate=e},r.prototype.getCartesianExtents=function(e,t){return!this.playData||_.isEmpty(this.playData.allViewModels)||_.isEmpty(this.playData.frameData)?e:u.getMinMaxForAllFrames(this.playData,t)||e},r.prototype.setPlayControlPosition=function(e){if(this.playControl){var t=this.playControl.getContainer();t.css("left",e.left?e.left+"px":""),t.css("top",e.top?e.top+"px":"")}},r.prototype.moveToFrameAndRender=function(e){var t=this.playData;if(this.isPlaying=!0,t&&e>=0&&e<t.allViewModels.length&&e!==t.currentFrameIndex){t.currentFrameIndex=e;var a=t.allViewModels[e];t.currentViewModel=a,this.renderDelegate(a)}this.isPlaying=!1},r.prototype.isCurrentlyPlaying=function(){return this.isPlaying},r.prototype.enumerateDataPoints=function(a,r,o,n){var l=_.filter(o.metadata.columns,function(e){return e.roles[t.scatterRoleNames.category]}),c=l.length>0&&l[l.length-1].queryName,u=_.filter(o.metadata.columns,function(e){return e.roles[t.scatterRoleNames.series]}),h=u.length>0&&u[0].queryName;r.hasDynamicSeries?e.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:a,dataPoints:_.map(r.dataPoints,function(e){return{color:e.fill,displayName:r.dataPointSeries[e.seriesIndex].name,identity:new t.SelectionId({data:e.identity.getSelectorsByColumn().dataMap[h].slice()},(!1))}})}):e.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:a,dataView:o,style:n,dataPoints:_.map(r.dataPoints,function(a){var r=a.identity.getSelectorsByColumn().dataMap[c],o=s.getKeyValuePairs(r[0].expr);return{color:a.fill,displayName:a.formattedCategory.getValue(),identity:new t.SelectionId({data:[e.data.DataViewRoleWildcard.fromRoles([t.scatterRoleNames.play])].concat(_.map(o,function(e){return i(e)}))},(!1))}}),fillInstanceKind:3})},r.PlayCallout=a("play-callout"),r.calloutOffsetMultiplier=.3,r}();t.PlayAxis=c;var u,h=function(){function e(e,t,a){this.isMobileChart=a,this.createSliderDOM(e),this.renderDelegate=t}return e.prototype.getContainer=function(){return this.playAxisContainer},e.prototype.remove=function(){this.playAxisContainer&&this.playAxisContainer.remove()},e.prototype.pause=function(){this.playButton.removeClass("pause").addClass("play")},e.prototype.play=function(){this.playButton.removeClass("play").addClass("pause")},e.prototype.getCurrentIndex=function(){if(this.noUiSlider)return Math.round(this.noUiSlider.get())},e.prototype.onPlay=function(e){this.playButtonCircle.off("click"),this.playButtonCircle.on("click",e)},e.prototype.setFrame=function(e){this.noUiSlider.set([e])},e.prototype.rebuild=function(t,a){var i=this,r=this.slider;this.playAxisContainer.css("width",a.width),this.noUiSlider&&this.noUiSlider.destroy();var o=t.labelData,n=e.calucalateSliderSize(o,a.width),s=this.getContainer();n.marginLeft>e.SliderMarginLeft&&(s.css("padding-left",n.marginLeft-e.SliderMarginLeft+"px"),s.css("box-sizing","border-box"));var l=this.updateSliderControl(t,n.width),c=e.adjustWidthRegardingLastItem(o,l,n.width);this.slider.css("width",c+"px"),this.noUiSlider.on("slide",function(){var e=i.getCurrentIndex();i.renderDelegate(e)});var u=0;$(".noUi-value",r).each(function(e,t){var a=o.labelInfo[u].labelWidth;$(t).width(a),$(t).css("margin-left",-a/2+"px"),u+=l})},e.prototype.updateSliderControl=function(t,a){var i=t.labelData,r=this.slider.get(0),o=t.frameData.length,n={start:0===o?0:t.currentFrameIndex,step:1,range:{min:0,max:0===o?0:o-1}},s=null,l=0;if(o>0){var c=e.createPipsFilterFn(t,a,i);l=c.skipStep,s={mode:"steps",density:Math.ceil(100/o),format:{to:function(e){return t.frameData[e].escapedText},from:function(e){return t.frameData.indexOf(e)}},filter:c.filter}}return n.pips=s,noUiSlider.create(r,n),this.noUiSlider=r.noUiSlider,l},e.createPipsFilterFn=function(e,t,a){var i=_.max(_.map(a.labelInfo,function(e){return e.labelWidth})),r=1,o=1,n=e.frameData.length>1?t/(e.frameData.length-1):t,s=i/n;return s>1.25?(o=Math.ceil(s),r=2):(s>1||a.anyWordBreaks)&&(r=2),{filter:function(e,t){return e%o===0?r:0},skipStep:o}},e.adjustWidthRegardingLastItem=function(t,a,i){if(_.isEmpty(t.labelInfo))return i;var r=t.labelInfo.length,o=Math.floor((r-1)/a)*a,n=i+e.SliderMarginRight-i/r*(o+1),s=t.labelInfo[o].labelWidth,l=s/2-n;if(l>0){var c=e.SliderMaxMargin-e.SliderMarginRight;return l=l>c?c:l,i-l}return i},e.prototype.createSliderDOM=function(t){this.playAxisContainer=$('<div class="play-axis-container"></div>').appendTo(t).css("height",e.PlayControlHeight+"px"),this.playButtonCircle=$('<div class="button-container"></div>').appendTo(this.playAxisContainer),this.isMobileChart&&this.playButtonCircle.addClass("mobile-button-container"),this.playButton=$('<div class="play"></div>').appendTo(this.playButtonCircle),this.slider=$('<div class="sliders"></div>').attr(l,"true").appendTo(this.playAxisContainer)},e.calucalateSliderSize=function(t,a){var i=0;_.isEmpty(t.labelInfo)||(i=_.head(t.labelInfo).labelWidth/2);var r=Math.max(i,e.SliderMarginLeft);return r=Math.min(e.SliderMaxMargin,r),{width:Math.max(a-r-e.SliderMarginRight,1),marginLeft:r}},e.SliderMarginLeft=44,e.SliderMarginRight=20,e.SliderMaxMargin=100,e.PlayControlHeight=80,e}();!function(a){function s(a,i){var n,s,u=a.matrix,h={categories:[],values:e.data.DataViewTransform.createValueColumns()};if(_.isEmpty(u.columns.levels)||u.rows.levels.length<2&&u.columns.levels.length<2)return(n=h.values).push.apply(n,l(u.valueSources)),{metadata:a.metadata,categorical:h};for(var d=1,p=[],g=d,y=u.rows.levels.length;g<y;g++){var m=u.rows.levels[g].sources[0];p.push({source:m,values:[],identity:[],objects:[]})}var v=!_.isEmpty(u.rows.root.children),f=!_.isEmpty(u.columns.root.children),x=u.columns.levels.length>1&&f,C=u.rows.levels.length>1&&v;if(x&&!C){h.categories=void 0;var S=u.columns.root;h.values.source=u.columns.levels[0].sources[0];for(var b=u.valueSources.length,D=[],w=0,P=S.children.length;w<P;w++){var L=S.children[w];if(!L.isSubtotal){for(var A=0;A<b;A++){var V=_.create(u.valueSources[A],{groupName:void 0===L.value?null:L.value}),M={identity:L.identity,values:[],source:V};h.values.push(M)}D.push({identity:L.identity,values:[],objects:L.objects,name:L.levelValues[0].value})}}for(var I=u.rows.root.children[i],k=I.values,T=0,F=S.children.length;T<F;T++)if(!S.children[T].isSubtotal){for(var A=0;A<b;A++)h.values[T*b+A].values.push(k[T*b+A].value);D[T].values=h.values.grouped()[T].values}e.data.DataViewTransform.setGrouped(h.values,D)}else if(x&&v){var I=u.rows.root.children[i];o.forEachLeafNode(I.children,function(e,t,a){e.isSubtotal||c(a,p)}),h.categories=p;var N=[];h.values.source=u.columns.levels[0].sources[0];for(var O=[],L=u.columns.root,H=-1;L;)if(!L.isSubtotal){if(L.children&&L.children[0].children)for(var A=0,R=L.children.length;A<R;A++)L.children[A].isSubtotal||O.push(L.children[A]);else if(L.children&&I.children){for(var B=L.children.length,A=0;A<B;A++){var V=_.create(u.valueSources[A],{groupName:L.value}),M={identity:L.identity,values:[],source:V};h.values.push(M)}N.push({identity:L.identity,values:[],objects:L.objects,name:L.levelValues[0].value}),o.forEachLeafNode(I.children,function(e){if(!e.isSubtotal){for(var t=0;t<B;t++)h.values[H*B+t].values.push(e.values[H*B+t].value);var a=h.values.grouped();N[N.length-1].values=a[N.length-1]&&a[N.length-1].values}})}O.length>0?(L=O[0],O=O.splice(1),H++):(e.data.DataViewTransform.setGrouped(h.values,N),L=void 0)}}else if(C){var I=u.rows.root.children[i],E=u.valueSources.length;(s=h.values).push.apply(s,l(u.valueSources)),o.forEachLeafNode(I.children,function(e,t,a){if(!e.isSubtotal){c(a,p);for(var i=0;i<E;i++)h.values[i].values.push(e.values[i].value)}}),h.categories=p}return r.applyToPlayChartCategorical(a.metadata,t.getScatterChartObjectDescriptors(),"Category",h)}function l(e){return _.isEmpty(e)?[]:_.map(e,function(e){return{identity:void 0,values:[],source:e,objects:[]}})}function c(e,t){var a,r=_.last(e).objects;if(e.length>1){for(var o=e[0].identity.expr,s=1,l=e.length;s<l;s++){var c=e[s].identity.expr;o=n.and(o,c)}a=i(o)}else a=e[0].identity;for(var u=0,h=t.length;u<h;u++){t[u].identity.push(a),t[u].objects.push(r);var d=e[u];t[u].values.push(d.value)}}function u(a,i){var r={};if(a&&a.objects){var o=a.objects;r.currentFrameIndex=e.DataViewObjects.getValue(o,t.scatterChartProps.currentFrameIndex.index,null)}return r}function h(e,a,i){var r,o,n=e.metadata,l=t.LabelUtils.getDefaultPointLabelSettings(i,"smallLightLabel"),c=u(n,l),h=v(e),d=[],p=[],y=e.matrix.rows,m=y.root.children?y.root.children.length:0;if(e.matrix&&m>0&&!_.isEmpty(y.levels)&&!_.isEmpty(y.levels[0].sources)){o=y.levels[0].sources[0];var f=t.valueFormatter.getFormatString(o,t.scatterChartProps.general.formatString),x=void 0;if(o.type.numeric){var C=Math.abs(y.root.children[m-1].value-y.root.children[0].value);x=t.valueFormatter.create({format:f,value:C,value2:0,columnType:o.type})}else x=t.valueFormatter.createDefaultFormatter(f,!0);for(var S=0,b=m;S<b;S++){var D=y.root.children[S];if(!D.isSubtotal){var w=x.format(D.value),P=$("<div/>").text(w).html();p.push({escapedText:P,text:w});var L=s(e,S);r=a(L,{label:P,column:o,identity:D.identity},h),d.push(r)}}}else{var L=s(e,0);r=a(L,void 0,h),d.push(r)}return c.currentFrameIndex=p.length-1,{allViewModels:d,currentViewModel:r,frameData:p,currentFrameIndex:c.currentFrameIndex,labelData:g(p,o)}}function d(){return{frameData:[],allViewModels:[],currentFrameIndex:0,currentViewModel:void 0,labelData:{anyWordBreaks:!1,labelInfo:[]}}}function p(e,t){var a={minY:null,maxY:null,minX:null,maxX:null},i=!1;if(e.allViewModels&&e.allViewModels.length>0)for(var r=0,o=e.allViewModels.length;r<o;r++){var n=e.allViewModels[r];if(!_.isEmpty(n.dataPoints)){i=!0;var s=t(n);a={minY:d3.min([s.minY,a.minY]),maxY:d3.max([s.maxY,a.maxY]),minX:d3.min([s.minX,a.minX]),maxX:d3.max([s.maxX,a.maxX])}}}return i?a:null}function g(a,i){for(var r={fontFamily:t.Font.Family.regular.css,fontSize:jsCommon.PixelConverter.toString(14)},o=[],n=!1,s=0,l=a;s<l.length;s++){var c=l[s],u=jsCommon.WordBreaker.getMaxWordWidth(c.escapedText,e.TextMeasurementService.measureSvgTextWidth,r);n=n||jsCommon.WordBreaker.hasBreakers(c.escapedText)||c.escapedText.indexOf("-")>-1,o.push({label:c.escapedText,labelWidth:u})}return{labelInfo:o,anyWordBreaks:n,labelFieldName:i&&i.displayName}}function y(e,t){void 0===t&&(t="Play");var a=e.matrix&&e.matrix.rows&&e.matrix.rows.levels&&e.matrix.rows.levels[0]&&e.matrix.rows.levels[0].sources&&e.matrix.rows.levels[0].sources[0]&&e.matrix.rows.levels[0].sources[0].roles;return a&&a[t]}function m(e,t,a){var i=_.filter(e,function(e){return e.selected});i=_.uniqBy(i,function(e){return e.identity.getKey()}),t.render(i,a)}function v(e){if(e&&e.matrix){var a=_.find(e.matrix.rows.root.children,function(e){return e.isSubtotal});if(a){for(var i=_.size(a.values),r=_.size(e.matrix.valueSources),o={},n=0;n<r;n++){var s=e.matrix.valueSources[n].roles,l=t.AxisHelper.normalizeNonFiniteNumber(a.values[i-r+n].value);for(var c in s)o[c]=l}return o}}}a.FrameStepDuration=800,a.FrameAnimationDuration=750,a.ClassName="playChart",a.convertMatrixToCategorical=s,a.converter=h,a.getDefaultPlayData=d,a.getMinMaxForAllFrames=p,a.isDataViewPlayable=y,a.renderTraceLines=m,a.getSubtotals=v}(u=t.PlayChart||(t.PlayChart={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a="realTimeLineChart",i=1.5,r=3e5,o=function(){function o(e){this.animator=e.animator,this.maxDataValue=Number.MIN_VALUE,this.newDataInterval=0,this.duration=r}return o.prototype.init=function(e){this.options=e;var i=this.cartesianSVG=e.svg;this.host=e.host,this.currentViewport=e.viewport,this.cartesianVisualHost=e.cartesianHost,this.style=e.style,i.classed(a,!0).classed("cartesianChart",!0);var r=this.mainGraphicsSVG=i.append("svg");r.classed("mainGraphicsSVG",!0),this.mainGraphicsContext=r.append("g").classed("mainGraphicsContext",!0),this.data={series:[],dataLabelsSettings:t.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:t.LineStyle.getDefault()}},o.prototype.setData=function(a){if(this.data||(this.data={series:[],dataLabelsSettings:t.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:t.LineStyle.getDefault()}),!_.isEmpty(a)){var i=_.head(a);if(i.categorical){var r=t.CartesianHelper.getCategoryAxisProperties(i.metadata),o=r.duration;o&&(this.duration=o);var n=this.dataViewCat=i.categorical;this.removeOldData();var s=n.categories,l=e.ValueType.fromDescriptor({text:!0});s&&s.length>0&&s[0].source&&s[0].source.type&&(l=s[0].source.type);var c=t.ScalarUtils.canHaveScalarAxis(i.metadata?i.metadata.objects:null,t.lineChartProps.categoryAxis.axisType,l),u=t.LineChart.converter({dataView:i,style:this.style,isScalar:c});this.mergeNewData(u),this.removeOldData(this.newDataInterval)}}},o.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||!_.isEmpty(this.data.series))},o.prototype.calculateAxesProperties=function(e){return this.currentViewport=e.viewport,this.margin=e.margin,this.newAxisData&&(this.axisData=this.newAxisData),this.newAxisData=this.createAxisData(e),this.axisData||(this.axisData=this.newAxisData),[this.xAxisProperties,this.yAxisProperties]},o.prototype.overrideXScale=function(e){this.xAxisProperties=e},o.prototype.render=function(e,t){if(!this.containsEmptySeries())return this.renderLines(),this.animator&&this.animator.refreshLastUpdate(),{dataPoints:[],behaviorOptions:{},labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:[],animateLabels:!1}},o.prototype.onClearSelection=function(){},o.prototype.createAxisData=function(a){var i=this.data;if(i){var r;this.containsEmptySeries()||(r=i.series[0].yCol);var o=this.truncateSeries(),n=t.AxisHelper.createDomain(o,i.categoryMetadata?i.categoryMetadata.type:e.ValueType.fromDescriptor({text:!0}),!0,[this.getMinData()+this.newDataInterval,null]),s=a.viewport,l=s.width,c=this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:l,dataDomain:n,metaDataColumn:i.categoryMetadata,formatString:t.valueFormatter.getFormatString(i.categoryMetadata,t.columnChartProps.general.formatString),outerPadding:10,isCategoryAxis:!0,isScalar:!0,isVertical:!1,categoryThickness:null,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,a){return t.CartesianHelper.lookupXValue(i,e,a,!0)},scaleType:t.axisScale.linear,margin:a.margin,preventNice:a.preventNiceX}),u=t.AxisHelper.createValueDomain(o),h=this.margin,d=this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:s.height-h.top-h.bottom,dataDomain:u,metaDataColumn:r,formatString:t.valueFormatter.getFormatString(r,t.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:t.axisScale.linear,margin:a.margin,preventNice:a.preventNiceY});return d.axis.orient("left").tickSize(-l),{x:c,y1:d}}},o.prototype.truncateSeries=function(){var t=this.getMinData(),a=this.data.series;return a?_.map(a,function(a,i){a=e.Prototype.inherit(a),a.data=e.Prototype.inherit(a.data);var r=_.findIndex(a.data,function(e){return e&&e.categoryValue>=t}),o=0;return r>0&&o++,a.data=a.data.slice(o),a}):[]},o.prototype.removeOldData=function(e){if(void 0===e&&(e=0),!this.containsEmptySeries()){for(var t=this.getMinData(e),a=this.data,i=0,r=a.series;i<r.length;i++){var o=r[i],n=_.findIndex(o.data,function(e){return e&&e.categoryValue>t});n>0&&(o.data=o.data.slice(n))}var s=_.findIndex(a.categoryData,function(e){return e&&e.categoryValue>t});s>0&&(a.categoryData=this.data.categoryData.slice(s),a.categories=this.data.categories.slice(s))}},o.prototype.mergeNewData=function(e){if(this.containsEmptySeries())return this.data=e,void(this.maxDataValue=this.getMaxData());this.data.series=o.mergeSeries(this.data.series,e.series,this.maxDataValue),o.mergeCategories(this.data,e,this.maxDataValue);var t=this.getMaxData();this.newDataInterval=this.maxDataValue&&t?t-this.maxDataValue:0,this.maxDataValue=t},o.prototype.getMaxData=function(){for(var e=0,t=0,a=this.data.series;t<a.length;t++){var i=a[t];i.data.length&&(e=Math.max(_.last(i.data).categoryValue,e))}return e},o.prototype.getMinData=function(e){return void 0===e&&(e=0),this.maxDataValue-this.duration-e*i},o.prototype.renderLines=function(){var e=this.axisData.x.scale,a=this.axisData.y1.scale,i=this.currentViewport,r=this.margin,o=i.height-r.top-r.bottom,n=i.width-r.left-r.right,s=e(e.domain()[0]+this.newDataInterval)-e(e.domain()[0]),l=d3.svg.line().x(function(t,a){return e(t.categoryValue)}).y(function(e,t){return a(e.value)});this.mainGraphicsSVG.attr({x:0,height:o,width:n}),this.mainGraphicsContext.attr("transform",t.SVGUtil.translate(0,0));
var c=this.mainGraphicsContext.selectAll(".line").data(this.data.series,function(e){return e.identity.getKey()});c.enter().append("path").classed("line",!0),c.style("stroke",function(e){return e.color}).attr("d",function(e){return l(e.data)}),c.exit().remove(),this.animator&&this.animator.animate({mainGraphicsContext:this.mainGraphicsContext,interactivityService:null,xTranslation:s})},o.prototype.containsEmptySeries=function(){return!this.data||_.isEmpty(this.data.series)},o.mergeCategories=function(e,t,a){var i=t.categories,r=_.findIndex(i,function(e){return e&&e.categoryValue>a});r>-1?(e.categories=e.categories.concat(t.categories.slice(r)),e.categoryData=e.categoryData.concat(t.categoryData.slice(r))):(e.categories=t.categories,e.categoryData=t.categoryData)},o.mergeSeries=function(e,t,a){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r],s=_.find(e,function(e){return e.identity.equals(n.identity)});if(s){i.push(s);for(var l=0,c=n.data;l<c.length;l++){var u=c[l];u.categoryValue>a&&s.data.push(u)}}else i.push(n)}return i},o.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},o.prototype.getStaticSeriesRole=function(){return"Y"},o}();t.RealTimeLineChart=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=1500,a="linear",i=function(i){function r(e){var t=i.call(this,e)||this;return t.lastUpdateTime=null,t}return __extends(r,i),r.prototype.refreshLastUpdate=function(){this.lastUpdateTime=Date.now()},r.prototype.getDuration=function(){if(this.lastUpdateTime){var e=Math.min(Date.now()-this.lastUpdateTime,t);return Math.max(this.animationDuration,e)}return this.animationDuration},r.prototype.getEasing=function(){return a},r.prototype.animate=function(t){var a=t.mainGraphicsContext,i=this.getDuration();return a.transition().duration(i).ease(this.getEasing()).attrTween("transform",function(a,i,r){return function(a){return e.SVGUtil.translate(-(t.xTranslation*a),0)}}),{failed:!1}},r}(e.BaseAnimator);e.RealTimeLineChartAnimator=i;var r=function(t){function i(e){return t.call(this,e)||this}return __extends(i,t),i.prototype.animate=function(t){var a={failed:!0,shapes:null},i=t.viewModel,r=this.previousViewModel;return i.categories.length*i.series.length>e.AnimatorCommon.MaxDataPointsToAnimate?a:(r&&(a=this.animateDefaultShapes(t.viewModel,t.series,t.layout,t.itemCS)),this.previousViewModel=i,a)},i.prototype.getEasing=function(){return a},i.prototype.animateDefaultShapes=function(t,a,i,r){var o=a.selectAll(r.selector),n=o.data(function(e){return e.data},function(e){return e.key});return n.enter().append("rect").attr("class",function(e){return r.class.concat(e.highlight?" highlight":"")}),n.style("fill",function(e){return e.color}).style("fill-opacity",function(a){return e.ColumnUtil.getFillOpacity(a.selected,a.highlight,!1,t.hasHighlights)}).transition().ease(this.getEasing()).duration(this.animationDuration).attr(i.shapeLayout),n.exit().remove(),{failed:!1,shapes:n}},i}(e.BaseAnimator);e.DashboardColumnChartAnimator=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){function t(){function t(e,t,r,o){return t.useMatrixDV?i(e,t,r):e.categorical&&e.categorical.values?a(e,t,r,o):void 0}function a(t,a,i,n){var s,l,c=e.data.createDataViewCategoricalReaderAdvanced(t,{colorOptions:{valueRole:"Size",visualStyle:a.style}}),u=a.style,h=a.interactivityService,p=a.categoryAxisProperties,y=a.valueAxisProperties,m=t.categorical,v=k.getGradientValueColumn(m);m.categories&&m.categories.length>0?(s=m.categories[0].values,l=E.create({format:E.getFormatString(m.categories[0].source,O.general.formatString),value:s[0],value2:s[s.length-1],columnType:c.data.getCategoryType("Category")})):(s=[null],l=E.createDefaultFormatter(null));var f,x=m.categories,C=m.values,S=!!C.source,b=C.grouped(),D=C.source,w=g(b,D),P=T.getDefaultPointLabelSettings(u,"smallLightLabel"),L=r(b,w.idx.size),A=d(t,P,!1,u),V=o(c,C,w,x,s,l,S,P,v,A.colorByCategory,i,a.tooltipsEnabled),M=_.reduce(V,function(e,t){return e.concat(t.dataPoints)},[]);f=S?F.buildSeriesLegendData({dataView:t,style:a.style,showByDefault:!0,simpleMarkerProp:O.bubbles.markerShape}):F.getDefaultLegendData(),p&&null!==p.showAxisTitle&&p.showAxisTitle===!1&&(w.axesLabels.x=null),y&&null!==y.showAxisTitle&&y.showAxisTitle===!1&&(w.axesLabels.y=null),h&&(h.applySelectionStateToData(M),h.applySelectionStateToData(f.dataPoints));var I=c.data.hasCategories();return{xCol:w.cols.x,yCol:w.cols.y,hasCategory:I,hasSize:!!w.cols.size,dataPoints:M,dataPointSeries:V,legendData:f,axesLabels:w.axesLabels,size:w.cols.size,sizeRange:L,dataLabelsSettings:P,hasDynamicSeries:S,fillPoint:A.fillPoint,colorBorder:A.colorBorder,colorByCategory:A.colorByCategory,multiplier:A.bubbleSizeMultiplier,xSubtotal:n&&n[H.x],ySubtotal:n&&n[H.y],plotAreaShadingSettings:A.plotAreaShadingSettings,ratioLineSettings:A.ratioLineSettings,markerShape:A.markerShape,dataVolume:A.dataVolume}}function i(e,t,a){if(e&&e.matrix&&(0!==_.size(e.matrix.valueSources)||0!==_.size(e.matrix.rows.levels))){var i=t.interactivityService,r=T.getDefaultPointLabelSettings(t.style,"smallLightLabel"),o=d(e,r,!0,t.style),s=v(e,o),l={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c=s.cols.size;c&&c.aggregates&&(l={min:c.aggregates.minLocal||c.aggregates.min,max:c.aggregates.maxLocal||c.aggregates.max});for(var u=e.matrix.valueSources,h=[],p=0;p<u.length;p++)L.hasRole(u[p],"Tooltips")&&h.push(p);var g,y={colorHelper:w.create(t.style,O.dataPoint.fill,o.defaultDataPointColor,o.fill),metadata:s,hasDynamicSeries:L.hasRoleInDataView(e,"Series"),tooltipsEnabled:t.tooltipsEnabled,sizeRange:l,dataLabelSettings:r,playFrameInfo:a,tooltipValuesIndices:h,gradientIndex:_.findIndex(u,function(e){return L.hasRole(e,"Gradient")}),objProps:o,categoryMap:{},categoryMapNextIndex:0,categoryIdentities:t.axisInteractivity?[]:void 0},m=n(e,y),f=_.reduce(m.series,function(e,t){return e.concat(t.dataPoints)},[]);if(y.hasDynamicSeries){var x={dataView:e,colorHelper:y.colorHelper,style:t.style,formatStringProp:null,showByDefault:!0,markerShapePropIdentifier:O.bubbles.markerShape},C=y.metadata.xGroupMetadata;g=C&&C.isCategoricalAxis?F.buildFromFirstMatrixColumnLevel(x):F.buildFromFirstMatrixRowLevel(x)}else g=F.getDefaultLegendData(t.style);i&&(i.applySelectionStateToData(f),i.applySelectionStateToData(g.dataPoints));var S=!!(s.xGroupMetadata||s.yGroupMetadata||s.categoryLevel);return{xCol:s.cols.x,yCol:s.cols.y,hasCategory:S,hasSize:!!s.cols.size,dataPoints:f,dataPointSeries:m.series,legendData:g,axesLabels:s.axesLabels,categoryIdentities:y.categoryIdentities,size:s.cols.size,sizeRange:l,dataLabelsSettings:r,hasDynamicSeries:y.hasDynamicSeries,fillPoint:o.fillPoint,colorBorder:o.colorBorder,colorByCategory:o.colorByCategory,multiplier:o.bubbleSizeMultiplier,xSubtotal:m.xSubtotal,ySubtotal:m.ySubtotal,plotAreaShadingSettings:o.plotAreaShadingSettings,ratioLineSettings:o.ratioLineSettings,markerShape:o.markerShape,dataVolume:o.dataVolume,xGroupMetadata:s.xGroupMetadata,yGroupMetadata:s.yGroupMetadata,treatNullsAsZero:s.treatNullsAsZero}}}function r(e,t){var a={};return e&&e.forEach(function(e){var i=N.getMeasureValue(t,e.values),r=C.getRangeForColumn(i);(null==a.min||a.min>r.min)&&(a.min=r.min),(null==a.max||a.max<r.max)&&(a.max=r.max)}),a}function o(e,t,a,i,r,o,n,s,l,c,u,h){var d=e.data.hasValues("X"),p=e.data.hasValues("Y");if(!d&&!p)return[];for(var g=[],y=a.idx,v=O.general.formatString,f=t.source,S=t.grouped(),b=_.isEmpty(i)?null:i[0],w=e.objects.getStaticObjects(),P=V.getValue(w,O.bubbles.markerShape,x.markerShape.circle),L=m(a),A=0,k=S.length;A<k;A++){var T=S[A],F=T.values,B=N.getMeasureValue(_.first(y.x),F),U=N.getMeasureValue(y.y,F),z=N.getMeasureValue(y.size,F),G=void 0;n&&(G=e.colors.createBySeries(A,void 0,M));var j=void 0;j=e.data.hasSeries()&&V.getValue(w,O.bubbles.showSeries)?V.getValue(e.objects.getSeriesDataObjects(A),O.bubbles.markerShape,P):P;var W=e.identities.createForSeries(A,[H.size]),X={identityKey:T&&T.identity&&T.identity.key||"",dataPoints:[],hasSize:!(!z||!z.values),fill:G,identity:W,markerShape:j,name:n?E.format(e.data.getSeriesName(A),e.objects.getSeriesFormatString()):void 0};g.push(X);for(var Y=function(a,g){var y=r[a],m=d?C.normalizeNonFiniteNumber(e.data.getValue("X",a,A)):0,x=p?C.normalizeNonFiniteNumber(e.data.getValue("Y",a,A)):0,S=C.normalizeNonFiniteNumber(e.data.getValue("Size",a,A));if(null==m||null==x)return"continue";var w=void 0;w=c&&!n?e.colors.createByCategory(a,M):e.colors.createBySeries(A,a,M);var P=void 0,V=R.builder().withCategory(b,a).withSeries(t,T).withMeasures(L);u?(P=V.clone(),P.withColumnIdentity(u.identity,u.column.queryName)):P=V;var k=P.createSelectionId(),F=V?V.createSelectionId():k,O=new D(e.columns);if(h){var H=I.defaultFormatter(v),E=I.fallbackBasedOnType(v);O.withColumnValueByIndex(b,a,!0,H),n&&O.withColumnValue(f,T.name,!0,H),O.withColumnValueByIndex(B,a,!1,E).withColumnValueByIndex(U,a,!1,E).withColumnValueByIndex(z,a,!1,E).withColumnValueByIndex(l,a,!1,E),u&&O.withValue(u.column.displayName,u.label),O.withAllValuesForRole("Tooltips",a,A,!1,E)}var _={x:m,y:x,size:S,radius:{sizeMeasure:z,index:a},fill:w,formattedCategory:N.createLazyFormattedCategory(o,null!=i?y:T.name),selected:!1,identity:k,renderIdentity:F,tooltipInfo:function(){return O.getTooltipItems()},labelFill:s.fontProperties.color,markerShape:j,categoryIndex:a,seriesIndex:A};X.dataPoints.push(_)},q=0,K=r.length;q<K;q++)Y(q,K)}return g}function n(t,a){var i=[],r=t.matrix;if(!r.rows.root||0===_.size(r.rows.root.children))return{series:i};var o,n=a.metadata,u=n.seriesLevel,d=n.categoryLevel,p=n.seriesNode,g=n.idx.size!==-1?r.valueSources[n.idx.size]:void 0;if(p){for(var y=0;y<p.children.length;y++){var v=p.children[y];if(!v.isSubtotal){var f=a.colorHelper.getColorForSeriesValue(v.objects,p.childIdentityFields,v.value,M),x=(new R).withColumnIdentity(v.identity,u.sources[0].queryName).createSelectionId(),C=void 0;C=a.objProps.markerShapeShowAllSeries?e.DataViewObjects.getValue(v.objects,O.bubbles.markerShape,a.objProps.markerShape):a.objProps.markerShape;var S=E.format(v.value,e.DataViewObjects.getValue(u.sources[0].objects,O.general.formatString)),b={identityKey:v.identity&&v.identity.key||"",dataPoints:[],hasSize:!!g,fill:f,identity:x,markerShape:C,name:S};i.push(b);var D={currentSeries:v,currentSeriesColor:f,seriesShape:C,seriesIndex:y};if(b.dataPoints=l(t,D,a),!d&&0===_.size(b.dataPoints)){var w=u.sources[0],P=c(void 0,w),L={category:v,categoryMetadataColumns:[w],categoryIdentityFields:v.childIdentityFields,currentSeries:v,currentSeriesMetadata:w,currentSeriesColor:f,categoryFormatter:P,valueColumnIds:m(a.metadata),seriesShape:C,currentSeriesIndex:y},A=h(t,L,a);A&&b.dataPoints.push(A)}}}var V=t.matrix.rows.root.children,I=_.find(V,function(e){return e.isSubtotal});I&&(o=s(n,I))}else if(d){var k=null!=g?g.queryName:"",f=a.colorHelper.getColorForMeasure(null,k,M),b={identityKey:"",dataPoints:[],hasSize:!!g,fill:f,markerShape:a.objProps.markerShape};i.push(b);var D={currentSeries:r.rows.root,currentSeriesColor:f,seriesShape:a.objProps.markerShape};b.dataPoints=l(t,D,a);var V=t.matrix.rows.root.children,I=_.find(V,function(e){return e.isSubtotal});I&&(o=s(a.metadata,I))}else{var k=null!=g?g.queryName:"",f=a.colorHelper.getColorForMeasure(null,k,M),T={identityKey:"",dataPoints:[],hasSize:!!g,fill:f};i.push(T);var D={currentSeries:r.rows.root,currentSeriesColor:f,seriesShape:a.objProps.markerShape};T.dataPoints=l(t,D,a);var F=a.metadata;F.xGroupMetadata||F.yGroupMetadata||(o=s(F,t.matrix.rows.root.children[0]))}return{series:i,xSubtotal:o&&o.xSubtotal,ySubtotal:o&&o.ySubtotal}}function s(e,t){var a,i=e.idx.x,r=e.idx.y,o=_.first(i);o!==-1&&(a=C.normalizeNonFiniteNumber(t.values[o].value));var n;return r!==-1&&(n=C.normalizeNonFiniteNumber(t.values[r].value)),{xSubtotal:a,ySubtotal:n}}function l(e,t,a){var i=[],r=t.currentSeries,o=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,n=m(a.metadata),s=u(e,t,a);if(_.isEmpty(s.categories))return i;for(var l=0,c=s.categories;l<c.length;l++){var d=c[l],p={category:d,categoryMetadataColumns:s.categoryMetadataColumns,categoryIdentityFields:r.childIdentityFields,currentSeries:r,currentSeriesMetadata:o,currentSeriesColor:t.currentSeriesColor,categoryFormatter:s.formatter,valueColumnIds:n,seriesShape:t.seriesShape,currentSeriesIndex:t.seriesIndex},g=h(e,p,a);g&&i.push(g)}return i}function c(e,t){var a;if(e){var i=e.levelValues;a=E.create({format:E.getFormatString(t,O.general.formatString),value:i[0],value2:i[_.size(e.values)-1],columnType:null})}else a=E.createDefaultFormatter(null);return a}function u(e,t,a){var i,r,o=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,n=t.currentSeries,s=E.createDefaultFormatter(null);if(a.metadata.xGroupMetadata&&a.metadata.xGroupMetadata.isCategoricalAxis){var l=e.matrix.rows;i=l.root.children,r=l.levels[0].sources,s=c(i[0],r[0])}else n.children?(i=n.children,r=e.matrix.rows.levels.length>0?e.matrix.rows.levels[i[0].level].sources:void 0,o&&(s=c(i[0],r[0]))):o&&L.hasRole(o,"Category")&&(i=[n],r=[o],s=c(i[0],r[0]));return{categories:i,categoryMetadataColumns:r,formatter:s}}function h(e,t,a){if(!t.category.isSubtotal){var i=a.metadata,r=e.matrix,o=i.idx.x,n=i.idx.y,s=i.idx.size,l=_.size(r.valueSources),c=i.xGroupMetadata,u=i.yGroupMetadata,h=_.first(o),d=0;c||h===-1||(d=C.normalizeNonFiniteNumber(t.category.values[h].value),d=i.treatNullsAsZero&&i.treatNullsAsZero.x&&null==d?0:d);var p=null==d?null:[d];c&&(p=_.map(o,function(e){return t.category.levelValues[e].value}));var g=0,y=i.xGroupMetadata&&i.xGroupMetadata.isCategoricalAxis;if(u||n===-1)u&&(g=t.category.levelValues[n].value);else{var m=y&&null!=t.currentSeriesIndex?t.currentSeriesIndex*l+n:n;g=C.normalizeNonFiniteNumber(t.category.values[m].value),g=i.treatNullsAsZero&&i.treatNullsAsZero.y&&null==g?0:g}if(null!=p&&null!=g){var v;if(s!==-1){var m=null!=t.currentSeriesIndex&&y?t.currentSeriesIndex*l+s:s;v=C.normalizeNonFiniteNumber(t.category.values[m].value)}var f,x=R.builder();if(!_.isEmpty(t.categoryMetadataColumns))for(var S=0,b=t.categoryMetadataColumns;S<b.length;S++){var w=b[S];x.withColumnIdentity(t.category.identity,w.queryName)}if(t.currentSeriesMetadata&&!_.some(t.categoryMetadataColumns,function(e){return e===t.currentSeriesMetadata})&&x.withColumnIdentity(t.currentSeries.identity,t.currentSeriesMetadata.queryName),_.isEmpty(t.valueColumnIds)||x.withMeasures(t.valueColumnIds),a.playFrameInfo){var P=a.playFrameInfo;f=x.clone(),x.withColumnIdentity(P.identity,P.column.queryName)}var L=x.createSelectionId(),V=f?f.createSelectionId():L,k=a.sizeRange;k.min>v&&(k.min=v),k.max<v&&(k.max=v);var T=t.currentSeriesColor;if(!a.hasDynamicSeries)if(a.objProps.colorByCategory)T=a.colorHelper.getColorForSeriesValue(t.category.objects,t.categoryIdentityFields,t.category.value,M);else if(t.category.objects){var F=null!=a.metadata.cols.size?a.metadata.cols.size.queryName:"";T=a.colorHelper.getColorForMeasure(t.category.objects,F,M)}var H=O.general.formatString,B=I.defaultFormatter(H),E=function(){var e=t.category.levelValues,a=t.currentSeries.value;if(e){a=_.size(e)>1?A.concatenateValues(_.map(e,function(e,a){return B(e.value,t.categoryMetadataColumns[a])})):e[0].value}return a},U=new D((void 0));if(a.tooltipsEnabled){var z=I.fallbackBasedOnType(H),G=t.category.levelValues,j=_.size(t.categoryMetadataColumns)>1;c||u||(j?U.withMultipleColumnAndValues(t.categoryMetadataColumns,_.map(G,function(e){return e.value}),!0,B):G&&U.withColumnValue(_.head(t.categoryMetadataColumns),G[0].value,!0,B)),a.hasDynamicSeries&&U.withColumnValue(t.currentSeriesMetadata,t.currentSeries.value,!0,B),c&&a.metadata.xGroupMetadata.isCategoricalAxis?U.withMultipleColumnAndValues(t.categoryMetadataColumns,p,!0,B):U.withColumnValue(i.cols.x,p[0],!1,z),U.withColumnValue(i.cols.y,g,!1,z).withColumnValue(i.cols.size,v,!1,z);var W=a.gradientIndex,X=r.valueSources;W>=0&&U.withColumnValue(X[W],t.category.values[W].value,!1,z);var P=a.playFrameInfo;P&&U.withValue(P.column.displayName,P.label);for(var Y=0,q=a.tooltipValuesIndices;Y<q.length;Y++){var m=q[Y];U.withColumnValue(X[m],t.category.values[m].value,!1,z)}}var K,Z=_.size(p)>1?p.join(" "):p[0];K=y?Z:E();var $=a.categoryMap,J=String(K),Q=$[J];if(void 0===Q){$[J]=Q=a.categoryMapNextIndex,a.categoryMapNextIndex=Q+1;var ee=a.categoryIdentities;ee&&(ee[Q]=function(){var e=R.builder();if(!_.isEmpty(t.categoryMetadataColumns))for(var a=0,i=t.categoryMetadataColumns;a<i.length;a++){var r=i[a];e.withColumnIdentity(t.category.identity,r.queryName)}return e.withMeasures(t.valueColumnIds).createSelectionId()})}return{x:Z,y:g,size:v,radius:{sizeMeasure:null,index:-1,value:v},fill:T,formattedCategory:N.createLazyFormattedLazyValue(t.categoryFormatter,function(){return E()}),selected:!1,identity:L,renderIdentity:V,tooltipInfo:function(){return U.getTooltipItems()},labelFill:a.dataLabelSettings.fontProperties.color,markerShape:t.seriesShape,categoryIndex:Q,seriesIndex:t.currentSeriesIndex||0}}}}function d(t,a,i,r){var o={};t&&t.metadata&&t.metadata.objects&&(o=t.metadata.objects);var n={};n.defaultDataPointColor=e.DataViewObjects.getFillColor(o,P.dataPoint.defaultColor),n.fill=e.DataViewObjects.getFillColor(o,P.dataPoint.fill);var s=o.categoryLabels;s&&a&&T.updateLabelSettingsFromLabelsObject(s,a,void 0,r);var l=!1;l=i?t&&k.hasGradientRoleInMatrix(t.matrix):t&&k.hasGradientRole(t.categorical),n.fillPoint=e.DataViewObjects.getValue(o,O.fillPoint.show,l),n.colorBorder=e.DataViewObjects.getValue(o,O.colorBorder.show,!1),n.colorByCategory=e.DataViewObjects.getValue(o,O.colorByCategory.show,!1),n.bubbleSizeMultiplier=B.getBubbleSizeMultiplier(e.DataViewObjects.getValue(o,O.bubbles.bubbleSize)),n.markerShape=e.DataViewObjects.getValue(o,O.bubbles.markerShape,x.markerShape.circle),n.markerShapeShowAllSeries=V.getValue(o,O.bubbles.showSeries);var c=w.create(r);n.plotAreaShadingSettings={show:e.DataViewObjects.getValue(o,O.plotAreaShading.show,N.DefaultPlotAreaShadingSettings.show),upperShadingColor:p(c,o,O.plotAreaShading.upperShadingColor,N.DefaultPlotAreaShadingSettings.upperShadingColor),lowerShadingColor:p(c,o,O.plotAreaShading.lowerShadingColor,N.DefaultPlotAreaShadingSettings.lowerShadingColor),transparency:e.DataViewObjects.getValue(o,O.plotAreaShading.transparency,N.DefaultPlotAreaShadingSettings.transparency)};var u=b.getDefaultScatterRatioLineSettings(r);return n.ratioLineSettings={show:e.DataViewObjects.getValue(o,O.ratioLine.show,u.show),lineColor:p(c,o,O.ratioLine.lineColor,u.lineColor),transparency:e.DataViewObjects.getValue(o,O.ratioLine.transparency,u.transparency),style:e.DataViewObjects.getValue(o,O.ratioLine.style,u.style)},n.dataVolume=e.DataViewObjects.getValue(o,O.general.dataVolume,N.DefaultDataVolume),n.categoryAxisType=e.DataViewObjects.getValue(o,S.categoryAxis.axisType),n.xValuesTreatNullsAsZero=e.DataViewObjects.getValue(o,O.categoryAxis.treatNullsAsZero,!1),n.yValuesTreatNullsAsZero=e.DataViewObjects.getValue(o,O.valueAxis.treatNullsAsZero,!1),n}function p(e,t,a,i){return{solid:{color:e.getColorForPropertyWithDefaultColor(t,a,i?i.solid.color:void 0)}}}function g(e,t){var a,i,r,o=L.getMeasureIndexOfRole(e,"X"),n=L.getMeasureIndexOfRole(e,"Y"),s=L.getMeasureIndexOfRole(e,"Size"),l="",c="";if(e&&e.length){var u=e[0];o>=0&&(a=u.values[o].source,l=u.values[o].source.displayName),n>=0&&(i=u.values[n].source,c=u.values[n].source.displayName),s>=0&&(r=u.values[s].source)}return{idx:{x:[o],y:n,size:s},cols:{x:a,y:i,size:r},axesLabels:{x:l,y:c}}}function y(e,t){for(var a=0,i=e.levels.length;a<i;a++){var r=e.levels[a],o=_.chain(r.sources).map(function(e,t){return{levelSource:e,index:t}}).filter(function(e){return L.hasRole(e.levelSource,t)}).map(function(e){return e.index}).value();if(!_.isEmpty(o))return{levelIndex:a,levelSourceIndices:o,column:r.sources[_.first(o)]}}}function m(e){var t=[],a=e.cols;return!e.xGroupMetadata&&a.x&&t.push(a.x.queryName),!e.yGroupMetadata&&a.y&&t.push(a.y.queryName),a.size&&t.push(a.size.queryName),t}function v(t,a){var i,r,o,n=t.matrix,s=n.valueSources,l=!1,c=!1,u=[_.findIndex(s,function(e){return L.hasRole(e,"X")})],h=_.findIndex(s,function(e){return L.hasRole(e,"Y")}),d=_.findIndex(s,function(e){return L.hasRole(e,"Size")}),p="",g="";if(u[0]>=0)i=s[u[0]],p=i.displayName;else{var m=y(n.rows,H.x);m&&(i=m.column,u=m.levelSourceIndices,p=i.displayName,l=!0)}if(h>=0)r=s[h],g=r.displayName;else{var m=y(n.rows,H.y);m&&(r=m.column,h=m.levelSourceIndices[0],g=r.displayName,c=!0)}d>=0&&(o=s[d]);var v,f=_.find(n.rows.levels,function(e){return!_.isEmpty(e.sources)&&L.hasRole(e.sources[0],H.series)});f?v=n.rows.root:(f=_.find(n.columns.levels,function(e){return!_.isEmpty(e.sources)&&L.hasRole(e.sources[0],H.series)}),f&&(v=n.columns.root));var x=!1,C=!1;if(i){var S=i.type;x=_.size(u)<=1&&!(!S.integer&&!S.numeric),C=a.categoryAxisType===e.visuals.axisType.categorical||!x}var b;return b=l?_.find(n.rows.levels,function(e){return L.hasRole(e.sources[0],H.x)}):c?_.find(n.rows.levels,function(e){return L.hasRole(e.sources[0],H.y)}):_.find(n.rows.levels,function(e){return L.hasRole(e.sources[0],H.category)}),{idx:{x:u,y:h,size:d},cols:{x:i,y:r,size:o},axesLabels:{x:p,y:g},xGroupMetadata:l?{isCategoricalAxis:C,isScalarType:x}:void 0,yGroupMetadata:c?{isCategoricalAxis:!1,isScalarType:!0}:void 0,seriesLevel:f,seriesNode:v,categoryLevel:b,treatNullsAsZero:{x:a.xValuesTreatNullsAsZero,y:a.yValuesTreatNullsAsZero}}}var f=e.data,x=e.visuals,C=x.AxisHelper,S=x.cartesianChartProps,b=e.visuals.CartesianHelper,D=x.CategoricalLazyTooltipBuilder,w=e.visuals.ColorHelper,P=x.columnChartProps,L=f.DataRoleHelper,A=x.DataViewConcatenateUtil,V=e.DataViewObjects,M=x.ForegroundColorName,I=x.FormattingStrategies,k=x.GradientUtils,T=x.LabelUtils,F=x.Legend,N=x.ScatterChart,O=x.scatterChartProps,H=x.scatterRoleNames,R=x.SelectionIdBuilder,B=x.shapeUtil,E=x.valueFormatter;return{scatterConverter:function(e,a,i,r){return t(e,a,i,r)}}}e.scatterChartConverterModuleFactory=t}(powerbi||(powerbi={}));var powerbi;!function(e){function t(){function t(e,t){if(t)for(var a in e)e[a]===t[a]&&(e[a]=null)}function a(e,t){for(var a in t){var i=e.style[a],r=t[a];if(null==r){if(""===i)continue}else if(r=r.toString(),r===i)continue;e.style[a]=r}}var i=e.visuals,r=i.CartesianHelper,o=jsCommon.CssConstants.createClassAndSelector,n=e.visuals.DataDirection,s=i.LineStyle,l=i.PlayChart,c=i.ScatterChart,u=e.visuals.SetFocusRingClassName,h=i.SVGUtil,d=o("scatterMarker"),p=o("mainGraphicsContext"),g=o("scatterMarkerSeriesGroup"),y=o("plotAreaShadingLayer"),m=o("upperShadingArea"),v=o("lowerShadingArea"),f=o("ratioLineLayer"),x=o("ratioLine"),C=function(){function i(){}return i.prototype.init=function(e,t,a,i,r,o,n){if(this.axisGraphicsContext=e,this.mainGraphicsG=e.append("g").classed(p.class,!0),this.isMobileChart=a,a&&(this.mainGraphicsBackgroundRect=this.mainGraphicsG.append("rect").classed("backgroundRect",!0).attr({width:"100%",height:"100%"})),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.labelGraphicsContext=t,this.tooltipsEnabled=i,this.tooltipService=r,this.mainGraphicsContext.attr("stroke-width","1"),o){var s=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr("tabindex",0).attr("focusable","true").attr("aria-label",n.getLocalizedString("Visual_Plot")).classed(u,!s)}},i.prototype.markersHaveChanged=function(e){var t=_.map(e.data.dataPointSeries,function(e){return e.markerShape}),a=this.previousMarkers;if(!a)return this.previousMarkers=t,!1;for(var i=0,r=Math.min(t.length,a.length);i<r;i++)if(t[i]!==a[i])return this.previousMarkers=t,!0;return this.previousMarkers=t,!1},i.prototype.render=function(e,t,a,i){var r=e.plotArea,o=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({width:r.width,height:r.height}).classed(u,!o&&t),this.drawRatioLine(e,i),this.drawShadedBackground(e);var n;return n=e.suppressDataPointRendering?this.removeScatterMarkers():e.animationDuration>0&&!this.markersHaveChanged(e)?this.drawScatterMarkers(e,t):this.drawScatterMarkersNoAnimation(e,e.drawBubbles,t),e.drawBubbles&&n.order(),this.tooltipsEnabled&&this.tooltipService.addTooltip(this.mainGraphicsContext,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity}),h.flushAllD3TransitionsIfNeeded(e.animationOptions),this.numSeries=e.data.dataPointSeries.length,this.scatterChartDataPoints=e.allData.dataPoints,{dataPointsSelection:n,eventGroup:this.mainGraphicsG,data:e.data,root:this.mainGraphicsContext,visualInstanceId:a.instanceId}},i.prototype.getNextDataPoint=function(e,t,a){var i,r,o,s,l=this.mainGraphicsContext.selectAll(d.selector),c=this.scatterChartDataPoints,u=e,h=t;switch(a){case n.PreviousCategory:case n.NextCategory:s=a===n.PreviousCategory?-1:1,o=_.sortBy(_.filter(c,function(e){return e.seriesIndex===t}),"categoryIndex");var p=s+_.findIndex(o,function(t){return t.categoryIndex===e});p>=o.length||p<0?(i=this.rollToNextSeries(c,t,a),u=i[0],h=i[1]):u=o[p].categoryIndex;break;case n.PreviousSeries:case n.NextSeries:s=a===n.PreviousSeries?-1:1,o=_.sortBy(_.filter(c,function(t){return t.categoryIndex===e}),"seriesIndex");var g=s+_.findIndex(o,function(e){return e.seriesIndex===t});g>=o.length||g<0?(r=this.rollToNextCategory(c,e,a),u=r[0],h=r[1]):h=o[g].seriesIndex}return{element:l.filter(function(e,t){return e.seriesIndex===h&&e.categoryIndex===u}).node(),targetCategoryIndex:u}},i.prototype.rollToNextSeries=function(e,t,a){var i=a===n.PreviousCategory?-1:1,r=a===n.PreviousCategory?_.last:_.first;return t+=i,t>=this.numSeries?t=0:t<0&&(t=this.numSeries-1),[r(_.sortBy(_.filter(e,function(e){return e.seriesIndex===t}),"categoryIndex")).categoryIndex,t]},i.prototype.rollToNextCategory=function(e,t,a){var i=d3.max(e,function(e){return e.categoryIndex})+1,r=a===n.PreviousSeries?-1:1,o=a===n.PreviousSeries?_.last:_.first;return t+=r,t>=i?t=0:t<0&&(t=i-1),[t,o(_.sortBy(_.filter(e,function(e){return e.categoryIndex===t}),"seriesIndex")).seriesIndex]},i.prototype.getFirstElement=function(){return this.mainGraphicsContext.selectAll(d.selector).node()},i.prototype.createTraceLineRenderer=function(e){return new D(e,this.mainGraphicsContext,this.tooltipsEnabled,this.tooltipService)},i.prototype.drawShadedBackground=function(e){var t=e.data.plotAreaShadingSettings||c.DefaultPlotAreaShadingSettings,a=this.axisGraphicsContext.select(y.selector);if(!t.show)return void(a.empty()||a.remove());a.empty()&&(a=this.axisGraphicsContext.insert("svg",":first-child").classed(y.class,!0).style("pointer-events","none")),a.attr({height:e.plotArea.height,width:e.plotArea.width});var i=e.xAxisProperties.scale,r=e.yAxisProperties.scale,o=i.domain(),n=r.domain(),s=[Math.min(o[0],n[0]),Math.max(o[1],n[1])],l=[{x:i(s[0]),y:r(s[0])},{x:i(s[1]),y:r(s[1])}],u=t.show?[[{x:l[0].x,y:l[0].y},{x:l[0].x,y:l[1].y}],[{x:l[1].x,y:l[1].y},{x:l[1].x,y:l[1].y}]]:[];this.drawArea(m,a,u,t.upperShadingColor,t.transparency);var h=t.show?[[{x:l[0].x,y:l[0].y},{x:l[0].x,y:l[0].y}],[{x:l[1].x,y:l[0].y},{x:l[1].x,y:l[1].y}]]:[];this.drawArea(v,a,h,t.lowerShadingColor,t.transparency)},i.prototype.drawRatioLine=function(e,t){var a=e.data.ratioLineSettings||r.getDefaultScatterRatioLineSettings(t),i=this.axisGraphicsContext.select(f.selector);if(!a.show)return void(i.empty()||i.remove());i.empty()&&(i=this.axisGraphicsContext.append("svg").classed(f.class,!0)),i.attr({height:e.plotArea.height,width:e.plotArea.width});var o=e.xAxisProperties.scale,n=e.yAxisProperties.scale,s=o.domain(),l=n.domain(),c=e.data.xSubtotal,u=e.data.ySubtotal,h=[];if(a.show&&_.isFinite(c)&&_.isFinite(u))if(0!==c&&0!==u){var d=u/c;h=[{x:o(s[0]),y:n(s[0]*d)},{x:o(s[1]),y:n(s[1]*d)}]}else 0!==u?h=[{x:o(0),y:n(l[0])},{x:o(0),y:n(l[1])}]:0!==c&&(h=[{x:o(s[0]),y:n(0)},{x:o(s[1]),y:n(0)}]);this.drawLine(x,i,h,a)},i.prototype.removeScatterMarkers=function(){return this.mainGraphicsContext.selectAll(g.selector).remove(),this.mainGraphicsContext.selectAll(d.selector)},i.getXOfFirstCategory=function(e){var t=e.data.xGroupMetadata;if(t&&t.isCategoricalAxis){var a=e.xAxisProperties.scale;if(a.rangeBand)return a.rangeBand()/2}return 0},i.prototype.drawScatterMarkers=function(t,a){var o=t.data,n=t.xAxisProperties.scale,s=t.yAxisProperties.scale,l=o.xGroupMetadata&&o.xGroupMetadata.isCategoricalAxis,p=i.getXOfFirstCategory(t),y=[{identityKey:"",dataPoints:o.dataPoints}],m=this.mainGraphicsContext.selectAll(g.selector).data(y,function(e){return e.identityKey});m.enter().append("g").classed(g.class,!0),m.exit().remove();var v=m.selectAll(d.selector).data(function(e){return e.dataPoints},function(e){return e.renderIdentity.getKey()}),f=jsCommon.BrowserUtils.isInternetExplorerOrEdge();return v.enter().append("path").classed(d.class,!0).classed(u,!f&&a).style("opacity",0).attr({transform:function(e){return h.translate(n(l?e.categoryIndex:e.x)+p,s(e.y))},tabindex:a?0:null,focusable:!!a||null}),v.style({"stroke-opacity":function(e){return c.getMarkerStrokeOpacity(null!=e.size,o.colorBorder,t.hasSelection,e.selected)},stroke:function(e){return c.getStrokeFill(e,o.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return c.getMarkerFillOpacity(null!=e.size,t.fillMarkers,t.hasSelection,e.selected)}}).transition().ease(t.easeType).duration(t.animationDuration).style("opacity",1).attr({d:function(a){return e.visuals.Markers.getPathWithRadius(a.markerShape,r.getBubbleRadius(a.radius,o.sizeRange,t.plotArea,o.multiplier))},transform:function(e){return h.translate(n(l?e.categoryIndex:e.x)+p,s(e.y))}}),v.exit().transition().ease(t.easeType).duration(t.animationDuration).style("opacity",0).attr("r",0).remove(),v},i.prototype.drawScatterMarkersNoAnimation=function(o,n,s){var l,p=o.data,y=o.xAxisProperties.scale,m=o.yAxisProperties.scale,v=p.xGroupMetadata&&p.xGroupMetadata.isCategoricalAxis,f=i.getXOfFirstCategory(o);if(n){var x=[{identityKey:"",dataPoints:p.dataPoints}];l=this.mainGraphicsContext.selectAll(g.selector).data(x,function(e){return e.identityKey})}else l=this.mainGraphicsContext.selectAll(g.selector).data(p.dataPointSeries,function(e){return e.identityKey});return l.enter().append("g").classed(g.class,!0),l.exit().remove(),l.each(function(i){var n=c.getSeriesStyle(i.hasSize,p.colorBorder,o.hasSelection,o.fillMarkers,i.fill),l=d3.select(this);a(this,n);var g=l.selectAll(d.selector).data(i.dataPoints,function(e){return e.renderIdentity.getKey()});g.interrupt(),g.enter().append("path").classed(d.class,!0),g.exit().remove(),g.each(function(e){var i=c.getMarkerStyle(e,p.colorBorder,o.hasSelection,o.fillMarkers);t(i,n),a(this,i)});var x=jsCommon.BrowserUtils.isInternetExplorerOrEdge();g.classed(u,!x&&s).attr({d:function(t){return e.visuals.Markers.getPathWithRadius(t.markerShape,r.getBubbleRadius(t.radius,p.sizeRange,o.plotArea,p.multiplier))},transform:function(e){return h.translate(y(v?e.categoryIndex:e.x)+f,m(e.y))},tabindex:s?0:null,focusable:!!s||null}).style("opacity",null)}),this.mainGraphicsContext.selectAll(d.selector)},i.prototype.drawLine=function(e,t,a,i){var r={};r.stroke=i.lineColor.solid.color,r["stroke-width"]=2,r["stroke-opacity"]=(100-i.transparency)/100,r["stroke-dasharray"]=s.getStrokeDashArrayFromLineStyle(i.style),r["stroke-linecap"]=s.getStrokeLineCapFromLineStyle(i.style),r.fill="none",r["stroke-width"]="3px";var o=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),n=t.selectAll(e.selector).data([a]);return n.enter().append("path").classed(e.class,!0),n.attr("d",function(e){return o(e)}).style(r),n.exit().remove(),t},i.prototype.drawArea=function(e,t,a,i,r){var o=d3.svg.area().x0(function(e){return e[0].x}).y0(function(e){return e[0].y}).x1(function(e){return e[1].x}).y1(function(e){return e[1].y}),n=t.selectAll(e.selector).data([a]);n.enter().append("path").classed(e.class,!0),n.attr("d",function(e){return o(e)}).style({fill:i.solid.color,"fill-opacity":(100-r)/100}),n.exit().remove()},i}(),S=o("traceLine"),b=o("traceBubble"),D=function(){function t(e,t,a,i){this.viewModel=e,
this.element=t,this.tooltipsEnabled=a,this.tooltipService=i}return t.prototype.remove=function(){this.element.selectAll(S.selector).remove(),this.element.selectAll(b.selector).remove()},t.prototype.render=function(t,a){var i=this.viewModel,o=i.data.currentViewModel,n=i.viewModel,s=[];if(_.isEmpty(t)||n.suppressDataPointRendering)this.remove();else{for(var u=i.data.currentFrameIndex,d=[],p=0,g=t.length;p<g;p++){s[p]=[],d[p]=!1;for(var y=0,m=i.data.allViewModels.length;y<m&&y<=u;y++){var v=_.find(i.data.allViewModels[y].dataPoints,function(e,a){var i=t[p],r=i;return r.renderIdentity?e.renderIdentity.getKey()===r.renderIdentity.getKey():e.identity.getKey()===t[p].identity.getKey()});null!=v&&(v.frameIndex=y,s[p].push(v),y===u&&(d[p]=!0))}}var f=n.xAxisProperties.scale,x=n.yAxisProperties.scale,D=d3.svg.line().x(function(e){return f(e.x)}).y(function(e){return x(e.y)}).defined(function(e){return null!==e.x&&null!==e.y}),w=this.element.selectAll(S.selector).data(t,function(e){return e.renderIdentity.getKey()});w.enter().append("path").classed(S.class,!0);var P=[],L=[],A=!1;w.each(function(e,t){var a=this,i=a.hasAttribute("d")?a.getTotalLength():0;P.push(i);var r=$("<svg><path></path></svg>"),o=$("path",r);o.attr("d",D(s[t]));var n=s[t].length>0?o.get()[0].getTotalLength():0;L.push(n),A=A||n<i}),A?a?w.transition().ease("linear").duration(l.FrameAnimationDuration).attr("stroke-dashoffset",function(e,t){return P[t]-L[t]}).transition().ease("linear").duration(1).delay(l.FrameAnimationDuration).style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return D(s[t])},"stroke-dasharray":function(e,t){return L[t]+" "+L[t]},"stroke-dashoffset":0}):w.style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return D(s[t])},"stroke-dasharray":function(e,t){return L[t]+" "+L[t]},"stroke-dashoffset":0}):(w.style("stroke",function(e){return c.getStrokeFill(e,!0)}).attr({d:function(e,t){return D(s[t])},"stroke-dasharray":function(e,t){return L[t]+" "+L[t]},"stroke-dashoffset":function(e,t){return L[t]-P[t]}}),a?w.transition().ease("linear").duration(l.FrameAnimationDuration).attr("stroke-dashoffset",0):w.attr("stroke-dashoffset",0)),w.exit().remove();for(var V=C.getXOfFirstCategory(n),M=n.xAxisProperties.isCategoryAxis,I=(jsCommon.BrowserUtils.isInternetExplorerOrEdge(),[]),k=0;k<s.length;k++){var T=s[k],F=d[k]?T.slice(0,T.length-1):T;I=I.concat(F)}var N=this.element.selectAll(b.selector).data(I,function(e){return e.renderIdentity.getKey()+e.x+e.y+e.size});N.enter().append("path").style("opacity",0).classed(b.class,!0),N.attr({d:function(t){return e.visuals.Markers.getPathWithRadius(t.markerShape,r.getBubbleRadius(t.radius,n.data.sizeRange,n.plotArea,n.data.multiplier))},transform:function(e){return h.translate(f(M?e.categoryIndex:e.x)+V,x(e.y))}}).style({"stroke-opacity":function(e){return c.getBubbleOpacity(e,!0)},stroke:function(e){return c.getStrokeFill(e,o.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return null!=e.size?.2+e.frameIndex/u*.6:0}}).transition().ease("linear").duration(l.FrameAnimationDuration).style("opacity",1),N.exit().transition().ease("linear").duration(l.FrameAnimationDuration).style("opacity",0).remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(N,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity}),N.sort(function(e,t){return t.size-e.size})}},t}();return{create:function(){return new C}}}e.scatterChartRendererModuleFactory=t}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.Color,i=function(){function i(t){t&&(this.tooltipsEnabled=t.tooltipsEnabled,this.interactivityService=t.interactivityService,this.animator=t.animator,this.scatterWithMatrixDV=t.featureSwitches.scatterWithMatrixDV,this.axisInteractivity=t.featureSwitches.axisInteractivity,this.playAxisDataColorsEnabled=t.featureSwitches.playAxisDataColors,this.viewModelAdapter=t.viewModelAdapter,this.isScrollable=t.isScrollable),this.renderer=e.scatterChartRendererModuleFactory().create()}return i.prototype.init=function(e){this.options=e,this.element=e.element,this.currentViewport=e.viewport,this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.hostService=e.host,this.cartesianVisualHost=e.cartesianHost,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.tooltipService=e.services.tooltips;var a=this.svg=e.svg;a.classed(i.ClassName+" "+t.PlayChart.ClassName,!0),this.renderer.init(a,e.labelsContext,this.isMobileChart,this.tooltipsEnabled,this.tooltipService,this.interactivityService,this.hostService),i.DefaultPlotAreaShadingSettings.upperShadingColor={solid:{color:t.ColorHelper.getDataColorByIndex(this.style,3)}},i.DefaultPlotAreaShadingSettings.lowerShadingColor={solid:{color:t.ColorHelper.getDataColorByIndex(this.style,5)}}},i.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},i.createLazyFormattedLazyValue=function(e,t){return new jsCommon.Lazy(function(){return e.format(t())})},i.getMeasureValue=function(e,t){return e>=0?t[e]:null},i.getDefaultData=function(e){return{xCol:void 0,yCol:void 0,hasCategory:void 0,dataPoints:[],dataPointSeries:[],legendData:t.Legend.getDefaultLegendData(e),axesLabels:{x:"",y:""},sizeRange:{min:void 0,max:void 0},dataLabelsSettings:t.LabelUtils.getDefaultPointLabelSettings(e,"smallLightLabel"),hasDynamicSeries:!1,plotAreaShadingSettings:i.DefaultPlotAreaShadingSettings,ratioLineSettings:t.CartesianHelper.getDefaultScatterRatioLineSettings(e),markerShape:t.markerShape.circle,dataVolume:i.DefaultDataVolume,multiplier:t.shapeUtil.MinBubbleMultiplier}},i.prototype.renderAtFrame=function(e){this.data=this.originalData=e,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView)),this.cartesianVisualHost.triggerRender(!1)},i.prototype.setData=function(a){var r=this;if(this.data=i.getDefaultData(this.style),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&this.playAxis.stop(),a.length>0){var o=a[0]||a[1];if(o){this.categoryAxisProperties=t.CartesianHelper.getCategoryAxisProperties(o.metadata,!0),this.valueAxisProperties=t.CartesianHelper.getValueAxisProperties(o.metadata,!0),this.dataView=o;var n={viewport:this.currentViewport,colors:this.colors,interactivityService:this.interactivityService,categoryAxisProperties:this.categoryAxisProperties,valueAxisProperties:this.valueAxisProperties,style:this.style,tooltipsEnabled:this.tooltipsEnabled,useMatrixDV:this.scatterWithMatrixDV,axisInteractivity:this.axisInteractivity},s=e.scatterChartConverterModuleFactory();if(t.PlayChart.isDataViewPlayable(o)){this.playAxis||(this.playAxis=new t.PlayAxis({animator:this.animator,interactivityService:this.interactivityService,isScrollable:!1,featureSwitches:{}}),this.playAxis.init(this.options)),n.useMatrixDV=!1;var l=this.playAxis.setData(o,function(e,t,a){return s.scatterConverter(e,n,t,a)});this.mergeSizeRanges(l),this.data=l.currentViewModel,this.playAxis.setRenderFunction(function(e){return r.renderAtFrame(e)})}else{this.playAxis&&(this.playAxis.remove(),this.playAxis=null);var c=s.scatterConverter(o,n);c&&(this.data=c)}}}else this.playAxis&&(this.playAxis.remove(),this.playAxis=null);this.originalData=this.data},i.prototype.mergeSizeRanges=function(e){if(e&&e.currentViewModel){for(var t=e.currentViewModel.sizeRange,a=0,i=e.allViewModels;a<i.length;a++){var r=i[a],o=r.sizeRange;null!=o.min&&(t.min=Math.min(t.min,o.min)),null!=o.max&&(t.max=Math.max(t.max,o.max))}for(var n=0,s=e.allViewModels;n<s.length;n++){s[n].sizeRange=t}}},i.prototype.calculateCustomLegend=function(){return this.data&&this.data.legendData},i.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},i.prototype.enumerateObjectInstances=function(e,a){var r=this.originalData;switch(a.objectName){case"colorByCategory":r&&(r.hasDynamicSeries||e.pushInstance({objectName:"colorByCategory",selector:null,properties:{show:r.colorByCategory}}));break;case"dataPoint":if(this.playAxisDataColorsEnabled&&this.playAxis&&this.dataView){if(this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix)||!this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRole(this.dataView.categorical))return this.playAxis.enumerateDataPoints(e,this.data,this.dataView,this.style)}else if(!this.playAxis&&this.dataView&&(this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix)||!this.scatterWithMatrixDV&&!t.GradientUtils.hasGradientRole(this.dataView.categorical)))return this.enumerateDataPoints(e);break;case"categoryAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle},objectName:"categoryAxis"}),r.xGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!r.treatNullsAsZero||!r.treatNullsAsZero.x)},objectName:"categoryAxis"});break;case"valueAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle},objectName:"valueAxis"}),r.yGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!r.treatNullsAsZero||!r.treatNullsAsZero.y)},objectName:"valueAxis"});break;case"categoryLabels":if(this.data&&this.data.xGroupMetadata&&this.data.xGroupMetadata.isCategoricalAxis)return;this.data?t.LabelUtils.enumerateCategoryLabels(e,r.dataLabelsSettings,!0,void 0,void 0,this.style):t.LabelUtils.enumerateCategoryLabels(e,null,!0,void 0,void 0,this.style);break;case"fillPoint":if(r.hasSize)return;e.pushInstance({objectName:"fillPoint",selector:null,properties:{show:r.fillPoint}});break;case"colorBorder":r.hasSize&&e.pushInstance({objectName:"colorBorder",selector:null,properties:{show:r.colorBorder}});break;case"bubbles":i.enumerateBubbles(e,r,this.dataView);break;case"plotAreaShading":this.isCategoryAxisCategorical()||e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{show:r.plotAreaShadingSettings.show,upperShadingColor:r.plotAreaShadingSettings.upperShadingColor,lowerShadingColor:r.plotAreaShadingSettings.lowerShadingColor,transparency:r.plotAreaShadingSettings.transparency}});break;case"ratioLine":r.xCol&&r.yCol&&r.xCol.isMeasure&&r.yCol.isMeasure&&e.pushInstance({selector:null,objectName:"ratioLine",properties:{show:r.ratioLineSettings.show,lineColor:r.ratioLineSettings.lineColor,transparency:r.ratioLineSettings.transparency,style:r.ratioLineSettings.style}});break;case"general":!r||this.playAxis||this.isCategoryAxisCategorical()||e.pushInstance({selector:null,objectName:"general",properties:{dataVolume:r.dataVolume},validValues:{dataVolume:{numberRange:{min:i.DefaultDataVolume,max:i.MaximumDataVolume}}}})}},i.prototype.enumerateDataPoints=function(a){var i=this.originalData;i&&(i.hasDynamicSeries?e.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:a,dataPoints:t.LegendData.toIEnumerableDataPoints(i.legendData)}):e.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:a,dataView:this.dataView,style:this.style,dataPoints:_.map(i.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3}))},i.enumerateBubbles=function(a,i,r){var o;i.dataPointSeries.length>1&&(o=e.DataViewObjects.getValue(r&&r.metadata&&r.metadata.objects,t.scatterChartProps.bubbles.showSeries,!1));var n={selector:null,properties:{bubbleSize:t.shapeUtil.invertBubbleSizeMultiplier(i.multiplier),markerShape:i.markerShape},validValues:{bubbleSize:{numberRange:{min:-30,max:100}},markerShape:[t.markerShape.circle,t.markerShape.square,t.markerShape.diamond,t.markerShape.triangle]},objectName:t.scatterChartProps.bubbles.markerShape.objectName};if(null!=o&&(n.properties[t.scatterChartProps.bubbles.showSeries.propertyName]=o),a.pushInstance(n),o)for(var s=0,l=i.dataPointSeries.length;s<l;s++){var c=i.dataPointSeries[s];a.pushContainer({displayName:c.name}),a.pushInstance({selector:e.data.Selector.normalizeSelector(c.identity.getSelector()),properties:{markerShape:c.markerShape},validValues:{markerShape:[t.markerShape.circle,t.markerShape.square,t.markerShape.diamond,t.markerShape.triangle]},objectName:t.scatterChartProps.bubbles.markerShape.objectName}),a.popContainer()}},i.prototype.supportsTrendLine=function(){var t=this.data;if(!t||this.isCategoryAxisCategorical()||this.playAxis)return!1;var a=this.dataView;if(this.scatterWithMatrixDV)return!t.hasSize&&(t.hasCategory||t.hasDynamicSeries)&&!!t.xCol&&!!t.yCol;var i=e.data.createDataViewCategoricalReader(a);return!t.hasSize&&(t.hasCategory||t.hasDynamicSeries)&&i.data.hasValues("X")&&i.data.hasValues("Y")},i.prototype.supportsStaticReferenceLines=function(){return this.data&&!this.isCategoryAxisCategorical()},i.prototype.getAxisLocationForRole=function(e){return"X"===e?0:1},i.getExtents=function(e){var t={},a=e.dataPoints;if(_.isEmpty(a))return{minY:0,maxY:0,minX:0,maxX:0};var i=!!e.xGroupMetadata,r=i&&e.xGroupMetadata.isCategoricalAxis;return r||(t.minX=d3.min(a,function(e){return e.x}),t.maxX=d3.max(a,function(e){return e.x})),i&&!r&&(a=_.filter(a,function(e){return null!=e.x})),t.minY=d3.min(a,function(e){return e.y}),t.maxY=d3.max(a,function(e){return e.y}),t},i.prototype.calculateAxesProperties=function(e){var a=this.currentViewport=e.viewport;this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView));var r=this.data,o=e.margin;this.currentViewport=a,this.margin=o;var n=a.width-(o.left+o.right),s=a.height-(o.top+o.bottom),l={minY:0,maxY:10,minX:0,maxX:10};this.playAxis?(l=this.playAxis.getCartesianExtents(l,i.getExtents),this.playAxis.setPlayControlPosition(e.playAxisControlLayout)):_.isEmpty(r.dataPoints)||(l=i.getExtents(r));var c,u=this.isCategoryAxisCategorical();c=u?_.uniq(_.map(r.dataPoints,function(e){return e.categoryIndex})):t.AxisHelper.combineDomain(e.forcedXDomain,[l.minX,l.maxX],e.ensureXDomain);var h={pixelSpan:n,dataDomain:c,zeroScalarDomain:[-1,1],metaDataColumn:r.xCol,formatString:t.valueFormatter.getFormatString(r.xCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!u,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:u,scaleType:e.categoryAxisScaleType,axisDisplayUnits:e.categoryAxisDisplayUnits,axisPrecision:e.categoryAxisPrecision,margin:o,preventNice:e.preventNiceX};if(u){var d=this.getCategoryLayout(c,e);h.outerPadding=d.outerPaddingRatio,h.categoryThickness=d.categoryThickness,h.innerPaddingRatio=d.innerPaddingRatio,h.outerPaddingRatio=d.outerPaddingRatio,h.getValueFn=function(e,t){return _.find(r.dataPoints,function(t){return t.categoryIndex===e}).formattedCategory.getValue()}}this.xAxisProperties=t.AxisHelper.createAxis(h),this.xAxisProperties.axis.tickSize(-s,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x,this.axisInteractivity&&u&&(this.xAxisProperties.categoryIdentities=r.categoryIdentities);var p=t.AxisHelper.combineDomain(e.forcedYDomain,[l.minY,l.maxY],e.ensureYDomain);return this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:s,dataDomain:p,zeroScalarDomain:[-1,1],metaDataColumn:r.yCol,formatString:t.valueFormatter.getFormatString(r.yCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:e.valueAxisScaleType,axisDisplayUnits:e.valueAxisDisplayUnits,axisPrecision:e.valueAxisPrecision,margin:o,preventNice:e.preventNiceY}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},i.prototype.getCategoryLayout=function(e,a){var i=this.data,r=this.currentViewport.width-(this.margin.left+this.margin.right),o=_.size(_.uniqBy(i.dataPoints,function(e){return e.categoryIndex})),n=t.CartesianHelper.getCategoryAxisProperties(this.dataView.metadata),s=t.CartesianHelper.getPreferredCategoryWidth(n),l=this.isCategoryAxisCategorical();return t.CartesianChart.getLayout(void 0,{availableWidth:r,categoryCount:o,preferredCategoryWidth:s,domain:e,isScalar:!l,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio})},i.prototype.getPreferredPlotArea=function(e,a,i,r){return void 0===r&&(r=0),t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},i.prototype.setFilteredData=function(t,a){if(this.isCategoryAxisCategorical()){var i=this.data=e.Prototype.inherit(this.originalData);i.dataPoints=_.filter(i.dataPoints,function(e){return e.categoryIndex>=t&&e.categoryIndex<a}),i.dataPointSeries=_.map(i.dataPointSeries,function(i){var r=e.Prototype.inherit(i),o=_.filter(i.dataPoints,function(e){return e.categoryIndex>=t&&e.categoryIndex<a});return r.dataPoints=o,r})}},i.prototype.overrideXScale=function(e){this.xAxisProperties=e},i.prototype.shouldSuppressAnimation=function(){return this.data&&this.data.dataPoints&&this.data.dataPoints.length>i.NoAnimationThreshold},i.prototype.categoryAxisTitleOnByDefault=function(){return!0},i.prototype.valueAxisTitleOnByDefault=function(){return!0},i.prototype.render=function(a,o){if(this.data){var n=this.data,s=this.margin,l=this.currentViewport,c=this.interactivityService&&this.interactivityService.hasSelection(),u={width:l.width-(s.left+s.right),height:l.height-(s.top+s.bottom)},h=t.AnimatorCommon.GetAnimationDuration(this.animator,a);this.playAxis&&this.playAxis.isCurrentlyPlaying()&&(this.isMobileChart||h>0)&&(h=t.PlayChart.FrameAnimationDuration);var d=this.playAxis?"linear":"cubic-in-out",p=this.data.hasSize,g=!p&&n.fillPoint,y=1===o&&n.dataPoints&&n.dataPoints.length>i.NoRenderResizeThreshold,m={data:n,allData:this.originalData,drawBubbles:p,isPlay:!!this.playAxis,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,plotArea:u,hasSelection:c,animationDuration:h,animationOptions:this.options.animation,fillMarkers:g,easeType:d,suppressDataPointRendering:y};if(p&&(!n.xGroupMetadata||!n.xGroupMetadata.isCategoricalAxis)){var v=n.dataPoints.sort(i.sortBubbles);m.data=e.Prototype.inherit(m.data),m.data.dataPoints=v}var f=[];(n.dataLabelsSettings&&n.dataLabelsSettings.show||n.dataLabelsSettings.showCategory)&&(f=r.createLabelDataPoints(m,this.style));var x=this.renderer.render(m,this.interactivityService,this.hostService,this.style);this.isMobileChart&&(x={data:x.data,dataPointsSelection:x.dataPointsSelection,eventGroup:x.eventGroup,root:x.root,host:this.cartesianVisualHost,mobileRoot:this.svg,visualInitOptions:this.options,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,background:d3.select(this.element.get(0)),visualInstanceId:x.visualInstanceId});var C;if(this.playAxis&&(C=this.playAxis.render(a,m,l,s),this.interactivityService)){var S={traceLineRenderer:this.renderer.createTraceLineRenderer(C.viewModel)};c&&t.PlayChart.renderTraceLines(C.allDataPoints,S.traceLineRenderer,!a),x.playOptions=S}var b;if(!this.playAxis&&this.interactivityService){var D=t.DataPointNavigationStrategy.SeriesFirst;n.xGroupMetadata&&n.xGroupMetadata.isCategoricalAxis?D=t.DataPointNavigationStrategy.CategoryFirst:this.data.hasDynamicSeries||(D=t.DataPointNavigationStrategy.CategoryOnly),b={navigationStrategy:D,helper:this.renderer}}return{dataPoints:C?C.allDataPoints:n.dataPoints,behaviorOptions:x,navigationOptions:b,labelDataPoints:f,labelsAreNumeric:!1,animateLabels:!0}}},i.getStrokeFill=function(e,t){if(null!=e.size&&t){var r=a.parseColorString(e.fill);return r?a.hexString(a.darken(r,i.StrokeDarkenColorValue)):e.fill}return e.fill},i.getMarkerFillOpacity=function(e,t,a,r){return e||t?a&&!r?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity:0},i.getMarkerStrokeOpacity=function(e,t,a,r){return e&&t?1:a&&!r?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity},i.getMarkerStrokeFill=function(e,t,r){if(e&&t){var o=a.parseColorString(r);return o?a.hexString(a.darken(o,i.StrokeDarkenColorValue)):r}return r},i.getMarkerStyle=function(e,t,a,r){return{"stroke-opacity":i.getMarkerStrokeOpacity(null!=e.size,t,a,e.selected),stroke:i.getMarkerStrokeFill(null!=e.size,t,e.fill),fill:e.fill,"fill-opacity":i.getMarkerFillOpacity(null!=e.size,r,a,e.selected)}},i.getSeriesStyle=function(e,t,a,r,o){return{"stroke-opacity":i.getMarkerStrokeOpacity(e,t,a,!1),stroke:null,fill:o,"fill-opacity":i.getMarkerFillOpacity(e,r,a,!1)}},i.getBubbleOpacity=function(e,t){return t&&!e.selected?i.DimmedBubbleOpacity:i.DefaultBubbleOpacity},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.getSupportedCategoryAxisType=function(){return this.data.xGroupMetadata?this.data.xGroupMetadata.isScalarType?t.axisType.both:t.axisType.categorical:t.axisType.scalar},i.prototype.getVisualCategoryAxisIsScalar=function(){return!this.isCategoryAxisCategorical()},i.sortBubbles=function(e,t){if(e.radius.sizeMeasure){var a=t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index];if(0!==a)return a}else if(null!=e.radius.value)return t.radius.value-e.radius.value;return t.identity.getKey().localeCompare(e.identity.getKey())},i.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},i.prototype.getStaticSeriesRole=function(){},i.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},i.prototype.isCategoryAxisCategorical=function(){return this.data.xGroupMetadata&&this.data.xGroupMetadata.isCategoricalAxis},i.DefaultBubbleOpacity=.85,i.DimmedBubbleOpacity=.4,i.StrokeDarkenColorValue=63.75,i.ClassName="scatterChart",i.NoAnimationThreshold=1e3,i.NoRenderResizeThreshold=1e3,i.DefaultDataVolume=3500,i.MaximumDataVolume=1e4,i.DefaultPlotAreaShadingSettings={show:!1,upperShadingColor:null,lowerShadingColor:null,transparency:70},i}();t.ScatterChart=i;var r;!function(a){function i(a,i){for(var o=a.xAxisProperties.scale,n=a.yAxisProperties.scale,s=a.data.sizeRange,l=a.data.multiplier,h=[],d=a.data.dataPoints,p=a.data.dataLabelsSettings,g=r(a),y=0,m=d;y<m.length;y++){var v=m[y],f=v.formattedCategory.getValue(),x=p.fontProperties,C=t.FontProperties.toTextProperties(x,f),S=e.TextMeasurementService.measureSvgTextWidth(C),b=e.TextMeasurementService.estimateSvgTextHeight(C);h.push({isPreferred:!!g&&c(v.identity.getKey(),g),text:f,textSize:{width:S,height:b},outsideFill:x.color?x.color:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultLabelColorName),insideFill:t.ColorHelper.getThemeColor(i,t.LabelUtils.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:o(v.x),y:n(v.y)},radius:t.CartesianHelper.getBubbleRadius(v.radius,s,a.plotArea,l),validPositions:u},identity:v.renderIdentity,fontProperties:x,hasBackground:p.enableBackground,backgroundColor:p.backgroundColor,backgroundTransparency:p.backgroundTransparency})}return h}function r(e){var a=e.plotArea.width,i=e.plotArea.height;return n(new t.Point(a/2,i/2),o(a,i),e)}function o(e,a){var i=[],r=e/4,o=a/4;return i.push(new t.Point(r,o)),i.push(new t.Point(3*r,o)),i.push(new t.Point(r,3*o)),i.push(new t.Point(3*r,3*o)),i}function n(e,t,a){for(var i,r=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[],n=a.xAxisProperties.scale,c=a.yAxisProperties.scale,u=0,h=a.data.dataPoints;u<h.length;u++){var d=h[u],p=n(d.x),g=c(d.y),y=s(p,g,e);a.drawBubbles?o[y]||(o[y]=d.identity):(i=l(t[y].x,t[y].y,p,g),i<r[y]&&(o[y]=d.identity,r[y]=i))}for(var m=[],v=0,f=o;v<f.length;v++){var x=f[v];x&&m.push(x.getKey())}return m}function s(e,t,a){return e>a.x&&t<=a.y?0:e<=a.x&&t<=a.y?1:e<=a.x&&t>a.y?2:3}function l(e,t,a,i){return Math.sqrt((e-a)*(e-a)+(t-i)*(t-i))}function c(e,t){for(var a=0,i=t;a<i.length;a++){var r=i[a];if(0===e.localeCompare(r))return!0}return!1}var u=[2,1,8,4,16,32,64,128];a.createLabelDataPoints=i}(r||(r={}));var o=function(){function t(e){this.dataPoints=e}return t.prototype.queryRegion=function(t){return _.filter(this.dataPoints,function(a){return e.Double.lessOrEqualWithPrecision(t.left,a.x)&&e.Double.lessOrEqualWithPrecision(a.x,t.right)&&e.Double.lessOrEqualWithPrecision(t.bottom,a.y)&&e.Double.lessOrEqualWithPrecision(a.y,t.top)})},t}();t.ScatterChartHitTester=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=jsCommon.CssConstants.createClassAndSelector,i=jsCommon.PerfTimer,r=function(){function a(){}return a.prototype.bindEvents=function(t,a,i){var r=this.bubbles=t.dataPointsSelection,o=t.data,n=t.eventGroup;!this.playOptions||!this.playOptions.traceLineRenderer||t.playOptions&&t.playOptions.traceLineRenderer||this.playOptions.traceLineRenderer.remove(),this.playOptions=t.playOptions,this.shouldEnableFill=!o.size&&o.fillPoint,this.colorBorder=o.colorBorder,this.hitTester=new e.ScatterChartHitTester(t.data.dataPoints);var s=this.rootSelection=t.root,l=this.visualInstanceId=t.visualInstanceId;e.InteractivityUtils.appendUseElementForFocus(s,l),this.selectionHandler=a,n?e.InteractivityUtils.registerGroupInteractivityHandlers(n,a):e.InteractivityUtils.registerStandardInteractivityHandlers(r,a),i&&!i.isEmpty()&&(e.InteractivityUtils.registerEnterPlotAreaHandler(s,i),e.InteractivityUtils.registerDataPointNavigationHandler(s,i),e.InteractivityUtils.registerClearCatcherShortcut(s,a))},a.prototype.renderSelection=function(t){var a=this.shouldEnableFill,i=this.colorBorder;if(this.bubbles.style({"fill-opacity":function(i){return e.ScatterChart.getMarkerFillOpacity(null!=i.size,a,t,i.selected)},"stroke-opacity":function(a){return e.ScatterChart.getMarkerStrokeOpacity(null!=a.size,i,t,a.selected)}}),this.playOptions&&this.bubbles){var r=this.bubbles.filter(function(e){return e.selected}).data(),o=this.playOptions.traceLineRenderer;r&&r.length>0&&null!=o?o.render(r,!0):o.remove()}},a.prototype.renderFocus=function(a){var i=e.CurrentFocusDataPointId+"-"+this.visualInstanceId;if(this.rootSelection.select("#"+i).attr("id",null),a){this.bubbles.attr("aria-label",null);var r=d3.select(a).datum();r&&a.setAttribute("aria-label",e.tooltipUtils.formatTooltipInfo(r.tooltipInfo())),a.setAttribute("id",i),t.focus(a)}},a.prototype.lassoSelect=function(e,t){var a=this.hitTester.queryRegion(t),i=0;e.ctrlKey?i=1:e.altKey?i=3:e.shiftKey&&(i=2),this.selectionHandler.handleMultipleSelection(a,i)},a}();e.ScatterChartWebBehavior=r;var o=function(){function t(){}return t.prototype.bindEvents=function(e,t){this.setOptions(e),e.visualInitOptions&&e.visualInitOptions.interactivity.isInteractiveLegend&&(this.makeDataPointsSelectable(e.dataPointsSelection),this.makeRootSelectable(e.mobileRoot),this.makeDragable(e.mobileRoot),this.disableDefaultTouchInteractions(e.mobileRoot),this.selectRoot())},t.prototype.renderSelection=function(e){},t.prototype.setSelectionHandler=function(e){},t.prototype.makeDataPointsSelectable=function(){for(var e=this,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];for(var i=0,r=t.length;i<r;i++){t[i].on("click",function(t,a){e.select(a)})}},t.prototype.makeRootSelectable=function(e){var t=this;e.on("click",function(e,a){t.selectRoot()})},t.prototype.makeDragable=function(){for(var e=this,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];for(var i=0,r=t.length;i<r;i++){var o=t[i],n=d3.behavior.drag().on("drag",function(t){e.drag(0)}).on("dragend",function(t){e.drag(1)});o.call(n)}},t.prototype.disableDefaultTouchInteractions=function(e){e.style("touch-action","none")},t.prototype.setOptions=function(e){this.data=e.data,this.mainGraphicsContext=e.root,this.xAxisProperties=e.xAxisProperties,this.yAxisProperties=e.yAxisProperties,this.host=e.host},t.prototype.select=function(e){this.selectDotByIndex(e)},t.prototype.selectRoot=function(){var e=i.start("selectRoot");this.onClick(),e()},t.prototype.drag=function(e){switch(e){case 0:this.onDrag();break;case 1:this.onClick()}},t.prototype.onDrag=function(){var e=this.getMouseCoordinates();this.moveCrosshairToXY(e.x,e.y);var t=this.findClosestDotIndex(e.x,e.y);this.selectDot(t),this.updateLegend(t)},t.prototype.onClick=function(){var e=this.getMouseCoordinates(),t=this.findClosestDotIndex(e.x,e.y);t!==-1&&this.selectDotByIndex(t)},t.prototype.getMouseCoordinates=function(){var e=this.mainGraphicsContext,t=0,a=parseInt(e.attr("height"),10);a=a||0;try{var i=d3.mouse(e.node());t=i[0],a=i[1]}catch(e){}return{x:t,y:a}},t.prototype.selectDotByIndex=function(e){this.selectDot(e),this.moveCrosshairToIndexDot(e),this.updateLegend(e)},t.prototype.selectDot=function(e){var a=this,i=this.mainGraphicsContext;i.selectAll(t.ScatterMarker.selector).classed({selected:!1,notSelected:!0}),i.selectAll(t.ScatterMarker.selector).filter(function(t,i){var r=a.data.dataPoints,o=r[e];return t.x===o.x&&t.y===o.y}).classed({selected:!0,notSelected:!1})},t.prototype.moveCrosshairToIndexDot=function(e){var a=this.data.dataPoints,i=this.mainGraphicsContext,r=this.xAxisProperties.scale(a[e].x),o=this.yAxisProperties.scale(a[e].y);if(null==this.crosshair){var n=+i.attr("width"),s=+i.attr("height");this.crosshair=this.drawCrosshair(i,r,o,n,s),this.crosshairHorizontal=this.crosshair.select(t.Horizontal.selector),this.crosshairVertical=this.crosshair.select(t.Vertical.selector)}else this.moveCrosshairToXY(r,o)},t.prototype.moveCrosshairToXY=function(e,t){this.crosshairHorizontal.attr({y1:t,y2:t}),this.crosshairVertical.attr({x1:e,x2:e})},t.prototype.drawCrosshair=function(e,a,i,r,o){var n=e.append("g");return n.classed(t.CrosshairClassName,!0),n.append("line").classed(t.Horizontal.class,!0).attr({x1:0,x2:r,y1:i,y2:i}),n.append("line").classed(t.Vertical.class,!0).attr({x1:a,x2:a,y1:o,y2:0}),n},t.prototype.findClosestDotIndex=function(e,t){var a=-1,i=Number.MAX_VALUE,r=this.data.dataPoints,o=this.xAxisProperties.scale,n=this.yAxisProperties.scale;for(var s in r){var l=r[s],c=o(l.x),u=n(l.y),h=c-e,d=u-t,p=h*h+d*d;i===Number.MAX_VALUE?(a=s,i=p):i&&i>p&&(a=s,i=p)}return a},t.prototype.updateLegend=function(e){if(null==this.lastDotIndex||this.lastDotIndex!==e){var t=this.createLegendDataPoints(e);this.host.updateLegend(t),this.lastDotIndex=e}},t.prototype.createLegendDataPoints=function(t){var a=e.scatterChartProps.general.formatString,i=[],r=this.data,o=r.dataPoints[t],n=e.valueFormatter.format(null),s=n,l=r.legendData,c=l.dataPoints,u=o.formattedCategory.getValue();u!==n?(s=u,null!=o&&null!=o.radius&&null!=o.radius.sizeMeasure&&(s+="; "+e.valueFormatter.format(o.radius.sizeMeasure.source.groupName))):null!=o.radius.sizeMeasure?s=e.valueFormatter.format(o.radius.sizeMeasure.source.groupName):c.length>0&&c.length>=t&&c[t].label!==n&&(s=c[t].label),null!=r.xCol&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.xCol.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(this.data.axesLabels.x),measure:e.valueFormatter.format(o.x,e.valueFormatter.getFormatString(r.xCol,a)),iconOnlyOnLabel:!0,index:0}),null!=r.yCol&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.yCol.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(r.axesLabels.y),measure:e.valueFormatter.format(o.y,e.valueFormatter.getFormatString(r.yCol,a)),iconOnlyOnLabel:!0,index:1}),null!=r.size&&i.push({category:s,color:o.fill,identity:e.SelectionIdBuilder.builder().withMeasure(r.size.queryName).createSelectionId(),selected:o.selected,icon:e.LegendIcon.Box,label:e.valueFormatter.format(r.size.displayName),measure:e.valueFormatter.format(o.radius.sizeMeasure&&o.radius.sizeMeasure.values[o.radius.index]||o.radius.value,e.valueFormatter.getFormatString(r.size,a)),iconOnlyOnLabel:!0,index:2});var h=e.Legend.getDefaultLegendData();return h.dataPoints=i,
h},t.CrosshairClassName="crosshair",t.ScatterMarker=a("scatterMarker"),t.Horizontal=a("horizontal"),t.Vertical=a("vertical"),t}();e.ScatterChartMobileBehavior=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var a=jsCommon.CssConstants.createClassAndSelector,i=t.labelPosition,r=jsCommon.Lazy,o=jsCommon.StringExtensions,n=function(){function n(e){this.isScrollable=e.isScrollable,this.tooltipsEnabled=null==e.tooltipsEnabled||e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.waterfallBreakdown=e.featureSwitches.waterfallBreakdown,this.axisInteractivity=e.featureSwitches.axisInteractivity,this.viewModelAdapter=e.viewModelAdapter}return n.prototype.init=function(e){if(this.svg=e.svg,this.svg.classed(n.WaterfallClassName,!0),this.style=e.style,this.currentViewport=e.viewport,this.hostServices=e.host,this.interactivity=e.interactivity,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.element=e.element,this.tooltipService=e.services.tooltips,this.colors=this.style.colorPalette.dataColors,this.mainGraphicsSVG=this.svg.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVG.append("g").classed(n.MainGraphicsContextClassName,!0),this.labelGraphicsContext=this.mainGraphicsSVG.append("g").classed(t.LabelUtils.labelGraphicsContextClass.class,!0),this.interactivityService){var a=jsCommon.BrowserUtils.isInternetExplorerOrEdge();this.mainGraphicsContext.attr({tabindex:0,focusable:!0,"aria-label":this.hostServices.getLocalizedString("Visual_Plot")}).classed(t.SetFocusRingClassName,!a)}},n.converter=function(t){var a=t.dataView;if(a)return a.categorical?n.categoricalConverter(t):a.matrix?e.waterfallConverterModuleFactory().matrixConverter(t):void 0},n.categoricalConverter=function(a){var i,r,o=a.dataView,s=a.hostServices,l=a.dataLabelSettings,c=a.sentimentColors,u=a.interactivityService,h=a.tooltipsEnabled,d=e.data.createDataViewCategoricalReaderAdvanced(o),p=d.data,g=n.formatStringProp,y=o.categorical.categories||[],m=s.getLocalizedString(n.TotalLabel),v=n.createLegend(c,s,d.objects.getStaticObjects(),a.style),f={current:0,min:0,max:0},x=[],C=[],S=[],b=[];if(p.hasValues("Tooltips")&&(r=d.columns.getAllValueMetadataColumnsForRole("Tooltips",void 0)),p.hasValues("Y")){b=[d.columns.getValueMetadataColumn("Y")];var D=b[0].format;if(_.isEmpty(y)){var w=p.getValue("Y",0);f={current:w,max:w,min:0}}else{var P=y[0];i=P.source,C=P.values.slice(),C.push(m);for(var L=function(e,o){var u=C[e],d=p.getValue("Y",e)||0,y=t.SelectionIdBuilder.builder().withCategory(P,e).withMeasure(b[0].queryName).createSelectionId(),m=void 0;if(h){m=n.createCategoryTooltip(i?[i]:null,b[0],[u],d,g);var v=p.getAllValuesForRole("Tooltips",e);v&&r&&n.appendTooltipMeasures(v,m,r,g,s)}x.push(n.createDataPoint(d,f.current,c,u,e,y,m,l.fontProperties.color,D,0)),a.axisInteractivity&&(S[e]=function(){return t.CartesianHelper.getCategoryIdentity(e,P,b[0].queryName)}),f=n.getNewPositionContext(f,d)},A=0,V=p.getCategoryCount();A<V;A++)L(A,V)}var M=void 0;h&&(M=n.createCategoryTooltip(i?[i]:null,b[0],[m],f.current,g));var I=t.SelectionId.createNull();x.push(n.createDataPoint(f.current,0,c,m,p.getCategoryCount(),I,M,l.fontProperties.color,D,1,{text:!0}))}u&&u.applySelectionStateToData(x);var k;a.style.isHighContrast&&(k={visible:!0,color:t.ColorHelper.getThemeColor(a.style,t.ForegroundColorName),width:t.CartesianHelper.defaultLineStrokeWidth});var T=t.CartesianHelper.getCategoryAxisProperties(o.metadata,void 0),F=t.CartesianHelper.getPreferredCategoryWidth(T);return{series:[{data:x,type:!_.isEmpty(b)&&b[0].type}],categories:C,categoryIdentities:S,categoryMetadata:i,preferredCategoryWidth:F,valuesMetadata:b,legend:v,hasHighlights:!1,positionMin:f.min,positionMax:f.max,dataLabelsSettings:l,sentimentColors:c,strokeSettings:k}},n.createDataPoint=function(t,a,i,r,o,n,s,l,c,u,h){var d;return d=1===u||2===u?i.totalFill:3===u?i.otherFill:t>0?i.increaseFill:i.decreaseFill,{value:t,position:a,color:d.solid.color,categoryValue:r,categoryIndex:o,identity:n,seriesIndex:0,selected:!1,highlight:!1,key:n.getKey(),tooltipInfo:s&&function(){return s.getTooltipItems()},labelFill:l,labelFormatString:c,type:e.ValueType.fromDescriptor(h),barType:u}},n.createCategoryTooltip=function(e,a,i,o,n){var s=new t.LazyTooltipBuilder;return _.isEmpty(e)||s.withLazyValue(new r(function(){return{displayName:_.map(e,function(e){return e.displayName}).join(" "),value:_.map(i,function(a,i){return t.converterHelper.formatFromMetadataColumn(a,e[i],n)}).join(" ")}})),null!=o&&a&&s.withLazyValue(new r(function(){return{displayName:a.displayName,value:t.converterHelper.formatFromMetadataColumn(o,a,n,!1)}})),s},n.appendTooltipMeasures=function(e,a,i,s,l,c,u,h){if(!_.isEmpty(e)&&!_.isEmpty(i))for(var d=function(d){if(null!=e[d]&&i[d]){var p=i[d].displayName,g=t.converterHelper.formatFromMetadataColumn(e[d],i[d],s,!1);if(_.isEmpty(c))a.withLazyValue(new r(function(){return{displayName:p,value:g}}));else{var y=e[d],m=c[d];if(_.isNumber(y)&&_.isNumber(m))p=o.format(l.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),p),g=n.createPercentTooltipValue(g,y,m),a.withLazyValue(new r(function(){return{displayName:p,value:g}}));else{if(null!=m){var v=t.converterHelper.formatFromMetadataColumn(m,i[d],s,!1);a.withLazyValue(new r(function(){return{displayName:h+" "+p,value:v}}))}null!=y&&a.withLazyValue(new r(function(){return{displayName:u+" "+p,value:g}}))}}}},p=0;p<e.length;p++)d(p)},n.createPercentTooltipValue=function(e,a,i){if(!i)return e;var r=a/Math.abs(i),o=t.valueFormatter.getLocalizedString("Percentage");return e+" ("+t.valueFormatter.format(r,o)+")"},n.createLegend=function(e,a,i,r,o){var s=e.increaseFill.solid.color,l=e.decreaseFill.solid.color,c=e.totalFill.solid.color,u=e.otherFill.solid.color,h=a.getLocalizedString(n.TotalLabel),d=a.getLocalizedString(n.IncreaseLabel),p=a.getLocalizedString(n.DecreaseLabel),g=a.getLocalizedString(n.OtherLabel),y=[{label:d,color:s,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("increase").createSelectionId(),selected:!1,index:0},{label:p,color:l,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("decrease").createSelectionId(),selected:!1,index:1},{label:h,color:c,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("total").createSelectionId(),selected:!1,index:2}];return o&&y.splice(2,0,{label:g,color:u,icon:t.LegendIcon.Box,identity:t.SelectionIdBuilder.builder().withMeasure("other").createSelectionId(),selected:!1,index:3}),t.LegendData.create(i,y,!0,"",!1,r)},n.getNewPositionContext=function(e,t){var a=e.current+t;return{current:a,min:Math.min(e.min,a),max:Math.max(e.max,a)}},n.getDefaultWaterfallLabelSettings=function(e,a,i,r){void 0===a&&(a=!1);var o=t.LabelUtils.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",labelColor:i,fontSize:r}).fontProperties;return{show:a,labelOrientation:1,position:t.labelPosition.auto,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,fontProperties:o,enableBackground:!1}},n.doesDataLabelFitInShape=function(a,i,r){if(null==a||null===a.value)return!1;var o={text:r.labelText(a),fontFamily:t.dataLabelUtils.LabelTextProperties.fontFamily,fontSize:t.dataLabelUtils.LabelTextProperties.fontSize,fontWeight:t.dataLabelUtils.LabelTextProperties.fontWeight};if(t.CartesianHelper.getRectTop(i.scale,a.position,a.value)-t.dataLabelUtils.labelMargin>0)return!0;var n=e.TextMeasurementService.measureSvgTextWidth(o),s=e.TextMeasurementService.estimateSvgTextHeight(o),l=r.categoryWidth,c=Math.abs(t.AxisHelper.diffScaled(i.scale,Math.max(0,Math.abs(a.value)),0));return!(n>l||s>c)},n.prototype.setData=function(a){var i=this.getSentimentColorsFromObjects(null),r=n.DefaultBreakdowns,o=a.length>0?a[0]:void 0;if(this.data=this.originalData={series:[{data:[]}],categories:[],valuesMetadata:[],legend:t.Legend.getDefaultLegendData(this.style),hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,positionMax:0,positionMin:0,dataLabelsSettings:n.getDefaultWaterfallLabelSettings(this.style,!1,void 0),sentimentColors:i,axesLabels:{x:null,y:null},numberOfBreakdowns:r,totalBreakdownCategories:0},o){if(this.dataView=o,o.metadata&&o.metadata.objects){var s=o.metadata.objects,l=s.labels;l&&t.LabelUtils.updateLabelSettingsFromLabelsObject(l,this.data.dataLabelsSettings,!0,this.style),i=this.getSentimentColorsFromObjects(s),r=e.DataViewObjects.getValue(s,t.waterfallChartProps.breakdown.maxBreakdowns,n.DefaultBreakdowns)}(o.categorical||o.matrix)&&(this.data=this.originalData=n.converter({dataView:o,style:this.style,hostServices:this.hostServices,dataLabelSettings:this.data.dataLabelsSettings,sentimentColors:i,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,numberOfBreakdowns:r,axisInteractivity:this.axisInteractivity}))}},n.prototype.enumerateObjectInstances=function(e,a){var i=this.originalData;switch(a.objectName){case"sentimentColors":this.enumerateSentimentColors(e);break;case"labels":var r=this.data.dataLabelsSettings,o={enumeration:e,dataLabelsSettings:i.dataLabelsSettings,positionObject:n.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:r.enableBackground,backgroundColor:r.backgroundColor,backgroundTransparency:r.backgroundTransparency,style:this.style};t.LabelUtils.enumerateDataLabels(o);break;case t.waterfallChartProps.breakdown.maxBreakdowns.objectName:this.enumerateBreakdown(e)}},n.prototype.enumerateSentimentColors=function(e){var t=this.originalData,a=t.sentimentColors,i={increaseFill:a.increaseFill,decreaseFill:a.decreaseFill};t.isBreakdown&&(i.otherFill=a.otherFill),i.totalFill=a.totalFill,e.pushInstance({selector:null,properties:i,objectName:"sentimentColors"})},n.prototype.enumerateBreakdown=function(e){var a=this.originalData;a.isBreakdown&&e.pushInstance({selector:null,properties:{maxBreakdowns:a.numberOfBreakdowns},validValues:{maxBreakdowns:{numberRange:{min:n.MinimumBreakdowns,max:Math.min(n.MaximumBreakdowns,a.totalBreakdownCategories)}}},objectName:t.waterfallChartProps.breakdown.maxBreakdowns.objectName})},n.prototype.calculateCustomLegend=function(){return this.data.legend},n.prototype.hasLegend=function(){return!0},n.createClippedDataIfOverflowed=function(t,a){var i=t,r=t.series[0].data;return t&&a<r.length&&(i=e.Prototype.inherit(t),i.series=[{data:r.slice(0,a)}],i.categories=t.categories.slice(0,a)),i},n.prototype.calculateAxesProperties=function(e){var a=this;this.currentViewport=e.viewport,this.viewModelAdapter&&this.originalData&&(this.data=this.viewModelAdapter.applyChanges(this.currentViewport,this.originalData,this.dataView)),this.margin=e.margin;var i=this.clippedData=this.data,r=i.series,o=i.categories.length,s=this.getPreferredPlotArea(!1,o,t.CartesianHelper.MinOrdinalRectThickness,e.outerPaddingRatio),l=i?i.preferredCategoryWidth:null,c=t.CartesianChart.getLayout(null,{availableWidth:s.width,categoryCount:o,preferredCategoryWidth:l,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,outerPaddingRatio:e.outerPaddingRatio,innerPaddingRatio:e.innerPaddingRatio});this.isScrollable||(i=this.clippedData=n.createClippedDataIfOverflowed(i,c.categoryCount));var u=n.getXAxisCreationOptions(i,s.width,c,e),h=n.getYAxisCreationOptions(i,s.height,e),d=this.xAxisProperties=t.AxisHelper.createAxis(u),p=this.yAxisProperties=t.AxisHelper.createAxis(h);this.xAxisProperties.outerPaddingRatio=c.outerPaddingRatio,this.axisInteractivity&&i.categoryIdentities&&(this.xAxisProperties.categoryIdentities=i.categoryIdentities);var g=this.xAxisProperties.categoryThickness*(1-e.innerPaddingRatio),y=t.LabelUtils.createColumnFormatterCacheManager(),m=i.dataLabelsSettings,v=t.LabelUtils.getLabelUnitAndPrecisionForAxis(p,m);return this.layout={categoryCount:c.categoryCount,categoryThickness:c.categoryThickness,isScalar:c.isScalar,outerPaddingRatio:c.outerPaddingRatio,categoryWidth:g,labelText:function(e){var a=r[e.seriesIndex].type,i=y.getOrCreate(e.labelFormatString,m,v.units,v.getPrecision(!!e.labelFormatString,a));return t.LabelUtils.getLabelTailoredText({label:i.format(e.value)})},labelLayout:t.CartesianHelper.getLabelLayoutXYForWaterfall(d,g,p,h.dataDomain),filter:function(e){return n.doesDataLabelFitInShape(e,p,a.layout)},style:{fill:function(e){return e.isLabelInside?t.ColorHelper.getThemeColor(a.style,t.LabelUtils.DefaultInsideLabelColorName):e.labelFill}}},[d,p]},n.lookupXValue=function(e,a,i){var r=e.series[0].data;return a===r.length-1?r[a].categoryValue:t.CartesianHelper.lookupXValue(e,a,r[a].type||i,!1)},n.getXAxisCreationOptions=function(e,a,i,r){var o=t.AxisHelper.getCategoryValueType(e.categoryMetadata),s=t.AxisHelper.createDomain(e.series,o,!1,r.forcedXDomain,r.ensureXDomain),l=i.categoryThickness,c=l*i.outerPaddingRatio;return{pixelSpan:a,dataDomain:s,metaDataColumn:e.categoryMetadata,formatString:t.valueFormatter.getFormatString(e.categoryMetadata,n.formatStringProp),isScalar:!1,outerPadding:c,categoryThickness:l,getValueFn:function(t,a){return n.lookupXValue(e,t,a)},forcedTickCount:r.forcedTickCount,isCategoryAxis:!0,axisDisplayUnits:r.categoryAxisDisplayUnits,axisPrecision:r.categoryAxisPrecision,outerPaddingRatio:i.outerPaddingRatio,preventNice:r.preventNiceX,innerPaddingRatio:r.innerPaddingRatio}},n.getYAxisCreationOptions=function(e,a,i){return{pixelSpan:a,dataDomain:t.AxisHelper.combineDomain(i.forcedYDomain,[e.positionMin,e.positionMax],i.ensureYDomain),zeroScalarDomain:[0,1],isScalar:!0,isVertical:!0,metaDataColumn:e.valuesMetadata,formatString:t.valueFormatter.getFormatString(e.valuesMetadata[0],n.formatStringProp),outerPadding:0,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,axisDisplayUnits:i.valueAxisDisplayUnits,axisPrecision:i.valueAxisPrecision,outerPaddingRatio:0,preventNice:i.preventNiceY}},n.prototype.getPreferredPlotArea=function(e,a,i,r){return t.CartesianChart.getPreferredPlotArea(a,i,this.currentViewport,this.isScrollable,e,this.margin,r)},n.prototype.getVisualCategoryAxisIsScalar=function(){return!1},n.prototype.overrideXScale=function(e){this.xAxisProperties=e},n.prototype.setFilteredData=function(t,a){var i=this.clippedData=e.Prototype.inherit(this.data);return i.series=[{data:i.series[0].data.slice(t,a)}],i.categories=i.categories.slice(t,a),i},n.prototype.createRects=function(e){var t=this.mainGraphicsContext,a=t.selectAll(n.CategoryValueClasses.selector),i=a.data(e,function(e){return e.key});return i.enter().append("rect").attr("class",function(e){return n.CategoryValueClasses.class.concat(e.highlight?"highlight":"")}),i.exit().remove(),i},n.prototype.createConnectors=function(e){var t=this.mainGraphicsContext,a=t.selectAll(n.WaterfallConnectorClasses.selector),i=a.data(e.slice(0,e.length-1),function(e){return e.key});return i.enter().append("line").classed(n.WaterfallConnectorClasses.class,!0),i.exit().remove(),i},n.prototype.render=function(e){var a=this,i=this.clippedData.series[0].data,r=this.createRects(i),o=this.createConnectors(i),s=this.clippedData.strokeSettings;this.tooltipsEnabled&&this.tooltipService.addTooltip(r,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity});var l=this.interactivityService&&this.interactivityService.hasSelection(),c=this.xAxisProperties.scale,u=this.yAxisProperties.scale,h=u.domain()[0];if(this.mainGraphicsSVG.attr("height",this.getAvailableHeight()).attr("width",this.getAvailableWidth()),s&&s.visible&&this.mainGraphicsSVG.style("stroke",s.color).style("stroke-width",s.width),r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return 1===e.barType?t.ColumnUtil.DefaultOpacity:t.ColumnUtil.getFillOpacity(e.selected,e.highlight,l,a.data.hasHighlights)}).attr("width",this.layout.categoryWidth).attr("x",function(e){return c(e.categoryIndex)}).attr("y",function(e){return t.CartesianHelper.getRectTop(u,e.position,e.value)}).attr("height",function(e){return e.position<h?u(h)-u(e.value):Math.abs(u(e.position)-u(e.position+e.value))}),this.interactivityService){var d=jsCommon.BrowserUtils.isInternetExplorerOrEdge();r.attr({tabindex:0,focusable:!0}).attr("aria-label",function(e){return t.tooltipUtils.formatTooltipInfo(e.tooltipInfo())}).classed(t.SetFocusRingClassName,!d)}o.style("stroke",t.ColorHelper.getThemeColor(this.style,n.DefaultWaterfallConnectorColorName)).attr({x1:function(e){return c(e.categoryIndex)},y1:function(e){return u(e.position+e.value)},x2:function(e){return c(e.categoryIndex+1)+a.layout.categoryWidth},y2:function(e){return u(e.position+e.value)}});var p=this.data.dataLabelsSettings,g=[];(p&&p.show||p.showCategory)&&(g=this.createLabelDataPoints());var y,m;return this.interactivityService&&(m={navigationStrategy:t.DataPointNavigationStrategy.CategoryOnly,helper:this},y={root:this.mainGraphicsContext,bars:r,isBreakdown:this.data.isBreakdown}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:this.data.series[0].data,behaviorOptions:y,navigationOptions:m,labelDataPoints:g,labelsAreNumeric:!0,labelOrientation:p.labelOrientation,animateLabels:!e}},n.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},n.prototype.getSupportedCategoryAxisType=function(){return t.axisType.categorical},n.prototype.getFirstElement=function(){if(_.isEmpty(this.clippedData.series)||_.isEmpty(this.clippedData.series[0].data))return null;var e=this.clippedData.series[0].data[0].categoryIndex;return this.getHTMLElementFromCategoryIndex(e)},n.prototype.getNextDataPoint=function(e,a,i){switch(i){case t.DataDirection.NextCategory:e+=1,e>=this.data.categories.length&&(e=0);break;case t.DataDirection.PreviousCategory:e-=1,e<0&&(e=this.data.categories.length-1);break;case t.DataDirection.NextSeries:case t.DataDirection.PreviousSeries:break;default:debug.assertNever(i)}return{element:this.getHTMLElementFromCategoryIndex(e),targetCategoryIndex:e}},n.prototype.getHTMLElementFromCategoryIndex=function(e){return this.mainGraphicsContext.selectAll(n.CategoryValueClasses.selector).filter(function(t){return t.categoryIndex===e}).node()},n.prototype.getAvailableWidth=function(){return this.currentViewport.width-(this.margin.left+this.margin.right)},n.prototype.getAvailableHeight=function(){return this.currentViewport.height-(this.margin.top+this.margin.bottom)},n.prototype.getSentimentColorsFromObjects=function(e){var a=t.ColorHelper.create(this.style);return{increaseFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.increaseFill,t.ColorHelper.getSentimentColor(this.style,"good"))}},decreaseFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.decreaseFill,t.ColorHelper.getSentimentColor(this.style,"bad"))}},totalFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.totalFill,t.ColorHelper.getDataColorByIndex(this.style,0))}},otherFill:{solid:{color:a.getColorForPropertyWithDefaultColor(e,t.waterfallChartProps.sentimentColors.otherFill,t.ColorHelper.getSentimentColor(this.style,"neutral"))}}}},n.prototype.createLabelDataPoints=function(){for(var a=[],i=this.data,r=this.xAxisProperties.scale,o=this.yAxisProperties.scale,n=o(0),s=i.series,l=t.LabelUtils.createColumnFormatterCacheManager(),c=i.dataLabelsSettings,u=t.LabelUtils.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,c),h=0,d=s;h<d.length;h++)for(var p=d[h],g=0,y=p.data;g<y.length;g++){var m=y[g],v={left:r(m.categoryIndex),top:t.CartesianHelper.getRectTop(o,m.position,m.value),width:this.layout.categoryWidth,height:n-o(Math.abs(m.value))},f=m.labelFormatString,x=l.getOrCreate(f,this.data.dataLabelsSettings,u.units,u.getPrecision(!!f,p.type)),C=t.LabelUtils.getLabelFormattedText(x.format(m.value)),S=c.fontProperties,b=t.FontProperties.toTextProperties(S,C),D=e.TextMeasurementService.measureSvgTextWidth(b),w=e.TextMeasurementService.estimateSvgTextHeight(b,!0),P=this.getValidPositions(c.position,m.value);a.push({isPreferred:!0,text:C,textSize:{width:D,height:w},outsideFill:S.color?S.color:t.ColorHelper.getThemeColor(this.style,t.LabelUtils.DefaultLabelColorName),insideFill:t.ColorHelper.getThemeColor(this.style,t.LabelUtils.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:v,orientation:m.value>=0?1:2,validPositions:P},fontProperties:S,identity:void 0,hasBackground:c.enableBackground,backgroundColor:c.backgroundColor,backgroundTransparency:c.backgroundTransparency})}return a},n.prototype.getValidPositions=function(e,a){if(0===a)return n.validZeroLabelPosition;switch(e){case t.labelPosition.insideEnd:return[4];case t.labelPosition.insideCenter:return[1];case t.labelPosition.insideBase:return[2];case t.labelPosition.outsideEnd:return[16];default:return n.validLabelPositionsAuto}},n.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},n.prototype.getStaticSeriesRole=function(){},n.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e,this.originalData,this.data)},n.formatStringProp={objectName:"general",propertyName:"formatString"},n.WaterfallClassName="waterfallChart",n.MainGraphicsContextClassName="mainGraphicsContext",n.IncreaseLabel="Increase",n.DecreaseLabel="Decrease",n.TotalLabel="Waterfall_TotalLabel",n.OtherLabel="Waterfall_OtherLabel",n.CategoryValueClasses=a("column"),n.WaterfallConnectorClasses=a("waterfall-connector"),n.AutoLabelPosition="Auto",n.DefaultWaterfallConnectorColorName="foregroundNeutralTertiary",n.MinimumBreakdowns=1,n.MaximumBreakdowns=20,n.DefaultBreakdowns=5,n.validLabelPositionsOptions=[n.AutoLabelPosition,i.outsideEnd,i.insideEnd,i.insideCenter,i.insideBase],n.validLabelPositionsAuto=[16,4,1,2],n.validZeroLabelPosition=[16,8],n}();t.WaterfallChart=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.BrowserUtils,a=function(){function a(){}return a.prototype.bindEvents=function(a,i,r){var o=this,n=this.bars=a.bars;if(r&&!r.isEmpty()){var s=a.root;e.InteractivityUtils.registerEnterPlotAreaHandler(s,r),e.InteractivityUtils.registerDataPointNavigationHandler(s,r),e.InteractivityUtils.registerClearCatcherShortcut(s,i)}n.on("click",function(e){return o.handleSelection(e,i,a.isBreakdown)}).on("keydown",function(e){var t=d3.event.keyCode;32!==t&&13!==t||(d3.event.preventDefault(),d3.event.stopPropagation(),o.handleSelection(e,i,a.isBreakdown))}),n.on("contextmenu",function(a){if(!t.isCtrlOrMeta(d3.event)&&(d3.event.preventDefault(),e.EventBubblingUtil.markAsHandled(d3.event),1!==a.barType)){var r=e.InteractivityUtils.getPositionOfLastInputEvent();i.handleContextMenu(a,r)}})},a.prototype.renderSelection=function(t){this.bars.style("fill-opacity",function(a){return 1===a.barType?e.ColumnUtil.DefaultOpacity:e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)}).style("stroke-opacity",function(a){return 1===a.barType?e.ColumnUtil.DefaultOpacity:e.ColumnUtil.getFillOpacity(a.selected,a.highlight,t,!1)})},a.prototype.renderFocus=function(e){e&&t.focus(e)},a.prototype.handleSelection=function(a,i,r){if(1!==a.barType){var o=e.InteractivityUtils.getPositionOfLastInputEvent();i.handleSelection(a,!r&&t.isCtrlOrMeta(d3.event),o)}},a}();e.WaterfallChartWebBehavior=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={})),define("CartesianVisuals/cartesianModule",["require","exports"],function(e,t){function a(e){return new g(e)}function i(e){return new w(e)}function r(e){return new y(e)}function o(){return new m}function n(){return new f}function s(){return new x}function l(){return new b}function c(){return new D}function u(e){return new C(e)}function h(e){return new v(e)}function d(){return new S}Object.defineProperty(t,"__esModule",{value:!0});var p=powerbi.visuals,g=p.CartesianChart,y=p.CartesianChartBehavior,m=p.ColumnChartWebBehavior,v=p.DashboardColumnChartAnimator,f=p.DataDotChartWebBehavior,x=p.LineChartWebBehavior,C=p.RealTimeLineChartAnimator,S=p.ScatterChartMobileBehavior,b=p.ScatterChartWebBehavior,D=p.WaterfallChartWebBehavior,w=p.WebColumnChartAnimator;t.createCartesianChart=a,t.createWebColumnChartAnimator=i,t.createCartesianChartBehavior=r,t.createColumnChartWebBehavior=o,t.createDataDotChartWebBehavior=n,t.createLineChartWebBehavior=s,t.createScatterChartWebBehavior=l,t.createWaterfallChartWebBehavior=c,t.createRealTimeLineChartAnimator=u,t.createDashboardColumnChartAnimator=h,t.createScatterChartMobileBehavior=d});var powerbi;!function(e){function t(){function t(e){var t,a=e.dataView,i=e.hostServices,r=e.dataLabelSettings,h=e.sentimentColors,g=e.interactivityService,y=e.tooltipsEnabled,f=e.numberOfBreakdowns,x=a.matrix,C=!_.isEmpty(x.columns.levels)&&x.columns.levels[0].sources[0],S=!_.isEmpty(x.rows.levels)&&x.rows.levels[0].sources,b=_.findIndex(x.valueSources,function(e){return c.hasRole(e,"Y")}),D=x.valueSources[b],w=_.filter(x.valueSources,function(e){return c.hasRole(e,"Tooltips")}),P=[],L=[],A={current:0,min:0,max:0},V=0;if(C&&S&&D){var M=new v(C,S,D),I=D.format,k=i.getLocalizedString("Waterfall_OtherLabel"),T=m.formatStringProp,F=x.rows.root.children,N=x.columns.root.children;if(!_.isEmpty(F)&&!_.isEmpty(N)){var O=F.length,H=N.length,R=0,B=void 0,E=void 0,U=_.size(w)+1;O>0&&(V=_.size(F[0].values)/U-1),f=Math.min(f,V);for(var z=0;z<O;z++){for(var G=F[z],j=z>0?F[z-1]:void 0,W=_.map(G.levelValues,function(e){return e.value}),X=_.map(W,function(e,t){return l.formatFromMetadataColumn(e,S[t],T)}).join(" "),Y=M.splitIdentity(G.identity.expr),q=[],K=_.size(G.values),Z=0;Z<K;Z+=U){for(var $=void 0,J=void 0,Q=[],ee=[],te=0;te<U;te++)te===b?($=o.normalizeNonFiniteNumber(G.values[Z+te].value),J=j&&o.normalizeNonFiniteNumber(j.values[Z+te].value)):(Q.push(G.values[Z+te].value),ee.push(j&&j.values[Z+te].value));q.push({key:Z,currentValue:$,previousValue:J,difference:($||0)-(J||0),column:N[Z/U],currentTooltipValues:Q,previousTooltipValues:ee})}q=_.sortBy(q,function(e){return Math.abs(e.difference)*-1});var ae=_.chain(q).filter(function(e){return!e.column.isSubtotal}).take(f).sortBy(function(e){return e.difference*-1}).value(),ie=_.find(q,function(e){return e.column.isSubtotal}),re=ie.currentValue,oe=ie.previousValue;if(j){var ne=_.sumBy(ae,function(e){return e.currentValue}),se=_.sumBy(ae,function(e){return e.previousValue}),le=_.chain(ae).map(function(e){return M.splitIdentity(e.column.identity.expr)}).flatten().value(),ce=H>f+1,ue=0,he=void 0,de=void 0;if(ce){var pe=re-ne,ge=oe-se;if(ue=pe-ge,he=M.createBreakdownOtherIdentity(le,Y,E),y){de=M.createBreakdownTooltip(X,B,k,pe,ge,ue,T,i);for(var ye=[],me=[],ve=function(e){var t=ie.currentTooltipValues[e],a=ie.previousTooltipValues[e];if(_.isNumber(t)&&_.isNumber(a)){var i=t-_.sumBy(ae,function(t){return t.currentTooltipValues[e]}),r=a-_.sumBy(ae,function(t){return t.previousTooltipValues[e]});ye.push(i-r),me.push(r)}},fe=0;fe<ie.currentTooltipValues.length;fe++)ve(fe);m.appendTooltipMeasures(ye,de,w,T,i,me,X,B)}}for(var xe=!1,Ce=function(e){ce&&ue>e.difference&&!xe&&(xe=!0,P.push(m.createDataPoint(ue,A.current,h,k,R++,he,de,r.fontProperties.color,I,3,{text:!0})),L.push(k),A=m.getNewPositionContext(A,ue));var t=l.formatFromMetadataColumn(e.column.value,C,T),a=M.splitIdentity(e.column.identity.expr),o=M.createBreakdownIdentity(Y,E,a),n=void 0;if(y){n=M.createBreakdownTooltip(X,B,t,e.currentValue,e.previousValue,e.difference,T,i);var s=_.map(e.currentTooltipValues,function(t,a){return _.isNumber(t)?t-e.previousTooltipValues[a]:t});m.appendTooltipMeasures(s,n,w,T,i,e.previousTooltipValues,X,B)}P.push(m.createDataPoint(e.difference,A.current,h,t,R++,o,n,r.fontProperties.color,I,0,{text:!0})),L.push(t),A=m.getNewPositionContext(A,e.difference)},Se=0,be=ae;Se<be.length;Se++)Ce(be[Se]);ce&&!xe&&(xe=!0,P.push(m.createDataPoint(ue,A.current,h,k,R++,he,de,r.fontProperties.color,I,3,{text:!0})),L.push(k),A=m.getNewPositionContext(A,ue))}var De={dataMap:(t={},t[S[0].queryName]=[G.identity],t),metadata:[D.queryName]},we=p.convertSelectorsByColumnToSelector(De),Pe=new d(we,(!1),De),Le=void 0;y&&(Le=m.createCategoryTooltip(S,D,W,re,T),m.appendTooltipMeasures(ie.currentTooltipValues,Le,w,T,i)),P.push(m.createDataPoint(re,0,h,X,R++,Pe,Le,r.fontProperties.color,I,2,{text:!0})),L.push(X),0===z&&(A={current:re,max:re,min:re}),B=X,E=Y}}}g&&g.applySelectionStateToData(P);var Ae;e.style.isHighContrast&&(Ae={visible:!0,color:s.getThemeColor(e.style,u),width:n.defaultLineStrokeWidth});var Ve,Me=n.getCategoryAxisProperties(a.metadata,void 0),Ie=n.getPreferredCategoryWidth(Me);return e.axisInteractivity&&(Ve=_.map(P,function(e){return function(){return e.identity}})),{series:[{data:P,type:D&&D.type}],categories:L,categoryIdentities:Ve,categoryMetadata:S[0],preferredCategoryWidth:Ie,valuesMetadata:x.valueSources,legend:m.createLegend(h,i,a.metadata&&a.metadata.objects,e.style,!0),hasHighlights:!1,positionMin:A.min,positionMax:A.max,dataLabelsSettings:r,sentimentColors:h,isBreakdown:!0,numberOfBreakdowns:f,totalBreakdownCategories:V,strokeSettings:Ae}}var a=e,i=a.data,r=a.visuals,o=r.AxisHelper,n=r.CartesianHelper,s=r.ColorHelper,l=r.converterHelper,c=i.DataRoleHelper,u=r.ForegroundColorName,h=jsCommon.Lazy,d=e.visuals.SelectionId,p=i.Selector,g=i.SQExprBuilder,y=jsCommon.StringExtensions,m=e.visuals.WaterfallChart,v=function(){function e(e,t,a){this.breakdownMetadata=e,this.categoryMetadata=t,this.valueMetadata=a}return e.prototype.splitIdentity=function(e){return i.ScopeIdentityExtractor.getKeyValuePairs(e)},e.prototype.createBreakdownIdentity=function(e,t,a){var r,o={dataMap:(r={},r[this.breakdownMetadata.queryName]=[i.createDataViewScopeIdentity(g.inValues(_.map(e,function(e){return e.left}).concat(_.map(a,function(e){return e.left})),[_.map(t,function(e){return e.right}).concat(_.map(a,function(e){return e.right})),_.map(e,function(e){return e.right}).concat(_.map(a,function(e){return e.right}))]))],r),metadata:[this.valueMetadata.queryName]};return new d(p.convertSelectorsByColumnToSelector(o),(!1),o)},e.prototype.createBreakdownOtherIdentity=function(e,t,a){var r,o={dataMap:(r={},r[this.breakdownMetadata.queryName]=[i.createDataViewScopeIdentity(g.not(g.inValues([this.breakdownMetadata.expr],_.map(e,function(e){return[e.right]}))))],r),metadata:[this.valueMetadata.queryName]};return o.dataMap[this.categoryMetadata[0].queryName]=[i.createDataViewScopeIdentity(g.inValues(_.map(t,function(e){return e.left}),[_.map(a,function(e){return e.right}),_.map(t,function(e){return e.right})]))],new d(p.convertSelectorsByColumnToSelector(o),(!1),o)},e.prototype.createBreakdownTooltip=function(e,t,a,i,o,n,s,c){var u=this,d=new r.LazyTooltipBuilder;if(this.breakdownMetadata&&d.withLazyValue(new h(function(){return{displayName:u.breakdownMetadata.displayName,value:l.formatFromMetadataColumn(a,u.breakdownMetadata,s)}})),this.valueMetadata&&(null!=o&&d.withLazyValue(new h(function(){return{displayName:t+" "+u.valueMetadata.displayName,value:l.formatFromMetadataColumn(o,u.valueMetadata,s,!1)}})),null!=i&&d.withLazyValue(new h(function(){return{displayName:e+" "+u.valueMetadata.displayName,value:l.formatFromMetadataColumn(i,u.valueMetadata,s,!1)}})),null!=n)){var p=l.formatFromMetadataColumn(n,this.valueMetadata,s,!1);p=m.createPercentTooltipValue(p,n,o),d.withLazyValue(new h(function(){return{displayName:y.format(c.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),u.valueMetadata.displayName),value:p}}))}return d},e}();return{matrixConverter:function(e){return t(e)}}}e.waterfallConverterModuleFactory=t}(powerbi||(powerbi={}));