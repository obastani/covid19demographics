"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,n){function a(e){try{l(o.next(e))}catch(e){n(e)}}function s(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,n&&(a=2&r[0]?n.return:r[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,n=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__assign.apply(this,arguments)},powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t){var r=t.getHierarchyDepth(),o=t.getChildren(e);if(!_.isEmpty(o))for(var i=0,n=o;i<n.length;i++){var a=n[i];r=Math.min(r,t.getLevel(a))}return r-t.getLevel(e)}function r(e,t){return t.isLeaf(e)?e:r(_.head(t.getChildren(e)),t)}function o(e,t){return void 0!==t.getLeafIndex(e)?e:o(_.head(t.getChildren(e)),t)}function i(e,t){return t.isLeaf(e)?e:i(_.last(t.getChildren(e)),t)}function n(e,t){return void 0!==t.getLeafIndex(e)?e:n(_.last(t.getChildren(e)),t)}function a(e,t){return t.getLeafIndex(r(e,t))}function s(e,t){return t.getLeafIndex(o(e,t))}function l(e,t){return t.getLeafIndex(i(e,t))}function u(e,t){return t.getLeafIndex(n(e,t))}e.getHeaderSpan=t,e.getFirstVisualLeaf=o,e.getLastLeaf=i,e.getLastVisualLeaf=n,e.getFirstLeafIndex=a,e.getFirstVisualLeafIndex=s,e.getLastLeafIndex=l,e.getLastVisualLeafIndex=u}(t=e.PivotTableHierarchyNavigator||(e.PivotTableHierarchyNavigator={}))}(t=e.pivotTable||(e.pivotTable={}))}(t=e.controls||(e.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(e,t,r,o,i){var n=this;this.elementOriginalCursor=t.style.cursor,this.verticalResizeHandler=r,this.horizontalResizeHandler=o,(r||o)&&(t.addEventListener("mousedown",function(r){return n.onMouseDown(e,t,r)}),t.addEventListener("mousemove",function(e){return n.onMouseMove(t,e)}),t.addEventListener("dblclick",function(r){return n.onDoubleClick(e,t,r)})),i&&t.addEventListener("click",function(r){return n.onClick(e,t,r,i)})}return t.prototype.onMouseDown=function(e,r,o){var i=this.getActiveHandler(r,o);return i?(this.resizing=!0,this.startMousePosition=t.getMouseCoordinates(o),this.initializeDocumentEvents(r,i),document.documentElement&&(this.documentOriginalCursor=document.documentElement.style.cursor,document.documentElement.style.cursor=this.getCursor(r,o)),void i.onStartResize(e)):void(this.resizing=!1)},t.prototype.onMouseMove=function(e,t){this.startMousePosition||(e.style.cursor=this.getCursor(e,t))},t.prototype.onDoubleClick=function(e,t,r){var o=this.getActiveHandler(t,r);o&&o.onReset(e)},t.prototype.onClick=function(e,t,r,o){this.resizing||o&&o(e,r)},t.prototype.getActiveHandler=function(e,r){return this.isMouseOnVerticalHandle(e,t.getMouseCoordinates(r))?this.verticalResizeHandler:this.isMouseOnHorizontalHandle(e,t.getMouseCoordinates(r))?this.horizontalResizeHandler:null},t.prototype.getCursor=function(e,r){return this.isMouseOnVerticalHandle(e,t.getMouseCoordinates(r))?"col-resize":this.isMouseOnHorizontalHandle(e,t.getMouseCoordinates(r))?"row-resize":this.elementOriginalCursor},t.prototype.initializeDocumentEvents=function(e,r){var o=this;this.documentMouseMoveListener=function(i){i.preventDefault(),r.onResize(t.getMouseCoordinatesDelta(e,o.startMousePosition,t.getMouseCoordinates(i)))},document.addEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseUpListener=function(e){e.preventDefault(),document.removeEventListener("mousemove",o.documentMouseMoveListener),o.documentMouseMoveListener=null,document.removeEventListener("mouseup",o.documentMouseUpListener),o.documentMouseUpListener=null,document.documentElement&&(document.documentElement.style.cursor=o.documentOriginalCursor,o.documentOriginalCursor=void 0),o.startMousePosition=null,r.onEndResize()},document.addEventListener("mouseup",this.documentMouseUpListener)},t.prototype.isMouseOnVerticalHandle=function(e,r){return!!this.verticalResizeHandler&&r.x>=e.getBoundingClientRect().right-t.HandleSize},t.prototype.isMouseOnHorizontalHandle=function(e,r){return!!this.horizontalResizeHandler&&r.y>=e.getBoundingClientRect().bottom-t.HandleSize},t.getMouseCoordinates=function(e){return{x:e.pageX,y:e.pageY}},t.getMouseCoordinatesDelta=function(t,r,o){if(!o||!r)return{x:0,y:0};var i=e.HTMLElementUtils.getAccumulatedScale(t);return{x:(o.x-r.x)/i,y:(o.y-r.y)/i}},t.HandleSize=4,t}();t.HeaderResizer=r;var o=function(){function e(e){this.control=e}return e.prototype.onStartResize=function(e){var r=t.PivotTableHierarchyNavigator.getLastLeaf(e,this.control.getColumnNavigator()),o=this.control.getColumnNavigator().getLeafIndex(r);this.resizeState={leafToResize:r,leafToResizeIndex:o,originalWidth:this.control.getColumnWidthMeasureManager().getColumnWidth(o)}},e.prototype.onResize=function(e){if(e.x&&this.resizeState){var o=this.control.getViewport(),i=t.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager()),n=t.ColumnMeasurementUtil.getVisibleRange(o.left,o.width,this.control.getColumnWidthMeasureManager());if(i&&n){this.control.getWorkScheduler().clear();var a=Math.max(this.resizeState.originalWidth+e.x,r.HandleSize);this.control.getColumnWidthMeasureManager().setColumnWidth(this.resizeState.leafToResizeIndex,a),t.RowMeasurementUtil.remeasureRows(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),i.firstLeafIndex,i.lastLeafIndex,n.firstLeafIndex,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clearFloatingRows(),this.control.getColumnLevelHeightMeasureManager().clear(),this.resizeBodyPages(this.resizeState.leafToResizeIndex,i.firstLeafIndex,i.lastLeafIndex),this.control.render(t.PivotTableRenderingMode.Incremental)}}},e.prototype.onEndResize=function(){var e=this;if(this.resizeState){var r=this.resizeState.leafToResize,o=this.control.getColumnWidthMeasureManager().getColumnWidth(this.resizeState.leafToResizeIndex),i=this.resizeState.originalWidth;this.resizeState=void 0;var n=this.control.getViewport(),a=t.RowMeasurementUtil.getVisibleRange(n.top,n.height,this.control.getRowHeightMeasureManager());if(a&&o!==i){this.control.getWorkScheduler().clear(),this.control.getSizeManager().setColumnWidth(r,o);var s=t.RowMeasurementUtil.getVisibleRowStart(a,n.top,this.control.getRowHeightMeasureManager());this.control.getRowHeightMeasureManager().clear(),this.control.makeVisible(t.PivotTableRenderingMode.Incremental,s,null,function(){return e.control.rebuildBodyPagesSync()})}}},e.prototype.onReset=function(e){var r=this,o=this.control.getViewport(),i=t.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager());if(i){var n=t.PivotTableHierarchyNavigator.getLastLeaf(e,this.control.getColumnNavigator()),a=this.control.getColumnNavigator().getLeafIndex(n);this.control.getSizeManager().setColumnWidth(n,void 0),t.ColumnMeasurementUtil.remeasureColumn(a,this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),i.firstLeafIndex,this.control.getColumnWidthMeasureManager());var s=t.RowMeasurementUtil.getVisibleRowStart(i,o.top,this.control.getRowHeightMeasureManager());this.control.getRowHeightMeasureManager().clear(),this.control.getColumnLevelHeightMeasureManager().clear(),this.control.makeVisible(t.PivotTableRenderingMode.Incremental,s,null,function(){return r.control.rebuildBodyPagesSync()})}},e.prototype.resizeBodyPages=function(e,t,r){this.control.getBodyCellRenderer().resizRows(t,r),this.control.getFloatingBodyCellRenderer().resizRows(0,this.control.getRowNavigator().getFloatingHierarchyLeafCount()-1),this.control.getBodyCellRenderer().resizeColumn(e),this.control.getFloatingBodyCellRenderer().resizeColumn(e)},e}();t.ColumnWidthResizeHandler=o;var i=function(){function e(e){this.control=e}return e.prototype.onStartResize=function(e){},e.prototype.onResize=function(e){},e.prototype.onEndResize=function(){},e.prototype.onReset=function(e){},e}();t.RowHeightResizeHandler=i;var n=function(){function e(e){this.control=e}return e.prototype.onStartResize=function(e){},e.prototype.onResize=function(e){},e.prototype.onEndResize=function(){},e.prototype.onReset=function(e){},e}();t.ColumnLevelHeightResizeHandler=n;var a=function(){function e(e){this.control=e}return e.prototype.onStartResize=function(e){var t=this.getLevelToResize(e);this.resizeState={cornerCellToResize:this.control.getRowNavigator().getCorner(t,this.control.getColumnNavigator().getHierarchyDepth()-1),levelToResize:t,originalWidth:this.control.getRowLevelWidthMeasureManager().getLevelWidth(t)}},e.prototype.onResize=function(e){if(e.x&&this.resizeState){var o=this.control.getViewport(),i=t.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager()),n=t.ColumnMeasurementUtil.getVisibleRange(o.left,o.width,this.control.getColumnWidthMeasureManager());if(i){this.control.getWorkScheduler().clear();var a=Math.min(this.getMaxWidth(this.resizeState.levelToResize),Math.max(this.resizeState.originalWidth+e.x,r.HandleSize));this.control.getRowLevelWidthMeasureManager().setLevelWidth(this.resizeState.levelToResize,a),t.RowMeasurementUtil.remeasureRows(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),i.firstLeafIndex,i.lastLeafIndex,n?n.firstLeafIndex:0,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clearFloatingRows(),this.control.getColumnLevelHeightMeasureManager().clear(),this.resizeBodyPages(i.firstLeafIndex,i.lastLeafIndex),this.control.render(t.PivotTableRenderingMode.Incremental)}}},e.prototype.onEndResize=function(){var e=this;if(this.resizeState){var r=this.resizeState.cornerCellToResize,o=this.control.getRowLevelWidthMeasureManager().getLevelWidth(this.resizeState.levelToResize),i=this.resizeState.originalWidth;this.resizeState=void 0;var n=this.control.getViewport(),a=t.RowMeasurementUtil.getVisibleRange(n.top,n.height,this.control.getRowHeightMeasureManager());if(a&&o!==i){this.control.getWorkScheduler().clear(),this.control.getSizeManager().setRowLevelWidth(r,o);var s=t.RowMeasurementUtil.getVisibleRowStart(a,n.top,this.control.getRowHeightMeasureManager());this.control.getRowHeightMeasureManager().clear(),this.control.makeVisible(t.PivotTableRenderingMode.Incremental,s,null,function(){return e.control.rebuildBodyPagesSync()})}}},e.prototype.onReset=function(e){var r=this,o=this.control.getViewport(),i=t.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager());if(i){var n=this.getLevelToResize(e),a=this.control.getRowNavigator().getCorner(n,this.control.getColumnNavigator().getHierarchyDepth()-1);this.control.getSizeManager().setRowLevelWidth(a,void 0),this.control.getRowLevelWidthMeasureManager().measure(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),i.firstLeafIndex,t.MeasureRowSampleCount,n);var s=t.RowMeasurementUtil.getVisibleRowStart(i,o.top,this.control.getRowHeightMeasureManager());this.control.getRowHeightMeasureManager().clear(),this.control.getColumnLevelHeightMeasureManager().clear(),this.control.makeVisible(t.PivotTableRenderingMode.Incremental,s,null,function(){return r.control.rebuildBodyPagesSync()})}},e.prototype.getLevelToResize=function(e){return this.control.getSteppedLayout()?0:this.control.getRowNavigator().getRowLevel(e)},e.prototype.getMaxWidth=function(e){for(var t=this.control.getClientWidth(),r=0;r<e;r++)t-=this.control.getRowLevelWidthMeasureManager().getLevelWidth(r);return t},e.prototype.resizeBodyPages=function(e,t){this.control.getBodyCellRenderer().resizRows(e,t),this.control.getFloatingBodyCellRenderer().resizRows(0,this.control.getRowNavigator().getFloatingHierarchyLeafCount()-1)},e}();t.RowLevelWidthResizeHandler=a}(t=e.pivotTable||(e.pivotTable={}))}(t=e.controls||(e.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(e,t){for(var r=[];;){var o=t.getParent(e);if(!o||!t.isLastItem(e,t.getChildren(o)))break;r.push({node:o,size:-1}),e=o}return r}function o(e,t,r,o){for(var n=0,a=0,s=e;a<s.length;a++){var l=s[a];n=Math.max(n,i(l,t,r,o))}return n}function i(t,r,o,i){for(var n=e.PivotTableHierarchyNavigator.getFirstLeafIndex(t.node,o),a=0,s=n;s<=r;s++)if(a+=i(s),a>=t.size)return 0;return t.size-a}function n(e,t){return Math.floor(e/t)}function a(e,t,r){var o=n(e,r),i=n(t,r);if(o===i)return[{pageIndex:o,startIndex:e%r,endIndex:t%r}];var a=[];a.push({pageIndex:o,startIndex:e%r,endIndex:r-1});for(var s=o+1;s<i;s++)a.push({pageIndex:s,startIndex:0,endIndex:r-1});return a.push({pageIndex:i,startIndex:0,endIndex:t%r}),a}t.getAncestorsToMeasure=r,t.getSizeDifference=o,t.getPageIndex=n,t.itemRangeToPageRange=a}(t=e.MeasureUtil||(e.MeasureUtil={}));var r;!function(r){function o(e,t,r){var o=i(e,t,r);if(!o)return null;var s=n(o.firstPageColumn,o.firstPageIndex,o.firstPageLeft,e,t),l=a(o.lastPageColumn,o.lastPageIndex,o.lastPageLeft,e,t);return{firstLeafIndex:s.leafIndex,firstLeafLeft:s.left,lastLeafIndex:l}}function i(e,t,r){for(var o=0,i=0,n=null,a=0,l=r.getPageColumns();a<l.length;a++){var u=l[a],h=u.getWidth();if(s(o,h,e,t))n?(n.lastPageColumn=u,n.lastPageIndex=i,n.lastPageLeft=o):n={firstPageColumn:u,firstPageIndex:i,firstPageLeft:o,lastPageColumn:u,lastPageIndex:i,lastPageLeft:o};else if(n)break;o+=h,i++}return n}function n(t,r,o,i,n){for(var a=0,l=o,u=null,h=0,d=t.getColumnWidths();h<d.length;h++){var c=d[h];if(s(l,c,i,n))return u={leafIndex:r*e.PageColumnCount+a,left:l};l+=c,a++}return null}function a(t,r,o,i,n){for(var a,l=0,u=o,h=0,d=t.getColumnWidths();h<d.length;h++){var c=d[h];s(u,c,i,n)&&(a=r*e.PageColumnCount+l),u+=c,l++}return a}function s(e,t,r,o){return!(r>e+t||r+o<e)}function l(e,t){return u(t)>e}function u(t){var r=t.getPageColumns();return _.isEmpty(r)?0:(r.length-1)*e.PageColumnCount+_.last(r).getColumnWidths().length}function h(r,o){var i=t.getPageIndex(r,e.PageColumnCount);if(!(i>=o.getPageColumns().length)){for(var n=o.getPageColumns()[i],a=o.getPageColumnLeft(n),s=r%e.PageColumnCount,l=n.getColumnWidths(),u=0;u<s;u++)a+=l[u];return{left:a,width:l[s]}}}function d(e,t){var r=h(e.columnIndex,t);return r?e.alignRight?e.visibleWidth>=r.width?r.left+r.width:r.left+e.visibleWidth:e.visibleWidth>=r.width?r.left:r.left+r.width-e.visibleWidth:0}function c(t,r,o,i,n,a){var s=a.getPageColumn(t,r,o,i,n);a.measurePage(s,r,o,i,n,e.MeasureRowSampleCount,t%e.PageColumnCount,1)}function g(e,t,r){var o=r.getColumnWidth(e.firstLeafIndex);return{columnIndex:e.firstLeafIndex,visibleWidth:o-t+e.firstLeafLeft}}r.getVisibleRange=o,r.isColumnMeasured=l,r.getOffset=d,r.remeasureColumn=c,r.getVisibleColumnStart=g}(r=e.ColumnMeasurementUtil||(e.ColumnMeasurementUtil={}));var o;!function(r){function o(e,t,r){var o=i(e,t,r);if(!o)return null;var s=n(o.firstPageRow,o.firstPageIndex,o.firstPageTop,e,t),l=a(o.lastPageRow,o.lastPageIndex,o.lastPageTop,e,t);return{firstLeafIndex:s.leafIndex,firstLeafTop:s.top,lastLeafIndex:l}}function i(e,t,r){for(var o=0,i=0,n=null,a=0,l=r.getPageRows();a<l.length;a++){var u=l[a],h=u.getHeight();if(s(o,h,e,t))n?(n.lastPageRow=u,n.lastPageIndex=i,n.lastPageTop=o):n={firstPageRow:u,firstPageIndex:i,firstPageTop:o,lastPageRow:u,lastPageIndex:i,lastPageTop:o};else if(n)break;o+=h,i++}return n}function n(t,r,o,i,n){for(var a=0,l=o,u=null,h=0,d=t.getRowHeights();h<d.length;h++){var c=d[h];if(s(l,c,i,n))return u={leafIndex:r*e.PageRowCount+a,top:l};l+=c,a++}}function a(t,r,o,i,n){for(var a,l=0,u=o,h=0,d=t.getRowHeights();h<d.length;h++){var c=d[h];s(u,c,i,n)&&(a=r*e.PageRowCount+l),u+=c,l++}return a}function s(e,t,r,o){return!(r>e+t||r+o<e)}function l(e,t){return u(t)>e}function u(t){var r=t.getPageRows();return _.isEmpty(r)?0:(r.length-1)*e.PageRowCount+_.last(r).getRowHeights().length}function h(r,o){var i=t.getPageIndex(r,e.PageRowCount);if(!(i>=o.getPageRows().length)){for(var n=o.getPageRows()[i],a=o.getPageRowTop(n),s=r%e.PageRowCount,l=0;l<s;l++)a+=n.getRowHeights()[l];return{top:a,height:n.getRowHeights()[s]}}}function d(e,t){var r=h(e.rowIndex,t);return r?e.alignBottom?e.visibleHeight>=r.height?r.top+r.height:r.top+e.visibleHeight:e.visibleHeight>=r.height?r.top:r.top+r.height-e.visibleHeight:0}function c(r,o,i,n,a,s,l){for(var u=t.itemRangeToPageRange(n,a,e.PageRowCount),h=0,d=u;h<d.length;h++){var c=d[h];l.measurePage(l.getPageRows()[c.pageIndex],r,o,i,n,s,e.MeasureColumnSampleCount,c.startIndex,c.endIndex-c.startIndex+1)}}function g(e,t,r){var o=r.getRowHeight(e.firstLeafIndex);return{rowIndex:e.firstLeafIndex,visibleHeight:o-t+e.firstLeafTop}}r.getVisibleRange=o,r.isRowMeasured=l,r.getOffset=d,r.remeasureRows=c,r.getVisibleRowStart=g}(o=e.RowMeasurementUtil||(e.RowMeasurementUtil={})),e.PageColumnCount=10,e.MeasureRowSampleCount=50,e.MaxAutoPageColumnMeasure=100;var i=function(){function r(e,t){this.pageColumns=[],this.measureElement=e,this.sizeManager=t}return r.prototype.canAddPageColumn=function(e){return this.pageColumns.length<this.getMaxPageColumnCount(e)},r.prototype.getMaxPageColumnCount=function(t){return Math.ceil(t.getHierarchyLeafCount()/e.PageColumnCount)},r.prototype.getPageColumns=function(){return this.pageColumns},r.prototype.getPageColumnStartIndex=function(t){var r=this.pageColumns.indexOf(t);return r===-1?-1:r*e.PageColumnCount},r.prototype.getPageColumnLeft=function(e){for(var t=0,r=0,o=this.pageColumns;r<o.length;r++){var i=o[r];if(e===i)break;t+=i.getWidth()}return t},r.prototype.getColumnsWidth=function(){for(var e=0,t=0,r=this.pageColumns;t<r.length;t++){e+=r[t].getWidth()}return e},r.prototype.clear=function(){this.pageColumns=[]},r.prototype.measureNextPage=function(t,r,o,i){var n=new e.PivotTablePageColumn;this.getPageColumns().push(n),this.measurePage(n,t,r,o,i,e.MeasureRowSampleCount)},r.prototype.getWidestCellBindingString=function(t,o,i,n,a,s,l){for(var u={item:null,width:-1},h=0;h<s;h++)this.updateWidestItemFromBodyCell(n.getHierarchyLeafAt(h+l),t,i,n,u);if(o)for(var d=n.getFloatingHierarchyLeafCount(),h=0;h<d;h++)this.updateWidestItemFromBodyCell(n.getFloatingHierarchyLeafAt(h),t,i,n,u);var c=i.getApproximateColumnHeaderWidth(t);c>u.width&&(u.item=t,u.width=c);var g;return g=u.item===t?i.getColumnHeaderBinding(u.item,!0):i.getBodyCellBinding(u.item,!0),e.ElementBuilder.build(g,r.measureRequiredStyle)},r.prototype.measurePage=function(t,r,o,i,n,a,s,l){var u=this.getPageColumnStartIndex(t);void 0===s&&(s=0),void 0===l&&(l=Math.min(i.getHierarchyLeafCount()-u,e.PageColumnCount)+s);for(var h=Math.min(o.getHierarchyLeafCount()-n,a),d="",c=o.getFloatingHierarchyItems(),g=0;g<l;g++){var p=i.getHierarchyLeafAt(g+s+u);void 0===(t.getColumnWidths()[g+s]=this.sizeManager.getColumnWidth(p))&&(d+=this.getWidestCellBindingString(p,c,r,o,i,h,n))}if(d){this.measureElement.insertAdjacentHTML("beforeend",d);for(var f=this.measureElement.firstChild,g=0;g<l;g++)void 0===t.getColumnWidths()[g+s]&&(t.getColumnWidths()[g+s]=f.offsetWidth+1,f=f.nextSibling);this.measureElement.innerHTML="",this.adjustItemsWidth(t,r,i,u,s,l)}},r.prototype.updateWidestItemFromBodyCell=function(e,t,r,o,i){var n=o.getIntersection(e,t),a=r.getApproximateBodyCellWidth(n);a>i.width&&(i.item=n,i.width=a)},r.prototype.adjustItemsWidth=function(e,t,r,o,i,n){for(var a=0;a<n;a++){var s=r.getHierarchyLeafAt(a+i+o);void 0===this.sizeManager.getColumnWidth(s)&&this.adjustItemWidth(e,a+i,o,t,r,s)}},r.prototype.adjustItemWidth=function(e,r,o,i,n,a){var s=this,l=t.getAncestorsToMeasure(a,n);_.isEmpty(l)||(this.measureAncestors(l,i),e.getColumnWidths()[r]+=t.getSizeDifference(l,r+o,n,function(e){return s.getColumnWidth(e)}))},r.prototype.measureAncestors=function(t,o){for(var i="",n=0,a=t;n<a.length;n++){var s=a[n],l=o.getColumnHeaderBinding(s.node,!0);i+=e.ElementBuilder.build(l,r.measureRequiredStyle)}this.measureElement.insertAdjacentHTML("beforeend",i);for(var u=this.measureElement.firstChild,h=0,d=t;h<d.length;h++){var s=d[h];s.size=u.offsetWidth+1,u=u.nextSibling}this.measureElement.innerHTML=""},r.prototype.getColumnWidth=function(t,r,o,i,n){return this.getPageColumn(t,r,o,i,n).getColumnWidths()[t%e.PageColumnCount]},r.prototype.setColumnWidth=function(t,r){this.getPageColumn(t).getColumnWidths()[t%e.PageColumnCount]=r},r.prototype.getPageColumn=function(e,t,r,o,i){var n=this.getPageIndex(e);if(t&&n>=this.pageColumns.length)for(var a=n-this.pageColumns.length+1,s=0;s<a;s++)this.measureNextPage(t,r,o,i);return this.pageColumns[n]},r.prototype.getPageIndex=function(r){return t.getPageIndex(r,e.PageColumnCount)},r.measureRequiredStyle={"box-sizing":"border-box",display:"inline-flex"},r}();e.ColumnWidthMeasureManager=i,e.PageRowCount=20,e.MeasureColumnSampleCount=20,e.MaxAutoPageRowMeasure=100;var n=function(){function r(e,t,r,o){this.pageRows=[],this.measureElement=e,this.columnWidthMeasureManager=t,this.rowLevelWidthMeasureManager=r,this.sizeManager=o}return r.prototype.clear=function(){this.pageRows=[],this.clearFloatingRows()},r.prototype.clearFloatingRows=function(){this.floatingPageRow=new e.PivotTablePageRow},r.prototype.ensureLastPageComplete=function(t,r,o,i,n,a){if(0===this.pageRows.length)return-1;var s=this.pageRows.length-1,l=this.pageRows[s],u=l.getRowHeights().length;return u<e.PageRowCount&&this.gotMoreRows(l,r)&&(this.measurePage(l,t,r,o,i,n,a,l.getRowHeights().length-1),l.getRowHeights().length>u)?s:-1},r.prototype.measureNextPage=function(t,r,o,i,n){var a=new e.PivotTablePageRow;this.getPageRows().push(a),this.measurePage(a,t,r,o,i,n,e.MeasureColumnSampleCount)},r.prototype.measureFloatingRows=function(t,r,o,i,n){if(_.isEmpty(this.floatingPageRow.getRowHeights())){var a=r.getFloatingHierarchyItems();if(!_.isEmpty(a)){for(var s=Math.min(o.getHierarchyLeafCount()-n,e.MeasureColumnSampleCount),l="",u=r.getFloatingHierarchyLeafCount(),h=0;h<u;h++){var d=r.getFloatingHierarchyLeafAt(h);this.floatingPageRow.getRowHeights()[h]=this.sizeManager.getRowHeight(d),void 0===this.floatingPageRow.getRowHeights()[h]&&(l+=this.getHeighestCellBindingString(d,t,r,o,s,n,i))}if(l){this.measureElement.insertAdjacentHTML("beforeend",l);for(var c=this.measureElement.firstChild,h=0;h<u;h++)void 0===this.floatingPageRow.getRowHeights()[h]&&(this.floatingPageRow.getRowHeights()[h]=c.offsetHeight,c=c.nextSibling);this.measureElement.innerHTML="",this.adjustItemsHeight(this.floatingPageRow,t,r,0,0,u)}}}},r.prototype.getPageIndex=function(r){return t.getPageIndex(r,e.PageRowCount)},r.prototype.getMeasureRequiredStyle=function(t){return{"box-sizing":"border-box",width:e.PivotTableControl.pixelUnits(t)}},r.prototype.gotMoreRows=function(e,t){return t.getHierarchyLeafCount()-this.getPageRowStartIndex(e)-e.getRowHeights().length>0},r.prototype.measurePage=function(t,r,o,i,n,a,s,l,u){var h=this.getPageRowStartIndex(t);void 0===l&&(l=0),void 0===u&&(u=Math.min(o.getHierarchyLeafCount()-h,e.PageRowCount)-l);for(var d=Math.min(i.getHierarchyLeafCount()-a,s),c="",g=0;g<u;g++){var p=o.getHierarchyLeafAt(g+l+h);void 0===(t.getRowHeights()[g+l]=this.sizeManager.getRowHeight(p))&&(c+=this.getHeighestCellBindingString(p,r,o,i,d,a,n))}if(c){this.measureElement.insertAdjacentHTML("beforeend",c);for(var f=this.measureElement.firstChild,g=0;g<u;g++)void 0===t.getRowHeights()[g+l]&&(t.getRowHeights()[g+l]=f.offsetHeight,f=f.nextSibling);this.measureElement.innerHTML="",this.adjustItemsHeight(t,r,o,h,l,u)}},r.prototype.getHeighestCellBindingString=function(t,r,o,i,n,a,s){for(var l={item:null,width:-1,height:-1},u=0;u<n;u++){var h=i.getHierarchyLeafAt(u+a),d=o.getIntersection(t,h),c=this.columnWidthMeasureManager.getColumnWidth(u+a,r,o,i,s),g=r.getApproximateBodyCellHeight(d,c);g>l.height&&(l.item=d,l.width=c,l.height=g)}var p=this.getItemWidth(t,o),f=r.getApproximateRowHeaderHeight(t,p);f>l.height&&(l.item=t,l.height=f,l.width=p);var m;return m=l.item===t?r.getRowHeaderBinding(l.item,!0):r.getBodyCellBinding(l.item,!0),e.ElementBuilder.build(m,this.getMeasureRequiredStyle(l.width))},r.prototype.getItemWidth=function(e,t){return 0},r.prototype.adjustItemsHeight=function(e,t,r,o,i,n){},r.prototype.getMaxPageRowCount=function(t){return Math.ceil(t.getHierarchyLeafCount()/e.PageRowCount)},r.prototype.getPageRows=function(){return this.pageRows},r.prototype.getFloatingPageRow=function(){return this.floatingPageRow},r.prototype.getFloatingRowHeights=function(){return _.sum(this.floatingPageRow.getRowHeights())},r.prototype.canAddPageRow=function(e){return this.pageRows.length<this.getMaxPageRowCount(e)},r.prototype.getPageRowStartIndex=function(t){if(t===this.floatingPageRow)return 0;var r=this.pageRows.indexOf(t);return r===-1?-1:r*e.PageRowCount},r.prototype.getPageRowTop=function(e){if(e===this.floatingPageRow)return 0;for(var t=0,r=0,o=this.pageRows;r<o.length;r++){var i=o[r];if(e===i)break;t+=i.getHeight()}return t},r.prototype.getRowsHeight=function(){for(var e=0,t=0,r=this.pageRows;t<r.length;t++){e+=r[t].getHeight()}return e},r.prototype.getRowHeight=function(t,r,o,i,n,a){return this.getPageRow(t,r,o,i,a).getRowHeights()[t%e.PageRowCount]},r.prototype.getFloatingRowHeight=function(e){return this.floatingPageRow.getRowHeights()[e]},r.prototype.getPageRow=function(e,t,r,o,i,n){var a=this.getPageIndex(e);if(t&&a>this.pageRows.length)for(var s=a-this.pageRows.length+1,l=0;l<s;l++)this.measureNextPage(t,r,o,i,n);return this.pageRows[a]},r}();e.RowHeightMeasureManager=n;var a=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return __extends(o,r),o.prototype.getItemWidth=function(t,r){return this.rowLevelWidthMeasureManager.getWidth(r.getLevel(t),e.PivotTableHierarchyNavigator.getHeaderSpan(t,r))},o.prototype.adjustItemsHeight=function(e,t,r,o,i,n){for(var a=0;a<n;a++){var s=r.getHierarchyLeafAt(a+i+o);void 0===this.sizeManager.getRowHeight(s)&&this.adjustItemHeight(e,a+i,o,t,r,s)}},o.prototype.adjustItemHeight=function(e,r,o,i,n,a){var s=this,l=t.getAncestorsToMeasure(a,n);_.isEmpty(l)||(this.measureAncestors(l,i,n),e.getRowHeights()[r]+=t.getSizeDifference(l,o+r,n,function(t){return e===s.getFloatingPageRow()?s.getFloatingRowHeight(t):s.getRowHeight(t)}))},o.prototype.measureAncestors=function(t,r,o){for(var i="",n=0,a=t;n<a.length;n++){var s=a[n],l=r.getRowHeaderBinding(s.node,!0);i+=e.ElementBuilder.build(l,this.getMeasureRequiredStyle(this.getItemWidth(s.node,o)))}this.measureElement.insertAdjacentHTML("beforeend",i);for(var u=this.measureElement.firstChild,h=0,d=t;h<d.length;h++){var s=d[h];s.size=u.offsetHeight,u=u.nextSibling}this.measureElement.innerHTML=""},o}(n);e.BlockedRowHeightMeasureManager=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getItemWidth=function(e,t){return this.rowLevelWidthMeasureManager.getLevelWidth(t.getLevel(e))},t.prototype.adjustItemsHeight=function(e,t,r,o,i,n){},t}(n);e.SteppedRowHeightMeasureManager=s;var l=function(){function t(e,t,r,o){this.columnLevelHeights=[],this.measureElement=e,this.columnWidthMeasureManager=t,this.rowLevelWidthMeasureManager=r,this.sizeManager=o}return t.prototype.clear=function(){this.columnLevelHeights=[]},t.prototype.getMeasureRequiredStyle=function(t){return{"box-sizing":"border-box",width:e.PivotTableControl.pixelUnits(t)}},t.prototype.measure=function(t,r,o,i,n,a,s){if(0===this.columnLevelHeights.length){for(var l={done:!1,levels:[],spanningHeaders:[],leafCount:0},u=o.getHierarchyDepth(),h=r.getHierarchyDepth(),d=0;d<u;d++)void 0!==s&&s!==d||(this.columnLevelHeights[d]=this.sizeManager.getColumnLevelHeight(r.getCorner(h-1,d))),l.levels.push({largestItem:null,isHeader:!0,largestItemWidth:-1,largestItemHeight:-1});var c=o.getHierarchyItems();c&&this.getHeighestColumnHeaders(c,l,t,r,o,i,n,a);for(var g=0;g<h;g++)for(var p=0;p<u;p++)if(void 0===this.columnLevelHeights[p]){var f=r.getCorner(g,p),m=this.rowLevelWidthMeasureManager.getLevelWidth(g),v=t.getApproximateCornerCellHeight(f,m);v>l.levels[p].largestItemHeight&&(l.levels[p].isHeader=!1,l.levels[p].largestItem=f,l.levels[p].largestItemHeight=v,l.levels[p].largestItemWidth=m)}for(var y="",C=0,H=l.levels;C<H.length;C++){var w=H[C];if(w.largestItem){var b=this.getMeasureRequiredStyle(w.largestItemWidth);if(w.isHeader){var P=t.getColumnHeaderBinding(w.largestItem,!0);y+=e.ElementBuilder.build(P,b)}else{var P=t.getCornerCellBinding(w.largestItem,!0);y+=e.ElementBuilder.build(P,b)}}}if(y){this.measureElement.insertAdjacentHTML("beforeend",y);for(var M=this.measureElement.firstChild,x=0,S=0,T=l.levels;S<T.length;S++){var w=T[S];w.largestItem&&(void 0!==s&&s!==x||(this.columnLevelHeights[x]=M.offsetHeight),M=M.nextSibling),x++}this.measureElement.innerHTML="",this.adjustLevelHeightsFromSpanningHeaders(l,t,r,o,i)}}},t.prototype.adjustLevelHeightsFromSpanningHeaders=function(t,r,o,i,n){for(var a="",s=0,l=t.spanningHeaders;s<l.length;s++){var u=l[s];if(t.levels[u.levelToAdjust].largestItem){var h=this.getMeasureRequiredStyle(this.getHeaderWidth(u.item,r,o,i,n)),d=r.getColumnHeaderBinding(u.item,!0);a+=e.ElementBuilder.build(d,h)}}if(a){this.measureElement.insertAdjacentHTML("beforeend",a);for(var c=this.measureElement.firstChild,g=0,p=t.spanningHeaders;g<p.length;g++){var u=p[g];t.levels[u.levelToAdjust].largestItem&&(this.adjustLevelFromSpanningHeader(u.item,u.level,u.levelToAdjust,c.offsetHeight,i),c=c.nextSibling)}this.measureElement.innerHTML=""}},t.prototype.adjustLevelFromSpanningHeader=function(e,t,r,o,i){for(var n=0,a=t;a<=r;a++)n+=this.getLevelHeight(a);o>n&&(this.columnLevelHeights[r]+=o-n)},t.prototype.getHeighestColumnHeaders=function(t,r,o,i,n,a,s,l){for(var u=0,h=t;u<h.length;u++){var d=h[u];if(r.done)return;var c=n.isLeaf(d),g=n.getLevel(d),p=e.PivotTableHierarchyNavigator.getHeaderSpan(d,n),f=e.PivotTableHierarchyNavigator.getLastLeafIndex(d,n)>=s;if(f)if(1===p){if(void 0===this.columnLevelHeights[g]){var m=this.getHeaderWidth(d,o,i,n,a),v=o.getApproximateColumnHeaderHeight(d,m);v>r.levels[g].largestItemHeight&&(r.levels[g].largestItem=d,r.levels[g].largestItemHeight=v,r.levels[g].largestItemWidth=m)}}else r.spanningHeaders.push({item:d,level:g,levelToAdjust:p+g-1});var y=n.getChildren(d);y&&this.getHeighestColumnHeaders(y,r,o,i,n,a,s,l),c&&f&&r.leafCount++,r.leafCount===l&&(r.done=!0)}},t.prototype.getHeadersHeight=function(){for(var e=0,t=0,r=this.columnLevelHeights;t<r.length;t++){
e+=r[t]}return e},t.prototype.getLevelTop=function(e){for(var t=0,r=0;r<e;r++)t+=this.columnLevelHeights[r];return t},t.prototype.getLevelHeight=function(e){return this.columnLevelHeights[e]},t.prototype.getHeaderWidth=function(t,r,o,i,n){for(var a=e.PivotTableHierarchyNavigator.getFirstLeafIndex(t,i),s=e.PivotTableHierarchyNavigator.getLastLeafIndex(t,i),l=0,u=a;u<=s;u++)l+=this.columnWidthMeasureManager.getColumnWidth(u,r,o,i,n);return l},t}();e.ColumnLevelHeightMeasureManager=l;var u=function(){function t(e,t){this.rowLevelWidths=[],this.measureElement=e,this.sizeManager=t}return t.prototype.clear=function(){this.rowLevelWidths=[]},t.prototype.measure=function(r,o,i,n,a,s){if(0===this.rowLevelWidths.length||void 0!==s){for(var l={done:!1,levels:[],spanningHeaders:[],leafCount:0},u=o.getHierarchyDepth(),h=i.getHierarchyDepth(),d=0;d<u;d++)void 0!==s&&s!==d||(this.rowLevelWidths[d]=this.sizeManager.getRowLevelWidth(o.getCorner(d,h-1))),l.levels.push({largestItem:null,isHeader:!0,largestItemWidth:-1,largestItemHeight:-1});this.getWidestRowHeaders(o.getHierarchyItems(),l,r,o,n,a);var c=o.getFloatingHierarchyItems();_.isEmpty(c)||(l.done=!1,l.leafCount=0,this.getWidestRowHeaders(c,l,r,o,-1,o.getFloatingHierarchyLeafCount()));for(var g=0;g<h;g++)for(var p=0;p<u;p++)if(void 0===this.rowLevelWidths[p]){var f=o.getCorner(p,g),m=r.getApproximateCornerCellWidth(f);m>l.levels[p].largestItemWidth&&(l.levels[p].isHeader=!1,l.levels[p].largestItem=f,l.levels[p].largestItemWidth=m)}for(var v="",y=0,C=l.levels;y<C.length;y++){var H=C[y];if(H.largestItem)if(H.isHeader){var w=r.getRowHeaderBinding(H.largestItem,!0);v+=e.ElementBuilder.build(w,t.measureRequiredStyles)}else{var w=r.getCornerCellBinding(H.largestItem,!0);v+=e.ElementBuilder.build(w,t.measureRequiredStyles)}}if(v){this.measureElement.insertAdjacentHTML("beforeend",v);for(var b=this.measureElement.firstChild,P=0,M=0,x=l.levels;M<x.length;M++){var H=x[M];H.largestItem&&(void 0!==s&&s!==P||(this.rowLevelWidths[P]=b.offsetWidth+1),b=b.nextSibling),P++}this.measureElement.innerHTML="",this.adjustLevelWidthsFromSpanningHeaders(l,r,o)}}},t.prototype.adjustLevelWidthsFromSpanningHeaders=function(r,o,i){for(var n="",a=0,s=r.spanningHeaders;a<s.length;a++){var l=s[a];if(r.levels[l.levelToAdjust].largestItem){var u=o.getRowHeaderBinding(l.item,!0);n+=e.ElementBuilder.build(u,t.measureRequiredStyles)}}if(n){this.measureElement.insertAdjacentHTML("beforeend",n);for(var h=this.measureElement.firstChild,d=0,c=r.spanningHeaders;d<c.length;d++){var l=c[d];r.levels[l.levelToAdjust].largestItem&&(this.adjustLevelWidthFromSpanningHeader(l.item,l.level,l.levelToAdjust,h.offsetWidth,i),h=h.nextSibling)}this.measureElement.innerHTML=""}},t.prototype.adjustLevelWidthFromSpanningHeader=function(e,t,r,o,i){for(var n=0,a=t;a<=r;a++)n+=this.getLevelWidth(a);o>n&&(this.rowLevelWidths[r]+=o-n)},t.prototype.getWidestRowHeaders=function(t,r,o,i,n,a){for(var s=0,l=t;s<l.length;s++){var u=l[s];if(r.done)return;var h=i.isLeaf(u),d=i.getLevel(u),c=e.PivotTableHierarchyNavigator.getHeaderSpan(u,i),g=e.PivotTableHierarchyNavigator.getLastLeafIndex(u,i)>=n;if(g)if(1===c){if(void 0===this.rowLevelWidths[d]){var p=o.getApproximateRowHeaderWidth(u);p>r.levels[d].largestItemWidth&&(r.levels[d].largestItem=u,r.levels[d].largestItemWidth=p)}}else r.spanningHeaders.push({item:u,level:d,levelToAdjust:c+d-1});var f=i.getChildren(u);f&&this.getWidestRowHeaders(f,r,o,i,n,a),h&&g&&r.leafCount++,r.leafCount===a&&(r.done=!0)}},t.prototype.getHeadersWidth=function(){for(var e=0,t=0,r=this.rowLevelWidths;t<r.length;t++){e+=r[t]}return e},t.prototype.getLevelLeft=function(e){for(var t=0,r=0;r<e;r++)t+=this.rowLevelWidths[r];return t},t.prototype.getLevelWidth=function(e){return this.rowLevelWidths[e]},t.prototype.setLevelWidth=function(e,t){this.rowLevelWidths[e]=t},t.prototype.getWidth=function(e,t){for(var r=0,o=e;o<e+t;o++)r+=this.getLevelWidth(o);return r},t.measureRequiredStyles={"box-sizing":"border-box",display:"inline-flex"},t}();e.BlockedRowLevelWidthMeasureManager=u;var h=function(){function t(e,t){this.measureElement=e,this.sizeManager=t}return t.prototype.clear=function(){this.width=void 0},t.prototype.getHeaderBindingString=function(t,r){var o=r.getRowHeaderBinding(t,!0);return e.ElementBuilder.build(o,u.measureRequiredStyles)},t.prototype.measure=function(t,r,o,i,n,a){if((void 0===this.width||void 0!==a)&&(this.width=this.sizeManager.getRowLevelWidth(r.getCorner(0,o.getHierarchyDepth()-1)),void 0===this.width)){for(var s="",l=Math.min(r.getHierarchyLeafCount()-i,n),h=0;h<l;h++)s+=this.getHeaderBindingString(r.getHierarchyLeafAt(h+i),t);var d=r.getFloatingHierarchyItems();if(!_.isEmpty(d))for(var c=r.getFloatingHierarchyLeafCount(),h=0;h<c;h++)s+=this.getHeaderBindingString(r.getFloatingHierarchyLeafAt(h),t);if(r.getHierarchyDepth()>0)for(var h=0;h<o.getHierarchyDepth();h++){var g=r.getCorner(0,h),p=t.getCornerCellBinding(g,!0);s+=e.ElementBuilder.build(p,u.measureRequiredStyles)}this.measureElement.insertAdjacentHTML("beforeend",s);for(var f=this.measureElement.firstChild,m=0;f;)m=Math.max(m,f.offsetWidth+1),f=f.nextSibling;this.measureElement.innerHTML="",this.width=m}},t.prototype.getHeadersWidth=function(){return this.width},t.prototype.getLevelWidth=function(e){return this.width},t.prototype.setLevelWidth=function(e,t){this.width=t},t.prototype.getLevelLeft=function(e){return 0},t}();e.SteppedRowLevelWidthMeasureManager=h}(t=e.pivotTable||(e.pivotTable={}))}(t=e.controls||(e.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){var r;!function(t){var r,o=e.shapes.Rect.isIntersecting;!function(e){function t(e,r,o){var i=o.getParent(e);i&&t(i,r,o),r.push(o.getIndex(e))}function r(e){for(var t="",r=0,o=e;r<o.length;r++){t+=o[r]+"_"}return t}function o(e,t){if(t===e.length){var r=e[t-1].currentPosition;e.push({startItem:null,startPosition:r,currentPosition:r})}}e.getHeaderIndices=t,e.getHeaderKey=r,e.ensureLevelContext=o}(r=t.HeaderRendererUtil||(t.HeaderRendererUtil={}));var i=function(){function e(e,t,r,o,i,n,a){this.element=e,this.rowHeightMeasureManager=t,this.rowLevelWidthMeasureManager=r,this.rowHeightResizeHandler=o,this.clickHandler=i,this.contextMenuHandler=n,this.interactionHandler=a}return e.prototype.clear=function(){this.element.innerHTML="",this.headers={}},e.prototype.getHierarchyLeafAt=function(e,t,r){return e?r.getFloatingHierarchyLeafAt(t):r.getHierarchyLeafAt(t)},e.prototype.removeUnusedHeaders=function(e){for(var t=this.getUnusedHeaders(e),r=0,o=t;r<o.length;r++){var i=o[r];this.element.removeChild(this.getHeader(i).getElement()),this.removeHeader(i)}},e.prototype.addHeader=function(e){var r=new t.PivotTableHeader;return this.headers[e]=r,r},e.prototype.removeHeader=function(e){delete this.headers[e]},e.prototype.getHeader=function(e){return this.headers[e]},e.prototype.getOrAddHeader=function(e){var t=this.getHeader(e);return t||(t=this.addHeader(e)),t},e.prototype.getUnusedHeaders=function(e){var t=[];for(var r in this.headers)e[r]||t.push(r);return t},e}();t.RowHeaderRenderer=i;var n=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.update=function(e,t,r,o,i,n){var a=this.getRenderingContext(t,r,o,n);a&&(e&&this.render(e,t,0,n.getIndex(a.levelsContext[0].startItem),a,r,i,n),this.removeUnusedHeaders(a.addedHeaders))},o.prototype.getRenderingContext=function(e,r,o,i){var n;if(n=e?{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:i.getFloatingHierarchyLeafCount()-1}:t.RowMeasurementUtil.getVisibleRange(r,o,this.rowHeightMeasureManager),!n)return null;var a=this.getHierarchyLeafAt(e,n.firstLeafIndex,i),s=[],l=n.firstLeafTop;for(s.push({startItem:a,currentPosition:l,startPosition:l});a;){var u=s[0];if(a=i.getParent(a)){var h=void 0;h=i.isLastItem(u.startItem,i.getChildren(a))&&u.currentPosition-r<0?u.currentPosition:r,s.unshift({startItem:a,currentPosition:h,startPosition:h})}}return{currentLeafIndex:n.firstLeafIndex,lastVisibledLeafIndex:n.lastLeafIndex,levelsContext:s,addedHeaders:{},done:!1}},o.prototype.render=function(e,t,r,o,i,n,a,s){for(var l=e.length,u=0,h=o;h<l&&(u+=this.renderHeader(e[h],e,t,r,i,n,a,s),!i.done);h++);return u},o.prototype.renderHeader=function(e,o,i,n,a,s,l,u){var h=[];r.getHeaderIndices(e,h,u);var d=r.getHeaderKey(h),c=this.getOrAddHeader(d);a.addedHeaders[d]=c,c.build(this.element,l.getRowHeaderBinding(e,!1),e,null,this.rowHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler),c.setLeft(this.rowLevelWidthMeasureManager.getLevelLeft(u.getLevel(e)));var g;if(r.ensureLevelContext(a.levelsContext,n),u.isLeaf(e))if(g=i?this.rowHeightMeasureManager.getFloatingRowHeight(a.currentLeafIndex):this.rowHeightMeasureManager.getRowHeight(a.currentLeafIndex),c.setTop(a.levelsContext[n].currentPosition),c.setHeight(g),a.currentLeafIndex===a.lastVisibledLeafIndex)a.done=!0;else{a.currentLeafIndex++;for(var p=n;p<a.levelsContext.length;p++)a.levelsContext[p].currentPosition+=g}else{var f=void 0;f=a.levelsContext[n].startItem===e?u.getIndex(a.levelsContext[n+1].startItem):0;var m=this.render(u.getChildren(e),i,n+1,f,a,s,l,u);c.setTop(a.levelsContext[n].currentPosition),g=a.levelsContext[n].startItem===e&&a.levelsContext[n].startPosition===s?m+a.levelsContext[n+1].startPosition-s:m,c.setHeight(g),a.levelsContext[n].currentPosition+=g}return c.setWidth(this.rowLevelWidthMeasureManager.getWidth(u.getLevel(e),t.PivotTableHierarchyNavigator.getHeaderSpan(e,u))),g},o.prototype.getCellAt=function(e){var t=this.getHeader(r.getHeaderKey(e));return t.getElement()},o}(i);t.BlockedRowHeaderRenderer=n;var a=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.update=function(e,t,r,o,i,n){var a=this.getRenderingContext(t,r,o,n);return a?(this.render(t,a,i,n),void this.removeUnusedHeaders(a.addedHeaders)):null},o.prototype.clear=function(){this.element.innerHTML="",this.headers={}},o.prototype.render=function(e,t,o,i){for(var n=t.startTop,a=t.currentLeafIndex;a<=t.lastVisibledLeafIndex;a++){var s=[],l=this.getHierarchyLeafAt(e,a,i);r.getHeaderIndices(l,s,i);var u=r.getHeaderKey(s),h=this.getOrAddHeader(u);h.build(this.element,o.getRowHeaderBinding(l,!1),l,null,this.rowHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler);var d=void 0;d=e?this.rowHeightMeasureManager.getFloatingRowHeight(a):this.rowHeightMeasureManager.getRowHeight(a),h.setTop(n),h.setHeight(d),t.addedHeaders[u]=h,h.setWidth(this.rowLevelWidthMeasureManager.getHeadersWidth()),n+=d}},o.prototype.getRenderingContext=function(e,r,o,i){var n;return n=e?{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:i.getFloatingHierarchyLeafCount()-1}:t.RowMeasurementUtil.getVisibleRange(r,o,this.rowHeightMeasureManager),n?{currentLeafIndex:n.firstLeafIndex,lastVisibledLeafIndex:n.lastLeafIndex,startTop:n.firstLeafTop,addedHeaders:{},done:!1}:null},o.prototype.getCellAt=function(e){var t=this.getHeader(r.getHeaderKey(e));return t.getElement()},o}(i);t.SteppedRowHeaderRenderer=a;var s=function(){function e(e,t,r,o,i,n,a){this.element=e,this.columnWidthMeasureManager=t,this.columnLevelHeightMeasureManager=r,this.columnWidthResizeHandler=o,this.clickHandler=i,this.contextMenuHandler=n,this.interactionHandler=a}return e.prototype.clear=function(){this.element.innerHTML="",this.headers={}},e.prototype.update=function(e,t,r,o){var i=this.getRenderingContext(e,t,o);if(i){var n=o.getHierarchyItems();n&&this.render(n,0,o.getIndex(i.levelsContext[0].startItem),i,e,r,o),this.removeUnusedHeaders(i.addedHeaders)}},e.prototype.getRenderingContext=function(e,r,o){var i=t.ColumnMeasurementUtil.getVisibleRange(e,r,this.columnWidthMeasureManager);if(!i)return null;var n=o.getHierarchyLeafAt(i.firstLeafIndex),a=[],s=i.firstLeafLeft;for(a.push({startItem:n,currentPosition:s,startPosition:s});n;){var l=a[0];if(n=o.getParent(n)){var u=void 0;u=o.isLastItem(l.startItem,o.getChildren(n))&&l.currentPosition-e<0?l.currentPosition:e,a.unshift({startItem:n,currentPosition:u,startPosition:u})}}return{currentLeafIndex:i.firstLeafIndex,lastVisibledLeafIndex:i.lastLeafIndex,levelsContext:a,addedHeaders:{},done:!1}},e.prototype.removeUnusedHeaders=function(e){for(var t=this.getUnusedHeaders(e),r=0,o=t;r<o.length;r++){var i=o[r];this.element.removeChild(this.getHeader(i).getElement()),this.removeHeader(i)}},e.prototype.render=function(e,t,r,o,i,n,a){for(var s=e.length,l=0,u=r;u<s&&(l+=this.renderHeader(e[u],e,t,o,i,n,a),!o.done);u++);return l},e.prototype.getHeight=function(e,t){for(var r=0,o=e;o<e+t;o++)r+=this.columnLevelHeightMeasureManager.getLevelHeight(o);return r},e.prototype.renderHeader=function(e,o,i,n,a,s,l){var u=[];r.getHeaderIndices(e,u,l);var h=r.getHeaderKey(u),d=this.getOrAddHeader(h);n.addedHeaders[h]=d,d.build(this.element,s.getColumnHeaderBinding(e,!1),e,this.columnWidthResizeHandler,null,this.clickHandler,this.contextMenuHandler,this.interactionHandler),d.setTop(this.columnLevelHeightMeasureManager.getLevelTop(l.getLevel(e)));var c;if(r.ensureLevelContext(n.levelsContext,i),l.isLeaf(e))if(c=this.columnWidthMeasureManager.getColumnWidth(n.currentLeafIndex),d.setLeft(n.levelsContext[i].currentPosition),d.setWidth(c),n.currentLeafIndex===n.lastVisibledLeafIndex)n.done=!0;else{n.currentLeafIndex++;for(var g=i;g<n.levelsContext.length;g++)n.levelsContext[g].currentPosition+=c}else{var p=void 0;p=n.levelsContext[i].startItem===e?l.getIndex(n.levelsContext[i+1].startItem):0;var f=this.render(l.getChildren(e),i+1,p,n,a,s,l);d.setLeft(n.levelsContext[i].currentPosition),c=n.levelsContext[i].startItem===e&&n.levelsContext[i].startPosition===a?f+n.levelsContext[i+1].startPosition-a:f,d.setWidth(c),n.levelsContext[i].currentPosition+=c}return d.setHeight(this.getHeight(l.getLevel(e),t.PivotTableHierarchyNavigator.getHeaderSpan(e,l))),c},e.prototype.addHeader=function(e){var r=new t.PivotTableHeader;return this.headers[e]=r,r},e.prototype.removeHeader=function(e){delete this.headers[e]},e.prototype.getHeader=function(e){return this.headers[e]},e.prototype.getOrAddHeader=function(e){var t=this.getHeader(e);return t||(t=this.addHeader(e)),t},e.prototype.getUnusedHeaders=function(e){var t=[];for(var r in this.headers)e[r]||t.push(r);return t},e.prototype.getCellAt=function(e){var t=this.getHeader(r.getHeaderKey(e));return t.getElement()},e}();t.ColumnHeaderRenderer=s;var l=function(){function e(e,t,r,o,i,n,a){this.element=e,this.columnWidthMeasureManager=t,this.rowHeightMeasureManager=r,this.clickHandler=o,this.contextMenuHandler=i,this.interactionHandler=n,this.workScheduler=a}return e.prototype.removeRowPages=function(e){for(var t=0;t<this.columnWidthMeasureManager.getPageColumns().length;t++){var r=this.getPage(e,t);r&&(this.element.removeChild(r.getElement()),this.removePage(e,t))}},e.prototype.update=function(e,t,r,o,i,n){for(var a=0,s=0,l=0,u=this.columnWidthMeasureManager.getPageColumns();l<u.length;l++){var h=u[l],d=0,c=0,g=h.getWidth(),p=void 0;p=t?[this.rowHeightMeasureManager.getFloatingPageRow()]:this.rowHeightMeasureManager.getPageRows();for(var f=0,m=p;f<m.length;f++){var v=m[f],y=v.getHeight();if(this.rectsOverlap(a,d,g,y,e.left,e.top,e.width,e.height))this.addBodyPage(e,c,s,a,d,g,y,v,h,t,r,o,i,n);else{this.getPage(c,s)&&this.removeBodyPageAsync(e,c,s,a,d,g,y)}d+=y,c++}a+=g,s++}},e.prototype.clear=function(){this.element.innerHTML="",this.pages={}},e.prototype.resizeColumn=function(e){var r=t.MeasureUtil.getPageIndex(e,t.PageColumnCount),o=e%t.PageColumnCount;for(var i in this.pages){var n=this.pages[i],a=this.columnWidthMeasureManager.getPageColumns()[n.columnIndex];n.columnIndex===r?n.resizeColumn(o,a):n.columnIndex>r&&(n.getElement().style.left=t.PivotTableControl.pixelUnits(this.columnWidthMeasureManager.getPageColumnLeft(a)))}},e.prototype.resizRows=function(e,r){var o=t.MeasureUtil.itemRangeToPageRange(e,r,t.PageRowCount);for(var i in this.pages)for(var n=this.pages[i],a=0,s=o;a<s.length;a++){var l=s[a];if(l.pageIndex===n.rowIndex){this.resizePageRows(n,this.rowHeightMeasureManager.getPageRows()[l.pageIndex],l.startIndex,l.endIndex);break}}for(var i in this.pages){var n=this.pages[i],u=this.rowHeightMeasureManager.getPageRows()[n.rowIndex];n.getElement().style.top=t.PivotTableControl.pixelUnits(this.rowHeightMeasureManager.getPageRowTop(u))}},e.prototype.resizePageRows=function(e,r,o,i){var n=e.getElement();if(n){for(var a=n.firstChild;a;)this.resizeCellsHeight(a,r,o,i),a=a.nextSibling;n.style.height=t.PivotTableControl.pixelUnits(r.getHeight())}},e.prototype.resizeCellsHeight=function(e,r,o,i){var n=e.firstChild;if(n){for(var a=0;a<o;a++)if(n=n.nextSibling,!n)return;for(var a=o;a<=i;a++)if(n.style.height=t.PivotTableControl.pixelUnits(r.getRowHeights()[a]),n=n.nextSibling,!n)return}},e.prototype.addPage=function(e,r){var o=new t.PivotTableBodyPage(e,r);return this.pages[this.getPageKey(e,r)]=o,o},e.prototype.removePage=function(e,t){delete this.pages[this.getPageKey(e,t)]},e.prototype.getPage=function(e,t){return this.pages[this.getPageKey(e,t)]},e.prototype.getPageKey=function(e,t){return e.toString()+"_"+t.toString()},e.prototype.addBodyPage=function(e,t,r,o,i,n,a,s,l,u,h,d,c,g){var p=this,f=function(){if(p.rectsOverlap(o,i,n,a,e.left,e.top,e.width,e.height)){var g=p.getPage(t,r);if(!g){var f=p.rowHeightMeasureManager.getPageRowStartIndex(s),m=p.columnWidthMeasureManager.getPageColumnStartIndex(l);f!==-1&&m!==-1&&(g=p.addPage(t,r),g.build(p.element,f,m,p.rowHeightMeasureManager,p.columnWidthMeasureManager,s,l,u,d,c,h,p.clickHandler,p.contextMenuHandler,p.interactionHandler))}}};g?this.workScheduler.scheduleAnimationFrameTask(f):f()},e.prototype.removeBodyPageAsync=function(e,t,r,o,i,n,a){var s=this;this.workScheduler.scheduleAnimationFrameTask(function(){if(!s.rectsOverlap(o,i,n,a,e.left,e.top,e.width,e.height)){var l=s.getPage(t,r);l&&(s.element.removeChild(l.getElement()),s.removePage(t,r))}})},e.prototype.rectsOverlap=function(e,t,r,i,n,a,s,l){return o({left:e,top:t,width:r,height:i},{left:n,top:a,width:s,height:l})},e.prototype.getCellAt=function(e){var r=this.getPage(Math.floor(e.rowIndex/t.PageRowCount),Math.floor(e.columnIndex/t.PageColumnCount));return r.getCellAt(e.rowIndex%t.PageRowCount,e.columnIndex%t.PageColumnCount)},e}();t.BodyCellRenderer=l;var u=function(){function e(e,t,r,o,i,n,a,s){this.element=e,this.columnLevelHeightMeasureManager=t,this.rowLevelWidthMeasureManager=r,this.columnLevelHeightResizeHandler=o,this.rowLevelWidthResizeHandler=i,this.clickHandler=n,this.contextMenuHandler=a,this.interactionHandler=s,this.headers={}}return e.prototype.update=function(e,t,r){for(var o=t.getHierarchyDepth(),i=r.getHierarchyDepth(),n=0;n<o;n++)for(var a=0;a<i;a++)this.renderHeader(n,a,e,t)},e.prototype.clear=function(){this.element.innerHTML="",this.headers={}},e.prototype.renderHeader=function(e,t,o,i){var n=i.getCorner(e,t),a=r.getHeaderKey([e,t]),s=this.getOrAddHeader(a),l=o.getCornerCellBinding(n,!1);s.build(this.element,l,n,this.rowLevelWidthResizeHandler,this.columnLevelHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler);var u=this.rowLevelWidthMeasureManager.getLevelWidth(e),h=this.rowLevelWidthMeasureManager.getLevelLeft(e),d=this.columnLevelHeightMeasureManager.getLevelHeight(t),c=this.columnLevelHeightMeasureManager.getLevelTop(t);s.setHeight(d),s.setWidth(u),s.setTop(c),s.setLeft(h)},e.prototype.addHeader=function(e){var r=new t.PivotTableHeader;return this.headers[e]=r,r},e.prototype.getHeader=function(e){return this.headers[e]},e.prototype.getOrAddHeader=function(e){return this.getHeader(e)||this.addHeader(e)},e.prototype.getCellAt=function(e){var t=this.headers[r.getHeaderKey([e.rowLevel,e.columnLevel])];return t.getElement()},e}();t.CornerRenderer=u}(r=t.pivotTable||(t.pivotTable={}))}(t=e.controls||(e.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r;!function(r){var o=jsCommon.BrowserUtils,i=jsCommon.FocusManagerFocusEventName,n=e.visuals.controls.internal.TablixUtils.PivotTableAttributeDelimiter;r.ScrollbarWidth=9;var a,s="<div style='position:relative' tabindex='0' aria-label='Grid'><div class='innerContainer' style='position:absolute;left:0;top:0;right:0;bottom:0'><div class='corner' ></div><div class='columnHeaders' style='position:absolute;overflow:auto;right:0;top:0;-ms-overflow-style:none'><div></div></div><div class='rowHeaders' style='position:absolute;overflow:auto;left:0;bottom:0;-ms-overflow-style:none'><div></div></div><div class='bodyCells' style='position:absolute;overflow:auto;left:0;top:0;right:0;bottom:0;-ms-overflow-style:none;box-sizing:border-box'><div style='position:absolute;overflow:hidden'></div></div><div class='floatingRowHeader' style='position:absolute;left:0'></div><div class='floatingBodyCells' style='position:absolute;overflow:auto;right:0;-ms-overflow-style:none'><div></div></div></div><div class='measureElement' style='position:absolute;left:0;top:0;visibility:hidden'></div></div>";!function(e){e[e.Incremental=0]="Incremental",e[e.ClearRendering=1]="ClearRendering",e[e.ClearMeasurement=2]="ClearMeasurement"}(a=r.PivotTableRenderingMode||(r.PivotTableRenderingMode={}));var l=function(){function n(t,o,n){var a=this;this.workScheduler=new e.WorkScheduler,this.sizeManager=o,t.insertAdjacentHTML("beforeend",s),this.element=t.lastChild,this.innerContainer=this.element.querySelector(".innerContainer"),this.measureElement=this.element.querySelector(".measureElement"),this.cornerContainer=this.element.querySelector(".corner"),this.cornerContainer.setAttribute("drag-resize-disabled","true"),this.columnHeaderContainer=this.element.querySelector(".columnHeaders"),this.innerColumnHeaderContainer=this.columnHeaderContainer.firstChild,this.innerColumnHeaderContainer.setAttribute("drag-resize-disabled","true"),this.rowHeaderContainer=this.element.querySelector(".rowHeaders"),this.innerRowHeaderContainer=this.rowHeaderContainer.firstChild,this.innerRowHeaderContainer.setAttribute("drag-resize-disabled","true"),this.bodyCellContainer=this.element.querySelector(".bodyCells"),this.innerBodyCellContainer=this.bodyCellContainer.firstChild,this.floatingRowHeaderContainer=this.element.querySelector(".floatingRowHeader"),this.floatingBodyCellContainer=this.element.querySelector(".floatingBodyCells"),this.innerFloatingBodyCellContainer=this.floatingBodyCellContainer.firstChild,this.options=n,this.initializeContainersForScrolling(this.options.scrollingEnabled),this.initializeScrollbars(),this.options.whitespaceClickHandler&&this.innerContainer.addEventListener("click",function(e){return a.onClick(e)}),this.options.columnResizingEnabled&&(this.columnWidthResizeHandler=new r.ColumnWidthResizeHandler(this)),this.options.rowLevelResizingEnabled&&(this.rowLevelWidthResizeHandler=new r.RowLevelWidthResizeHandler(this)),$(this.element).on(i,function(){return a.onFocus()}),this.element.addEventListener("blur",function(e){return a.onBlur(e)}),this.element.addEventListener("keydown",function(e){return a.onKeyDown(e)}),this.focusManager=new r.PivotTableFocusManager(function(){return a.onFocusChanged()}),this.setSteppedLayout(!1)}return n.prototype.onFocus=function(){this.hasFocus=!0,this.focusManager.initialize()},n.prototype.onBlur=function(e){this.hasFocus=!1,this.clearFocusStyle()},n.prototype.onKeyDown=function(e){if(this.hasFocus){var t=e.code||e.key,r=e.shiftKey,i=o.isCtrlOrMeta(e);return this.hasFocus&&"Tab"===t?(e.preventDefault(),void e.stopPropagation()):"Escape"===t||"Esc"===t?void(this.hasFocus=!1):"ArrowRight"===t||"Right"===t?(e.stopPropagation(),e.preventDefault(),void(r?this.options.rowHeaderExpandCollapseHandler&&this.focusManager.CurrentFocus.rowHeader&&1===this.rowNavigator.getExpansionState(this.focusManager.CurrentFocus.item)&&this.options.rowHeaderExpandCollapseHandler(this.focusManager.CurrentFocus.item,!1):this.focusManager.moveFocus("right"))):"ArrowLeft"===t||"Left"===t?(e.stopPropagation(),e.preventDefault(),void(r?this.options.rowHeaderExpandCollapseHandler&&this.focusManager.CurrentFocus.rowHeader&&0===this.rowNavigator.getExpansionState(this.focusManager.CurrentFocus.item)&&this.options.rowHeaderExpandCollapseHandler(this.focusManager.CurrentFocus.item,!0):this.focusManager.moveFocus("left"))):"ArrowUp"===t||"Up"===t?(e.stopPropagation(),e.preventDefault(),void this.focusManager.moveFocus("up")):"ArrowDown"===t||"Down"===t?(e.stopPropagation(),e.preventDefault(),void this.focusManager.moveFocus("down")):"F10"===t&&r?void(i||(e.preventDefault(),e.stopPropagation(),this.showContextMenuForFocus(e))):"Enter"===t||"Space"===t||"Spacebar"===t||" "===t?(e.preventDefault(),e.stopPropagation(),void this.selectFocus(e)):("KeyC"===t||"c"===t)&&i&&r?(e.stopPropagation(),e.preventDefault(),void this.options.whitespaceClickHandler(null)):void 0}},n.prototype.notifyVisual=function(e){e.bodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item):e.columnHeader&&this.options.columnHeaderFocusHandler?this.options.columnHeaderFocusHandler(e.item):e.rowHeader&&this.options.rowHeaderFocusHandler?this.options.rowHeaderFocusHandler(e.item):e.cornerCell&&this.options.cornerCellFocusHandler?this.options.cornerCellFocusHandler(e.item):e.floatingBodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item):void 0!==e.floatingRowHeader&&this.options.rowHeaderFocusHandler&&this.options.rowHeaderFocusHandler(e.item)},n.prototype.onFocusChanged=function(){var e=this,t=this.focusManager.CurrentFocus;this.notifyVisual(t),this.clearFocusStyle();var o,i,n,s,l=this.getBodyCellViewPort();if(t.bodyCell?(o=t.bodyCell.rowIndex,n=t.bodyCell.columnIndex):t.rowHeader?o=r.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(t.item,this.rowNavigator):t.columnHeader?n=r.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(t.item,this.columnNavigator):t.floatingBodyCell&&(n=t.floatingBodyCell.columnIndex),void 0!==o&&this.rowScrollbar.visible){var u=r.RowMeasurementUtil.getVisibleRange(l.top,l.height,this.rowHeightMeasureManager);u&&(o<=u.firstLeafIndex?i={rowIndex:o,visibleHeight:Number.MAX_VALUE,alignBottom:!1}:o>=u.lastLeafIndex&&(i={rowIndex:o,visibleHeight:Number.MAX_VALUE,alignBottom:!0}))}if(void 0!==n&&this.columnScrollbar.visible){var h=r.ColumnMeasurementUtil.getVisibleRange(l.left,l.width,this.columnWidthMeasureManager);h&&(n<=h.firstLeafIndex?s={columnIndex:n,visibleWidth:Number.MAX_VALUE,alignRight:!1}:n>=h.lastLeafIndex&&(s={columnIndex:n,visibleWidth:Number.MAX_VALUE,alignRight:!0}))}var d=function(){e.rebuildBodyPagesSync(),e.focusedElement=e.getFocusedCell(t),e.setFocusStyle()};i||s?this.makeVisible(a.Incremental,i,s,d):d()},n.prototype.setFocusStyle=function(){this.focusedElement&&this.focusedElement.classList.add("hasFocus")},n.prototype.clearFocusStyle=function(){this.focusedElement&&this.focusedElement.classList.remove("hasFocus")},n.prototype.getFocusedCell=function(e){if(e.bodyCell)return this.bodyCellRenderer.getCellAt(e.bodyCell);if(e.columnHeader)return this.columnHeaderRenderer.getCellAt(e.columnHeader);if(e.rowHeader){var t=[];return r.HeaderRendererUtil.getHeaderIndices(e.item,t,this.rowNavigator),this.rowHeaderRenderer.getCellAt(t)}return e.cornerCell?this.cornerRenderer.getCellAt(e.cornerCell):e.floatingBodyCell?this.floatingBodyCellRenderer.getCellAt(e.floatingBodyCell):void 0!==e.floatingRowHeader?this.floatingRowHeaderRenderer.getCellAt([e.floatingRowHeader]):void 0},n.prototype.getCurrentFocusBoundingRect=function(){if(this.focusedElement){var e=this.focusedElement.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}}return{top:0,left:0,width:0,height:0}},n.prototype.selectFocus=function(e){var t=this.focusManager.CurrentFocus,r=t.item,o=this.getCurrentFocusBoundingRect(),i=new MouseEvent("click",{clientX:o.left,clientY:o.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey});t.bodyCell||t.floatingBodyCell?this.options.bodyCellClickHandler&&this.options.bodyCellClickHandler(r,i):t.rowHeader||void 0!==t.floatingRowHeader?this.options.rowHeaderClickHandler&&this.options.rowHeaderClickHandler(r,i):t.columnHeader?this.options.columnHeaderClickHandler&&this.options.columnHeaderClickHandler(r,i):t.cornerCell&&this.options.cornerCellClickHandler&&this.options.cornerCellClickHandler(r,i)},n.prototype.showContextMenuForFocus=function(e){var t=this.focusManager.CurrentFocus,r=t.item,o=this.getCurrentFocusBoundingRect(),i=new MouseEvent("contextmenu",{clientX:o.left,clientY:o.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey});t.bodyCell||t.floatingBodyCell?this.options.bodyCellContextMenuHandler&&this.options.bodyCellContextMenuHandler(r,i):t.rowHeader||void 0!==t.floatingRowHeader?this.options.rowHeaderContextMenuHandler&&this.options.rowHeaderContextMenuHandler(r,i):t.columnHeader?this.options.columnHeaderContextMenuHandler&&this.options.columnHeaderContextMenuHandler(r,i):t.cornerCell&&this.options.cornerCellContextMenuHandler&&this.options.cornerCellContextMenuHandler(r,i)},n.prototype.initializeContainersForScrolling=function(e){var t=this;e?(this.bodyCellContainer.addEventListener("scroll",function(){return t.onBodyCellContainerScroll()}),this.columnHeaderContainer.addEventListener("scroll",function(){return t.onColumnHeaderContainerScroll()}),this.rowHeaderContainer.addEventListener("scroll",function(){return t.onRowHeaderContainerScroll()}),this.floatingBodyCellContainer.addEventListener("scroll",function(){return t.onFloatingBodyCellContainerScroll()}),this.columnHeaderContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.cornerContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.floatingRowHeaderContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.floatingBodyCellContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),o.isFirefox()&&(this.columnHeaderContainer.style.overflow=this.rowHeaderContainer.style.overflow=this.bodyCellContainer.style.overflow=this.floatingBodyCellContainer.style.overflow="-moz-scrollbars-none",this.columnHeaderContainer.style["scrollbar-width"]=this.rowHeaderContainer.style["scrollbar-width"]=this.bodyCellContainer.style["scrollbar-width"]=this.floatingBodyCellContainer.style["scrollbar-width"]="none")):this.columnHeaderContainer.style.overflow=this.bodyCellContainer.style.overflow=this.rowHeaderContainer.style.overflow=this.floatingBodyCellContainer.style.overflow="hidden"},n.prototype.onBodyCellContainerScroll=function(){this.scriptUpdatedBodyVerticalToggle?this.scriptUpdatedBodyVerticalToggle=!1:(this.scriptUpdatedRowToggle=!0,this.rowScrollbar.viewMin=this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop),this.scriptUpdatedBodyHorizontalToggle?this.scriptUpdatedBodyHorizontalToggle=!1:(this.scriptUpdatedColumnToggle=!0,this.scriptUpdatedFloatingBodyToggle=!0,this.columnScrollbar.viewMin=this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft),(this.scriptUpdatedRowToggle||this.scriptUpdatedColumnToggle)&&this.refreshScrollbarsAndRender()},n.prototype.onColumnHeaderContainerScroll=function(){return this.scriptUpdatedColumnToggle?void(this.scriptUpdatedColumnToggle=!1):(this.scriptUpdatedBodyHorizontalToggle=!0,this.scriptUpdatedFloatingBodyToggle=!0,this.columnScrollbar.viewMin=this.bodyCellContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.columnHeaderContainer.scrollLeft,void this.refreshScrollbarsAndRender())},n.prototype.onRowHeaderContainerScroll=function(){return this.scriptUpdatedRowToggle?void(this.scriptUpdatedRowToggle=!1):(this.scriptUpdatedBodyVerticalToggle=!0,this.rowScrollbar.viewMin=this.bodyCellContainer.scrollTop=this.rowHeaderContainer.scrollTop,void this.refreshScrollbarsAndRender())},n.prototype.onFloatingBodyCellContainerScroll=function(){return this.scriptUpdatedFloatingBodyToggle?void(this.scriptUpdatedFloatingBodyToggle=!1):(this.scriptUpdatedBodyHorizontalToggle=!0,
this.scriptUpdatedColumnToggle=!0,this.columnScrollbar.viewMin=this.bodyCellContainer.scrollLeft=this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft,void this.refreshScrollbarsAndRender())},n.prototype.scrollTo=function(e,t){this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop=e,this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft=t,this.rowScrollbar.viewMin=Math.max(this.rowHeaderContainer.scrollTop,this.bodyCellContainer.scrollTop),this.columnScrollbar.viewMin=Math.max(this.columnHeaderContainer.scrollLeft,this.floatingBodyCellContainer.scrollLeft,this.bodyCellContainer.scrollLeft),this.render(a.Incremental)},n.prototype.onWheel=function(e){this.rowScrollbar.visible&&e.deltaY&&this.rowScrollbar.onMouseWheel(-e.deltaY)},n.prototype.onClick=function(e){var r=this.rowLevelWidthMeasureManager.getHeadersWidth()+this.columnWidthMeasureManager.getColumnsWidth(),o=this.columnLevelHeightMeasureManager.getHeadersHeight()+this.rowHeightMeasureManager.getRowsHeight()+this.rowHeightMeasureManager.getFloatingRowHeights();if(!(r>=this.width&&o>=this.height)){var i=t.HTMLElementUtils.getRelativeMouseCoordinates(this.element,e);(i.x>r||i.y>o)&&this.options.whitespaceClickHandler(e)}},n.prototype.initializeScrollbars=function(){var e=this;this.columnScrollbar=new t.HorizontalScrollbar(this.element,0),this.columnScrollbar.smallIncrement=20,this.columnScrollbar.min=0,this.columnScrollbar.height=n.pixelUnits(r.ScrollbarWidth),this.columnScrollbar.element.style.position="absolute",this.columnScrollbar.element.style.left="0",this.columnScrollbar.element.style.bottom="0",this.columnScrollbar.element.style.right=n.pixelUnits(r.ScrollbarWidth),this.columnScrollbar._onscroll.push(function(t){return e.onHorizontalScroll()}),this.rowScrollbar=new t.VerticalScrollbar(this.element,0),this.rowScrollbar.smallIncrement=20,this.rowScrollbar.min=0,this.rowScrollbar.width=n.pixelUnits(r.ScrollbarWidth),this.rowScrollbar.element.style.position="absolute",this.rowScrollbar.element.style.right="0",this.rowScrollbar.element.style.top="0",this.rowScrollbar.element.style.bottom=n.pixelUnits(r.ScrollbarWidth),this.rowScrollbar._onscroll.push(function(t){return e.onVerticalScroll()}),this.scriptUpdatedBodyHorizontalToggle=!1,this.scriptUpdatedBodyVerticalToggle=!1,this.scriptUpdatedColumnToggle=!1,this.scriptUpdatedRowToggle=!1},n.prototype.refreshScrollbarsAndRender=function(){var e=this;this.rowScrollbar.refresh(),this.columnScrollbar.refresh(),this.options.onScroll&&this.options.onScroll(),this.workScheduler.scheduleAnimationFrameTask(function(){return e.render(a.Incremental)})},n.prototype.setSteppedLayout=function(e){e!==this.steppedLayout&&(this.steppedLayout=e,this.columnWidthMeasureManager=new r.ColumnWidthMeasureManager(this.measureElement,this.sizeManager),this.steppedLayout?(this.rowLevelWidthMeasureManager=new r.SteppedRowLevelWidthMeasureManager(this.measureElement,this.sizeManager),this.rowHeightMeasureManager=new r.SteppedRowHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager)):(this.rowLevelWidthMeasureManager=new r.BlockedRowLevelWidthMeasureManager(this.measureElement,this.sizeManager),this.rowHeightMeasureManager=new r.BlockedRowHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager)),this.columnLevelHeightMeasureManager=new r.ColumnLevelHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager),this.steppedLayout?(this.rowHeaderRenderer=new r.SteppedRowHeaderRenderer(this.innerRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler),this.floatingRowHeaderRenderer=new r.SteppedRowHeaderRenderer(this.floatingRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler)):(this.rowHeaderRenderer=new r.BlockedRowHeaderRenderer(this.innerRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler),this.floatingRowHeaderRenderer=new r.BlockedRowHeaderRenderer(this.floatingRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler)),this.columnHeaderRenderer=new r.ColumnHeaderRenderer(this.innerColumnHeaderContainer,this.columnWidthMeasureManager,this.columnLevelHeightMeasureManager,this.columnWidthResizeHandler,this.options.columnHeaderClickHandler,this.options.columnHeaderContextMenuHandler,this.options.columnHeaderInteractionHandler),this.bodyCellRenderer=new r.BodyCellRenderer(this.innerBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,this.workScheduler),this.cornerRenderer=new r.CornerRenderer(this.cornerContainer,this.columnLevelHeightMeasureManager,this.rowLevelWidthMeasureManager,this.columnLevelHeightResizeHandler,this.rowLevelWidthResizeHandler,this.options.cornerCellClickHandler,this.options.cornerCellContextMenuHandler,this.options.cornerCellInteractionHandler),this.floatingBodyCellRenderer=new r.BodyCellRenderer(this.innerFloatingBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,this.workScheduler),this.clear(a.ClearMeasurement))},n.prototype.clearBodyPages=function(){this.bodyCellRenderer.clear(),this.floatingBodyCellRenderer.clear()},n.prototype.rebuildBodyPagesSync=function(){this.clearBodyPages();var e=this.getViewport();if(this.bodyCellRenderer.update(e,!1,this.binder,this.rowNavigator,this.columnNavigator,!1),this.rowNavigator.getFloatingHierarchyItems()){var t=this.rowHeightMeasureManager.getFloatingRowHeights();this.floatingBodyCellRenderer.update({left:e.left,top:0,width:e.width,height:t},!0,this.binder,this.rowNavigator,this.columnNavigator,!1)}},n.prototype.setWidth=function(e){this.width=e,this.element.style.width=n.pixelUnits(this.width),this.columnScrollbar.invalidateArrange()},n.prototype.setHeight=function(e){this.height=e,this.element.style.height=n.pixelUnits(this.height),this.rowScrollbar.invalidateArrange()},n.prototype.getCornerContainer=function(){return this.cornerContainer},n.prototype.getColumnHeaderContainer=function(){return this.columnHeaderContainer},n.prototype.getRowHeaderContainer=function(){return this.rowHeaderContainer},n.prototype.getBodyCellContainer=function(){return this.bodyCellContainer},n.prototype.getFloatingRowHeaderContainer=function(){return this.floatingRowHeaderContainer},n.prototype.getFloatingBodyCellContainer=function(){return this.floatingBodyCellContainer},n.prototype.setClassName=function(e){this.element.className=e},n.prototype.setColumnNavigator=function(e){this.columnNavigator=e,this.focusManager.columnNavigator=e},n.prototype.setRowNavigator=function(e){this.rowNavigator=e,this.focusManager.rowNavigator=e},n.prototype.setBinder=function(e){this.binder=e},n.prototype.getSteppedLayout=function(){return this.steppedLayout},n.prototype.getColumnNavigator=function(){return this.columnNavigator},n.prototype.getRowNavigator=function(){return this.rowNavigator},n.prototype.getSizeManager=function(){return this.sizeManager},n.prototype.getBinder=function(){return this.binder},n.prototype.getColumnWidthMeasureManager=function(){return this.columnWidthMeasureManager},n.prototype.getRowHeightMeasureManager=function(){return this.rowHeightMeasureManager},n.prototype.getColumnLevelHeightMeasureManager=function(){return this.columnLevelHeightMeasureManager},n.prototype.getRowLevelWidthMeasureManager=function(){return this.rowLevelWidthMeasureManager},n.prototype.getRowHeaderRenderer=function(){return this.rowHeaderRenderer},n.prototype.getColumnHeaderRenderer=function(){return this.columnHeaderRenderer},n.prototype.getBodyCellRenderer=function(){return this.bodyCellRenderer},n.prototype.getCornerRenderer=function(){return this.cornerRenderer},n.prototype.getFloatingRowHeaderRenderer=function(){return this.floatingRowHeaderRenderer},n.prototype.getFloatingBodyCellRenderer=function(){return this.floatingBodyCellRenderer},n.prototype.getViewport=function(){return{left:this.columnScrollbar.viewMin,top:this.rowScrollbar.viewMin,width:this.width,height:this.height}},n.prototype.getBodyCellViewPort=function(){return{left:this.columnScrollbar.viewMin,top:this.rowScrollbar.viewMin,width:this.columnScrollbar.viewSize,height:this.rowScrollbar.viewSize}},n.prototype.getClientWidth=function(){return this.width-(this.rowScrollbar.visible?r.ScrollbarWidth:0)},n.prototype.getWorkScheduler=function(){return this.workScheduler},n.prototype.restoreFocus=function(){this.hasFocus&&this.focusManager.initialize()},n.prototype.render=function(e,t){var o=this;try{this.clear(e);var i=this.getViewport(),n=r.RowMeasurementUtil.getVisibleRange(i.top,i.height,this.rowHeightMeasureManager),s=n?n.firstLeafIndex:0,l=r.ColumnMeasurementUtil.getVisibleRange(i.left,i.width,this.columnWidthMeasureManager),u=l?l.firstLeafIndex:0;this.rowLevelWidthMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,s,r.MeasureRowSampleCount),this.ensureLastPageComplete(s,u);var h=this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&!this.isFilledHorizontally(i.left,i.width),d=this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&!this.isFilledVertically(i.top,i.height);h&&this.measureNextPageColumn(s),d&&this.measureNextPageRow(s,u),this.rowHeightMeasureManager.measureFloatingRows(this.binder,this.rowNavigator,this.columnNavigator,s,u),this.columnLevelHeightMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,s,u,r.MeasureColumnSampleCount),this.updateRegionsPosition(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.updateScrollbars(),this.measureNextPageColumnAsync(s),this.measureNextPageRowAsync(s,u),this.columnHeaderRenderer.update(i.left,i.width,this.binder,this.columnNavigator),this.rowHeaderRenderer.update(this.rowNavigator.getHierarchyItems(),!1,i.top,i.height,this.binder,this.rowNavigator),this.bodyCellRenderer.update(i,!1,this.binder,this.rowNavigator,this.columnNavigator,!0),this.cornerRenderer.update(this.binder,this.rowNavigator,this.columnNavigator);var c=this.rowNavigator.getFloatingHierarchyItems();if(c){var g=this.rowHeightMeasureManager.getFloatingRowHeights();this.floatingRowHeaderRenderer.update(c,!0,0,g,this.binder,this.rowNavigator),this.floatingBodyCellRenderer.update({left:i.left,top:0,width:i.width,height:g},!0,this.binder,this.rowNavigator,this.columnNavigator,!0)}d||h?this.workScheduler.scheduleAnimationFrameTask(function(){return o.render(a.Incremental,t)}):(e!==a.Incremental&&this.restoreFocus(),t&&t())}catch(e){t&&t(e)}},n.prototype.ensureLastPageComplete=function(e,t){var o=this.rowHeightMeasureManager.ensureLastPageComplete(this.binder,this.rowNavigator,this.columnNavigator,e,t,r.MeasureColumnSampleCount);o!==-1&&(this.bodyCellRenderer.removeRowPages(o),this.updateScrollRegionHeight())},n.prototype.makeVisible=function(t,o,i,s){var l=this;try{this.clear(t);var u=this.getViewport(),h=void 0,d=void 0;if(i)h=i.columnIndex,d=r.ColumnMeasurementUtil.getOffset(i,this.columnWidthMeasureManager),i.alignRight&&(d-=this.columnScrollbar.viewSize);else{var c=r.ColumnMeasurementUtil.getVisibleRange(u.left,u.width,this.columnWidthMeasureManager);h=c?c.firstLeafIndex:0,d=this.columnScrollbar.viewMin}var g=void 0,p=void 0;if(o)g=o.rowIndex,p=r.RowMeasurementUtil.getOffset(o,this.rowHeightMeasureManager),o.alignBottom&&(p-=this.rowScrollbar.viewSize);else{var f=r.RowMeasurementUtil.getVisibleRange(u.top,u.height,this.rowHeightMeasureManager);g=f?f.firstLeafIndex:0,p=this.rowScrollbar.viewMin}this.rowLevelWidthMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,g,r.MeasureRowSampleCount),this.ensureLastPageComplete(g,h);var m=this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&(!r.ColumnMeasurementUtil.isColumnMeasured(h,this.columnWidthMeasureManager)||this.width>this.columnWidthMeasureManager.getColumnsWidth()-d),v=this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&(!r.RowMeasurementUtil.isRowMeasured(g,this.rowHeightMeasureManager)||this.height>this.rowHeightMeasureManager.getRowsHeight()-p);if(m&&this.measureNextPageColumn(g),v&&this.measureNextPageRow(g,h),v||m)this.workScheduler.scheduleAnimationFrameTask(function(){return l.makeVisible(a.Incremental,o,i,s)});else{this.rowHeightMeasureManager.measureFloatingRows(this.binder,this.rowNavigator,this.columnNavigator,g,h),this.columnLevelHeightMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,g,h,r.MeasureColumnSampleCount),this.updateRegionsPosition(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.updateScrollbars(),this.scrollTo(p,d);var y=e.Double.equalWithPrecision(this.rowScrollbar.viewMin,p,n.ScrollOffsetPrecision),C=e.Double.equalWithPrecision(this.columnScrollbar.viewMin,d,n.ScrollOffsetPrecision);y&&C?s&&s():(!y&&o&&(o=this.getVisibleRowStart()),!C&&i&&(i=this.getVisibleColumnStart()),this.makeVisible(a.ClearMeasurement,o,i,s))}}catch(e){s&&s(e)}},n.prototype.getVisibleRowStart=function(){var e=this.getViewport(),t=r.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);return t?r.RowMeasurementUtil.getVisibleRowStart(t,e.top,this.rowHeightMeasureManager):null},n.prototype.getVisibleColumnStart=function(){var e=this.getViewport(),t=r.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager);return t?r.ColumnMeasurementUtil.getVisibleColumnStart(t,e.left,this.columnWidthMeasureManager):null},n.prototype.clearRendering=function(){this.workScheduler.clear(),this.bodyCellRenderer.clear(),this.rowHeaderRenderer.clear(),this.columnHeaderRenderer.clear(),this.cornerRenderer.clear(),this.floatingRowHeaderRenderer.clear(),this.floatingBodyCellRenderer.clear()},n.prototype.clearMeasurement=function(){this.workScheduler.clear(),this.columnWidthMeasureManager.clear(),this.rowHeightMeasureManager.clear(),this.columnLevelHeightMeasureManager.clear(),this.rowLevelWidthMeasureManager.clear()},n.prototype.clear=function(e){switch(void 0===e&&(e=a.ClearMeasurement),e){case a.ClearRendering:this.clearRendering();break;case a.ClearMeasurement:this.clearRendering(),this.clearMeasurement()}},n.prototype.onHorizontalScroll=function(){this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft=this.columnScrollbar.viewMin},n.prototype.onVerticalScroll=function(){this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop=this.rowScrollbar.viewMin},n.prototype.updateRegionsPosition=function(){this.bodyCellContainer.style.top=this.rowHeaderContainer.style.top=this.cornerContainer.style.height=this.innerColumnHeaderContainer.style.height=n.pixelUnits(this.columnLevelHeightMeasureManager.getHeadersHeight()),this.bodyCellContainer.style.left=this.columnHeaderContainer.style.left=this.cornerContainer.style.width=this.innerRowHeaderContainer.style.width=this.floatingBodyCellContainer.style.left=this.floatingRowHeaderContainer.style.width=n.pixelUnits(this.rowLevelWidthMeasureManager.getHeadersWidth()),this.floatingRowHeaderContainer.style.height=this.floatingBodyCellContainer.style.height=this.innerFloatingBodyCellContainer.style.height=n.pixelUnits(this.rowHeightMeasureManager.getFloatingRowHeights())},n.prototype.updateScrollbars=function(){var e=this.rowHeightMeasureManager.getFloatingRowHeights(),t=this.height-this.columnLevelHeightMeasureManager.getHeadersHeight()-e,o=this.width-this.rowLevelWidthMeasureManager.getHeadersWidth(),i=this.rowHeightMeasureManager.getRowsHeight(),a=this.columnWidthMeasureManager.getColumnsWidth(),s=this.options.scrollingEnabled&&i>0&&i>t,l=this.options.scrollingEnabled&&a>0&&a>o;!s&&l&&i>0&&(s=i>t-r.ScrollbarWidth),!l&&s&&a>0&&(l=a>o-r.ScrollbarWidth),this.bodyCellContainer.style.right=this.columnHeaderContainer.style.right=this.floatingBodyCellContainer.style.right=s?this.rowScrollbar.width:n.pixelUnits(0);var u,h,d=l?r.ScrollbarWidth:0;i>t-d?(u=d+e,h=d):(u=t+e-i,h=t-i),this.bodyCellContainer.style.bottom=this.rowHeaderContainer.style.bottom=n.pixelUnits(u),this.floatingRowHeaderContainer.style.bottom=this.floatingBodyCellContainer.style.bottom=n.pixelUnits(h),this.rowScrollbar.show(s),this.rowScrollbar.viewSize=this.bodyCellContainer.clientHeight,this.rowScrollbar.refresh(),this.columnScrollbar.show(l),this.columnScrollbar.viewSize=this.bodyCellContainer.clientWidth,this.columnScrollbar.refresh()},n.prototype.measureNextPageColumnAsync=function(e){var t=this;this.workScheduler.scheduleTimeoutTask(function(){t.columnWidthMeasureManager.canAddPageColumn(t.columnNavigator)&&t.columnWidthMeasureManager.getPageColumns().length<r.MaxAutoPageColumnMeasure&&(t.measureNextPageColumn(e),t.updateScrollRegionWidth(),t.measureNextPageColumnAsync(e))},n.AutoMeasureDelay)},n.prototype.measureNextPageRowAsync=function(e,t){var o=this;this.workScheduler.scheduleTimeoutTask(function(){o.rowHeightMeasureManager.canAddPageRow(o.rowNavigator)&&o.rowHeightMeasureManager.getPageRows().length<r.MaxAutoPageRowMeasure&&(o.measureNextPageRow(e,t),o.updateScrollRegionHeight(),o.measureNextPageRowAsync(e,t))},n.AutoMeasureDelay)},n.prototype.updateScrollRegionWidth=function(){var e=this.columnWidthMeasureManager.getColumnsWidth(),t=this.bodyCellContainer.clientWidth;this.innerColumnHeaderContainer.style.width=this.innerBodyCellContainer.style.width=this.innerFloatingBodyCellContainer.style.width=n.pixelUnits(Math.max(e,t)),this.columnScrollbar.max=e,this.columnScrollbar.viewSize=t,this.columnScrollbar.refresh()},n.prototype.updateScrollRegionHeight=function(){var e=this.rowHeightMeasureManager.getRowsHeight(),t=this.bodyCellContainer.clientHeight;this.innerRowHeaderContainer.style.height=this.innerBodyCellContainer.style.height=n.pixelUnits(Math.max(e,t)),this.rowScrollbar.max=e,this.rowScrollbar.viewSize=t,this.rowScrollbar.refresh()},n.prototype.isFilledHorizontally=function(e,t){return this.columnWidthMeasureManager.getColumnsWidth()-e>t+n.MeasureBuffer},n.prototype.isFilledVertically=function(e,t){return this.rowHeightMeasureManager.getRowsHeight()-e>t+n.MeasureBuffer},n.prototype.measureNextPageColumn=function(e){this.columnWidthMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,e)},n.prototype.measureNextPageRow=function(e,t){this.rowHeightMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,e,t)},n.pixelUnits=function(e){return 0===e?e.toString():e+"px"},n.MeasureBuffer=50,n.AutoMeasureDelay=250,n.ScrollOffsetPrecision=.1,n}();r.PivotTableControl=l;var u=function(){function e(e,t){this.rowIndex=e,this.columnIndex=t}return e.prototype.build=function(e,t,r,o,i,n,a,s,u,h,d,c,p,f){for(var m=s?u.getFloatingHierarchyLeafCount():u.getHierarchyLeafCount(),v=Math.min(t+n.getRowHeights().length,m)-t,y=Math.min(r+a.getColumnWidths().length,h.getHierarchyLeafCount())-r,C=i.getPageColumnLeft(a),H=o.getPageRowTop(n),w={position:"absolute",left:l.pixelUnits(C),top:l.pixelUnits(H),width:l.pixelUnits(a.getWidth()),height:l.pixelUnits(n.getHeight())},b=[],P=0;P<v;P++)b[P]=[];for(var M={children:new Array(y),classNames:[],styleProperties:{},attributes:{}},x=0,S=0;S<y;S++){var T=a.getColumnWidths()[S];M.children[S]=this.buildColumn(v,t,S,r,n,a,s,u,h,d,b,x,T),x+=T}e.insertAdjacentHTML("beforeend",g.build(M,w)),this.element=e.lastChild,g.attachEventHandlers(this.element,M),(c||p)&&this.addEventListeners(v,y,b,c,p,f)},e.prototype.resizeColumn=function(e,t){if(this.element){for(var r,o=t.getColumnWidths(),i=o.length,n=0,a=0;a<i&&(r=0===a?this.element.firstChild:r.nextSibling,r);a++){var s=o[a];a===e?r.style.width=l.pixelUnits(s):a>e&&(r.style.left=l.pixelUnits(n)),n+=s}this.element.style.width=l.pixelUnits(t.getWidth())}},e.prototype.getHierarchyLeafAt=function(e,t,r){return e?r.getFloatingHierarchyLeafAt(t):r.getHierarchyLeafAt(t)},e.prototype.buildColumn=function(e,t,r,o,i,n,a,s,u,h,d,c,g){for(var p={children:new Array(e),classNames:[],attributes:{},styleProperties:{overflow:"hidden",position:"absolute",left:l.pixelUnits(c),width:l.pixelUnits(g)}},f=u.getHierarchyLeafAt(r+o),m=0;m<e;m++)p.children[m]=this.buildCell(m,this.getHierarchyLeafAt(a,m+t,s),r,f,i,s,h,d);return p},e.prototype.buildCell=function(e,t,r,o,i,n,a,s){var u=n.getIntersection(t,o);s[e][r]=u;var h=a.getBodyCellBinding(u,!1);return h.styleProperties["box-sizing"]="border-box",h.styleProperties.height=l.pixelUnits(i.getRowHeights()[e]),h},e.prototype.addEventListeners=function(e,t,r,o,i,n){for(var a,s=0;s<t;s++){a=0===s?this.element.firstChild:a.nextSibling;for(var l=void 0,u=function(e){l=0===e?a.firstChild:l.nextSibling;var t=r[e][s];o&&l.addEventListener("click",function(e){o(t,e)}),i&&l.addEventListener("contextmenu",function(e){i(t,e)}),n&&(n.isTooltipEnabled(t)?n.addTooltip(t,l):n.removeTooltip(t,l))},h=0;h<e;h++)u(h)}},e.prototype.getElement=function(){return this.element},e.prototype.getCellAt=function(e,t){return this.element.children[t].children[e]},e}();r.PivotTableBodyPage=u;var h=function(){function e(){this.columnWidths=[]}return e.prototype.getColumnWidths=function(){return this.columnWidths},e.prototype.getWidth=function(){return _.sum(this.columnWidths)},e}();r.PivotTablePageColumn=h;var d=function(){function e(){this.rowHeights=[]}return e.prototype.getRowHeights=function(){return this.rowHeights},e.prototype.getHeight=function(){return _.sum(this.rowHeights)},e.prototype.clear=function(){this.rowHeights=[]},e}();r.PivotTablePageRow=d;var c=function(){function e(){}return e.prototype.build=function(t,r,o,i,n,a,s,l){if(!this.element){var u={content:g.build(r,e.headerRequiredStyles),classNames:null,styleProperties:null,attributes:null};t.insertAdjacentHTML("beforeend",g.build(u,e.containerRequiredStyles)),this.element=t.lastChild,(i||n||a)&&this.createHeaderResizer(o,i,n,a),s&&this.element.addEventListener("contextmenu",function(e){s(o,e)}),l&&(l.isTooltipEnabled(o)?l.addTooltip(o,this.element):l.removeTooltip(o,this.element)),g.attachEventHandlers(this.element.firstChild,r)}},e.prototype.createHeaderResizer=function(e,t,o,i){return new r.HeaderResizer(e,this.element,t,o,i)},e.prototype.setWidth=function(e){this.element.style.width=l.pixelUnits(e)},e.prototype.setHeight=function(e){this.element.lastChild.style.height=l.pixelUnits(e)},e.prototype.setLeft=function(e){this.element.style.left=l.pixelUnits(e)},e.prototype.setTop=function(e){this.element.style.top=l.pixelUnits(e)},e.prototype.getElement=function(){return this.element},e.headerRequiredStyles={"box-sizing":"border-box"},e.containerRequiredStyles={position:"absolute",overflow:"hidden"},e}();r.PivotTableHeader=c;var g=function(){function e(){}return e.build=function(t,r){if(void 0===r&&(r={}),null===t.tagName)return t.content;var o=t.tagName||"div",i="<"+o+" "+this.buildAttributes(t.attributes)+this.buildClassNames(t.classNames)+this.buildStyles(t.styleProperties,r)+">";if(_.isEmpty(t.children))null!=t.content&&(i+=t.content);else for(var n=0,a=t.children;n<a.length;n++){var s=a[n];i+=e.build(s,null)}return i+="</"+o+">"},e.buildAttributes=function(e){var t="";if(e)for(var r in e)t+=r+"="+n+e[r]+n;return t},e.buildClassNames=function(e){if(!e||0===e.length)return"";for(var t='class="',r=0,o=e;r<o.length;r++){t+=o[r]+" "}return t+='"'},e.buildStyles=function(e,t){var r=!_.isEmpty(t),o=!_.isEmpty(e);if(!r&&!o)return"";var i="style="+n;if(o)for(var a in e)i+=a+":"+e[a]+";";if(r)for(var s in t)i+=s+":"+t[s]+";";return i+=n},e.attachEventHandlers=function(t,r){if(r.clickHandler&&t.addEventListener("click",function(e){return r.clickHandler(e)}),r.contextMenuHandler&&t.addEventListener("contextmenu",function(e){return r.contextMenuHandler(e)}),!_.isEmpty(r.children))for(var o=0;o<r.children.length;o++)null!==r.children[o].tagName&&e.attachEventHandlers(t.childNodes[o],r.children[o])},e}();r.ElementBuilder=g}(r=t.pivotTable||(t.pivotTable={}))}(r=t.controls||(t.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(e){this.onFocusChangedHandler=e}return Object.defineProperty(t.prototype,"CurrentFocus",{get:function(){return this.currentFocus},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.currentFocus&&this.isFocusValid(this.currentFocus)||(this.currentFocus=this.getInitialFocus()),this.updateFocusedItem(),this.onFocusChangedHandler&&this.onFocusChangedHandler()},t.prototype.getInitialFocus=function(){var e=this.rowNavigator.getHierarchyLeafCount(),t=this.columnNavigator.getHierarchyLeafCount();return e>0&&t>0?{bodyCell:{rowIndex:0,columnIndex:0}}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:0,columnLevel:this.columnNavigator.getHierarchyDepth()-1}}:{columnHeader:[0]}},t.prototype.isFocusValid=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount();if(e.bodyCell){var i=e.bodyCell.rowIndex,n=e.bodyCell.columnIndex;return i>=0&&i<t&&n>=0&&n<r}if(e.floatingBodyCell){var i=e.floatingBodyCell.rowIndex,n=e.floatingBodyCell.columnIndex;return i>=0&&i<o&&n>=0&&n<r}if(e.columnHeader)return!!this.columnNavigator.getNodeFromPath(e.columnHeader);if(e.rowHeader)return!!this.rowNavigator.getNodeFromPath(e.rowHeader);if(e.cornerCell){var a=this.rowNavigator.getHierarchyDepth(),s=this.columnNavigator.getHierarchyDepth(),l=e.cornerCell.rowLevel,u=e.cornerCell.columnLevel;return l>=0&&l<a&&u>=0&&u<s}if(e.floatingRowHeader){var h=e.floatingRowHeader;return h>=0&&h<o}},t.prototype.updateFocusedItem=function(){if(this.currentFocus.bodyCell){var e=this.rowNavigator.getHierarchyLeafAt(this.currentFocus.bodyCell.rowIndex),t=this.columnNavigator.getHierarchyLeafAt(this.currentFocus.bodyCell.columnIndex);this.currentFocus.item=this.rowNavigator.getIntersection(e,t)}else if(this.currentFocus.columnHeader)this.currentFocus.item=this.columnNavigator.getNodeFromPath(this.currentFocus.columnHeader);else if(this.currentFocus.rowHeader)this.currentFocus.item=this.rowNavigator.getNodeFromPath(this.currentFocus.rowHeader);else if(this.currentFocus.cornerCell)this.currentFocus.item=this.rowNavigator.getCorner(this.currentFocus.cornerCell.rowLevel,this.currentFocus.cornerCell.columnLevel);else if(this.currentFocus.floatingBodyCell){var e=this.rowNavigator.getFloatingHierarchyLeafAt(this.currentFocus.floatingBodyCell.rowIndex),t=this.columnNavigator.getHierarchyLeafAt(this.currentFocus.floatingBodyCell.columnIndex);this.currentFocus.item=this.rowNavigator.getIntersection(e,t)}else void 0!==this.currentFocus.floatingRowHeader&&(this.currentFocus.item=this.rowNavigator.getFloatingHierarchyLeafAt(this.currentFocus.floatingRowHeader))},t.prototype.moveFocus=function(e){this.currentFocus.bodyCell?this.currentFocus=this.moveBodyCellFocus(e):this.currentFocus.rowHeader?this.currentFocus=this.moveRowHeaderFocus(e):this.currentFocus.columnHeader?this.currentFocus=this.moveColumnHeaderFocus(e):this.currentFocus.cornerCell?this.currentFocus=this.moveCornerCellFocus(e):void 0!==this.currentFocus.floatingRowHeader?this.currentFocus=this.moveFloatingRowHeaderFocus(e):this.currentFocus.floatingBodyCell&&(this.currentFocus=this.moveFloatingBodyCellFocus(e)),this.updateFocusedItem(),this.onFocusChangedHandler&&this.onFocusChangedHandler()},t.prototype.moveBodyCellFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),i=this.currentFocus.bodyCell.columnIndex,n=this.currentFocus.bodyCell.rowIndex;switch(e){case"left":i--;break;case"right":i++;break;case"up":n--;break;case"down":n++;break;default:debug.assertNever(e)}if(n>=0&&i>=0&&n<t&&i<r)return{bodyCell:{rowIndex:n,columnIndex:i}};if(n<0)return this.columnNavigator.hasHierarchy()?{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(i))}:o>0?{floatingBodyCell:{rowIndex:o-1,columnIndex:i}}:{bodyCell:{rowIndex:t-1,columnIndex:i}};if(n>=t){if(o>0)return{floatingBodyCell:{rowIndex:0,columnIndex:i}};if(this.columnNavigator.hasHierarchy()){var a=this.columnNavigator.getHierarchyLeafAt(i),s=this.columnNavigator.getLeafAncestorAtLevel(a,0);return{columnHeader:this.columnNavigator.getPathIndices(s)}}return{bodyCell:{rowIndex:0,columnIndex:i}}}if(i<0)return this.rowNavigator.hasHierarchy()?{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(n))}:n>0?{bodyCell:{rowIndex:n-1,columnIndex:r-1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(r-1))};if(i>=r){if(n<t-1){var l=n+1;if(this.rowNavigator.hasHierarchy()){var u=this.rowNavigator.getHierarchyLeafAt(l),s=this.rowNavigator.getLeafAncestorAtLevel(u,0);return{rowHeader:this.rowNavigator.getPathIndices(s)}}return{bodyCell:{rowIndex:l,columnIndex:0}}}return o>0?{floatingRowHeader:0}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:this.rowNavigator.getHierarchyDepth()-1,columnLevel:0}}:{columnHeader:[0]}}},t.prototype.moveRowHeaderFocus=function(t){var r=this.rowNavigator.getHierarchyLeafCount(),o=this.columnNavigator.getHierarchyLeafCount(),i=this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.rowNavigator.getHierarchyDepth(),a=this.columnNavigator.getHierarchyDepth(),s=this.currentFocus.rowHeader,l=this.rowNavigator.getNodeFromPath(s),u=s.length-1;if(!l)return this.getInitialFocus();if("left"===t){if(s.length>1)return{rowHeader:_.dropRight(s,1)};if(s[0]>0){var h=e.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(l,this.rowNavigator)-1;return o>0?{bodyCell:{rowIndex:h,columnIndex:o-1}}:{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(h))}}return o>0?{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(o-1))}:{cornerCell:{rowLevel:n-1,columnLevel:0}}}if("right"===t){var d=this.rowNavigator.getLeafIndex(l);if(void 0===d)return{rowHeader:s.concat([0])};if(o>0)return{bodyCell:{rowIndex:d,columnIndex:0}};if(d<r-1){var c=this.rowNavigator.getLeafAncestorAtLevel(this.rowNavigator.getHierarchyLeafAt(d+1),0);return{rowHeader:this.rowNavigator.getPathIndices(c)}}return i>0?{floatingRowHeader:0}:{cornerCell:{rowLevel:0,columnLevel:a-1}}}var g=this.rowNavigator.getItemsByLevel(u),p=g.indexOf(l);return"up"===t?p>0?{rowHeader:this.rowNavigator.getPathIndices(g[p-1])}:{cornerCell:{rowLevel:u,columnLevel:a-1}}:"down"===t?p<g.length-1?{rowHeader:this.rowNavigator.getPathIndices(g[p+1])}:i>0?{floatingRowHeader:0}:{cornerCell:{rowLevel:u,columnLevel:a-1}}:void 0},t.prototype.moveColumnHeaderFocus=function(t){var r=this.rowNavigator.getHierarchyLeafCount(),o=this.columnNavigator.getHierarchyLeafCount(),i=this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.rowNavigator.getHierarchyDepth(),a=this.columnNavigator.getHierarchyDepth(),s=this.currentFocus.columnHeader,l=this.columnNavigator.getNodeFromPath(s),u=this.columnNavigator.getLevel(l);if(!l)return this.getInitialFocus();if("up"===t){if(s.length>1)return{columnHeader:_.dropRight(s,1)};var h=e.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(l,this.columnNavigator);
return i>0?{floatingBodyCell:{rowIndex:i-1,columnIndex:h}}:r>0?{bodyCell:{rowIndex:r-1,columnIndex:h}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(h))}}if("down"===t){var d=this.columnNavigator.getLeafIndex(l);if(void 0===d)return{columnHeader:s.concat([0])};if(r>0)return{bodyCell:{rowIndex:0,columnIndex:d}};if(i>0)return{floatingBodyCell:{rowIndex:0,columnIndex:d}};var c=this.columnNavigator.getLeafAncestorAtLevel(l,0);return{columnHeader:this.columnNavigator.getPathIndices(c)}}var g=this.columnNavigator.getItemsByLevel(u),p=g.indexOf(l);return"left"===t?p>0?{columnHeader:this.columnNavigator.getPathIndices(g[p-1])}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:n-1,columnLevel:u}}:u>0?{columnHeader:this.columnNavigator.getPathIndices(_.last(this.columnNavigator.getItemsByLevel(u-1)))}:i>0?{floatingBodyCell:{rowIndex:i-1,columnIndex:o-1}}:r>0?{bodyCell:{rowIndex:r-1,columnIndex:o-1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(o-1))}:"right"===t?p<g.length-1?{columnHeader:this.columnNavigator.getPathIndices(g[p+1])}:u<a-1?this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:n-1,columnLevel:u+1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getItemsByLevel(u+1)[0])}:r>0?this.rowNavigator.hasHierarchy()?{rowHeader:[0]}:{bodyCell:{rowIndex:0,columnIndex:0}}:i>0?this.rowNavigator.hasHierarchy()?{floatingRowHeader:0}:{floatingBodyCell:{rowIndex:0,columnIndex:0}}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:1===a?0:n-1,columnLevel:0}}:{columnHeader:[0]}:void 0},t.prototype.moveCornerCellFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),i=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.cornerCell.rowLevel,s=this.currentFocus.cornerCell.columnLevel,l=this.rowNavigator.getItemsByLevel(a),u=this.columnNavigator.getItemsByLevel(s);if("up"===e)return a===i-1&&s>0?{cornerCell:{rowLevel:a,columnLevel:s-1}}:o>0?{floatingRowHeader:o-1}:t>0?{rowHeader:this.rowNavigator.getPathIndices(_.last(l))}:{cornerCell:{rowLevel:a,columnLevel:n-1}};if("down"===e)return a===i-1&&s<n-1?{cornerCell:{rowLevel:a,columnLevel:s+1}}:t>0?{rowHeader:this.rowNavigator.getPathIndices(l[0])}:o>0?{floatingRowHeader:0}:{cornerCell:{rowLevel:a,columnLevel:a===i-1?0:n-1}};if("right"===e)return _.isEmpty(u)?s<n-1?{cornerCell:{rowLevel:a===i-1?0:i-1,columnLevel:s+1}}:t>0?{rowHeader:[0]}:{cornerCell:{rowLevel:1===n?0:i-1,columnLevel:0}}:{columnHeader:this.columnNavigator.getPathIndices(u[0])};if("left"===e){if(a>0&&s===n-1)return{cornerCell:{rowLevel:a-1,columnLevel:s}};if(s>0){var h=s-1;return r>0?{columnHeader:this.columnNavigator.getPathIndices(_.last(this.columnNavigator.getItemsByLevel(h)))}:{cornerCell:{rowLevel:i-1,columnLevel:h}}}return o>0&&r>0?{floatingBodyCell:{rowIndex:o-1,columnIndex:r-1}}:t>0&&r>0?{bodyCell:{rowIndex:t-1,columnIndex:r-1}}:t>0?{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(t-1))}:{cornerCell:{rowLevel:i-1,columnLevel:n-1}}}},t.prototype.moveFloatingRowHeaderFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),i=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.floatingRowHeader;if("left"===e){if(a>0)return{floatingBodyCell:{rowIndex:a-1,columnIndex:r-1}};if(t>0)return{bodyCell:{rowIndex:t-1,columnIndex:r-1}};var s=this.columnNavigator.getHierarchyLeafAt(r-1);return{columnHeader:this.columnNavigator.getPathIndices(s)}}return"right"===e?{floatingBodyCell:{rowIndex:a,columnIndex:0}}:"up"===e?a>0?{floatingRowHeader:a-1}:t>0?{rowHeader:[this.rowNavigator.getItemsByLevel(0).length-1]}:{cornerCell:{rowLevel:0,columnLevel:n-1}}:"down"===e?a<o-1?{floatingRowHeader:a+1}:{cornerCell:{rowLevel:0,columnLevel:1===i?0:n-1}}:void 0},t.prototype.moveFloatingBodyCellFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),i=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.floatingBodyCell.columnIndex,s=this.currentFocus.floatingBodyCell.rowIndex;switch(e){case"left":a--;break;case"right":a++;break;case"up":s--;break;case"down":s++;break;default:debug.assertNever(e)}if(s>=0&&a>=0&&s<o&&a<r)return{floatingBodyCell:{rowIndex:s,columnIndex:a}};if(s<0){if(t>0)return{bodyCell:{rowIndex:t-1,columnIndex:a}};var l=this.columnNavigator.getHierarchyLeafAt(a);return{columnHeader:this.columnNavigator.getPathIndices(l)}}if(s>=o){var l=this.columnNavigator.getHierarchyLeafAt(a),u=this.columnNavigator.getLeafAncestorAtLevel(l,0);return{columnHeader:this.columnNavigator.getPathIndices(u)}}return a<0?{floatingRowHeader:s}:a>=r?s<o-1?{floatingRowHeader:s+1}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:0,columnLevel:1===i?0:n-1}}:{columnHeader:[0]}:void 0},t}();e.PivotTableFocusManager=t}(t=e.pivotTable||(e.pivotTable={}))}(t=e.controls||(e.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.internal.TablixUtils,o=function(){function o(e){this.isTouchDisabled=e&&e.isTouchDisabled}return o.prototype.init=function(e){this.element=e.element,this.style=e.style,this.updateViewport(e.viewport),this.isInteractive=e.interactivity&&null!=e.interactivity.selection,this.hostServices=e.host,this.persistingObjects=!1,this.waitingForData=!1,this.lastAllowHeaderResize=!0,this.waitingForSort=!1,this.tablixPropertyManager=new t.TablixPropertyManager(this.style)},o.getFormattingProperties=function(e,t){return t.getMatrixObjects(e)},o.prototype.onResizing=function(e){this.updateViewport(e)},o.prototype.getColumnWidthManager=function(){return this.columnWidthManager},o.prototype.onDataChanged=function(t){var r=t.dataViews;if(r&&r.length>0){var i=this.dataView;this.dataView=r[0];var n=o.getFormattingProperties(this.dataView,this.tablixPropertyManager);this.formatters=n.formatters;var a=n.general.textSize;if(t.operationKind===e.VisualDataChangeOperationKind.Append){var s=i.matrix.rows.root!==this.dataView.matrix.rows.root;this.createOrUpdateHierarchyNavigator(s),this.tablixControl.updateModels(!1,this.hierarchyNavigator.getRowHierarchy().root.children,this.hierarchyNavigator.getColumnHierarchy().root.children),this.refreshControl(!1)}else{this.createOrUpdateHierarchyNavigator(!0),this.createColumnWidthManager(),this.createTablixControl(n);this.tablixControl.getBinder().onDataViewChanged(n),this.updateInternal(a,i)}}this.waitingForData=!1,this.waitingForSort=!1},o.prototype.createColumnWidthManager=function(){var e=this,r=this.hierarchyNavigator.getColumnHierarchy();this.columnWidthManager?this.persistingObjects||this.columnWidthManager.updateDataView(this.dataView,r.leafNodes):this.columnWidthManager=new t.controls.TablixColumnWidthManager(this.dataView,(!0),function(t){return e.persistColumnWidths(t)},r.leafNodes)},o.prototype.persistColumnWidths=function(e){this.persistingObjects=!0,this.hostServices.persistProperties(e)},o.prototype.updateViewport=function(e){this.currentViewport=e,this.tablixControl&&(this.tablixControl.viewport=this.currentViewport,this.verifyHeaderResize(),this.refreshControl(!1))},o.prototype.refreshControl=function(e){(this.element.is(":visible")||1===this.getLayoutKind())&&this.tablixControl.refresh(e)},o.prototype.getLayoutKind=function(){return this.isInteractive?0:1},o.prototype.createOrUpdateHierarchyNavigator=function(e){var r=!this.dataView.metadata.segment;if(this.tablixControl)this.hierarchyNavigator.update(this.dataView.matrix,!1,!1,!1,r,e,this.formatters);else{var o=t.createMatrixHierarchyNavigator(this.dataView.matrix,r,this.formatters,this.hostServices.getLocalizedString("ListJoin_Separator"),this.tablixPropertyManager);this.hierarchyNavigator=o}},o.prototype.createTablixControl=function(e){var t=e.general.textSize;this.tablixControl||(this.tablixControl=this.createControl(this.hierarchyNavigator,t)),this.tablixControl.wordWrapRowHeaders=e.rowHeaders.wordWrap},o.prototype.createControl=function(e,o){var i=this,n=this.getLayoutKind(),a={onBindRowHeader:function(e){i.onBindRowHeader(e)},totalLabel:this.hostServices.getLocalizedString(r.TotalLabel),onColumnHeaderClick:function(e,t){return i.onColumnHeaderClick(e,t)},showSortIcons:0===n,tablixPropertyManager:this.tablixPropertyManager},s=new t.MatrixBinder(this.hierarchyNavigator,a),l=1===n?t.controls.internal.DashboardTablixLayoutManager.createLayoutManager(s):t.controls.internal.CanvasTablixLayoutManager.createLayoutManager(s,this.columnWidthManager),u=document.createElement("div");this.element.append(u);var h={interactive:this.isInteractive,enableTouchSupport:!this.isTouchDisabled,layoutKind:n,fontSize:t.TablixPropertyManager.getTextSizeInPx(o)};return new t.controls.TablixControl(e,l,s,u,h)},o.prototype.updateInternal=function(e,r){var o=this;1===this.getLayoutKind()&&this.tablixControl.layoutManager.adjustContentSize(t.converterHelper.hasImageUrlColumn(this.dataView)),this.tablixControl.fontSize=t.TablixPropertyManager.getTextSizeInPx(e),this.verifyHeaderResize(),this.tablixControl.updateModels(!this.persistingObjects,this.hierarchyNavigator.getRowHierarchy().root.children,this.hierarchyNavigator.getColumnHierarchy().root.children),this.tablixControl.viewport=this.currentViewport;var i=this.shouldClearControl(r,this.dataView);setTimeout(function(){o.refreshControl(i);var e=o.columnWidthManager.onColumnsRendered(o.tablixControl.layoutManager.columnWidthsToPersist);o.persistingObjects&&!e&&(o.persistingObjects=!1)},0)},o.prototype.shouldClearControl=function(t,r){return!(this.waitingForSort&&t&&r)||!e.DataViewUtils.isMetadataEquivalent(t.metadata,r.metadata)},o.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},o.prototype.onColumnHeaderClick=function(e,t){this.waitingForSort=!0,this.hostServices.onCustomSort(r.getCustomSortEventArgs(e,t))},o.prototype.needsMoreData=function(e){if(this.waitingForData||!this.hierarchyNavigator.isLeaf(e)||!this.dataView.metadata||!this.dataView.metadata.segment)return!1;var t=this.tablixControl.rowDimension.getItemsCount(),o=t*r.PreferredLoadMoreThreshold;return this.hierarchyNavigator.getLeafIndex(e)>=o},o.prototype.enumerateObjectInstances=function(e){var r=new t.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,r,this.dataView,t.controls.TablixType.Matrix),r.complete()},o.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,t.controls.TablixType.Matrix),e},o.prototype.shouldAllowHeaderResize=function(){return 1===this.hostServices.getViewMode()},o.prototype.onViewModeChanged=function(e){this.tablixControl&&this.tablixControl.toggleTouchBindings(1!==e),this.updateViewport(this.currentViewport)},o.prototype.verifyHeaderResize=function(){var e=this.shouldAllowHeaderResize();e!==this.lastAllowHeaderResize&&(this.lastAllowHeaderResize=e,this.tablixControl.layoutManager.setAllowHeaderResize(e))},o}();t.Matrix=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,o=e.visuals.controls.internal.TablixUtils.CellStyle,i=e.visuals.controls.internal.TablixUtils.EdgeSettings,n=e.visuals.controls.internal.TablixUtils.EdgeType,a=e.visuals.controls.internal.TablixUtils,s=jsCommon.UrlUtils.UrlScheme,l=jsCommon.UrlUtils;!function(e){function r(e,r,o,a,h,d){void 0===d&&(d=!1);var c=h.grid,g=h.rowHeaders,p=h.values,f=h.columnHeaders,m=h.grandTotal;o.paddings.top=o.paddings.bottom=c.rowPadding;var v=t.MatrixHierarchyNavigator.isNodeGrandTotal(r);o.borders.top=new i,(e.row.isFirst&&!a||a&&0===r.leafIndex)&&(o.borders.top.applyParams(t.outline.showTop(g.outline),c.outlineWeight,c.outlineColor,n.Outline),!t.outline.showTop(g.outline)&&t.outline.showTop(p.outline)&&(o.paddings.top+=c.outlineWeight)),o.borders.bottom=new i,e.row.isLast&&(!a||a&&e.column.isLast&&!h.general.rowSubtotals)||a&&e.row.isFirst&&r.isSubtotal?(o.borders.bottom.applyParams(t.outline.showBottom(g.outline),c.outlineWeight,c.outlineColor,n.Outline),!t.outline.showBottom(g.outline)&&t.outline.showBottom(p.outline)&&(o.paddings.bottom+=c.outlineWeight)):o.borders.bottom.applyParams(c.gridHorizontal,c.gridHorizontalWeight,c.gridHorizontalColor,n.Gridline),o.borders.left=new i,(a||e.column.isFirst)&&(o.borders.left.applyParams(t.outline.showLeft(g.outline),c.outlineWeight,c.outlineColor,n.Outline),!t.outline.showLeft(g.outline)&&t.outline.showLeft(f.outline)&&(o.paddings.left+=c.outlineWeight)),o.borders.right=new i;var y=a||e.column.isLast;if(y?o.borders.right.applyParams(t.outline.showRight(g.outline),c.outlineWeight,c.outlineColor,n.Outline):o.borders.right.applyParams(c.gridVertical,c.gridVerticalWeight,c.gridVerticalColor,n.Gridline),m.applyToHeaders&&v)o.fontColor=m.fontColor||g.fontColor,o.backColor=m.backColor||g.backColor;else{var C=p.fontColorPrimary!==p.fontColorSecondary||p.backColorPrimary!==p.backColorSecondary,H=d&&C&&y,w=h.subtotals,b=r.hasSubtotalStyle&&w.fontColor,P=v&&m.fontColor,M=H&&!b&&!P,x=r.hasSubtotalStyle&&w.backColor,S=v&&m.backColor,T=H&&!x&&!S,I=void 0;(M||T)&&(I=s(r.position,h.general,w)),M?o.fontColor=l(I,p):o.fontColor=g.fontColor,T?o.backColor=u(I,p):o.backColor=g.backColor}}function o(e,r,o,a){var s=a.grid,l=a.columnHeaders,u=a.values,h=a.grandTotal,d=a.columnFormatting[r.queryName],c=t.MatrixHierarchyNavigator.isNodeGrandTotal(r);d&&d.styleHeader&&d.fontColor?o.fontColor=d.fontColor:h.applyToHeaders&&c?o.fontColor=h.fontColor||l.fontColor:o.fontColor=l.fontColor,d&&d.styleHeader&&d.backColor?o.backColor=d.backColor:h.applyToHeaders&&c?o.backColor=h.backColor||l.backColor:o.backColor=l.backColor,o.paddings.top=o.paddings.bottom=s.rowPadding,o.borders.top=new i,e.row.isFirst&&o.borders.top.applyParams(t.outline.showTop(l.outline),s.outlineWeight,s.outlineColor,n.Outline),o.borders.bottom=new i,e.row.isLast?o.borders.bottom.applyParams(t.outline.showBottom(l.outline),s.outlineWeight,s.outlineColor,n.Outline):o.borders.bottom.applyParams(s.gridHorizontal,s.gridHorizontalWeight,s.gridHorizontalColor,n.Gridline),o.borders.left=new i,e.column.isFirst&&!t.outline.showLeft(l.outline)&&t.outline.showLeft(u.outline)&&(o.paddings.left+=s.outlineWeight),o.borders.right=new i,e.column.isLast?(o.borders.right.applyParams(t.outline.showRight(l.outline),s.outlineWeight,s.outlineColor,n.Outline),!t.outline.showRight(l.outline)&&t.outline.showRight(u.outline)&&(o.paddings.right+=s.outlineWeight)):o.borders.right.applyParams(s.gridVertical,s.gridVerticalWeight,s.gridVerticalColor,n.Gridline)}function a(e,r,o,a,h){var d=h.grid,c=h.values,g=h.subtotals,p=h.grandTotal,f=h.rowHeaders,m=h.columnHeaders;o.paddings.top=o.paddings.bottom=d.rowPadding,o.borders.top=new i,e.row.isFirst&&(o.borders.top.applyParams(t.outline.showTop(c.outline),d.outlineWeight,d.outlineColor,n.Outline),!t.outline.showTop(c.outline)&&t.outline.showTop(f.outline)&&(o.paddings.top+=d.outlineWeight)),o.borders.bottom=new i,e.row.isLast&&(!a||a&&!h.general.rowSubtotals)||a&&r.isRowGrandTotal?(o.borders.bottom.applyParams(t.outline.showBottom(c.outline),d.outlineWeight,d.outlineColor,n.Outline),!t.outline.showBottom(c.outline)&&t.outline.showBottom(f.outline)&&(o.paddings.bottom+=d.outlineWeight)):o.borders.bottom.applyParams(d.gridHorizontal,d.gridHorizontalWeight,d.gridHorizontalColor),o.borders.left=new i,e.column.isFirst&&o.borders.left.applyParams(t.outline.showLeft(c.outline),d.outlineWeight,d.outlineColor,n.Outline),o.borders.right=new i,e.column.isLast?(o.borders.right.applyParams(t.outline.showRight(c.outline),d.outlineWeight,d.outlineColor,n.Outline),!t.outline.showRight(c.outline)&&t.outline.showRight(m.outline)&&(o.paddings.right+=d.outlineWeight)):o.borders.right.applyParams(d.gridVertical,d.gridVerticalWeight,d.gridVerticalColor,n.Gridline);var v,y,C=r.columnMetadata&&h.columnFormatting[r.columnMetadata.queryName];C&&(r.isGrandTotal?(y=C.styleTotal&&C.fontColor,v=C.styleTotal&&C.backColor):r.hasSubtotalStyle?(y=C.styleSubTotals&&C.fontColor,v=C.styleSubTotals&&C.backColor):(y=C.styleValues&&C.fontColor,v=C.styleValues&&C.backColor));var H=s(r.position,h.general,g),w=l(H,c),b=u(H,c);r.isGrandTotal?(o.fontColor=r.fontColor||y||p.fontColor||g.fontColor||w,o.backColor=r.backColor||v||p.backColor||g.backColor||b):r.hasSubtotalStyle?(o.fontColor=r.fontColor||y||g.fontColor||w,o.backColor=r.backColor||v||g.backColor||b):(o.fontColor=r.fontColor||y||w,o.backColor=r.backColor||v||b)}function s(e,t,r){var o;return o=t.rowSubtotals&&r.backColor?e.row.indexInSiblings:e.row.index,o<0||o%2===0}function l(e,t){return e?t.fontColorPrimary:t.fontColorSecondary}function u(e,t){return e?t.backColorPrimary:t.backColorSecondary}function h(e,r,o,a){var s=a.grid,l=a.columnHeaders,u=a.rowHeaders;r.fontColor=l.fontColor||u.fontColor,r.backColor=l.backColor||u.backColor,r.paddings.top=r.paddings.bottom=s.rowPadding,r.borders.top=new i,e.row.isFirst&&r.borders.top.applyParams(t.outline.showTop(l.outline),s.outlineWeight,s.outlineColor,n.Outline),r.borders.bottom=new i,e.row.isLast?r.borders.bottom.applyParams(t.outline.showBottom(l.outline),s.outlineWeight,s.outlineColor,n.Outline):r.borders.bottom.applyParams(s.gridHorizontal,s.gridHorizontalWeight,s.gridHorizontalColor,n.Gridline),r.borders.left=new i,(e.column.isFirst||o)&&(r.borders.left.applyParams(t.outline.showLeft(l.outline),s.outlineWeight,s.outlineColor,n.Outline),!t.outline.showLeft(l.outline)&&t.outline.showLeft(u.outline)&&(r.paddings.left+=s.outlineWeight)),r.borders.right=new i,r.borders.right.applyParams(s.gridVertical,s.gridVerticalWeight,s.gridVerticalColor,n.Gridline)}e.setRowHeaderStyle=r,e.setColumnHeaderStyle=o,e.setBodyCellStyle=a,e.setCornerCellStyle=h}(r=t.MatrixStyler||(t.MatrixStyler={}));var u=function(){function n(e,t){this.hierarchyNavigator=e,this.options=t}return n.prototype.onDataViewChanged=function(e){this.formattingProperties=e,this.updateTextHeights()},n.prototype.updateTextHeights=function(){this.fontSizeHeader=this.formattingProperties.general.textSize.px,this.textPropsHeader={fontFamily:a.FontFamilyHeader,fontSize:jsCommon.PixelConverter.toString(this.fontSizeHeader)},this.textHeightHeader=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsHeader,"a")),this.fontSizeValue=this.formattingProperties.general.textSize.px,this.textPropsValue={fontFamily:a.FontFamilyCell,fontSize:jsCommon.PixelConverter.toString(this.fontSizeValue)},this.textHeightValue=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsValue,"a")),this.fontSizeTotal=this.formattingProperties.general.textSize.px,this.textPropsTotal={fontFamily:a.FontFamilyTotal,fontSize:jsCommon.PixelConverter.toString(this.fontSizeTotal)},this.textHeightTotal=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsTotal,"a"))},n.prototype.onStartRenderingSession=function(){},n.prototype.onEndRenderingSession=function(){},n.prototype.bindRowHeader=function(e,n){a.resetCellCssClass(n);var s=this.options.tablixPropertyManager,l=new o;this.hierarchyNavigator&&this.hierarchyNavigator.isLeaf(e)&&(a.addCellCssClass(n,a.CssClassMatrixRowHeaderLeaf),l.borders.right=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,s.PropGridOutlineColor.getValue(null))),e.isSubtotal&&(l.paddings.left=a.CellPaddingLeftMatrixTotal),n.contentWidth=0,this.bindHeader(e,n,n.extension.contentHost,this.hierarchyNavigator.getRowHeaderMetadataColumn(e),l),n.contentWidth=Math.ceil(n.contentWidth),this.options.onBindRowHeader&&this.options.onBindRowHeader(e),r.setRowHeaderStyle(n.position,e,l,!1,this.formattingProperties),n.applyStyle(l)},n.prototype.unbindRowHeader=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t)},n.prototype.bindColumnHeader=function(e,n){a.resetCellCssClass(n);var s=new o,l=this.options.tablixPropertyManager,u=!1,h=n.extension.contentHost;if(h=a.appendDiv(h),h.classList.add(a.CssClassWrappingContainer),n.contentWidth=0,this.hierarchyNavigator&&this.hierarchyNavigator.isLeaf(e)){if(s.borders.bottom=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,l.PropGridOutlineColor.getValue(null)),a.addCellCssClass(n,a.CssClassTablixColumnHeaderLeaf),a.addCellCssClass(n,a.CssClassTablixValueNumeric),this.options.showSortIcons){var d=this.getSortableHeaderColumnMetadata(e);d&&(this.registerColumnHeaderClickHandler(d,n),h=a.addSortIconToColumnHeader(d.sort,h),d.sort&&(n.contentWidth=this.fontSizeHeader+a.SortIconPadding))}e.isSubtotal&&e.parent&&e.parent.children.length>1&&e.parent.children[0].isSubtotal&&(u=!0)}n.extension.disableDragResize(),this.bindHeader(e,n,h,this.hierarchyNavigator.getColumnHeaderMetadataColumn(e),s,u),n.contentWidth=Math.ceil(n.contentWidth),r.setColumnHeaderStyle(n.position,e,s,this.formattingProperties),n.applyStyle(s)},n.prototype.unbindColumnHeader=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t),this.getSortableHeaderColumnMetadata(e)&&this.unregisterColumnHeaderClickHandler(t),this.options.showSortIcons&&a.removeSortIcons(t)},n.prototype.bindHeader=function(r,o,i,n,u,h){a.addCellCssClass(o,a.CssClassTablixHeader),u.fontFamily=a.FontFamilyHeader,u.fontColor=a.FontColorHeaders;var d=this.formattingProperties.grid.imageHeight;if(t.converterHelper.isImageUrlColumn(n)?o.contentHeight=d:r.hasSubtotalStyle?o.contentHeight=this.textHeightTotal:o.contentHeight=this.textHeightValue,r.hasSubtotalStyle&&(a.addCellCssClass(o,a.CssClassTablixValueTotal),u.fontFamily=a.FontFamilyTotal),r.isSubtotal&&!h)return a.setCellTextAndTooltip(this.options.totalLabel,i,o.extension.contentHost),void(o.contentWidth=e.TextMeasurementService.measureSvgTextWidth(this.textPropsTotal,this.options.totalLabel));var c=this.getHeaderLabel(r);return c?a.getUrlScheme(n,c)!==s.NONE?(a.appendATagToBodyCell(c,i),void(o.contentWidth+=e.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,c))):t.converterHelper.isImageUrlColumn(n)&&l.isValidImageUrl(c)?(a.appendImgTagToBodyCell(r.valueFormatted,i,d),void(o.contentWidth+=d*a.ImageDefaultAspectRatio)):(a.setCellTextAndTooltip(c,i,o.extension.contentHost),void(o.contentWidth+=e.TextMeasurementService.measureSvgTextWidth(r.hasSubtotalStyle?this.textPropsTotal:this.textPropsHeader,c))):void(i.innerHTML=a.StringNonBreakingSpace)},n.prototype.applyWordWrapping=function(i,n){if(1===n.type){var s=this.hierarchyNavigator.getRowHeaderMetadataColumn(i);if(!t.converterHelper.isWebUrlColumn(s)&&!t.converterHelper.isImageUrlColumn(s)){var l=n.extension.contentHost;t.controls.HTMLElementUtils.clearChildren(l);var u=i.valueFormatted,h=new o;r.setRowHeaderStyle(i.position,i,h,!1,this.formattingProperties);for(var d=n.containerWidth-(h.getExtraRight()+h.getExtraLeft()),c=n.containerHeight-(h.getExtraTop()+h.getExtraBottom()),g=Math.floor(c/this.textHeightHeader),p=jsCommon.WordBreaker.splitByWidth(u,this.textPropsHeader,e.TextMeasurementService.measureSvgTextWidth,d,g,null,!0),f=0,m=p;f<m.length;f++){var v=m[f];a.appendDiv(l,v)}}}},n.prototype.registerColumnHeaderClickHandler=function(e,t){var r=this;if(this.options.onColumnHeaderClick){var o=function(t){if(a.isValidSortClick(t)){var o=a.reverseSort(e.sort);r.options.onColumnHeaderClick(e.queryName?e.queryName:e.displayName,o)}};t.extension.registerClickHandler(o)}},n.prototype.unregisterColumnHeaderClickHandler=function(e){this.options.onColumnHeaderClick&&e.extension.unregisterClickHandler()},n.prototype.bindBodyCell=function(t,o){a.resetCellCssClass(o);var i=new a.CellStyle;o.contentHeight=this.textHeightValue;var n=t.kpiContent;if(n)$(o.extension.contentHost).append(n),o.contentWidth=this.fontSizeValue;else{var s=this.textPropsValue;a.addCellCssClass(o,a.CssClassTablixValueNumeric),t.isTotal&&(a.addCellCssClass(o,a.CssClassTablixValueTotal),i.fontFamily=a.FontFamilyTotal,o.contentHeight=this.textHeightTotal,s=this.textPropsTotal);var l=t.textContent;l&&(a.setCellTextAndTooltip(l,o.extension.contentHost),o.contentWidth=e.TextMeasurementService.measureSvgTextWidth(s,l))}o.contentWidth=Math.ceil(o.contentWidth),r.setBodyCellStyle(o.position,t,i,!1,this.formattingProperties),o.applyStyle(i)},n.prototype.unbindBodyCell=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t)},n.prototype.bindCornerCell=function(n,s){a.resetCellCssClass(s);var l=this.options.tablixPropertyManager,u=new o;u.fontFamily=a.FontFamilyHeader,u.fontColor=a.FontColorHeaders,s.contentHeight=this.textHeightHeader,s.contentWidth=0;var h=s.extension.contentHost;if(h=a.appendDiv(h),h.classList.add(a.CssClassWrappingContainer),n.isColumnHeaderLeaf&&(a.addCellCssClass(s,a.CssClassTablixColumnHeaderLeaf),u.borders.bottom=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,l.PropGridOutlineColor.getValue(null)),this.options.showSortIcons)){var d=this.getSortableCornerColumnMetadata(n);d&&(this.registerColumnHeaderClickHandler(d,s),h=a.addSortIconToColumnHeader(d?d.sort:void 0,h),d.sort&&(s.contentWidth=this.fontSizeHeader+a.SortIconPadding))}a.setCellTextAndTooltip(n.displayName,h,s.extension.contentHost),s.contentWidth+=e.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,n.displayName),s.contentWidth=Math.ceil(s.contentWidth),n.isRowHeaderLeaf&&a.addCellCssClass(s,a.CssClassMatrixRowHeaderLeaf),a.addCellCssClass(s,a.CssClassTablixHeader),r.setCornerCellStyle(s.position,u,!1,this.formattingProperties),s.applyStyle(u),s.extension.disableDragResize()},n.prototype.unbindCornerCell=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t),this.options.showSortIcons&&a.removeSortIcons(t),e.isColumnHeaderLeaf&&this.unregisterColumnHeaderClickHandler(t)},n.prototype.bindEmptySpaceHeaderCell=function(e){},n.prototype.unbindEmptySpaceHeaderCell=function(e){},n.prototype.bindEmptySpaceFooterCell=function(e){},n.prototype.unbindEmptySpaceFooterCell=function(e){},n.prototype.getHeaderLabel=function(e){return e.valueFormatted},n.prototype.getCellContent=function(e){return e.textContent||""},n.prototype.hasRowGroups=function(){var e=this.hierarchyNavigator.getRowHierarchy();return!(!e||!e.levels||0===e.levels.length)},n.prototype.getSortableCornerColumnMetadata=function(e){if(e.isColumnHeaderLeaf)return e.metadata},n.prototype.getSortableHeaderColumnMetadata=function(e){var t=this.hierarchyNavigator.getRowHierarchy();if(!t||!t.levels||0===t.levels.length)return null;var r=this.hierarchyNavigator.getValueSources(),o=r&&r.length>1,i=this.hierarchyNavigator.getColumnHierarchy(),n=i?i.levels.length:0;o?n--:1===n&&i.levels[0]&&i.levels[0].sources&&i.levels[0].sources[0]&&i.levels[0].sources[0].roles&&i.levels[0].sources[0].roles.Values&&(n=0);var a=-1;return 0===n?a=e.levelSourceIndex:e.isSubtotal&&(o?e.parent&&0===e.parent.level&&(a=e.levelSourceIndex):0===e.level&&(a=e.levelSourceIndex)),a!==-1?(a=a?a:0,r[a]):null},n}();t.MatrixBinder=u}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function r(e,t,r,o,i,n,a,l){void 0===n&&(n=!0);var u=new s(o,i);return n&&u.update(e,!1,!1,!1,t,!0,r,a,l),u}var o=e.visuals.controls.internal.TablixUtils.CellPosition,i=e.visuals.controls.internal.TablixUtils,n=i.TablixVisualCell,a=function(e){function t(t,r,o,i,n,a,s){var l,u,h=this;if(o)for(l=o;l.parent;)l=l.parent;if(i)for(u=i;u.parent;)u=u.parent;var d=u&&!!u.isSubtotal,c=!d&&i&&!!i.isSubtotal,g=l&&!!l.isSubtotal,p=!g&&o&&!!o.isSubtotal;return h=e.call(this,t,r,p,c,g,d,n,a,s,0)||this,h.rowItem=o,h.columnItem=i,h.hasSubtotalStyle=o&&o.hasSubtotalStyle||i&&i.hasSubtotalStyle,h}return __extends(t,e),Object.defineProperty(t.prototype,"isMeasure",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isValidUrl",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isValidImage",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(n);t.MatrixVisualBodyItem=a,t.createMatrixHierarchyNavigator=r;var s=function(){function t(e,t){this.tablixPropertyManager=t,this.compositeGroupSeparator=e}return t.prototype.getColumnHierarchyDepth=function(){return Math.max(this.columnHierarchy.levels.length,1)},t.prototype.getRowHierarchyDepth=function(){return Math.max(this.rowHierarchy.levels.length,1)},t.prototype.getLeafCount=function(e){var t=this.getMatrixHierarchy(e);return t?t.leafNodes.length:0},t.prototype.getLeafAt=function(e,t){var r=this.getMatrixHierarchy(e);return r?r.leafNodes[t]:null},t.prototype.getLeafIndex=function(e){return e.leafIndex},t.prototype.getParent=function(e){return 0===e.level?null:e.parent},t.prototype.getIndex=function(e){return e?e.index:-1},t.prototype.isLeaf=function(e){return!e.children||0===e.children.length},t.prototype.isRowHierarchyLeaf=function(e){return!0},t.prototype.isColumnHierarchyLeaf=function(e){return!1},t.prototype.isFirstItem=function(e,t){return e===_.head(t)},t.prototype.areAllParentsFirst=function(e,t){if(!e)return!1;var r=this.getParent(e);return r?this.isFirstItem(e,e.siblings)&&this.areAllParentsFirst(r,r.siblings):this.isFirstItem(e,e.siblings)},t.prototype.isLastItem=function(e,t){if(e!==_.last(t))return!1;if(!this.isItemRow(e)||this.isDataComplete)return!0;for(var r=e.parent;r;){if(r!==_.last(r.siblings))return!0;r=r.parent}return!1},t.prototype.isItemRow=function(e){if(!e)return!1;for(var t=e;t.parent;)t=t.parent;return t.siblings===this.rowHierarchy.root.children},t.prototype.areAllParentsLast=function(e,t){if(!e)return!1;var r=this.getParent(e);return r?this.isLastItem(e,e.siblings)&&this.areAllParentsLast(r,r.siblings):this.isLastItem(e,e.siblings)},t.prototype.getChildren=function(e){return e.children},t.prototype.getChildrenLevelDifference=function(e){var t=1/0,r=this.getChildren(e);if(!_.isEmpty(r))for(var o=0,i=r.length;o<i;o++)t=Math.min(t,r[o].level-e.level);return t},t.prototype.getCount=function(e){return e.length},t.prototype.getAt=function(e,t){return e[t]},t.prototype.getLevel=function(e){return e.level},t.prototype.getRowLeafIndex=function(e){return this.isSteppedLayout&&e.isSubtotal?e.parent?!this.valuesOnRow&&this.areRowSubtotalsBefore?e.parent.leafIndex:e.leafIndex:this.valuesOnRow?e.levelSourceIndex:-1:e.leafIndex},t.prototype.getIntersection=function(e,t){var r,o,i=t.leafIndex;if(r=e.values?e.values[t.leafIndex]:void 0){var n=this.valueSources[r.valueSourceIndex||0],s=n.queryName,l=this.formatters[s],u=this.tooltipFormatters[s];o=new a(r.value,r.objects,e,t,n,l,u)}else o=new a((void 0),(void 0),e,t,(void 0),(void 0),(void 0));var h=this.getRowLeafIndex(e);return o.position.row.index=h,o.position.row.indexInSiblings=e.siblings.indexOf(e),o.position.row.isFirst=0===h,o.position.row.isLast=this.isDataComplete&&h===this.rowHierarchy.leafNodes.length-1,o.position.column.index=i,o.position.column.indexInSiblings=t.siblings.indexOf(t),o.position.column.isFirst=0===i,o.position.column.isLast=i===this.columnHierarchy.leafNodes.length-1,r&&r.objects&&(o.backColor=this.tablixPropertyManager.PropValuesBackColor.getValue(r.objects),o.fontColor=this.tablixPropertyManager.PropValuesFontColor.getValue(r.objects)),o},t.prototype.getCorner=function(e,t){var r=this.columnHierarchy.levels,o=this.rowHierarchy.levels;if(t===r.length-1||0===r.length){var i=o[e];if(i){var n=e===o.length-1,a=this.valuesOnRow&&n;return{metadata:1===i.sources.length||i.sources.length>1&&a?i.sources[0]:null,displayName:a?"":_.map(i.sources,function(e){return e.displayName}).join(this.compositeGroupSeparator),isColumnHeaderLeaf:!0,isRowHeaderLeaf:n,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t}}}if(e===o.length-1){var i=r[t];if(i){var s=i.sources.filter(function(e){return!e.isMeasure});return{metadata:1===i.sources.length?i.sources[0]:null,
displayName:_.map(s,function(e){return e.displayName}).join(this.compositeGroupSeparator),isColumnHeaderLeaf:!1,isRowHeaderLeaf:!0,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t}}}return{metadata:null,displayName:"",isColumnHeaderLeaf:!1,isRowHeaderLeaf:!1,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t}},t.prototype.calculateCornerCellPosition=function(e,t){var r=new o,i=t;r.row.index=r.row.indexInSiblings=i,r.row.isFirst=0===i;var n=this.getColumnHierarchyDepth();r.row.isLast=t===n-1;var a=e;r.column.index=r.column.indexInSiblings=a,r.column.isFirst=0===a;var s=this.getRowHierarchyDepth();return r.column.isLast=a===s-1,r},t.prototype.headerItemEquals=function(e,t){return!(!e||!t)&&e===t},t.prototype.bodyCellItemEquals=function(e,t){return e.position.isMatch(t.position)},t.prototype.cornerCellItemEquals=function(e,t){var r=e,o=t;return!(!r||!o)&&(r.displayName===o.displayName&&r.isColumnHeaderLeaf===o.isColumnHeaderLeaf&&r.isRowHeaderLeaf===o.isRowHeaderLeaf&&r.metadata===o.metadata)},t.prototype.getColumnHierarchy=function(){return this.columnHierarchy},t.prototype.getRowHierarchy=function(){return this.rowHierarchy},t.prototype.getValueSources=function(){return this.valueSources},t.prototype.valuesOnRowApplied=function(){return this.valuesOnRow},t.prototype.hasMultipleValueSources=function(){return this.multipleValueSources},t.prototype.update=function(e,t,r,o,i,n,a,s,l){var u=this;this.isSteppedLayout=t,this.valuesOnRow=r,this.areRowSubtotalsBefore=o,this.isDataComplete=i,this.valueSources=e.valueSources,this.formatters=a,this.tooltipFormatters=s||{},this.subtotalByColumn=l||{},this.multipleValueSources=e.valueSources.length>1,this.rowHierarchy=this.wrapHierarchy(e.rows),n=n||this.valuesOnRow,n&&(this.columnHierarchy=this.wrapHierarchy(e.columns)),this.valuesOnRow&&this.pivotValues(),this.updateHierarchy(this.rowHierarchy,this.isSteppedLayout,this.areRowSubtotalsBefore,function(e,t){return u.calculateRowHeaderPosition(e,t)}),n&&(this.updateHierarchy(this.columnHierarchy,!1,!1,function(e,t){return u.calculateColumnHeaderPosition(e,t)}),this.updateStaticColumnHeaders(this.columnHierarchy))},t.prototype.pivotValues=function(){_.isEmpty(this.columnHierarchy.root.children)||this.removeValueNodesFromColumnHierarchy(this.columnHierarchy.root.children),_.isEmpty(this.rowHierarchy.root.children)||this.addValueNodesToRowHierarchy(this.rowHierarchy.root.children,this.rowHierarchy.levels.length>0),this.moveValueLevelFromColumnToRowHierarchy()},t.prototype.removeValueNodesFromColumnHierarchy=function(e){for(var t=0,r=e;t<r.length;t++){var o=r[t];if(!o.parent&&this.isLeaf(o))return e.length=0,void e.push({level:0});this.isLeaf(o.children[0])?o.children=void 0:this.removeValueNodesFromColumnHierarchy(o.children)}},t.prototype.addValueNodesToRowHierarchy=function(e,t){for(var r=this.getRowHierarchyDepth(),o=this.valueSources.length,i=e.length,n=0;n<i;n++){var a=e[n];if(this.isLeaf(a)){var s=void 0,l=void 0,u=void 0;this.isSteppedLayout&&a.isSubtotal||!t?(e.splice(n,1),s=e,l=n,u=a.level,i=i-1+o,n=n-1+o):(a.children=[],s=a.children,l=0,u=r);for(var h=0;h<o;h++){var d=this.createRowValueNode(h,o,a,u);s.splice(l++,0,d)}a.values=null}else this.addValueNodesToRowHierarchy(a.children,t)}},t.prototype.moveValueLevelFromColumnToRowHierarchy=function(){this.rowHierarchy.levels.push(this.columnHierarchy.levels.pop())},t.prototype.createRowValueNode=function(e,t,r,o){var i={level:o,levelSourceIndex:e,isSubtotal:r.isSubtotal,hasSubtotalStyle:!!r.hasSubtotalStyle,values:{}},n=0,a=0;for(var s in r.values)n%t===e&&(i.values[a++]=r.values[n]),n++;return i},t.prototype.wrapHierarchy=function(e){var t;return t={levels:this.wrapLevels(e.levels),root:{children:this.wrapNodes(e.root.children,e)}},t.leafNodes=[],t},t.prototype.wrapLevels=function(t){if(t){for(var r=[],o=0,i=t;o<i.length;o++){var n=i[o];r.push(e.Prototype.inherit(n))}return r}},t.prototype.wrapNodes=function(t,r){if(t){for(var o=[],i=0,n=t;i<n.length;i++){var a=n[i],s=e.Prototype.inherit(a);if(a.isCollapsed&&!_.isEmpty(a.children)){var l=_.find(a.children,function(e){return e.isSubtotal});l&&(s.values=l.values),s.children=null,s.hasSubtotalStyle=!0}else{if(s.isSubtotal){var u=r.levels[s.level||0];if(1===u.sources.length&&this.subtotalByColumn[u.sources[0].queryName]===!1)continue}s.hasSubtotalStyle=!!a.isSubtotal,s.children=this.wrapNodes(a.children,r)}o.push(s)}return o}},t.prototype.updateHierarchy=function(e,t,r,o){e.leafNodes.length>0&&(e.leafNodes.length=0),e.root.children&&this.updateRecursive(e,e.root.children,null,e.leafNodes,t,r,o)},t.prototype.updateRecursive=function(e,t,r,o,i,n,a){for(var s,l=function(l,h){var d=t[l];if(d.siblings=t,r&&(d.parent=r),s=e===u.rowHierarchy&&u.isSteppedLayout&&d.isSubtotal&&void 0!==d.levelSourceIndex?_.last(e.levels):e.levels[d.level],d.hierarchyLevel=s,s)if(d.levelValues){for(var c=[],g=[],p=0,f=d.levelValues;p<f.length;p++){var m=f[p],v=s.sources[m.levelSourceIndex||0],y=u.formatters[v.queryName],C=m.value;c.push(y.format(C,null));var H=u.tooltipFormatters[v.queryName];H&&g.push(H.format(C,null))}d.valueFormatted=c.join(u.compositeGroupSeparator),d.tooltipValueFormatted=_.isEmpty(g)?void 0:g.join(u.compositeGroupSeparator),d.queryName=1!==s.sources.length?void 0:s.sources[0].queryName}else{var v=s.sources[d.levelSourceIndex||0];d.valueFormatted=v.displayName,d.tooltipValueFormatted=v.displayName,d.queryName=v.queryName}d.index=l,_.isEmpty(d.children)?(!i||!d.isSubtotal||!n&&d.parent&&!d.parent.isSubtotal||u.valuesOnRow&&d.parent)&&(d.leafIndex=o.length,o.push(d)):(i&&(d.leafIndex=o.length,o.push(d)),u.updateRecursive(e,d.children,d,o,i,n,a),i&&(u.hasMultipleValueSources()&&!_.some(d.children,function(e){return _.some(e.hierarchyLevel.sources,function(e){return!e.isMeasure})})||(d.hasSubtotalStyle=!0))),d.position=a(d,t)},u=this,h=0,d=t.length;h<d;h++)l(h,d)},t.prototype.updateStaticColumnHeaders=function(e){var t=e.leafNodes;if(t&&t.length>0){if(!t[0].identity&&this.valuesOnRow&&1===t.length)return;for(var r=e.levels[t[0].level].sources,o=0,i=t.length;o<i;o++){var n=t[o];if(!n.identity&&_.isEmpty(n.levelValues)){var a=r[n.levelSourceIndex?n.levelSourceIndex:0];a&&(n.valueFormatted=a.displayName)}}}},t.prototype.getMatrixHierarchy=function(e){var t=this.rowHierarchy.root.children;if(t&&e===t)return this.rowHierarchy;var r=this.columnHierarchy.root.children;return r&&e===r?this.columnHierarchy:null},t.prototype.calculateRowHeaderPosition=function(e,t){var r=new o;r.row.index=this.getRowLeafIndex(e),r.row.indexInSiblings=this.getIndex(e),r.row.isFirst=this.areAllParentsFirst(e,t),r.row.isLast=this.areAllParentsLast(e,t);var i=this.getLevel(e);return r.column.index=r.column.indexInSiblings=i,r.column.isFirst=0===i,r.column.isLast=this.isLeaf(e),r},t.prototype.calculateColumnHeaderPosition=function(e,t){var r=new o,i=this.getLevel(e);r.row.index=r.row.indexInSiblings=i,r.row.isFirst=0===i,r.row.isLast=this.isLeaf(e);var n=this.getIndex(e);return r.column.index=r.column.indexInSiblings=n,r.column.isFirst=this.areAllParentsFirst(e,t),r.column.isLast=this.areAllParentsLast(e,t),r},t.prototype.getRowHeaderMetadataColumn=function(e){var t=this.getRowHeaderMetadataColumns(e);return t&&t[0]},t.prototype.getRowHeaderMetadataColumns=function(e){if(e&&this.rowHierarchy)return this.getHierarchyMetadataColumns(this.rowHierarchy,e.level)},t.prototype.getColumnHeaderMetadataColumn=function(e){var t=this.getColumnHeaderMetadataColumns(e);return t&&t[0]},t.prototype.getColumnHeaderMetadataColumns=function(e){if(e&&this.columnHierarchy)return this.getHierarchyMetadataColumns(this.columnHierarchy,e.level)},t.prototype.getHierarchyMetadataColumns=function(e,t){if(e&&e.levels&&!(e.levels.length<t)){var r=e.levels[t];if(r&&r.sources&&0!==r.sources.length)return r.sources}},t.isNodeGrandTotal=function(e){if(e){for(var t=e;t.parent;)t=t.parent;return t.isSubtotal}return!1},t}();t.MatrixHierarchyNavigator=s}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(r){function o(e){var t={content:"",classNames:null,styleProperties:{position:"absolute",left:"0",top:"0",visibility:"hidden"},attributes:null};return e.insertAdjacentHTML("beforeend",M.build(t,null)),e.lastChild}function i(t,r){return _.isEmpty(t)?0:e.TextMeasurementService.measureSvgTextWidth(r,t)}function n(t,r,o){return _.isEmpty(t)?[t]:(t=t.trim(),I.splitByWidth(t,o,e.TextMeasurementService.measureSvgTextWidth,r,S.WordWrappingMaxLines,void 0,!0,!0))}function a(e,t){return Math.max(0,e-(t.getExtraLeft()+t.getExtraRight()))}function s(e){e.opacity=R}function l(e,r){return M.build({content:"",classNames:[t.KpiUtil.getClassForKpi(e,r)||""],styleProperties:{display:"inline-block","vertical-align":"bottom",margin:"0"},attributes:null},null)}function u(e,t){return{children:[{tagName:"img",content:"",classNames:null,styleProperties:{"max-height":"100%","max-width":"100%"},attributes:{src:e},contextMenuHandler:function(e){e.stopPropagation()}}],classNames:[S.CssClassImageContainer],styleProperties:{height:x.pixelUnits(t),width:x.pixelUnits(t)},attributes:null}}function h(e,t,r){var o={attributes:{},styleProperties:{},classNames:["flex-container"]},i=d(e,t);switch(r.classNames.push("stretching-content"),e.layout){case"IconOnly":r.children=[i],c(e,r),o.children=[r];break;case"After":c(e,i),o.children=[r,i];break;case"Before":default:c(e,i),o.children=[i,r]}return o}function d(e,t){var r=x.pixelUnits(t);return null===e.value?{tagName:"div",styleProperties:{height:r,width:r},attributes:{},classNames:null}:e.value.svgId?{tagName:"svg",attributes:{height:r,width:r},classNames:null,styleProperties:{},children:[{tagName:"use",attributes:{href:"#"+e.value.svgId},classNames:null,styleProperties:{}}]}:null!=e.value.url?{tagName:"img",classNames:null,styleProperties:{height:r,width:r},attributes:{src:L(e.value.url)}}:void 0}function c(e,t){t.classNames||(t.classNames=[]);var r=t.classNames;switch(r.push("tablixIcon"),e.layout){case"IconOnly":break;case"Before":r.push("before");break;case"After":default:r.push("after")}switch(e.verticalAlignment){case"Bottom":r.push("bottom");break;case"Middle":r.push("middle");break;case"Top":default:r.push("top")}}function g(e,t){return e?S.getUrlIconName(t):null}function p(e,t,r,o,i,n){var a={tagName:"a",classNames:[],styleProperties:{},attributes:{href:t,target:"_blank",rel:"noopener noreferrer"},clickHandler:function(e){e.stopPropagation(),o(t,e)},contextMenuHandler:function(e){e.stopPropagation()}};return"string"==typeof e?a.content=e:a.children=[e],r&&(a.content=void 0,a.children=void 0,a.classNames.push(S.CssClassValueURLIcon,r)),i&&(a.styleProperties.color="inherit"),n&&(a.attributes.title=t),a}function f(e){return e-1}function m(e,t,r,o,i,n){var a;return t&&(a=e?["powervisuals-glyph","sort-icon",v(e)]:r?["powervisuals-glyph","sort-icon",v(o),"future"]:["sort-icon"]),{content:S.StringNonBreakingSpace,attributes:null,styleProperties:{"font-size":n,bottom:i+"px"},classNames:a}}function v(e){switch(e){case 1:return"caret-up";case 2:return"caret-down"}}function y(e,t){return S.getUrlScheme(e,t)!==T.NONE}function C(e){return e?e.replace(/&#10;/g,"<BR />"):e}function H(e,r,o){var i={measuredFontHeight:null,textProperties:t.FontProperties.toTextProperties(e),fontProperties:e,nonInheritedFontProperties:t.FontProperties.excludeInheritedProperties(e,o)};return r.addItem(i),i}function w(e,r,o,i){return H(t.FontProperties.inherit(e.fontProperties,r),o,i)}function b(e,t,r){var o=r?e.nonInheritedFontProperties:e.fontProperties;o.family&&(t.fontFamily=o.family),o.size&&(t.fontSize=o.size),o.weight&&(t.fontWeight=o.weight)}function P(e,r,o){if(null==e||e===t.textAlignment.auto){if(!o)return;e=o}switch(e){case t.textAlignment.left:return void r.push(S.CSSClassPivotTableAlignLeft);case t.textAlignment.center:return void r.push(S.CSSClassPivotTableAlignCenter);case t.textAlignment.right:return void r.push(S.CSSClassPivotTableAlignRight);default:return}}var M=e.visuals.controls.pivotTable.ElementBuilder,x=e.visuals.controls.pivotTable.PivotTableControl,S=e.visuals.controls.internal.TablixUtils,T=jsCommon.UrlUtils.UrlScheme,I=jsCommon.WordBreaker,L=jsCommon.StringExtensions.encodeHtml,R="0.3";r.cssClassCellInteractive="cell-interactive",r.cssPivotTableCellClassNoWrap="pivotTableCellNoWrap",r.cssPivotTableCellClassWrap="pivotTableCellWrap",r.CellHorizontalPadding=5,r.ExpandCollapseRightMargin=5,r.TablixIconMargin=5,r.addMeasureElement=o,r.measureText=i,r.getWordWrappingLines=n,r.getNetWidth=a,r.setUnselectedStyle=s,r.createKpiDomString=l,r.buildImage=u,r.addIconToCell=h,r.getUrlIconName=g,r.addHyperlink=p,r.getSortIconHeight=f,r.buildSortIcon=m,r.getSortIconClass=v,r.isValidUrl=y,r.replaceEncodedNewLines=C,r.createFontInfo=H,r.overrideFontInfo=w,r.applyFontInfo=b,r.addAlignmentCssClass=P;var N=function(){function e(){this.items=[]}return e.prototype.addItem=function(e){this.items.push(e)},e.prototype.measureAll=function(e){if(!_.isEmpty(this.items)){for(var r=[],o=0,i=this.items;o<i.length;o++){var n=i[o],a={content:"a",classNames:null,styleProperties:t.FontProperties.toHTMLStyle(n.fontProperties),attributes:null};r.push(M.build(a,null))}var s=r.join("");e.insertAdjacentHTML("beforeend",s);for(var l,u=!0,h=0,d=this.items;h<d.length;h++){var n=d[h];u?(u=!1,l=e.firstChild):l=l.nextSibling,n.measuredFontHeight=Math.ceil(l.offsetHeight)}e.innerHTML=""}},e}();r.FontInfoMeasurer=N}(r=t.PivotTableBinderUtils||(t.PivotTableBinderUtils={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(t,r,o){if(r){var i,s,l=t.aggregates;if(null!=r.minValue?i=r.minValue:l&&null!=l.min&&_.isNumber(l.min)&&(i=l.min),null!=r.maxValue?s=r.maxValue:l&&null!=l.max&&_.isNumber(l.max)&&(s=l.max),!(null==i||null==s||i>s)){var u=null!=r.minValue,h=null!=r.maxValue;i>=0&&s>0&&!u&&(i=0),i<0&&s<0&&!h&&(s=0);var d;d=0===i&&0===s?.5:i>=0&&s>0&&u?0:i<0&&s<=0&&h?1:(0-i)/(s-i);var c;return o.isHighContrast&&(c={visible:!0,color:e.ColorHelper.getThemeColor(o,e.ForegroundColorName),width:a}),{min:i,max:s,range:s-i,zeroPosition:d,positiveColor:n(e.ColorHelper.getFillColor(o,r.positiveColor,e.BackgroundColorName)),negativeColor:n(e.ColorHelper.getFillColor(o,r.negativeColor,e.BackgroundColorName)),axisColor:n(e.ColorHelper.getFillColor(o,r.axisColor,e.ForegroundColorName)),hideText:!!r.hideText,reverseDirection:!!r.reverseDirection,strokeSettings:c}}}}function o(e,t,r,o){var n=r.getExtraLeft()+"px",a=r.getExtraRight()+"px",s=r.getExtraTop()+"px",l=r.getExtraBottom()+"px",u={children:[],attributes:{},classNames:[],styleProperties:{position:"absolute",left:n,right:a,top:s,bottom:l}},h=i(t,o);h&&u.children.push(h);var d=t.zeroPosition;t.reverseDirection&&(d=1-d);var c={content:"",attributes:{},classNames:["dataBarAxis"],styleProperties:{top:"-"+s,bottom:"-"+l,left:100*d+"%","border-left-color":t.axisColor}};u.children.push(c);var g=e.styleProperties;return g.position="absolute",g.left=n,g.right=a,g.top=s,g.bottom=l,{children:[u,e],classNames:[],attributes:{},styleProperties:{}}}function i(e,t){if(null!=t&&_.isNumber(t)&&0!==t){var r=e.min,o=e.max,i=e.range,n=e.zeroPosition;if(t>=o){if(1===n)return;t=o}else if(t<=r){if(0===n)return;t=r}var a,s,l;if(0===i?(a=s=n,l=e.positiveColor):t>0?(a=n,s=(t-r)/i,l=e.positiveColor):(a=(t-r)/i,s=n,l=e.negativeColor),e.reverseDirection){var u=a;a=1-s,s=1-u}var h={left:100*a+"%",width:100*(s-a)+"%",background:l},d=e.strokeSettings;return d&&d.visible&&(h.outline=d.width+"px solid "+d.color,h["outline-offset"]="-"+d.width+"px"),{content:"",attributes:{},classNames:["dataBar"],styleProperties:h}}}var n=jsCommon.StringExtensions.encodeHtml,a=1;t.getColumnDataBarsSettings=r,t.addDataBarsToCell=o}(t=e.PivotTableBinderUtils||(e.PivotTableBinderUtils={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(t){function r(t,r,o){for(var i={remove:[],merge:[]},n=0,a=t;n<a.length;n++){var s=a[n],l={selector:s.selector,objectName:e.TablixPropertyManager.PropColumnWidthValue.objectName,properties:{}};l.properties[e.TablixPropertyManager.PropColumnWidthValue.propertyName]=s.value,null==s.value?i.remove.push(l):i.merge.push(l)}o&&o(),r.persistProperties(i)}t.persistWidths=r}(t=e.PivotTableSizeManagerUtils||(e.PivotTableSizeManagerUtils={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=jsCommon.BrowserUtils,o=t.controls.pivotTable.PivotTableControl,i=e.visuals.PivotTableOptions,n=t.controls.pivotTable.PivotTableRenderingMode,a=jsCommon.ScreenReaderUtil,s=t.controls.internal.TablixUtils,l=function(){function l(e,t){void 0===e&&(e=i.createDefaultConstructorOptions()),this.options=e,this.featureSwitches=t||{},this.options.tooltipsEnabled=this.options.tooltipsEnabled,this.suppressNextRender=!1,this.tooltipType=0}return l.prototype.init=function(e){var r=this;this.element=e.element,this.hostServices=e.host,this.waitingForData=!1,this.style=e.style,this.tablixPropertyManager=new t.TablixPropertyManager(this.style),this.selectionManager=new t.PivotTableSelectionManager(this.hostServices),this.sortingManager=new t.PivotTableSortingManager(this.hostServices),this.sizeManager=new t.PivotTableSizeManager(this.hostServices),this.sizeManager.onPersisting=function(){r.suppressNextRender=!0},this.tooltipService=t.createTooltipService(e.host),this.valueLabel=this.hostServices.getLocalizedString(s.ValueLabel),this.totalLabel=this.hostServices.getLocalizedString(s.TotalLabel)},l.prototype.update=function(t){return __awaiter(this,void 0,e.Promise,function(){return __generator(this,function(r){switch(r.label){case 0:return t.type&e.VisualUpdateType.Data?[4,this.onDataViewChanged(t.dataViews,t.operationKind,t.viewport)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.pivotTableControl&&t.type&e.VisualUpdateType.Resize?(this.pivotTableControl.setWidth(t.viewport.width),this.pivotTableControl.setHeight(t.viewport.height),[4,this.renderControl(n.Incremental,null,null)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},l.prototype.updatePersistedWidths=function(e){var r=t.TablixPropertyManager.PropColumnPivotTableAutoSizeColumns.getValue(this.dataView.metadata.objects);if(!r&&this.pivotTableControl){for(var o=[],i=this.columnHierarchyNavigator.getHierarchyLeafNodes(),n=this.pivotTableControl.getColumnWidthMeasureManager().getPageColumns(),a=0,s=0,l=n;s<l.length;s++)for(var u=l[s],h=u.getColumnWidths(),d=0,c=h;d<c.length;d++){var g=c[d];o.push({node:i[a],width:g}),a++}for(var p=[],f=this.rowHierarchyNavigator.getHierarchyDepth(),m=this.columnHierarchyNavigator.getHierarchyDepth(),v=0;v<f;v++)p.push({corner:this.rowHierarchyNavigator.getCorner(v,m-1),width:this.pivotTableControl.getRowLevelWidthMeasureManager().getLevelWidth(v)});this.sizeManager.setMissingWidths(o,p)}else if(r&&e&&e.metadata&&e.metadata.objects&&!t.TablixPropertyManager.PropColumnPivotTableAutoSizeColumns.getValue(e.metadata.objects)){for(var i=this.columnHierarchyNavigator.getHierarchyLeafNodes(),y=[],f=this.rowHierarchyNavigator.getHierarchyDepth(),m=this.columnHierarchyNavigator.getHierarchyDepth(),v=0;v<f;v++)y.push(this.rowHierarchyNavigator.getCorner(v,m-1));this.sizeManager.clearWidths(i,y),this.suppressNextRender=!1}},l.prototype.onDataViewChanged=function(t,r,o){return __awaiter(this,void 0,e.Promise,function(){var i,n,a,s=this;return __generator(this,function(l){switch(l.label){case 0:return this.setExpandCollapseEnabled(),_.isEmpty(t)?[3,5]:(i=this.dataView,this.dataView=t[0],n=!this.dataView.metadata.segment,this.formattingProperties=this.tablixPropertyManager.getPivotTableObjects(this.dataView,function(e){for(var t,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(t=s.hostServices).getLocalizedString.apply(t,[e].concat(r))},this.expandCollapseEnabled,this.style),this.formatters=this.formattingProperties.formatters,this.tooltipFormatters=this.formattingProperties.tooltipFormatters,a=this.formattingProperties.values.valuesOnRow&&this.dataView.matrix.valueSources.length>1,r!==e.VisualDataChangeOperationKind.Append?[3,2]:[4,this.onAppendDataView(i,a,n)]);case 1:return l.sent(),[3,4];case 2:return[4,this.onNewDataView(i,o,a,n)];case 3:l.sent(),l.label=4;case 4:return this.pivotTableControl.restoreFocus(),[3,6];case 5:this.dataView=void 0,this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(void 0,void 0),this.pivotTableControl&&this.pivotTableControl.clear(),l.label=6;case 6:return this.waitingForData=!1,[2]}})})},l.prototype.onAppendDataView=function(r,o,i){return __awaiter(this,void 0,e.Promise,function(){var e,a,s;return __generator(this,function(l){switch(l.label){case 0:return e=this.rowHierarchyNavigator.getHierarchyLeafCount(),a=this.getPreviousVisibleRowStart(),s=this.getPreviousVisibleColumnStart(),this.updateHierarchyNavigators(this.formattingProperties.rowHeaders.steppedLayout,o,this.formattingProperties.subtotals.rowSubtotalsPosition===t.rowSubtotalPosition.top,i,r.matrix.rows.root!==this.dataView.matrix.rows.root),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),e>this.rowHierarchyNavigator.getHierarchyLeafCount()||!_.isEqual(r.metadata.columns,this.dataView.metadata.columns)?[4,this.renderControl(n.ClearMeasurement,this.getVisibleRowStart(a,!1),this.getVisibleColumnStart(s))]:[3,2];case 1:return l.sent(),[3,4];case 2:return[4,this.renderControl(n.ClearRendering,null,null)];case 3:l.sent(),l.label=4;case 4:return[2]}})})},l.prototype.onNewDataView=function(r,o,i,a){return __awaiter(this,void 0,e.Promise,function(){var e,s,l,u,h,d,c,g,p;return __generator(this,function(f){switch(f.label){case 0:return this.updatePersistedWidths(r),e=this.formattingProperties.rowHeaders.steppedLayout,s=this.getPreviousVisibleRowStart(),l=this.getPreviousVisibleColumnStart(),u=this.rowHierarchyNavigator?this.rowHierarchyNavigator.getHierarchyLeafCount():0,h=this.columnHierarchyNavigator?this.columnHierarchyNavigator.getHierarchyLeafCount():0,this.createOrUpdateControlAndNavigators(e,i,this.formattingProperties.subtotals.rowSubtotalsPosition===t.rowSubtotalPosition.top,a),d=this.matrixNavigator.getColumnHierarchy(),c=this.matrixNavigator.getValueSources(),this.sizeManager.onDataViewChanged(d,c,this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,i),this.sortingManager.onDataViewChanged(this.matrixNavigator.getRowHierarchy(),d,c,e,i),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.suppressNextRender&&u===this.rowHierarchyNavigator.getHierarchyLeafCount()&&h===this.columnHierarchyNavigator.getHierarchyLeafCount()?[3,2]:(this.pivotTableControl.clear(),this.pivotTableControl.setWidth(o.width),this.pivotTableControl.setHeight(o.height),g=this.hostServices.tooltips(),this.options.tooltipsEnabled&&g&&g.enabled()?this.tooltipType=1:this.tooltipType=0,this.interactionManager&&this.interactionManager.setTooltipsEnabled(1===this.tooltipType),p=this.expandCollapseEnabled&&"interactive"===this.options.expandCollapse.buttonsOption,this.binder.onDataViewChanged(this.dataView,this.formattingProperties,this.style,0===this.tooltipType,p),this.applyContainerStyles(),[4,this.renderControl(n.ClearMeasurement,this.getVisibleRowStart(s,t.PivotTableSortingManager.hasSortingChanged(r,this.dataView)),this.getVisibleColumnStart(l))]);case 1:f.sent(),f.label=2;case 2:return this.suppressNextRender=!1,[2]}})})},l.prototype.applyContainerStyles=function(){var e=this.binder.getCornerContainerFontInfo().fontProperties,r=this.pivotTableControl.getCornerContainer();t.FontProperties.applyStyleToElement(e,r);var o=this.binder.getColumnHeaderContainerFontInfo().fontProperties,i=this.pivotTableControl.getColumnHeaderContainer();t.FontProperties.applyStyleToElement(o,i);var n=this.binder.getRowHeaderContainerFontInfo().fontProperties,a=this.pivotTableControl.getRowHeaderContainer();t.FontProperties.applyStyleToElement(n,a);var s=this.pivotTableControl.getFloatingRowHeaderContainer();t.FontProperties.applyStyleToElement(n,s);var l=this.binder.getValueContainerFontInfo().fontProperties,u=this.pivotTableControl.getBodyCellContainer();t.FontProperties.applyStyleToElement(l,u);var h=this.pivotTableControl.getFloatingBodyCellContainer();t.FontProperties.applyStyleToElement(l,h)},l.prototype.onClearSelection=function(){this.selectionManager.clearLocal()},l.prototype.onRestoreSelection=function(e){var t=this.selectionManager.restoreSelectionState(e.selection,this.matrixNavigator);return this.renderSelection(),t},l.prototype.updateHierarchyNavigators=function(e,t,r,o,i){this.matrixNavigator.update(this.dataView.matrix,e,t,r,o,i,this.formatters,this.tooltipFormatters,this.getSubtotalByColumn()),this.rowHierarchyNavigator.setHierarchy(this.matrixNavigator.getRowHierarchy()),this.columnHierarchyNavigator.setHierarchy(this.matrixNavigator.getColumnHierarchy())},l.prototype.getSubtotalByColumn=function(){for(var e={},r=this.dataView.metadata.objects,o=t.TablixPropertyManager.PropSubTotalsPivotTableRowSubtotals.getValue(r),i=t.TablixPropertyManager.PropSubTotalsPivotTableRowSubtotalsPerLevel.getValue(r),n=t.TablixPropertyManager.PropSubTotalsPivotTableColumnSubtotals.getValue(r),a=t.TablixPropertyManager.PropSubTotalsPivotTableColumnSubtotalsPerLevel.getValue(r),s=0,l=this.dataView.metadata.columns;s<l.length;s++){var u=l[s],h=void 0,d=void 0;if(u.roles){if(u.roles[t.matrixRoleNames.rows])h=o,d=i;else{if(!u.roles[t.matrixRoleNames.columns])continue;h=n,d=a}e[u.queryName]=h&&(!d||t.TablixPropertyManager.PropSubTotalsPivotTableLevelSubtotalEnabled.getValue(u.objects))}}return e},l.prototype.renderControl=function(e,t,r){var o=this.hostServices.promiseFactory().defer();return t||r?this.pivotTableControl.makeVisible(e,t,r,function(e){e?o.reject(e):o.resolve(null)}):this.pivotTableControl.render(e,function(e){e?o.reject(e):o.resolve(null)}),o.promise},l.prototype.getPreviousVisibleRowStart=function(){if(this.pivotTableControl){var e=this.pivotTableControl.getVisibleRowStart();if(!e)return null;var t=this.rowHierarchyNavigator.getHierarchyLeafAt(e.rowIndex);return t?{item:t,offset:e.visibleHeight}:null}},l.prototype.getPreviousVisibleColumnStart=function(){if(this.pivotTableControl){var e=this.pivotTableControl.getVisibleColumnStart();if(!e)return null;var t=this.columnHierarchyNavigator.getHierarchyLeafAt(e.columnIndex);return t?{item:t,offset:e.visibleWidth}:null}},l.prototype.getVisibleRowStart=function(e,r){if(!e)return null;if(0===this.pivotTableControl.getViewport().top)return null;if(r)return{rowIndex:0,visibleHeight:Number.MAX_VALUE};var o=t.PivotTableSelectionManager.getMatchingHeader(e.item,this.rowHierarchyNavigator.getHierarchyItems());if(!o||!this.rowHierarchyNavigator.isLeaf(o))return null;var i=this.rowHierarchyNavigator.getLeafIndex(o);return void 0===i?null:{rowIndex:i,visibleHeight:e.offset}},l.prototype.getVisibleColumnStart=function(e){if(!e)return null;var r=t.PivotTableSelectionManager.getMatchingHeader(e.item,this.columnHierarchyNavigator.getHierarchyItems());return r&&this.columnHierarchyNavigator.isLeaf(r)?{columnIndex:this.columnHierarchyNavigator.getLeafIndex(r),visibleWidth:e.offset}:null},l.prototype.renderSelection=function(){this.pivotTableControl.render(n.ClearRendering)},l.prototype.createOrUpdateControlAndNavigators=function(e,r,i,n){var a=this,s=this.hostServices.getLocalizedString("ListJoin_Separator");if(this.matrixNavigator||(this.matrixNavigator=new t.MatrixHierarchyNavigator(s,this.tablixPropertyManager)),this.rowHierarchyNavigator?e?this.rowHierarchyNavigator instanceof t.PivotTableSteppedHierarchyNavigator||(this.rowHierarchyNavigator=new t.PivotTableSteppedHierarchyNavigator(this.matrixNavigator)):this.rowHierarchyNavigator instanceof t.PivotTableSteppedHierarchyNavigator&&(this.rowHierarchyNavigator=new t.PivotTableHierarchyNavigator(this.matrixNavigator)):(this.rowHierarchyNavigator=e?new t.PivotTableSteppedHierarchyNavigator(this.matrixNavigator):new t.PivotTableHierarchyNavigator(this.matrixNavigator),this.columnHierarchyNavigator=new t.PivotTableHierarchyNavigator(this.matrixNavigator)),this.updateHierarchyNavigators(e,r,i,n,!0),this.pivotTableControl)this.pivotTableControl.getSteppedLayout()!==e&&this.switchRowHeadersLayout(e);else{var l={onBindRowHeader:function(e){a.onBindRowHeader(e)},onHyperlinkClicked:function(e,t){return a.onHyperlinkClicked(e,t)},onRowHeaderExpansionChange:function(e,r){return a.onHeaderExpansionChange(e,[t.matrixRoleNames.rows],r)},defaultTotalLabel:this.totalLabel,selectionEnabled:this.options.selection&&this.options.selection.enabled,sortingEnabled:this.options.sorting&&this.options.sorting.enabled,sortIconEnabled:this.options.sorting&&this.options.sorting.showActiveSortIcon,interactivityIndicatorEnabled:this.options.interactivityIndicatorEnabled,hyperlinksEnabled:this.featureSwitches.conditionalTablixWebURL,tablixPropertyManager:this.tablixPropertyManager},u=document.createElement("div");u.className="pivotTableContainer",this.element.append(u),this.binder=new t.PivotTableBinder(l,this.selectionManager,this.sortingManager,u),this.pivotTableControl=new o(u,this.sizeManager,this.createControlOptions()),this.pivotTableControl.setClassName("pivotTable"),this.switchRowHeadersLayout(e),this.pivotTableControl.setColumnNavigator(this.columnHierarchyNavigator),this.binder.setColumnNavigator(this.columnHierarchyNavigator),this.pivotTableControl.setBinder(this.binder)}},l.prototype.createControlOptions=function(){var e=this,r=this.options.scrolling.enabled,o=this.options.columnResizing.enabled;this.options.tooltipsEnabled&&(this.interactionManager=new t.PivotTableInteractionManager(this.tooltipService,this.selectionManager,this.valueLabel,this.totalLabel));var i=this.interactionManager,n="interactive"===this.options.expandCollapse.buttonsOption;return this.options.selection.enabled?{rowHeaderClickHandler:function(r,o){return e.onItemClick(r,o,t.PivotTableSelectionMode.RowHeader)},rowHeaderContextMenuHandler:function(r,o){return e.onItemContextMenu(r,t.PivotTableSelectionMode.RowHeader,o,t.matrixRoleNames.rows)},rowHeaderInteractionHandler:i?i.getRowHeaderHandler():null,rowHeaderFocusHandler:function(t){return e.onRowHeaderFocus(t)},rowHeaderExpandCollapseHandler:n?function(r,o){return e.onHeaderExpansionChange(r,[t.matrixRoleNames.rows],o)}:null,columnHeaderClickHandler:function(r,o){return e.onItemClick(r,o,t.PivotTableSelectionMode.ColumnHeader)},columnHeaderContextMenuHandler:function(r,o){return e.onItemContextMenu(r,t.PivotTableSelectionMode.ColumnHeader,o,t.matrixRoleNames.columns)},columnHeaderInteractionHandler:i?i.getColumnHeaderHandler():null,columnHeaderFocusHandler:function(t){return e.onColumnHeaderFocus(t)},bodyCellClickHandler:function(r,o){return e.onItemClick(r,o,t.PivotTableSelectionMode.BodyCell)},bodyCellContextMenuHandler:function(r,o){return e.onItemContextMenu(r,t.PivotTableSelectionMode.BodyCell,o,t.matrixRoleNames.values)},bodyCellInteractionHandler:i?i.getBodyHandler():null,bodyCellFocusHandler:function(t){return e.onBodyCellFocus(t)},cornerCellClickHandler:function(t,r){return e.onCornerCellClick(t,r)},cornerCellContextMenuHandler:function(t,r){return e.onCornerCellContextMenu(t,r)},cornerCellInteractionHandler:i?i.getCornerHandler():null,cornerCellFocusHandler:function(t){return e.onCornerCellFocus(t)},whitespaceClickHandler:function(t){return e.onWhitespaceClick()},scrollingEnabled:r,columnResizingEnabled:o,rowLevelResizingEnabled:o,onScroll:function(){return e.onScroll()}}:{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:i?i.getRowHeaderHandler():null,
rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:n?function(r,o){return e.onHeaderExpansionChange(r,[t.matrixRoleNames.rows],o)}:null,columnHeaderClickHandler:null,columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:i?i.getColumnHeaderHandler():null,columnHeaderFocusHandler:null,bodyCellClickHandler:null,bodyCellContextMenuHandler:null,bodyCellInteractionHandler:i?i.getBodyHandler():null,bodyCellFocusHandler:null,cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:i?i.getCornerHandler():null,cornerCellFocusHandler:null,whitespaceClickHandler:null,scrollingEnabled:r,columnResizingEnabled:o,rowLevelResizingEnabled:o,onScroll:function(){return e.onScroll()}}},l.prototype.onScroll=function(){this.interactionManager&&!this.interactionManager.tooltipVisible()&&this.interactionManager.hideTooltip()},l.prototype.onWhitespaceClick=function(){this.selectionManager.onWhitespaceClick(),this.renderSelection()},l.prototype.onHyperlinkClicked=function(e,t){this.hostServices.onHyperlinkClick(e,t)},l.prototype.onItemClick=function(e,o,i){if(!this.selectionManager.isDrillingEnabled(e,o,i))if(i===t.PivotTableSelectionMode.ColumnHeader&&this.sortingManager.isColumnHeaderSortable(e))this.options.sorting.enabled&&this.sortingManager.sortColumnHeader(e);else{var n=t.PivotTableSelectionManager.getMatchingItem(e,i,this.rowHierarchyNavigator.getHierarchyItems(),this.columnHierarchyNavigator.getHierarchyItems(),this.rowHierarchyNavigator);n&&(this.selectionManager.select(n,i,r.isCtrlOrMeta(o)||1===this.hostServices.dataMultiSelectMode()),this.renderSelection())}},l.prototype.onRowHeaderFocus=function(e){var r=t.PivotTableInteractivityUtils.getGroupingDataItems(e,this.valueLabel,!1,this.totalLabel),o=[];switch(this.rowHierarchyNavigator.getExpansionState(e)){case 1:o.push(this.hostServices.getLocalizedString("FieldListProperty_Collapsed"));break;case 0:o.push(this.hostServices.getLocalizedString("FieldListProperty_Expanded"))}a.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(r,o))},l.prototype.onColumnHeaderFocus=function(e){var r=t.PivotTableInteractivityUtils.getGroupingDataItems(e,this.valueLabel,!1,this.totalLabel),o=this.columnHierarchyNavigator.getItemsByLevel(e.position.row.index),i=o.indexOf(e)+1,n=o.length,s=[this.hostServices.getLocalizedString("Visual_Tablix_ColumnHeader"),this.hostServices.getLocalizedString("Generic_ListPosition",i,n)];a.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(r,s))},l.prototype.onBodyCellFocus=function(e){var r=t.PivotTableInteractivityUtils.getBodyCellInfo(e,this.valueLabel,!1,this.totalLabel);a.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(r))},l.prototype.onHeaderExpansionChange=function(e,t,r){var o=this.selectionManager.createSelectorsByColumn(e),i=this.selectionManager.getHierarchyNodeIndex(e);this.hostServices.setNodeExpansionState({dataRoles:t,data:o,isCollapse:r,nodeIndex:i})},l.prototype.onItemContextMenu=function(e,t,r,o){r.stopPropagation(),r.preventDefault(),this.selectionManager.onItemContextMenu(e,t,r,[o])},l.prototype.onCornerCellClick=function(e,t){this.options.sorting.enabled&&this.sortingManager.isCornerSortable(e)&&this.sortingManager.sortCorner(e)},l.prototype.onCornerCellContextMenu=function(e,t){},l.prototype.onCornerCellFocus=function(e){var r=t.PivotTableInteractivityUtils.getCornerCellParts(e);a.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(r))},l.prototype.switchRowHeadersLayout=function(e){this.pivotTableControl.setSteppedLayout(e),this.pivotTableControl.setRowNavigator(this.rowHierarchyNavigator),this.binder.setRowNavigator(this.rowHierarchyNavigator)},l.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},l.prototype.needsMoreData=function(e){if(this.waitingForData||!this.dataView||!this.dataView.metadata||!this.dataView.metadata.segment)return!1;var t=this.rowHierarchyNavigator.getHierarchyLeafCount(),r=t*l.preferredLoadMoreThreshold;return this.rowHierarchyNavigator.getLeafIndex(e)>=r},l.prototype.enumerateObjectInstances=function(e){var r=this,o=new t.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,o,this.dataView,t.controls.TablixType.PivotTable,function(e){for(var t,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return(t=r.hostServices).getLocalizedString.apply(t,[e].concat(o))},this.featureSwitches,this.expandCollapseEnabled,this.style),o.complete()},l.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,t.controls.TablixType.PivotTable,this.featureSwitches.tablixIcons,this.featureSwitches.conditionalTablixWebURL,this.featureSwitches.totalsConditionalFormatting),e},l.prototype.setExpandCollapseEnabled=function(){this.expandCollapseEnabled=this.hostServices.canExpandCollapse([t.matrixRoleNames.rows])&&"hidden"!==this.options.expandCollapse.buttonsOption},l.preferredLoadMoreThreshold=.8,l}();t.PivotTable=l}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.internal.TablixUtils.CellStyle,o=jsCommon.CssConstants,i=e.visuals.controls.internal.TablixUtils.EdgeSettings,n=e.visuals.controls.pivotTable.ElementBuilder,a=jsCommon.StringExtensions.encodeHtml,s=jsCommon.Utility.encodeUriForImageDataSvg,l=t.Units.FontSize,u=e.visuals.controls.internal.TablixUtils,h=jsCommon.UrlUtils.UrlScheme,d=jsCommon.UrlUtils,c=function(){function c(e,r,o,i){this.selectionManager=r,this.sortingManager=o,this.binderOptions=e,this.measureElement=t.PivotTableBinderUtils.addMeasureElement(i),this.legacyTooltipsEnabled=!0}return c.prototype.setRowNavigator=function(e){this.rowNavigator=e},c.prototype.setColumnNavigator=function(e){this.columnNavigator=e},c.prototype.getRowHeaderBinding=function(e,r){var o=this;this.binderOptions.onBindRowHeader&&!r&&this.binderOptions.onBindRowHeader(e);var i=a(this.getRowHeaderLabel(e)),n=i;this.formattingProperties.rowHeaders.wordWrap&&(i=t.PivotTableBinderUtils.replaceEncodedNewLines(i)),_.isEmpty(i)&&(i=u.StringNonBreakingSpace);var s,l,d=this.rowNavigator.getRowHeaderMetadataColumn(e),c=u.getUrlScheme(d,i);if(c!==h.NONE){var g=a(e.valueFormatted);s=t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,c),l=t.PivotTableBinderUtils.addHyperlink(i,g,s,function(e,t){return o.binderOptions.onHyperlinkClicked(e,t)})}else u.isImage(e,d)&&(l=t.PivotTableBinderUtils.buildImage(i,this.formattingProperties.grid.imageHeight));l=l?{children:[l],classNames:[],styleProperties:{},attributes:{}}:{content:i,classNames:[],styleProperties:{},attributes:{}};var p,f=this.getExpandCollapseButtonBinding(e);return f?(p={attributes:{},classNames:["expandableCell"],styleProperties:{},children:[f,l]},l.classNames.push("expandableContent")):p=l,_.assign(p.styleProperties,this.getRowHeaderStyleAttributes(e,r)),this.legacyTooltipsEnabled&&(p.attributes.title=n),this.addRowHeaderClasses(e,!!s,l.classNames,p.classNames),p},c.prototype.getExpandCollapseButtonBinding=function(e){var t=this,r=this.getRowsExpandCollapseButtonSize(e);if(0!==r){var o,i,n=["expandCollapseButton"];if(void 0===e.isCollapsed)o="";else{o='<i class="glyphicon '+(e.isCollapsed?"pbi-glyph-explore-content-single":"pbi-glyph-collapse-content-single")+'"></i>',this.isExpandCollapseEnabled?(n.push("clickable"),i=function(r){t.binderOptions.onRowHeaderExpansionChange(e,!e.isCollapsed),r.stopPropagation()}):n.push("disabled")}return{content:o,classNames:n,styleProperties:{width:r+u.UnitOfMeasurement,height:r+u.UnitOfMeasurement,color:this.formattingProperties.rowHeaders.expandCollapseButtonsColor,"font-size":this.expandCollapseButtonFontInfo.fontProperties.size.px+u.UnitOfMeasurement},attributes:{},clickHandler:i}}},c.prototype.getRowsExpandCollapseButtonSize=function(e){return this.formattingProperties.rowHeaders.showExpandCollapseButtons&&e.hierarchyLevel&&(e.hierarchyLevel.canBeExpanded||e.level&&this.formattingProperties.rowHeaders.steppedLayout)?this.expandCollapseButtonFontInfo.measuredFontHeight:0},c.prototype.getColumnHeaderBinding=function(e,r){var o,i=a(this.getColumnHeaderLabel(e));this.legacyTooltipsEnabled&&(o={title:i}),this.formattingProperties.columnHeaders.wordWrap&&(i=t.PivotTableBinderUtils.replaceEncodedNewLines(i)),_.isEmpty(i)&&(i=u.StringNonBreakingSpace);var n=this.getColumnHeaderStyle(e,this.getColumnHeaderFontInfo(e),r),s=n.getExtraBottom();e.position.row.isLast&&(n.paddings.bottom+=t.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight));var l,d=this.columnNavigator.getColumnHeaderMetadataColumn(e),c=u.getUrlScheme(d,i),g={tagName:null,content:i,attributes:{},classNames:[],styleProperties:{}};if(c!==h.NONE){var p=a(e.valueFormatted);l=t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,c),g=t.PivotTableBinderUtils.addHyperlink(g,p,l,this.binderOptions.onHyperlinkClicked)}else u.isImage(e,d)&&(g=t.PivotTableBinderUtils.buildImage(i,this.formattingProperties.grid.imageHeight));var f={tagName:"div",children:[g],classNames:this.getColumnHeaderClasses(e,!!l),styleProperties:this.getColumnHeaderStyleAttributes(e,n),attributes:o};if(e.position.row.isLast){var m=this.binderOptions.sortingEnabled&&this.sortingManager.isColumnHeaderSortable(e),v=this.sortingManager.getColumnHeaderSortDirection(e),y=t.PivotTableBinderUtils.buildSortIcon(v,this.binderOptions.sortIconEnabled,m,t.PivotTableSortingManager.getNextSortDirection(v,d),s,this.glyphFontInfo.textProperties.fontSize);f.children.push(y)}return f},c.prototype.getBodyCellBinding=function(r,o){var i,n=a(this.getBodyCellContent(r));this.legacyTooltipsEnabled&&(i={title:n});var l,c,g=this.getBodyCellStyle(r,this.getBodyCellFontInfo(r),o),p=r.columnMetadata,f=p&&this.columnsDataBarsSettings[p.queryName],m=f&&!r.isTotal&&!r.hasSubtotalStyle&&_.isNumber(r.dataPoint),v=p&&this.formattingProperties.columnFormatting[p.queryName],y=e.StructuralObjectValue.merge(v&&v.icon,r.icon),C=r.hyperlink;if(y&&"IconOnly"===y.layout)n="";else if(_.isEmpty(n)&&(n=u.StringNonBreakingSpace),r.isKpi)n=t.PivotTableBinderUtils.createKpiDomString(r.columnMetadata.kpi,r.textContent),i=null;else if(m&&f.hideText)n=o?u.StringNonBreakingSpace:"";else{this.formattingProperties.values.wordWrap&&(n=t.PivotTableBinderUtils.replaceEncodedNewLines(n));var H=u.getUrlScheme(r.columnMetadata,n);if(H!==h.NONE)l=t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,H),c=t.PivotTableBinderUtils.addHyperlink(n,a(r.textContent),l,this.binderOptions.onHyperlinkClicked),C=void 0;else if(this.isImage(r)){var w=s(r.textContent);c=t.PivotTableBinderUtils.buildImage(w,this.formattingProperties.grid.imageHeight)}}this.binderOptions.hyperlinksEnabled&&(c||""!==n&&n!==u.StringNonBreakingSpace)&&C&&d.getUrlScheme(C)!==h.NONE&&(c=t.PivotTableBinderUtils.addHyperlink(c||n,a(C),null,this.binderOptions.onHyperlinkClicked,!0,!0));var b={tagName:"div",classNames:[],styleProperties:{},attributes:{}};if(c?b.children=[c]:b.content=n,c=b,y){var P=this.getBodyCellFontInfo(r).measuredFontHeight;b=t.PivotTableBinderUtils.addIconToCell(y,P,c)}return m&&!o&&(b=t.PivotTableBinderUtils.addDataBarsToCell(b,f,g,r.dataPoint)),this.addBodyCellClasses(r,!!l,c.classNames,b.classNames),this.addBodyCellStyleAttributes(r,g,c.styleProperties,b.styleProperties),b.attributes=i,b},c.prototype.getCornerCellBinding=function(e,r){var o,i=a(this.getCornerCellLabel(e));this.legacyTooltipsEnabled&&(o={title:i}),this.formattingProperties.columnHeaders.wordWrap&&(i=t.PivotTableBinderUtils.replaceEncodedNewLines(i)),_.isEmpty(i)&&(i=u.StringNonBreakingSpace);var s=this.getCornerCellStyle(e,this.getCornerCellFontInfo(),r);if(e.position.row.isLast){var l=this.binderOptions.sortingEnabled&&this.sortingManager.isCornerSortable(e),h=this.sortingManager.getCornerSortDirection(e),d=null==h?1:h,c=t.PivotTableBinderUtils.buildSortIcon(h,this.binderOptions.sortIconEnabled,l,d,s.getExtraBottom(),this.glyphFontInfo.textProperties.fontSize);i+=n.build(c),s.paddings.bottom+=t.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight)}return{content:i,classNames:this.getCornerCellClasses(e),styleProperties:s.getAttributes(),attributes:o}},c.prototype.getApproximateRowHeaderWidth=function(e){var r,o=this.rowNavigator.getRowHeaderMetadataColumn(e),i=this.getRowHeaderLabel(e),n=u.getUrlScheme(o,i),a=this.rowHeaderFontInfo.fontProperties.size.px;r=n!==h.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,n)?a:u.isImage(e,o)?this.formattingProperties.grid.imageHeight:t.PivotTableBinderUtils.measureText(i,this.getRowHeaderFontInfo(e).textProperties);var s=this.getRowsExpandCollapseButtonSize(e);return s>0&&(r+=s+t.PivotTableBinderUtils.ExpandCollapseRightMargin),r},c.prototype.getApproximateColumnHeaderWidth=function(e){var r=this.columnNavigator.getColumnHeaderMetadataColumn(e),o=this.getColumnHeaderLabel(e),i=u.getUrlScheme(r,o);return i!==h.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,i)?this.columnHeaderFontInfo.fontProperties.size.px:u.isImage(e,r)?this.formattingProperties.grid.imageHeight:t.PivotTableBinderUtils.measureText(o,this.getColumnHeaderFontInfo(e).textProperties)},c.prototype.getApproximateBodyCellWidth=function(e){var r=0;if(e.icon){if(r=this.getBodyCellFontInfo(e).measuredFontHeight,"IconOnly"===e.icon.layout)return r;r+=t.PivotTableBinderUtils.TablixIconMargin}if(e.isKpi)return r+this.valueFontInfo.fontProperties.size.px;var o=e.columnMetadata&&this.columnsDataBarsSettings[e.columnMetadata.queryName];if(o&&o.hideText&&!e.isTotal&&_.isNumber(e.dataPoint))return r;var i=this.getBodyCellContent(e);return this.isUrlIcon(e,i)?r+this.valueFontInfo.fontProperties.size.px:this.isImage(e)?r+this.formattingProperties.grid.imageHeight:r+t.PivotTableBinderUtils.measureText(i,this.getBodyCellFontInfo(e).textProperties)},c.prototype.getApproximateCornerCellWidth=function(e){return t.PivotTableBinderUtils.measureText(this.getCornerCellLabel(e),this.getCornerCellFontInfo().textProperties)},c.prototype.getApproximateRowHeaderHeight=function(e,r){var o,i=this.rowNavigator.getRowHeaderMetadataColumn(e),n=this.getRowHeaderLabel(e),a=u.getUrlScheme(i,n),s=this.getRowsExpandCollapseButtonSize(e);if(a!==h.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,a))o=this.rowHeaderFontInfo.fontProperties.size.px;else if(u.isImage(e,i))o=this.formattingProperties.grid.imageHeight;else{var l=void 0,d=this.getRowHeaderFontInfo(e);r-=this.getRowsExpandCollapseButtonSize(e),l=this.formattingProperties.rowHeaders.wordWrap?t.PivotTableBinderUtils.getWordWrappingLines(n,t.PivotTableBinderUtils.getNetWidth(r,this.getRowHeaderStyle(e,d,!0)),d.textProperties).length:1,o=d.measuredFontHeight*l}return void 0===e.isCollapsed?o:Math.max(s,o)},c.prototype.getApproximateColumnHeaderHeight=function(e,r){var o=this.columnNavigator.getColumnHeaderMetadataColumn(e),i=this.getColumnHeaderLabel(e),n=u.getUrlScheme(o,i);if(n!==h.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,n))return this.columnHeaderFontInfo.fontProperties.size.px;if(u.isImage(e,o))return this.formattingProperties.grid.imageHeight;var a,s=this.getColumnHeaderFontInfo(e);return a=this.formattingProperties.columnHeaders.wordWrap?t.PivotTableBinderUtils.getWordWrappingLines(i,t.PivotTableBinderUtils.getNetWidth(r,this.getColumnHeaderStyle(e,s,!0)),s.textProperties).length:1,s.measuredFontHeight*a},c.prototype.getApproximateBodyCellHeight=function(e,r){var o=this.getBodyCellFontInfo(e);if(e.icon&&"IconOnly"===e.icon.layout)return o.measuredFontHeight;if(e.isKpi)return this.valueFontInfo.fontProperties.size.px;var i=this.getBodyCellContent(e);if(this.isUrlIcon(e,i))return this.valueFontInfo.fontProperties.size.px;if(this.isImage(e))return this.formattingProperties.grid.imageHeight;var n;return this.formattingProperties.values.wordWrap&&null!=r?(e.icon&&(r-=o.measuredFontHeight+t.PivotTableBinderUtils.TablixIconMargin),n=t.PivotTableBinderUtils.getWordWrappingLines(i,t.PivotTableBinderUtils.getNetWidth(r,this.getBodyCellStyle(e,o,!0)),o.textProperties).length):n=1,o.measuredFontHeight*n},c.prototype.getApproximateCornerCellHeight=function(e,r){var o,i=this.getCornerCellFontInfo();return o=this.formattingProperties.columnHeaders.wordWrap?t.PivotTableBinderUtils.getWordWrappingLines(this.getCornerCellLabel(e),t.PivotTableBinderUtils.getNetWidth(r,this.getCornerCellStyle(e,i,!0)),i.textProperties).length:1,i.measuredFontHeight*o},c.prototype.isUrlIcon=function(e,r){var o=u.getUrlScheme(e.columnMetadata,r);return o!==h.NONE&&!!t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,o)},c.prototype.getColumnHeaderFontInfo=function(e){return t.MatrixHierarchyNavigator.isNodeGrandTotal(e)?this.grandTotalColumnHeaderFontInfo:e.hasSubtotalStyle?this.subtotalColumnHeaderFontInfo:this.columnHeaderFontInfo},c.prototype.getRowHeaderFontInfo=function(e){return t.MatrixHierarchyNavigator.isNodeGrandTotal(e)?this.grandTotalRowHeaderFontInfo:e.hasSubtotalStyle?this.subtotalRowHeaderFontInfo:this.rowHeaderFontInfo},c.prototype.getBodyCellFontInfo=function(e){return e.isGrandTotal?this.grandTotalFontInfo:e.hasSubtotalStyle?this.subtotalFontInfo:this.valueFontInfo},c.prototype.getCornerCellFontInfo=function(){return this.columnHeaderFontInfo},c.prototype.addRowHeaderClasses=function(e,r,o,i){var n=this.formattingProperties.rowHeaders;n.wordWrap?o.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):o.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),r&&o.push(u.CssClassValueURLIconContainer),this.binderOptions.interactivityIndicatorEnabled&&this.binderOptions.selectionEnabled&&t.PivotTableSelectionManager.hasIdentity(e)&&i.push(t.PivotTableBinderUtils.cssClassCellInteractive);var a;r&&(a=t.textAlignment.center),t.PivotTableBinderUtils.addAlignmentCssClass(n.alignment,o,a)},c.prototype.getColumnHeaderClasses=function(e,r){var o=[],i=this.formattingProperties.columnHeaders,n=this.formattingProperties.columnFormatting[e.queryName];this.formattingProperties.columnHeaders.wordWrap?o.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):o.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),r&&o.push(u.CssClassValueURLIconContainer);var a=t.PivotTableSelectionManager.hasIdentity(e),s=this.sortingManager.isColumnHeaderSortable(e);this.binderOptions.interactivityIndicatorEnabled&&(this.binderOptions.selectionEnabled&&a&&!s||this.binderOptions.sortingEnabled&&s&&!a)&&o.push(t.PivotTableBinderUtils.cssClassCellInteractive);var l,h=n&&n.styleHeader&&n.alignment||i.alignment;return r&&(l=t.textAlignment.center),t.PivotTableBinderUtils.addAlignmentCssClass(h,o,l),o},c.prototype.addBodyCellClasses=function(e,r,o,i){this.formattingProperties.values.wordWrap?o.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):o.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),r&&o.push(u.CssClassValueURLIconContainer),!this.binderOptions.interactivityIndicatorEnabled||!this.binderOptions.selectionEnabled||e.isColumnGrandTotal&&e.isRowGrandTotal||i.push(t.PivotTableBinderUtils.cssClassCellInteractive);var n,a=e.columnMetadata&&e.columnMetadata.queryName,s=this.formattingProperties.columnFormatting[a];if(s){var l=void 0;l=e.isGrandTotal?s.styleTotal:e.hasSubtotalStyle?s.styleSubTotals:s.styleValues,l&&(n=s.alignment)}var h;r?h=t.textAlignment.center:!e.isKpi&&e.isNumeric&&(h=t.textAlignment.right),t.PivotTableBinderUtils.addAlignmentCssClass(n,o,h)},c.prototype.getCornerCellClasses=function(e){var r=[];this.formattingProperties.columnHeaders.wordWrap?r.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):r.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),this.binderOptions.interactivityIndicatorEnabled&&this.binderOptions.sortingEnabled&&this.sortingManager.isCornerSortable(e)&&r.push(t.PivotTableBinderUtils.cssClassCellInteractive);var o=this.formattingProperties.columnHeaders.titleAlignment;return o===t.textAlignment.auto&&(o=this.formattingProperties.columnHeaders.alignment),t.PivotTableBinderUtils.addAlignmentCssClass(o,r),r},c.prototype.getSteppedLayoutIndentation=function(e){return this.rowNavigator.getLevel(e)*this.formattingProperties.rowHeaders.steppedLayoutIndentation},c.prototype.getRowHeaderStyle=function(e,o,n){var a=new r(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);if(e.position.column.isLast){var s=this.binderOptions.tablixPropertyManager;a.borders.right=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,s.PropGridOutlineColor.getValue(null))}a.fontColor=u.FontColorHeaders,t.MatrixStyler.setRowHeaderStyle(e.position,e,a,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties,this.formattingProperties.values.bandedRowHeaders),t.PivotTableBinderUtils.applyFontInfo(o,a,!n);var l=t.MatrixHierarchyNavigator.isNodeGrandTotal(e)&&this.formattingProperties.grandTotal.applyToHeaders,h=e.hasSubtotalStyle&&this.formattingProperties.subtotals.applyToHeaders;return l&&this.formattingProperties.grandTotal.fontColor?a.fontColor=this.formattingProperties.grandTotal.fontColor:h&&this.formattingProperties.subtotals.fontColor&&(a.fontColor=this.formattingProperties.subtotals.fontColor),l&&this.formattingProperties.grandTotal.backColor?a.backColor=this.formattingProperties.grandTotal.backColor:h&&this.formattingProperties.subtotals.backColor&&(a.backColor=this.formattingProperties.subtotals.backColor),this.formattingProperties.rowHeaders.steppedLayout&&(a.paddings.left+=this.getSteppedLayoutIndentation(e)),a},c.prototype.getRowHeaderStyleAttributes=function(e,r){var o=this.getRowHeaderStyle(e,this.getRowHeaderFontInfo(e),r),i=o.getAttributes();return this.selectionManager.isRowHeaderHighlighted(e)||t.PivotTableBinderUtils.setUnselectedStyle(i),i},c.prototype.getColumnHeaderStyle=function(e,o,n){var a=new r(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);if(e.position.row.isLast){var s=this.binderOptions.tablixPropertyManager;a.borders.bottom=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,s.PropGridOutlineColor.getValue(null))}a.fontColor=u.FontColorHeaders,t.MatrixStyler.setColumnHeaderStyle(e.position,e,a,this.formattingProperties),t.PivotTableBinderUtils.applyFontInfo(o,a,!n);var l=this.formattingProperties.columnFormatting[e.queryName],h=l&&l.styleHeader,d=t.MatrixHierarchyNavigator.isNodeGrandTotal(e)&&this.formattingProperties.grandTotal.applyToHeaders,c=e.hasSubtotalStyle&&this.formattingProperties.subtotals.applyToHeaders;return h&&l.fontColor?a.fontColor=l.fontColor:d&&this.formattingProperties.grandTotal.fontColor?a.fontColor=this.formattingProperties.grandTotal.fontColor:c&&this.formattingProperties.subtotals.fontColor&&(a.fontColor=this.formattingProperties.subtotals.fontColor),h&&l.backColor?a.backColor=l.backColor:d&&this.formattingProperties.grandTotal.backColor?a.backColor=this.formattingProperties.grandTotal.backColor:c&&this.formattingProperties.subtotals.backColor&&(a.backColor=this.formattingProperties.subtotals.backColor),a},c.prototype.getColumnHeaderStyleAttributes=function(e,r){var o=r.getAttributes();return this.selectionManager.isColumnHeaderHighlighted(e)||t.PivotTableBinderUtils.setUnselectedStyle(o),o},c.prototype.getBodyCellStyle=function(e,o,i){var n=new r(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);return t.MatrixStyler.setBodyCellStyle(e.position,e,n,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties),t.PivotTableBinderUtils.applyFontInfo(o,n,!i),n},c.prototype.addBodyCellStyleAttributes=function(e,r,o,i){r.setAttributes(i),i.position="relative",this.selectionManager.isBodyCellHighlighted(e)||t.PivotTableBinderUtils.setUnselectedStyle(i)},c.prototype.getCornerCellStyle=function(e,o,n){var a=new r(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);if(a.fontColor=u.FontColorHeaders,e.position.row.isLast){var s=this.binderOptions.tablixPropertyManager;a.borders.bottom=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,s.PropGridOutlineColor.getValue(null))}return t.MatrixStyler.setCornerCellStyle(e.position,a,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties),t.PivotTableBinderUtils.applyFontInfo(o,a,!n),a},c.prototype.getColumnHeaderLabel=function(e){return this.getHeaderContent(e,this.columnNavigator.getColumnHeaderMetadataColumn(e),this.columnNavigator.isColumnHeaderMultiValueSubtotal(e),this.formattingProperties.columnHeaders.wordWrap)},c.prototype.getRowHeaderLabel=function(e){return this.getHeaderContent(e,this.rowNavigator.getRowHeaderMetadataColumn(e),this.rowNavigator.isRowHeaderMultiValueSubtotal(e),this.formattingProperties.rowHeaders.wordWrap)},c.prototype.getBodyCellContent=function(e){return this.formattingProperties.values.wordWrap?e.textContent:t.TextUtil.replaceSpaceWithNBSP(e.textContent)},c.prototype.getCornerCellLabel=function(e){return this.formattingProperties.columnHeaders.wordWrap?e.displayName:t.TextUtil.replaceSpaceWithNBSP(e.displayName)},c.prototype.getHeaderContent=function(e,r,o,i){if(e.isSubtotal&&!o){var n=this.formattingProperties.columnFormatting[r.queryName],a=n?n.subtotalLabel:this.binderOptions.defaultTotalLabel;return i?a:t.TextUtil.replaceSpaceWithNBSP(a)}var l=e.valueFormatted;return t.PivotTableBinderUtils.isValidUrl(r,l)?l:l&&u.isValidImage(e,r,l)?s(l):i?l:t.TextUtil.replaceSpaceWithNBSP(l)},c.prototype.onDataViewChanged=function(e,r,i,n,a){this.formattingProperties=r,this.legacyTooltipsEnabled=n,this.isExpandCollapseEnabled=!!a;var s=r.general.textSize,h=new t.PivotTableBinderUtils.FontInfoMeasurer;this.columnHeaderContainerFontInfo=t.PivotTableBinderUtils.createFontInfo({family:r.columnHeaders.fontFamily||u.FontFamilyHeader,size:r.columnHeaders.fontSize||s},h),this.columnHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderContainerFontInfo,{},h),this.rowHeaderContainerFontInfo=t.PivotTableBinderUtils.createFontInfo({family:r.rowHeaders.fontFamily||u.FontFamilyHeader,size:r.rowHeaders.fontSize||s},h),this.rowHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderContainerFontInfo,{},h),this.expandCollapseButtonFontInfo=t.PivotTableBinderUtils.createFontInfo({family:"PowrMDL2",size:r.rowHeaders.expandCollapseButtonsSize||this.rowHeaderFontInfo.fontProperties.size},h);var d=r.values.fontFamily||u.FontFamilyCell;this.valueContainerFontInfo=t.PivotTableBinderUtils.createFontInfo({family:d,size:r.values.fontSize||s},h),this.valueFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.valueContainerFontInfo,{},h);var g,p=r.subtotals.fontFamily;p||this.valueFontInfo.fontProperties.family!==u.FontFamilyCell?g=o.boldValue:this.valueFontInfo.fontProperties.family===u.FontFamilyCell&&(p=u.FontFamilyTotal),this.subtotalFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.valueFontInfo,{family:p,size:r.subtotals.fontSize,weight:g},h);var f=r.grandTotal.fontFamily;this.grandTotalFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.subtotalFontInfo,{family:f,size:r.grandTotal.fontSize,weight:r.grandTotal.fontFamily?o.boldValue:void 0},h,1);var m=this.columnHeaderFontInfo.fontProperties.family===u.FontFamilyHeader,v=this.rowHeaderFontInfo.fontProperties.family===u.FontFamilyHeader;r.subtotals.applyToHeaders?this.subtotalColumnHeaderFontInfo=this.subtotalRowHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.subtotalFontInfo,{},h,4):(this.subtotalColumnHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderFontInfo,c.applyBold(m),h),this.subtotalRowHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderFontInfo,c.applyBold(v),h)),r.grandTotal.applyToHeaders?this.grandTotalColumnHeaderFontInfo=this.grandTotalRowHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.grandTotalFontInfo,{},h,4):(this.grandTotalColumnHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderFontInfo,c.applyBold(m),h,1),this.grandTotalRowHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderFontInfo,c.applyBold(v),h,1)),this.glyphFontInfo=t.PivotTableBinderUtils.createFontInfo({family:u.FontFamilyGlyphs,size:l.createFromPt((r.columnHeaders.fontSize||s).pt*u.SortIconFontSizeRatio),lineHeight:"100%"},h),h.measureAll(this.measureElement),this.columnsDataBarsSettings={};var y=r.columnFormatting;if(y&&e&&e.matrix&&!_.isEmpty(e.matrix.valueSources))for(var C=0,H=e.matrix.valueSources;C<H.length;C++){var w=H[C],b=w.queryName;b&&y[b]&&(this.columnsDataBarsSettings[b]=t.PivotTableBinderUtils.getColumnDataBarsSettings(w,y[b].dataBarsSettings,i))}},c.prototype.isImage=function(e){return t.converterHelper.isImageUrlColumn(e.columnMetadata)},c.applyBold=function(e){return{family:e?u.FontFamilyTotal:void 0,weight:e?void 0:o.boldValue}},c.prototype.getCornerContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},c.prototype.getColumnHeaderContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},c.prototype.getRowHeaderContainerFontInfo=function(){return this.rowHeaderContainerFontInfo},c.prototype.getValueContainerFontInfo=function(){return this.valueContainerFontInfo},c}();t.PivotTableBinder=c}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e){this.matrixNavigator=e}return t.prototype.setHierarchy=function(e){this.hierarchy=e,this.floatingLeaves=[],this.getLeaves(this.getFloatingHierarchyItems(),this.floatingLeaves)},t.prototype.hasHierarchy=function(){return!_.isEmpty(this.hierarchy.levels)},t.prototype.getHierarchyDepth=function(){return Math.max(this.hierarchy.levels.length,1)},t.prototype.getHierarchyLeafNodes=function(){return this.hierarchy.leafNodes},t.prototype.getHierarchyLeafCount=function(){return this.hierarchy.leafNodes.length},t.prototype.getHierarchyLeafAt=function(e){return this.hierarchy.leafNodes[e]},t.prototype.getFloatingHierarchyLeafCount=function(){return this.floatingLeaves.length},t.prototype.getFloatingHierarchyLeafAt=function(e){return this.floatingLeaves[e]},t.prototype.getHierarchyItems=function(){return this.hierarchy.root.children||[]},t.prototype.getFloatingHierarchyItems=function(){return null},t.prototype.getLeafIndex=function(e){return this.matrixNavigator.getLeafIndex(e)},t.prototype.isLeaf=function(e){return this.matrixNavigator.isLeaf(e)},t.prototype.isLastItem=function(e,t){return this.matrixNavigator.isLastItem(e,t)},t.prototype.getParent=function(e){return this.matrixNavigator.getParent(e)},t.prototype.getIndex=function(e){return this.matrixNavigator.getIndex(e)},t.prototype.getPathIndices=function(e){for(var t=[this.getIndex(e)],r=this.getParent(e);r;)t=[this.getIndex(r)].concat(t),r=this.getParent(r);return t},t.prototype.getNodeFromPath=function(e){if(!(_.isEmpty(e)||e.length>this.hierarchy.levels.length)){for(var t=this.hierarchy.root,r=0,o=e;r<o.length;r++){var i=o[r];if(t=t.children[i],!t)return}return t}},t.prototype.getLeafAncestorAtLevel=function(e,t){for(var r=e;this.getLevel(r)>t;)r=this.getParent(r);return r},t.prototype.getItemsByLevel=function(e){var t=[];return this.findLevelItems(e,this.hierarchy.root,-1,t),t},t.prototype.findLevelItems=function(e,t,r,o){if(!_.isEmpty(t.children))for(var i=r+1,n=0,a=t.children;n<a.length;n++){var s=a[n];i===e||i+this.matrixNavigator.getChildrenLevelDifference(s)>e?o.push(s):i<e&&this.findLevelItems(e,s,i,o)}},t.prototype.getExpansionState=function(e){return e.isCollapsed?1:e.isCollapsed===!1?0:2},t.prototype.getChildren=function(e){return this.matrixNavigator.getChildren(e)},t.prototype.getLevel=function(e){return this.matrixNavigator.getLevel(e);
},t.prototype.getIntersection=function(t,r){var o=this.matrixNavigator.getIntersection(t,r);return o&&o.objects&&(o.icon=e.TablixPropertyManager.PropValuesIcon.getValue(o.objects),o.hyperlink=e.TablixPropertyManager.PropValuesWebURL.getValue(o.objects)),o},t.prototype.getCorner=function(e,t){return this.matrixNavigator.getCorner(e,t)},t.prototype.getRowLevel=function(e){return e.rowLevel},t.prototype.getColumnLevel=function(e){return e.columnLevel},t.prototype.getRowHeaderMetadataColumn=function(e){return this.matrixNavigator.getRowHeaderMetadataColumn(e)},t.prototype.getRowHeaderMetadataColumns=function(e){return this.matrixNavigator.getRowHeaderMetadataColumns(e)},t.prototype.getColumnHeaderMetadataColumn=function(e){return this.matrixNavigator.getColumnHeaderMetadataColumn(e)},t.prototype.getColumnHeaderMetadataColumns=function(e){return this.matrixNavigator.getColumnHeaderMetadataColumns(e)},t.prototype.valuesOnRowApplied=function(){return this.matrixNavigator.valuesOnRowApplied()},t.prototype.hasMultipleValueSources=function(){return this.matrixNavigator.hasMultipleValueSources()},t.prototype.isColumnHeaderMultiValueSubtotal=function(e){return e.isSubtotal&&e.parent&&e.parent.isSubtotal},t.prototype.isRowHeaderMultiValueSubtotal=function(e){return this.valuesOnRowApplied()&&e.parent&&e.parent.isSubtotal},t.prototype.getLeaves=function(e,t){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var i=o[r];this.isLeaf(i)?t.push(i):this.getLeaves(this.getChildren(i),t)}},t}();e.PivotTableHierarchyNavigator=t;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getIntersection=function(t,r){return this.isLeaf(t)||_.isEmpty(t.children)||!t.children[0].isSubtotal||this.valuesOnRowApplied()?e.prototype.getIntersection.call(this,t,r):e.prototype.getIntersection.call(this,t.children[0],r)},t.prototype.getChildren=function(e){return!_.isEmpty(e.children)&&e.children[0].isSubtotal?e.children.slice(1):e.children},t.prototype.getHierarchyDepth=function(){return e.prototype.getHierarchyDepth.call(this)>0?1:0},t.prototype.getCorner=function(t,r){var o=r===this.matrixNavigator.getColumnHierarchyDepth()-1?0:this.matrixNavigator.getRowHierarchyDepth()-1;return e.prototype.getCorner.call(this,o,r)},t.prototype.getFloatingHierarchyItems=function(){var e=this.getHierarchyItems();if(_.isEmpty(e))return null;for(var t=0,r=[];;){var o=e[t];if(!o||!o.isSubtotal)break;r.push(o),t++}return _.isEmpty(r)?null:r},t.prototype.isRowHeaderMultiValueSubtotal=function(e){return this.valuesOnRowApplied()&&e.isSubtotal},t.prototype.getLeaves=function(e,t){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var i=o[r];t.push(i),this.getLeaves(this.getChildren(i),t)}},t.prototype.getPathIndices=function(e){return[this.getLeafIndex(e)]},t.prototype.getNodeFromPath=function(e){if(1===e.length)return this.getHierarchyLeafAt(e[0])},t.prototype.getItemsByLevel=function(e){return this.getHierarchyLeafNodes().slice()},t.prototype.getLeafAncestorAtLevel=function(e,t){return e},t}(t);e.PivotTableSteppedHierarchyNavigator=r}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e,t,r,o){this.tooltipService=e,this.selectionManager=t,this.valueLabel=r,this.totalLabel=o,this.tooltipsEnabled=!0}return t.prototype.getRowHeaderHandler=function(){var e=this;return this.getHeaderHandler(function(t){return t.isSubtotal&&e.rowHierarchyNavigator.valuesOnRowApplied()&&e.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(t)},function(t){return e.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(t)})},t.prototype.getColumnHeaderHandler=function(){var e=this;return this.getHeaderHandler(function(t){return t.isSubtotal&&!e.rowHierarchyNavigator.valuesOnRowApplied()&&e.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(t)},function(t){return e.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(t)})},t.prototype.getBodyHandler=function(){var e=this;return{addTooltip:function(t,r){return e.addBodyTooltip(t,r)},removeTooltip:function(t,r){return e.removeTooltip(r)},isTooltipEnabled:function(t){return e.tooltipsEnabled}}},t.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t},t.prototype.addBodyTooltip=function(t,r){var o=this,i=d3.select(r);this.tooltipService.addTooltip(i,function(r){return e.PivotTableInteractivityUtils.getBodyCellTooltipInfo(t,o.valueLabel)},function(e){return o.getItemSelectionId(t,e)})},t.prototype.getCornerHandler=function(){var e=this;return{addTooltip:function(t,r){return e.addCornerTooltip(t,r)},removeTooltip:function(t,r){return e.removeTooltip(r)},isTooltipEnabled:function(t){return e.tooltipsEnabled&&!_.isEmpty(t.displayName)}}},t.prototype.tooltipVisible=function(){return this.tooltipService&&this.tooltipService.visible()},t.prototype.hideTooltip=function(){this.tooltipService&&this.tooltipService.hide()},t.prototype.setTooltipsEnabled=function(e){this.tooltipsEnabled=e},t.prototype.addHeaderTooltip=function(t,r,o,i){var n=this,a=d3.select(r);this.tooltipService.addTooltip(a,function(r){return e.PivotTableInteractivityUtils.getHeaderTooltipInfo(t,o,i,n.totalLabel,n.valueLabel)},function(e){})},t.prototype.addCornerTooltip=function(t,r){var o=this,i=d3.select(r);this.tooltipService.addTooltip(i,function(r){return e.PivotTableInteractivityUtils.getCornerCellTooltipInfo(t)},function(e){return o.getItemSelectionId(t,e)})},t.prototype.getHeaderHandler=function(e,t){var r=this;return{addTooltip:function(o,i){return r.addHeaderTooltip(o,i,e,t)},removeTooltip:function(e,t){return r.removeTooltip(t)},isTooltipEnabled:function(e){return r.tooltipsEnabled&&void 0!==e.valueFormatted}}},t.prototype.removeTooltip=function(e){var t=d3.select(e);this.tooltipService.removeTooltips(t)},t.prototype.getItemSelectionId=function(t,r){return e.SelectionId.fromSelectorsByColumn(this.selectionManager.createSelectorsByColumn(t))},t}();e.PivotTableInteractionManager=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e){this.hostServices=e}return t.prototype.onDataViewChanged=function(e,t,r,o,i){this.isSteppedLayout=o,this.valuesOnRowApplied=i,this.nonMeasureRowLevels=this.getNonMeasureRowLevels(e),this.valueSources=r,this.hasRows=e&&!_.isEmpty(this.nonMeasureRowLevels),this.hasColumns=t&&!_.isEmpty(t.levels),this.measureCount=r?r.length:0},t.hasSortingChanged=function(e,t){if(!e||!t)return!1;var r=e.metadata.columns;if(_.isEmpty(r))return!1;var o=t.metadata.columns;if(_.isEmpty(o))return!1;for(var i=function(e){var t=_.find(r,function(t){return e.queryName===t.queryName});if(t&&e.sort!==t.sort)return{value:!0}},n=0,a=o;n<a.length;n++){var s=a[n],l=i(s);if("object"==typeof l)return l.value}return!1},t.prototype.isCornerSortable=function(e){return this.hasRows&&null!=e.metadata&&e.position.row.isLast&&(!this.valuesOnRowApplied||!e.position.column.isLast)},t.prototype.getNonMeasureRowLevels=function(e){if(this.valuesOnRowApplied){var t=[];return t.push.apply(t,e.levels),t.pop(),t}return e.levels},t.prototype.isColumnHeaderSortable=function(t){var r=e.PivotTableSelectionManager.hasIdentity(t);return this.hasRows&&this.measureCount>0&&!r&&t.position.row.isLast&&!this.valuesOnRowApplied},t.prototype.getCornerSortDirection=function(e){if(!this.isCornerSortable(e))return null;if(this.isSteppedLayout){for(var t=null,r=0,o=this.nonMeasureRowLevels;r<o.length;r++){var i=o[r];if(1!==i.sources.length)return null;var n=i.sources[0].sort;if(null==n)return null;if(null!==t){if(n!==t)return null}else t=n}return t}return this.nonMeasureRowLevels[e.position.column.index].sources[0].sort},t.prototype.getColumnHeaderSortDirection=function(e){return this.isColumnHeaderSortable(e)?this.getMeasureSortDirection(this.getMeasureQueryName(e)):null},t.prototype.getMeasureQueryName=function(e){return this.hasColumns&&1===this.measureCount?this.valueSources[0].queryName:e.queryName},t.prototype.sortCorner=function(e){var r,o=this.getCornerSortDirection(e),i=t.getNextSortDirection(o);if(this.isSteppedLayout){r=[];for(var n=0,a=this.nonMeasureRowLevels;n<a.length;n++){var s=a[n];r.push({queryName:s.sources[0].queryName,sortDirection:i})}}else r=[{queryName:e.metadata.queryName,sortDirection:i}];this.hostServices.onCustomSort({sortDescriptors:r})},t.prototype.sortColumnHeader=function(e){var r=this.getColumnHeaderSortDirection(e),o=this.getMeasureColumn(this.getMeasureQueryName(e));this.hostServices.onCustomSort({sortDescriptors:[{queryName:this.getMeasureQueryName(e),sortDirection:t.getNextSortDirection(r,o)}]})},t.getNextSortDirection=function(e,r){return void 0===e?t.getDefaultSortDirection(r):1===e?2:1},t.getDefaultSortDirection=function(e){return e&&e.isMeasure&&e.type&&e.type.numeric&&!e.type.temporal?2:1},t.prototype.getMeasureSortDirection=function(e){var t=this.getMeasureColumn(e);if(null!=t)return t.sort},t.prototype.getMeasureColumn=function(e){return _.find(this.valueSources,function(t){return t.queryName===e})},t}();e.PivotTableSortingManager=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function r(e){return 0===e.type}var o,i=e.visuals.controls.internal.TablixUtils;!function(e){e[e.RowHeader=0]="RowHeader",e[e.ColumnHeader=1]="ColumnHeader",e[e.BodyCell=2]="BodyCell"}(o=t.PivotTableSelectionMode||(t.PivotTableSelectionMode={}));var n=function(){function n(e){this.hostServices=e,this.clearLocal()}return n.prototype.onItemContextMenu=function(e,r,o,i){t.EventBubblingUtil.markAsHandled(o);var n;!this.isEmpty()&&this.isItemSelected(e,!0)?(n=this.selectedItems,r=this.selectionMode):n=[e];var a=this.createContextMenuArgs(e,r,n,o,i);a&&this.hostServices.onContextMenu(a)},n.prototype.onWhitespaceClick=function(){this.clearLocal(),this.hostServices.onSelect(this.createSelectArgs(this.selectedItems))},n.prototype.isDrillingEnabled=function(e,t,r){var o=this.createSelectingArgs(e,r,t);return this.hostServices.onSelecting(o),1===o.action},n.prototype.select=function(e,t,r){this.updateSelection(e,t,r,!1),this.hostServices.onSelect(this.createSelectArgs(this.selectedItems,r))},n.prototype.updateSelection=function(e,t,r,o){if(o||t===this.selectionMode||this.clearLocal(),this.createSelectorsByColumn(e))if(this.isItemSelected(e,o)){if(o)return!1;1===this.selectedItems.length?this.clearLocal():r?this.unselectItem(e):this.selectedItems=[e]}else r&&t===this.selectionMode||this.clearLocal(),this.selectionMode=t,this.selectedItems.push(e),this.hostServices.canSelect(this.createSelectArgs(this.selectedItems))||(this.selectedItems=[e]);else this.clearLocal();return!0},n.prototype.isRowHeaderHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,r=this.selectedItems;t<r.length;t++){var o=r[t];if(this.isRowHeaderOnSelectedPath(o,e))return!0}return!1},n.prototype.isColumnHeaderHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,r=this.selectedItems;t<r.length;t++){var o=r[t];if(this.isColumnHeaderOnSelectedPath(o,e))return!0}return!1},n.prototype.isBodyCellHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,r=this.selectedItems;t<r.length;t++){var o=r[t];if(this.isBodyCellOnSelectedPath(o,e))return!0}return!1},n.prototype.isRowHeaderOnSelectedPath=function(e,t){if(this.selectionMode===o.ColumnHeader)return!0;var i;return i=r(e)?e.rowItem:e,this.isOnSelectedPath(this.getEffectiveSelectedHeader(i),t)},n.prototype.isColumnHeaderOnSelectedPath=function(e,t){if(this.selectionMode===o.RowHeader)return!0;var i;return i=r(e)?e.columnItem:e,this.isOnSelectedPath(this.getEffectiveSelectedHeader(i),t)},n.prototype.isBodyCellOnSelectedPath=function(e,t){return this.isRowHeaderOnSelectedPath(e,t.rowItem)&&this.isColumnHeaderOnSelectedPath(e,t.columnItem)},n.prototype.isOnSelectedPath=function(e,t){if(!e)return!0;for(var r=e;r;){if(r===t)return!0;r=r.parent}for(r=t;r;){if(r===e)return!0;r=r.parent}return!1},n.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t;var r=e&&e.getHierarchyItems(),o=t&&t.getHierarchyItems();if(!this.isEmpty()){for(var i=[],a=0,s=this.selectedItems;a<s.length;a++){var l=s[a],u=n.getMatchingItem(l,this.selectionMode,r,o,e);u?i.push(u):i.push(l)}this.selectedItems=i}},n.getMatchingItem=function(e,t,r,i,n){switch(t){case o.RowHeader:return this.getMatchingHeader(e,r);case o.ColumnHeader:return this.getMatchingHeader(e,i);case o.BodyCell:var a=e,s=this.getMatchingHeader(a.rowItem,r),l=this.getMatchingHeader(a.columnItem,i);return s&&l?n.getIntersection(s,l):null}},n.getMatchingHeader=function(e,t){if(t)for(var r=0,o=t;r<o.length;r++){var i=o[r];if(this.areHeadersEqual(e,i))return i;var n=this.getMatchingHeader(e,i.children);if(n)return n}return null},n.areHeadersEqual=function(t,r){if(e.DataViewScopeIdentity.equals(t.identity,r.identity)&&t.queryName===r.queryName){if(!t.parent&&!r.parent)return!0;if(t.parent&&r.parent)return this.areHeadersEqual(t.parent,r.parent)}return!1},n.getMatchingItemById=function(e,t,r,i,n){var a=_.keys(e.dataMap),s=_.chain(n.getColumnHierarchy().levels).filter(function(e){return!e.sources[0].isMeasure}).map(function(e){return e.sources[0].queryName}).filter(function(e){return _.includes(a,e)}).value(),l=_.chain(n.getRowHierarchy().levels).map(function(e){return e.sources[0].queryName}).filter(function(e){return _.includes(a,e)}).value();switch(t){case o.RowHeader:return this.getMatchingHeaderById(e,l,r);case o.ColumnHeader:return this.getMatchingHeaderById(e,s,i);case o.BodyCell:var u=this.getMatchingHeaderById(e,l,r),h=this.getMatchingHeaderById(e,s,i);return u&&h?n.getIntersection(u,h):null}},n.getMatchingHeaderById=function(e,t,r){if(r)for(var o=0,i=r;o<i.length;o++)for(var n=i[o],a=function(r,o){var i=t[r];if(s.headerMatchesId(e,i,n)){if(1===o)return{value:n};var a=s.getMatchingHeaderById(e,_.filter(t,function(e){return e!==i}),n.children);if(a)return{value:a}}},s=this,l=0,u=t.length;l<u;l++){var h=a(l,u);if("object"==typeof h)return h.value}return null},n.headerMatchesId=function(t,r,o){return!!(r===o.queryName&&t.dataMap&&t.dataMap[r]&&e.DataViewScopeIdentity.equals(_.head(t.dataMap[r]),o.identity))},n.areCornerItemsEqual=function(e,t){return!(!e.metadata||!t.metadata)&&e.metadata.queryName===t.metadata.queryName},n.prototype.clearLocal=function(){this.selectedItems=[]},n.prototype.restoreSelectionState=function(e,t){this.clearLocal();for(var r=!1,o=this.selectedItems,i=0,a=e;i<a.length;i++){var s=a[i],l=this.determineSelectionModeFromIds(s,t);if(null!=l){this.selectionMode=l;var u=n.getMatchingItemById(s,l,t.getRowHierarchy().root.children,t.getColumnHierarchy().root.children,t);u&&(o.push(u),r=!0)}}return r},n.prototype.determineSelectionModeFromIds=function(e,t){if(!e)return this.selectionMode;var r=_.map(t.getColumnHierarchy().levels,function(e){return e.sources[0].queryName}),i=!1,n=_.map(t.getRowHierarchy().levels,function(e){return e.sources[0].queryName}),a=!1;for(var s in e.dataMap)if(_.includes(r,s))i=!0;else{if(!_.includes(n,s))return;a=!0}return i&&a?o.BodyCell:i?o.ColumnHeader:a?o.RowHeader:void 0},n.prototype.isEmpty=function(){return _.isEmpty(this.selectedItems)},n.prototype.isItemSelected=function(e,t){void 0===t&&(t=!1);for(var o=r(e)?e:void 0,i=0,n=this.selectedItems;i<n.length;i++){var a=n[i];if(r(a)&&o){if(this.areBodyCellsEqual(a,o))return!0}else if(a===e)return!0}return!(!t||this.isEmpty()||!o)&&this.isBodyCellHighlighted(o)},n.prototype.unselectItem=function(e){var t=this;r(e)?_.remove(this.selectedItems,function(r){return t.areBodyCellsEqual(r,e)}):_.pull(this.selectedItems,e)},n.prototype.areBodyCellsEqual=function(e,t){return e.rowItem===t.rowItem&&e.columnItem===t.columnItem},n.prototype.getEffectiveSelectedHeader=function(e){return e&&!e.identity?this.getEffectiveSelectedHeader(e.parent):e},n.prototype.getEffectiveSelectedNodes=function(e){return e.parent?[this.getEffectiveSelectedHeader(e)]:e.identity?[e]:e.siblings},n.getRoleNames=function(e){switch(e){case o.ColumnHeader:return[t.matrixRoleNames.columns];case o.RowHeader:return[t.matrixRoleNames.rows];case o.BodyCell:return[t.matrixRoleNames.values]}},n.prototype.createSelectingArgs=function(e,t,r){return{visualObjects:this.getVisualObjects([e]),position:n.getMouseEventPosition(r),dataRoles:n.getRoleNames(t)}},n.prototype.createSelectArgs=function(e,t){for(var r=[],o=0,i=e;o<i.length;o++){var n=i[o],a=this.createSelectorsByColumn(n);a&&r.push({objectName:"",selectorsByColumn:a})}return{visualObjects:this.getVisualObjects(e),multiSelect:t}},n.prototype.getVisualObjects=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r],n=this.createSelectorsByColumn(i);n&&t.push({objectName:"",selectorsByColumn:n})}return t},n.prototype.createContextMenuArgs=function(e,t,o,i,a){for(var s=this,l=[],u=0,h=o;u<h.length;u++){var d=h[u],c=this.createSelectorsByColumn(d);c&&l.push(c)}var g={dataRoles:a,data:l,position:n.getMouseEventPosition(i)};if(r(e)||(g.nodeIndex=this.getHierarchyNodeIndex(e)),_.isEmpty(l)&&r(e)&&e.isColumnGrandTotal&&e.isRowGrandTotal)return g.copyArgs={singleValue:function(){return String(e.dataPoint)}},g;var p;if(r(e)){null!=e.dataPoint&&(p=e.dataPoint)}else p=e.tooltipValueFormatted;return g.copyArgs={grid:function(){return s.generateGridCopyCallback(o,t)}},void 0!==p&&(g.copyArgs.singleValue=function(){return String(p)}),g},n.prototype.generateGridCopyCallback=function(e,r){var n,a=e.slice(),s=[];switch(r){case o.BodyCell:a=this.collectSelectedBodyNodes(a),n=t.PivotTableInteractivityUtils.getGivenBodyCellsInfo(a,this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(i.ValueLabel)),s.push.apply(s,[n.headers].concat(n.values));break;case o.ColumnHeader:for(var l=[],u=0,h=a;u<h.length;u++){var d=h[u];this.columnHierarchyNavigator.isLeaf(d)&&this.columnHierarchyNavigator.getColumnHeaderMetadataColumn(d).isMeasure?l.push.apply(l,d.siblings):l.push(d)}a=l,n=t.PivotTableInteractivityUtils.getGivenGroupingDataItems([],a,this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(i.ValueLabel)),s.push.apply(s,[n.headers].concat(n.values));break;case o.RowHeader:n=t.PivotTableInteractivityUtils.getGivenGroupingDataItems(a,[],this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(i.ValueLabel)),s.push.apply(s,[n.headers].concat(n.values));break;default:debug.assertNever(r)}return{grid:s,coveragePercentage:n?n.coveragePercentage:void 0}},n.prototype.getHierarchyNodeIndex=function(e){for(var t=[];e&&null!=e.index;)t.splice(0,0,e.index),e=e.parent;return t},n.prototype.collectSelectedBodyNodes=function(e){for(var r=[],o=0,i=e;o<i.length;o++){var n=i[o];if(!n.isSubtotal&&n.columnItem.identity&&n.rowItem.identity)r.push(n);else{var a=[],s=[];n.isRowGrandTotal||(a=this.getEffectiveSelectedNodes(n.rowItem)),n.isColumnGrandTotal||(s=this.getEffectiveSelectedNodes(n.columnItem));var l=t.PivotTableInteractivityUtils.explodeHeadersToBodyItems(this.rowHierarchyNavigator,this.columnHierarchyNavigator,a,s);r.push.apply(r,l)}}for(var u=0;u<r.length;u++)for(var h=r[u],d=u+1;d<r.length;d++){var c=r[d];_.isEqual(h,c)&&(r.splice(d,1),d--)}return r},n.prototype.createSelectorsByColumn=function(e){return r(e)?this.createSelectorsByColumnForBodyCell(e):this.createSelectorsByColumnForHeader(e)},n.prototype.createSelectorsByColumnForHeader=function(e){var t=e.queryName,r={};return n.addHeaderIdentities(e,r)?{dataMap:r,metadata:[t]}:null},n.prototype.createSelectorsByColumnForBodyCell=function(e){var t={},r=n.addHeaderIdentities(e.rowItem,t),o=n.addHeaderIdentities(e.columnItem,t);return r||o?{dataMap:t,metadata:e.columnMetadata?[e.columnMetadata.queryName]:void 0}:null},n.addHeaderIdentities=function(e,t){for(var r=[];e;)e.identity&&r.splice(0,0,e),e=e.parent;for(var o=0,i=r;o<i.length;o++){var n=i[o];t[n.queryName]=[n.identity]}return r.length>0},n.hasIdentity=function(e){return n.addHeaderIdentities(e,{})},n.getMouseEventPosition=function(e){return{x:e.clientX,y:e.clientY}},n}();t.PivotTableSelectionManager=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.data.DataViewMatrixUtils,o=e.data.DataViewScopeTotal,i=function(){function e(e){this.hostServices=e}return e.prototype.onDataViewChanged=function(e,t,o,i){this.columnHierarchy=e,this.valueSources=t,this.metatdataObjects=o,this.valuesOnRowApplied=i,this.hasColumnGrouping=r.getColumnGroupingLevelsCount(this.columnHierarchy)>0,this.hasMultiMeasureOnColumns=!_.isEmpty(this.valueSources)&&this.valueSources.length>1&&!this.valuesOnRowApplied,this.headerPendingChanges=[],this.cornerPendingChanges=[]},e.prototype.getNodeSelector=function(e){if(!this.hasColumnGrouping){if(e.queryName)return{metadata:e.queryName};if(this.valuesOnRowApplied)return null}for(var t={};e;){if(this.hasMultiMeasureOnColumns&&e.level===this.columnHierarchy.levels.length-1)t.metadata=e.queryName;else if(e.isSubtotal){for(var r=[],i=this.columnHierarchy.levels[e.level].sources,n=0,a=i;n<a.length;n++){var s=a[n];_.isEmpty(s.identityExprs)||r.push.apply(r,s.identityExprs)}_.isEmpty(r)||(t.data=[o.fromExprs(r)])}else e.identity&&(t.data?t.data.splice(0,0,e.identity):t.data=[e.identity]);e=e.parent}return t},e.prototype.getCornerSelector=function(e){if(e.metadata&&e.metadata.queryName)return{metadata:e.metadata.queryName}},e.prototype.getHeaderPendingChange=function(e){return _.find(this.headerPendingChanges,function(r){return t.PivotTableSelectionManager.areHeadersEqual(r.cell,e)})},e.prototype.getCornerPendingChange=function(e){return _.find(this.cornerPendingChanges,function(r){return t.PivotTableSelectionManager.areCornerItemsEqual(r.cell,e)})},e.prototype.queueHeaderPendingChange=function(e,t){var r=this.getHeaderPendingChange(e);r?r.width=t:this.headerPendingChanges.push({cell:e,width:t})},e.prototype.queueCornerPendingChange=function(e,t){var r=this.getCornerPendingChange(e);r?r.width=t:this.cornerPendingChanges.push({cell:e,width:t})},e.prototype.getColumnWidth=function(e){var r=this.getHeaderPendingChange(e);if(r)return r.width;var o;return this.hasColumnGrouping?o=e.objects:e.queryName?o=this.valueSources[e.levelSourceIndex||0].objects:this.valuesOnRowApplied&&(o=this.metatdataObjects),t.TablixPropertyManager.PropColumnWidthValue.getValue(o)},e.prototype.setColumnWidth=function(e,r){var o=this.getNodeSelector(e);this.queueHeaderPendingChange(e,r),t.PivotTableSizeManagerUtils.persistWidths([{selector:o,value:r}],this.hostServices,this.onPersisting)},e.prototype.getRowHeight=function(e){},e.prototype.setRowHeight=function(e,t){},e.prototype.getRowLevelWidth=function(e){var r=this.getCornerPendingChange(e);return r?r.width:e.metadata&&e.metadata.objects?t.TablixPropertyManager.PropColumnWidthValue.getValue(e.metadata.objects):void 0},e.prototype.setRowLevelWidth=function(e,r){var o=this.getCornerSelector(e);o&&(this.queueCornerPendingChange(e,r),t.PivotTableSizeManagerUtils.persistWidths([{selector:o,value:r}],this.hostServices,this.onPersisting))},e.prototype.getColumnLevelHeight=function(e){},e.prototype.setColumnLevelHeight=function(e,t){},e.prototype.setMissingWidths=function(e,r){for(var o=[],i=0,n=e;i<n.length;i++){var a=n[i],s=a.node,l=a.width;null==this.getColumnWidth(s)&&(this.queueHeaderPendingChange(s,l),o.push({selector:this.getNodeSelector(s),value:l}))}for(var u=0,h=r;u<h.length;u++){var d=h[u],c=d.corner,l=d.width,g=this.getCornerSelector(c);g&&null==this.getRowLevelWidth(c)&&(this.queueCornerPendingChange(c,l),o.push({selector:g,value:l}))}_.isEmpty(o)||t.PivotTableSizeManagerUtils.persistWidths(o,this.hostServices,this.onPersisting)},e.prototype.clearWidths=function(e,r){for(var o=[],i=0,n=e;i<n.length;i++){var a=n[i];null!=this.getColumnWidth(a)&&o.push({selector:this.getNodeSelector(a),value:void 0}),this.queueHeaderPendingChange(a,void 0)}for(var s=0,l=r;s<l.length;s++){var u=l[s];null!=this.getRowLevelWidth(u)&&o.push({selector:this.getCornerSelector(u),value:void 0}),this.queueCornerPendingChange(u,void 0)}_.isEmpty(o)||t.PivotTableSizeManagerUtils.persistWidths(o,this.hostServices,this.onPersisting)},e}();t.PivotTableSizeManager=i}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.TablixColumnWidthManager,o=e.visuals.controls.TablixControl,i=e.visuals.controls.TablixType,n=e.visuals.controls.internal.TablixUtils,a=function(){function a(e){this.isTouchDisabled=e&&e.isTouchDisabled}return a.prototype.init=function(e){this.element=e.element,this.updateViewport(e.viewport),this.isInteractive=e.interactivity&&null!=e.interactivity.selection,this.getLocalizedString=e.host.getLocalizedString,this.hostServices=e.host,this.persistingObjects=!1,this.waitingForData=!1,this.lastAllowHeaderResize=!0,this.waitingForSort=!1,this.style=e.style,this.tablixPropertyManager=new t.TablixPropertyManager(this.style)},a.converter=function(t,r){var o=t.table,i=e.Prototype.inherit(o);i.visualRows=[];for(var n=0;n<o.rows.length;n++){var a={index:n,values:o.rows[n]};i.visualRows.push(a)}return i.formattingProperties=r.getTableObjects(t),i},a.prototype.onResizing=function(e){this.updateViewport(e)},a.prototype.getColumnWidthManager=function(){return this.columnWidthManager},a.prototype.onDataChanged=function(t){var r=t.dataViews;if(r&&r.length>0){var o=this.dataView;if(this.dataView=r[0],this.persistingObjects)return void(this.persistingObjects=!1);var i=a.converter(this.dataView,this.tablixPropertyManager);t.operationKind===e.VisualDataChangeOperationKind.Append?(this.createOrUpdateHierarchyNavigator(i),this.tablixControl.updateModels(!1,i.visualRows,i.columns),this.refreshControl(!1)):(this.createOrUpdateHierarchyNavigator(i),this.createColumnWidthManager(),this.createOrUpdateTablixControl(i),this.updateInternal(o,i))}this.waitingForData=!1,this.waitingForSort=!1},a.prototype.createColumnWidthManager=function(){var e=this;this.columnWidthManager?this.columnWidthManager.updateDataView(this.dataView):this.columnWidthManager=new r(this.dataView,(!1),function(t){return e.persistColumnWidths(t)})},a.prototype.persistColumnWidths=function(e){this.persistingObjects=!0,this.hostServices.persistProperties(e)},a.prototype.updateViewport=function(e){this.currentViewport=e,this.tablixControl&&(this.tablixControl.viewport=this.currentViewport,this.verifyHeaderResize(),this.refreshControl(!1))},a.prototype.refreshControl=function(e){(this.element.is(":visible")||1===this.getLayoutKind())&&this.tablixControl.refresh(e)},a.prototype.getLayoutKind=function(){return this.isInteractive?0:1},a.prototype.createOrUpdateHierarchyNavigator=function(e){var r=!this.dataView.metadata.segment;if(this.tablixControl)this.hierarchyNavigator.update(e,r,e.formattingProperties.formatters);else{var o=new t.TableHierarchyNavigator(e,r,e.formattingProperties.formatters,this.tablixPropertyManager);this.hierarchyNavigator=o}},a.prototype.createOrUpdateTablixControl=function(e){if(this.tablixControl){this.tablixControl.getBinder().updateDataView(e)}else this.tablixControl=this.createControl(this.hierarchyNavigator,e)},a.prototype.createControl=function(e,r){var i=this,n=this.getLayoutKind(),a=r.formattingProperties.general.textSize,s={onBindRowHeader:function(e){return i.onBindRowHeader(e)},onColumnHeaderClick:function(e,t){return i.onColumnHeaderClick(e,t)},layoutKind:n,columnWidthManager:this.columnWidthManager,tablixPropertyManager:this.tablixPropertyManager},l=new t.TableBinder(s,r),u=1===n?t.controls.internal.DashboardTablixLayoutManager.createLayoutManager(l):t.controls.internal.CanvasTablixLayoutManager.createLayoutManager(l,this.columnWidthManager),h=document.createElement("div");return this.element.append(h),new o(e,u,l,h,{interactive:this.isInteractive,enableTouchSupport:!this.isTouchDisabled,layoutKind:n,fontSize:t.TablixPropertyManager.getTextSizeInPx(a)})},a.prototype.updateInternal=function(e,r){var o=this,i=r.formattingProperties.general.textSize;1===this.getLayoutKind()&&this.tablixControl.layoutManager.adjustContentSize(t.converterHelper.hasImageUrlColumn(this.dataView)),this.tablixControl.fontSize=t.TablixPropertyManager.getTextSizeInPx(i),this.tablixControl.wordWrapColumnHeaders=r.formattingProperties.columnHeaders.wordWrap,this.verifyHeaderResize(),this.tablixControl.updateModels(!0,r.visualRows,r.columns);var n=this.createTotalsRow(this.dataView);this.tablixControl.rowDimension.setFooter(n),this.tablixControl.viewport=this.currentViewport;var a=this.shouldClearControl(e,this.dataView);setTimeout(function(){o.refreshControl(a);var e=o.columnWidthManager.onColumnsRendered(o.tablixControl.layoutManager.columnWidthsToPersist);o.persistingObjects&&!e&&(o.persistingObjects=!1)},0)},a.prototype.shouldClearControl=function(t,r){return!(this.waitingForSort&&t&&r)||!e.DataViewUtils.isMetadataEquivalent(t.metadata,r.metadata)},a.prototype.createTotalsRow=function(e){if(!t.TablixPropertyManager.PropGeneralTableTotals.getValue(e.metadata.objects))return null;var r=e.table.totals;if(!r||0===r.length)return null;for(var o=[],i=e.table.columns,n=0,a=i.length;n<a;++n){var s=r[n];null!=s?o.push(s):o.push(0===n?this.getLocalizedString("TableTotalLabel"):"")}return{totalCells:o,objects:e.table.totals.objects}},a.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},a.prototype.onColumnHeaderClick=function(e,t){this.waitingForSort=!0,this.hostServices.onCustomSort(n.getCustomSortEventArgs(e,t))},a.prototype.needsMoreData=function(e){if(this.waitingForData||!this.dataView.metadata||!this.dataView.metadata.segment)return!1;var t=this.tablixControl.rowDimension.getItemsCount(),r=t*n.PreferredLoadMoreThreshold;return this.hierarchyNavigator.getIndex(e)>=r},a.prototype.enumerateObjectInstances=function(e){var r=new t.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,r,this.dataView,i.Table),r.complete()},a.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,i.Table),e},a.prototype.shouldAllowHeaderResize=function(){return 1===this.hostServices.getViewMode()},a.prototype.onViewModeChanged=function(e){this.tablixControl&&this.tablixControl.toggleTouchBindings(1!==e),this.updateViewport(this.currentViewport)},a.prototype.verifyHeaderResize=function(){var e=this.shouldAllowHeaderResize();e!==this.lastAllowHeaderResize&&(this.lastAllowHeaderResize=e,this.tablixControl.layoutManager.setAllowHeaderResize(e))},a}();t.Table=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,o=e.visuals.controls.internal.TablixUtils.CellStyle,i=e.visuals.controls.internal.TablixUtils.EdgeSettings,n=e.visuals.controls.internal.TablixUtils.EdgeType,a=e.visuals.controls.internal.TablixUtils,s=jsCommon.UrlUtils.UrlScheme,l=jsCommon.UrlUtils,u=jsCommon.WordBreaker;!function(e){function r(e,r,o,s,l){r.fontFamily=a.FontFamilyHeader,r.fontColor=a.FontColorHeaders,r.borders.bottom=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,l.PropGridOutlineColor.getValue(null));var u=o.grid,h=o.columnHeaders,d=o.total,c=o.values;r.borders.top=new i,r.borders.top.applyParams(t.outline.showTop(h.outline),u.outlineWeight,u.outlineColor,n.Outline),r.borders.bottom=new i,r.borders.bottom.applyParams(t.outline.showBottom(h.outline),u.outlineWeight,u.outlineColor,n.Outline),r.borders.left=new i,e.column.isFirst&&(r.borders.left.applyParams(t.outline.showLeft(h.outline),u.outlineWeight,u.outlineColor,n.Outline),t.outline.showLeft(h.outline)||!t.outline.showLeft(d.outline)&&!t.outline.showLeft(c.outline)||(r.paddings.left+=u.outlineWeight)),r.borders.right=new i,e.column.isLast?(r.borders.right.applyParams(t.outline.showRight(h.outline),u.outlineWeight,u.outlineColor,n.Outline),t.outline.showRight(h.outline)||!t.outline.showRight(d.outline)&&!t.outline.showRight(c.outline)||(r.paddings.right+=u.outlineWeight)):r.borders.right.applyParams(u.gridVertical,u.gridVerticalWeight,u.gridVerticalColor,n.Gridline),
s&&s.styleHeader&&s.fontColor?r.fontColor=s.fontColor:r.fontColor=h.fontColor,s&&s.styleHeader&&s.backColor?r.backColor=s.backColor:r.backColor=h.backColor,r.paddings.top=r.paddings.bottom=u.rowPadding}function o(e,r,o,a,s,l){e.row.isLast||(o.borders.bottom=new i(t.TablixPropertyManager.PropGridHorizontalWeight.defaultValue,l.PropGridHorizontalColor.getValue(null)));var u=a.grid,h=a.values,d=a.total,c=a.columnHeaders;o.borders.top=new i,e.row.isFirst&&o.borders.top.applyParams(t.outline.showTop(h.outline),u.outlineWeight,u.outlineColor,n.Outline),o.borders.bottom=new i,e.row.isLast?o.borders.bottom.applyParams(t.outline.showBottom(h.outline),u.outlineWeight,u.outlineColor,n.Outline):o.borders.bottom.applyParams(u.gridHorizontal,u.gridHorizontalWeight,u.gridHorizontalColor,n.Gridline),o.borders.left=new i,e.column.isFirst&&(o.borders.left.applyParams(t.outline.showLeft(h.outline),u.outlineWeight,u.outlineColor,n.Outline),t.outline.showLeft(h.outline)||!t.outline.showLeft(d.outline)&&!t.outline.showLeft(c.outline)||(o.paddings.left+=u.outlineWeight)),o.borders.right=new i,e.column.isLast?(o.borders.right.applyParams(t.outline.showRight(h.outline),u.outlineWeight,u.outlineColor,n.Outline),t.outline.showRight(h.outline)||!t.outline.showRight(d.outline)&&!t.outline.showRight(c.outline)||(o.paddings.right+=u.outlineWeight)):o.borders.right.applyParams(u.gridVertical,u.gridVerticalWeight,u.gridVerticalColor,n.Gridline),r.fontColor?o.fontColor=r.fontColor:s&&s.styleValues&&s.fontColor?o.fontColor=s.fontColor:o.fontColor=e.row.index%2===0?h.fontColorPrimary:h.fontColorSecondary,r.backColor?o.backColor=r.backColor:s&&s.styleValues&&s.backColor?o.backColor=s.backColor:o.backColor=e.row.index%2===0?h.backColorPrimary:h.backColorSecondary,o.paddings.top=o.paddings.bottom=u.rowPadding}function s(e,r,o,s,l,u){o.fontFamily=a.FontFamilyTotal,o.borders.top=new i(t.TablixPropertyManager.PropGridOutlineWeight.defaultValue,u.PropGridOutlineColor.getValue(null));var h=s.total,d=s.grid,c=s.values,g=s.columnHeaders;o.borders.top=new i,o.borders.top.applyParams(t.outline.showTop(h.outline),d.outlineWeight,d.outlineColor,n.Outline),o.borders.bottom=new i,o.borders.bottom.applyParams(t.outline.showBottom(h.outline),d.outlineWeight,d.outlineColor,n.Outline),o.borders.left=new i,e.column.isFirst&&(o.borders.left.applyParams(t.outline.showLeft(h.outline),d.outlineWeight,d.outlineColor,n.Outline),t.outline.showLeft(h.outline)||!t.outline.showLeft(c.outline)&&!t.outline.showLeft(g.outline)||(o.paddings.left+=d.outlineWeight)),o.borders.right=new i,e.column.isLast?(o.borders.right.applyParams(t.outline.showRight(h.outline),d.outlineWeight,d.outlineColor,n.Outline),t.outline.showRight(h.outline)||!t.outline.showRight(c.outline)&&!t.outline.showRight(g.outline)||(o.paddings.right+=d.outlineWeight)):o.borders.right.applyParams(d.gridVertical,d.gridVerticalWeight,d.gridVerticalColor,n.Gridline);var p,f;l&&l.styleTotal&&(p=l.fontColor,f=l.backColor),o.fontColor=r.fontColor||p||h.fontColor,o.backColor=r.backColor||f||h.backColor,o.paddings.top=o.paddings.bottom=d.rowPadding}e.setColumnHeaderStyle=r,e.setBodyCellStyle=o,e.setFooterBodyCellStyle=s}(r=t.TableStyler||(t.TableStyler={}));var h=function(){function i(e,t){this.options=e,t&&this.updateDataView(t)}return i.prototype.updateDataView=function(e){this.tableDataView=e,this.formattingProperties=e.formattingProperties,this.updateTextHeights(),this.hasImage()?this.rowHeight=Math.max(this.textHeightValue,this.formattingProperties.grid.imageHeight):this.rowHeight=this.textHeightValue},i.prototype.updateTextHeights=function(){this.fontSizeHeader=this.formattingProperties.general.textSize.px,this.textPropsHeader={fontFamily:a.FontFamilyHeader,fontSize:jsCommon.PixelConverter.toString(this.fontSizeHeader)},this.textHeightHeader=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsHeader,"a")),this.fontSizeValue=this.formattingProperties.general.textSize.px,this.textPropsValue={fontFamily:a.FontFamilyCell,fontSize:jsCommon.PixelConverter.toString(this.fontSizeValue)},this.textHeightValue=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsValue,"a")),this.fontSizeTotal=this.formattingProperties.general.textSize.px,this.textPropsTotal={fontFamily:a.FontFamilyTotal,fontSize:jsCommon.PixelConverter.toString(this.fontSizeTotal)},this.textHeightTotal=Math.ceil(e.TextMeasurementService.measureSvgTextHeight(this.textPropsTotal,"a"))},i.prototype.hasImage=function(){return _.some(this.tableDataView.columns,function(e){return t.converterHelper.isImageUrlColumn(e)})},i.prototype.getColumnFormatting=function(e){return this.formattingProperties.columnFormatting[e.queryName]},i.prototype.onStartRenderingSession=function(){},i.prototype.onEndRenderingSession=function(){},i.prototype.bindRowHeader=function(e,t){e.totalCells?t.contentHeight=this.textHeightTotal:t.contentHeight=this.rowHeight,a.clearCellStyle(t),this.options.onBindRowHeader&&this.options.onBindRowHeader(e)},i.prototype.unbindRowHeader=function(e,t){},i.prototype.bindColumnHeader=function(t,i){var n=this;i.extension.disableDragResize(),a.resetCellCssClass(i),a.addCellCssClass(i,a.CssClassTablixHeader),a.addCellCssClass(i,a.CssClassTablixColumnHeaderLeaf);var s=new o;r.setColumnHeaderStyle(i.position,s,this.formattingProperties,this.getColumnFormatting(t),this.options.tablixPropertyManager);var l=i.extension.contentHost;l=a.appendDiv(l),l.classList.add(a.CssClassWrappingContainer);var u,h=this.getWordWrappingWidth(t.queryName,i,s);null!=h&&(u=this.getWordWrappingLines(t.displayName,h));var d=u&&u.length>1;if(d){i.contentHeight=u.length*this.textHeightHeader;for(var c=0,g=u.length;c<g-1;c++)a.appendDiv(l,u[c]);l=a.appendDiv(l)}else i.contentHeight=this.textHeightHeader;this.sortIconsEnabled()&&(l=a.addSortIconToColumnHeader(t.sort,l),t.sort&&!d&&(i.contentWidth=this.fontSizeHeader+a.SortIconPadding));var p=t.displayName;if(d){var f=_.last(u);a.setCellText(f,l),a.setCellTooltip(p,i.extension.contentHost),i.contentWidth=h}else a.setCellTextAndTooltip(p,l,i.extension.contentHost),i.contentWidth+=e.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,p);if(i.contentWidth=Math.ceil(i.contentWidth),this.options.onColumnHeaderClick){var m=function(e){if(a.isValidSortClick(e)){var r=a.reverseSort(t.sort);n.options.onColumnHeaderClick(t.queryName?t.queryName:t.displayName,r)}};i.extension.registerClickHandler(m)}i.applyStyle(s)},i.prototype.getWordWrappingLines=function(t,r){return u.splitByWidth(t,this.textPropsHeader,e.TextMeasurementService.measureSvgTextWidth,r,a.WordWrappingMaxLines,void 0,!0)},i.prototype.getWordWrappingWidth=function(e,t,r){if(this.formattingProperties.columnHeaders.wordWrap&&0===this.options.layoutKind){var o;if(t.isColumnResizing()&&t.containerWidth>=0?o=t.containerWidth:this.options.columnWidthManager&&(o=this.options.columnWidthManager.getPersistedColumnWidth(e)),null!=o)return Math.max(0,o-(r.getExtraLeft()+r.getExtraRight()))}},i.prototype.unbindColumnHeader=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t),this.sortIconsEnabled()&&a.removeSortIcons(t),this.options.onColumnHeaderClick&&t.extension.unregisterClickHandler()},i.prototype.bindBodyCell=function(e,t){a.resetCellCssClass(t),this.setBodyContent(e,t),t.contentWidth=Math.ceil(t.contentWidth),e.isTotal?(a.addCellCssClass(t,a.CssClassTablixValueTotal),a.addCellCssClass(t,a.CssClassTableFooter)):e.position.row.isLast?a.addCellCssClass(t,a.CssClassTableBodyCellBottom):a.addCellCssClass(t,a.CssClassTableBodyCell),e.isNumeric&&a.addCellCssClass(t,a.CssClassTablixValueNumeric);var i=new o;e.isTotal?r.setFooterBodyCellStyle(t.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixPropertyManager):r.setBodyCellStyle(t.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixPropertyManager),t.applyStyle(i)},i.prototype.setBodyContent=function(t,r){var o=r.extension.contentHost,i=this.formattingProperties.grid.imageHeight,n=t.textContent;t.isTotal?r.contentHeight=this.textHeightTotal:t.isImage?r.contentHeight=i:r.contentHeight=this.textHeightValue;var u=a.getUrlScheme(t.columnMetadata,t.textContent);if(u!==s.NONE){var h=this.formattingProperties.values.urlIcon,d=void 0;return h&&(d=a.getUrlIconName(u)),h&&null!=d?a.appendATagToBodyCell(n,o,d):a.appendATagToBodyCell(n,o),void(h?r.contentWidth=this.fontSizeValue:r.contentWidth=e.TextMeasurementService.measureSvgTextWidth(this.textPropsValue,n))}if(t.isImage&&l.isValidImageUrl(n))return a.appendImgTagToBodyCell(n,o,i),void(r.contentWidth=i*a.ImageDefaultAspectRatio);var c=t.kpiContent;return c?($(o).append(c),void(r.contentWidth=this.fontSizeValue)):n?(a.setCellTextAndTooltip(n,o),void(t.isTotal?r.contentWidth=e.TextMeasurementService.measureSvgTextWidth(this.textPropsTotal,n):r.contentWidth=e.TextMeasurementService.measureSvgTextWidth(this.textPropsValue,n))):(a.setCellTextAndTooltip(" ",o),void(r.contentWidth=0))},i.prototype.unbindBodyCell=function(e,t){a.clearCellStyle(t),a.clearCellTextAndTooltip(t)},i.prototype.bindCornerCell=function(e,t){t.contentWidth=0},i.prototype.unbindCornerCell=function(e,t){},i.prototype.bindEmptySpaceHeaderCell=function(e){},i.prototype.unbindEmptySpaceHeaderCell=function(e){},i.prototype.bindEmptySpaceFooterCell=function(e){},i.prototype.unbindEmptySpaceFooterCell=function(e){},i.prototype.getHeaderLabel=function(e){return e?e.displayName:""},i.prototype.getCellContent=function(e){return e},i.prototype.hasRowGroups=function(){return!1},i.prototype.sortIconsEnabled=function(){return 0===this.options.layoutKind},i}();t.TableBinder=h}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.internal.TablixUtils.CellPosition,o=e.visuals.controls.internal.TablixUtils.TablixVisualCell,i=function(){function t(e,t,r,o){this.tableDataView=e,this.isDataComplete=t,this.formatters=r,this.tablixPropertyManager=o}return t.prototype.getColumnHierarchyDepth=function(){return 1},t.prototype.getRowHierarchyDepth=function(){return 1},t.prototype.getLeafCount=function(e){return e.length},t.prototype.getLeafAt=function(e,t){return e[t]},t.prototype.getParent=function(e){return null},t.prototype.getIndex=function(e){return e?this.isRow(e)?e.index:this.getColumnIndex(e):-1},t.prototype.isRow=function(e){if(!e)return!1;var t=e;return void 0!==t.index&&void 0!==t.values},t.prototype.getColumnIndex=function(e){return t.getIndex(this.tableDataView.columns,e)},t.prototype.isLeaf=function(e){return!0},t.prototype.isRowHierarchyLeaf=function(e){return!1},t.prototype.isColumnHierarchyLeaf=function(e){return!0},t.prototype.isFirstItem=function(e,t){return e===t[0]},t.prototype.areAllParentsFirst=function(e,t){return this.isFirstItem(e,t)},t.prototype.isLastItem=function(e,t){return(t===this.tableDataView.columns||this.isDataComplete)&&e===_.last(t)},t.prototype.areAllParentsLast=function(e,t){return this.isLastItem(e,t)},t.prototype.getChildren=function(e){return null},t.prototype.getChildrenLevelDifference=function(e){return 1/0},t.prototype.getCount=function(e){return e.length},t.prototype.getAt=function(e,t){return e[t]},t.prototype.getLevel=function(e){return 0},t.prototype.getIntersection=function(e,i){var n,a,s=!1,l=new r,u=t.getIndex(this.tableDataView.columns,i);l.column.index=u,l.column.isFirst=0===u,l.column.isLast=u===this.tableDataView.columns.length-1;var h=e;if(null!=h.totalCells)s=!0,n=h.totalCells[u],a=h.objects&&h.objects[u];else{var d=e,c=d.index;l.row.index=c,l.row.isFirst=0===c,l.row.isLast=this.isDataComplete&&c===this.tableDataView.rows.length-1,n=d.values[u],a=d.values.objects&&d.values.objects[u]}var g=new o(n,a,(!1),(!1),s,(!1),i,this.formatters[i.queryName]);g.position=l;var p=e;if(p&&p.values){var f=p.values.objects;if(f){var m=f[u];m&&(g.backColor=this.tablixPropertyManager.PropValuesBackColor.getValue(m))}}return g},t.prototype.getCorner=function(e,t){return null},t.prototype.headerItemEquals=function(t,r){if(t===r)return!0;if(t.displayName&&r.displayName){var o=t,i=r;return e.DataViewUtils.areMetadataColumnsEquivalent(o,i)}return!(!this.isRow(t)||!this.isRow(r))&&t.index===r.index},t.prototype.bodyCellItemEquals=function(e,t){return e.isMatch(t)},t.prototype.cornerCellItemEquals=function(e,t){return!0},t.prototype.update=function(e,t,r){this.tableDataView=e,this.isDataComplete=t,this.formatters=r},t.getIndex=function(e,t){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(null!=i.index&&null!=t.index&&i.index===t.index)return r;if(t===e[r])return r}return-1},t}();t.TableHierarchyNavigator=i}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=jsCommon.CssConstants,o=e.visuals.controls.internal.TablixUtils.CellStyle,i=t.controls.pivotTable.ElementBuilder,n=jsCommon.StringExtensions.encodeHtml,a=jsCommon.Utility.encodeUriForImageDataSvg,s=t.Units.FontSize,l=e.visuals.controls.internal.TablixUtils,u=jsCommon.UrlUtils.UrlScheme,h=jsCommon.UrlUtils,d=function(){function d(e,r,o){this.options=e,this.selectionManager=r,this.measureElement=t.PivotTableBinderUtils.addMeasureElement(o),this.legacyTooltipsEnabled=!0}return d.prototype.getRowHeaderBinding=function(e,t){return this.options.onBindRowHeader&&!t&&this.options.onBindRowHeader(e),{content:"",classNames:null,styleProperties:null,attributes:void 0}},d.prototype.getColumnHeaderBinding=function(r,o){var a,s=this.formattingProperties.columnHeaders,u=this.formattingProperties.columnFormatting[r.metadata.queryName],h=n(this.getColumnHeaderLabel(r));this.legacyTooltipsEnabled&&(a={title:h}),_.isEmpty(h)&&(h=l.StringNonBreakingSpace),s.wordWrap&&(h=t.PivotTableBinderUtils.replaceEncodedNewLines(h));var d=this.getColumnHeaderStyle(r,o),c=d.getExtraBottom();d.paddings.bottom+=t.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight);var g=t.PivotTableBinderUtils.buildSortIcon(t.TableExSortingManager.getSortDirection(r),this.options.sortIconEnabled,this.options.sortingEnabled,t.PivotTableSortingManager.getDefaultSortDirection(r.metadata),c,this.glyphFontInfo.textProperties.fontSize);h+=i.build(g,{});var p=e.Prototype.inherit(this.columnHeaderClasses),f=u&&u.styleHeader&&u.alignment||s.alignment;return t.PivotTableBinderUtils.addAlignmentCssClass(f,p),{content:h,classNames:p,styleProperties:d.getAttributes(),attributes:a}},d.prototype.getBodyCellBinding=function(r,o){var i,s=n(this.getBodyCellContent(r));this.legacyTooltipsEnabled&&(i={title:s});var d,c,g=this.getBodyCellStyle(r,o),p=r.columnMetadata,f=this.columnsDataBarsSettings[r.columnMetadata.queryName],m=this.formattingProperties.columnFormatting[p.queryName],v=e.StructuralObjectValue.merge(m&&m.icon,r.icon),y=r.hyperlink;if(v&&"IconOnly"===v.layout)s="";else if(_.isEmpty(s)&&(s=l.StringNonBreakingSpace),r.isKpi)s=this.getKpiContentString(r),i=null;else if(f&&!r.isTotal&&_.isNumber(r.dataPoint)&&f.hideText)s=o?l.StringNonBreakingSpace:"";else{this.formattingProperties.values.wordWrap&&(s=t.PivotTableBinderUtils.replaceEncodedNewLines(s));var C=l.getUrlScheme(r.columnMetadata,s);if(C!==u.NONE)d=t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,C),c=t.PivotTableBinderUtils.addHyperlink(s,n(r.textContent),d,this.options.onHyperlinkClicked),y=void 0;else if(this.isImage(r)){var H=a(r.textContent);c=t.PivotTableBinderUtils.buildImage(n(H),this.formattingProperties.grid.imageHeight)}}this.options.hyperlinksEnabled&&(c||""!==s&&s!==l.StringNonBreakingSpace)&&y&&h.getUrlScheme(y)!==u.NONE&&(c=t.PivotTableBinderUtils.addHyperlink(c||s,n(y),null,this.options.onHyperlinkClicked,!0,!0)),c=c?{tagName:"div",children:[c],classNames:[],styleProperties:{},attributes:{}}:{tagName:"div",content:s,classNames:[],styleProperties:{},attributes:{}};var w=c;if(v){var b=this.getBodyCellFontInfo(r).measuredFontHeight;w=t.PivotTableBinderUtils.addIconToCell(v,b,c)}return f&&!o&&!r.isTotal&&_.isNumber(r.dataPoint)&&(w=t.PivotTableBinderUtils.addDataBarsToCell(w,f,g,r.dataPoint)),this.addBodyCellClasses(r,!!d,c.classNames,w.classNames),this.addBodyCellStyleAttributes(r,o,c.styleProperties,w.styleProperties),w.attributes=i,w},d.prototype.getCornerCellBinding=function(e){return{content:"",classNames:null,styleProperties:null,attributes:void 0}},d.prototype.getApproximateRowHeaderWidth=function(e){return 0},d.prototype.getApproximateColumnHeaderWidth=function(e){return t.PivotTableBinderUtils.measureText(this.getColumnHeaderLabel(e),this.getColumnHeaderFontInfo(e).textProperties)},d.prototype.getApproximateBodyCellWidth=function(e){var r=0;if(e.icon){if(r=this.getBodyCellFontInfo(e).measuredFontHeight,"IconOnly"===e.icon.layout)return r;r+=t.PivotTableBinderUtils.TablixIconMargin}if(e.isKpi)return r+this.valueFontInfo.fontProperties.size.px;var o=e.columnMetadata&&this.columnsDataBarsSettings[e.columnMetadata.queryName];if(o&&o.hideText&&!e.isTotal&&_.isNumber(e.dataPoint))return r;var i=this.getBodyCellContent(e),n=l.getUrlScheme(e.columnMetadata,i);return n!==u.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,n)?r+this.valueFontInfo.fontProperties.size.px:this.isImage(e)?r+this.formattingProperties.grid.imageHeight:r+t.PivotTableBinderUtils.measureText(i,this.getBodyCellFontInfo(e).textProperties)},d.prototype.getApproximateCornerCellWidth=function(e){return 0},d.prototype.getApproximateRowHeaderHeight=function(e,t){return 0},d.prototype.getApproximateColumnHeaderHeight=function(e,r){var o,i=this.getColumnHeaderFontInfo(e);return o=this.formattingProperties.columnHeaders.wordWrap&&null!=r?t.PivotTableBinderUtils.getWordWrappingLines(this.getColumnHeaderLabel(e),t.PivotTableBinderUtils.getNetWidth(r,this.getColumnHeaderStyle(e,!0)),i.textProperties).length:1,i.measuredFontHeight*o},d.prototype.getApproximateBodyCellHeight=function(e,r){var o=this.getBodyCellFontInfo(e);if(e.icon&&"IconOnly"===e.icon.layout)return o.measuredFontHeight;if(e.isKpi)return this.valueFontInfo.fontProperties.size.px;var i=this.getBodyCellContent(e),n=l.getUrlScheme(e.columnMetadata,i);if(n!==u.NONE&&t.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,n))return this.valueFontInfo.fontProperties.size.px;if(this.isImage(e))return this.formattingProperties.grid.imageHeight;var a;return this.formattingProperties.values.wordWrap&&null!=r?(e.icon&&(r-=o.measuredFontHeight+t.PivotTableBinderUtils.TablixIconMargin),a=t.PivotTableBinderUtils.getWordWrappingLines(i,t.PivotTableBinderUtils.getNetWidth(r,this.getBodyCellStyle(e,!0)),o.textProperties).length):a=1,o.measuredFontHeight*a},d.prototype.getApproximateCornerCellHeight=function(e,t){return 0},d.prototype.updateFormattingProperties=function(e,o,i,n){this.formattingProperties=o,this.legacyTooltipsEnabled=n;var a=o.general.textSize,u=new t.PivotTableBinderUtils.FontInfoMeasurer;this.columnHeaderContainerFontInfo=t.PivotTableBinderUtils.createFontInfo({family:o.columnHeaders.fontFamily||l.FontFamilyHeader,size:o.columnHeaders.fontSize||a},u),this.columnHeaderFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderContainerFontInfo,{},u),this.valueContainerFontInfo=t.PivotTableBinderUtils.createFontInfo({family:o.values.fontFamily||l.FontFamilyCell,size:o.values.fontSize||a},u),this.valueFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.valueContainerFontInfo,{},u);var h,d=o.total.fontFamily;d||this.valueFontInfo.fontProperties.family!==l.FontFamilyCell?h=r.boldValue:this.valueFontInfo.fontProperties.family===l.FontFamilyCell&&(d=l.FontFamilyTotal),this.totalFontInfo=t.PivotTableBinderUtils.overrideFontInfo(this.valueFontInfo,{family:d,size:o.total.fontSize,weight:h},u),this.glyphFontInfo=t.PivotTableBinderUtils.createFontInfo({family:l.FontFamilyGlyphs,size:s.createFromPt((o.columnHeaders.fontSize||a).pt*l.SortIconFontSizeRatio),lineHeight:"100%"},u),u.measureAll(this.measureElement),this.columnHeaderClasses=[],this.formattingProperties.columnHeaders.wordWrap?this.columnHeaderClasses.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):this.columnHeaderClasses.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),this.options.interactivityIndicatorEnabled&&this.options.sortingEnabled&&this.columnHeaderClasses.push(t.PivotTableBinderUtils.cssClassCellInteractive),this.columnsDataBarsSettings={};var c=o.columnFormatting;if(c&&e&&e.table&&!_.isEmpty(e.table.columns))for(var g=0,p=e.table.columns;g<p.length;g++){var f=p[g],m=f.queryName;m&&c[m]&&(this.columnsDataBarsSettings[m]=t.PivotTableBinderUtils.getColumnDataBarsSettings(f,c[m].dataBarsSettings,i))}},d.prototype.getColumnHeaderContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},d.prototype.getValueContainerFontInfo=function(){return this.valueContainerFontInfo},d.prototype.getColumnHeaderLabel=function(e){return this.formattingProperties.columnHeaders.wordWrap?e.metadata.displayName:t.TextUtil.replaceSpaceWithNBSP(e.metadata.displayName)},d.prototype.getBodyCellContent=function(e){var r=e.textContent;return this.formattingProperties.values.wordWrap?r:t.TextUtil.replaceSpaceWithNBSP(r)},d.prototype.addBodyCellStyleAttributes=function(e,r,o,i){this.getBodyCellStyle(e,r).setAttributes(i),i.position="relative",this.selectionManager.isBodyCellHighlighted(e)||t.PivotTableBinderUtils.setUnselectedStyle(i)},d.prototype.getColumnHeaderStyle=function(e,r){var i=new o(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);return t.TableStyler.setColumnHeaderStyle(e.position,i,this.formattingProperties,this.getColumnFormatting(e.metadata),this.options.tablixPropertyManager),i.fontFamily=void 0,t.PivotTableBinderUtils.applyFontInfo(this.columnHeaderFontInfo,i,!r),i},d.prototype.getBodyCellStyle=function(e,r){var i=new o(t.PivotTableBinderUtils.CellHorizontalPadding,t.PivotTableBinderUtils.CellHorizontalPadding);return e.isRowGrandTotal?(t.TableStyler.setFooterBodyCellStyle(e.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixPropertyManager),t.PivotTableBinderUtils.applyFontInfo(this.totalFontInfo,i,!r)):(t.TableStyler.setBodyCellStyle(e.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixPropertyManager),t.PivotTableBinderUtils.applyFontInfo(this.valueFontInfo,i,!r)),i},d.prototype.addBodyCellClasses=function(e,r,o,i){var n=this.formattingProperties.columnFormatting[e.columnMetadata.queryName];this.formattingProperties.values.wordWrap?o.push(t.PivotTableBinderUtils.cssPivotTableCellClassWrap):o.push(t.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),r&&o.push(l.CssClassValueURLIconContainer),this.options.interactivityIndicatorEnabled&&this.options.selectionEnabled&&!e.isRowGrandTotal&&i.push(t.PivotTableBinderUtils.cssClassCellInteractive);var a;if(n){var s=void 0;s=e.isTotal?n.styleTotal:n.styleValues,s&&(a=n.alignment)}var u;r?u=t.textAlignment.center:e.isNumeric&&(u=t.textAlignment.right),t.PivotTableBinderUtils.addAlignmentCssClass(a,o,u)},d.prototype.getKpiContentString=function(e){return t.PivotTableBinderUtils.createKpiDomString(e.columnMetadata.kpi,e.textContent)},d.prototype.getColumnHeaderFontInfo=function(e){return this.columnHeaderFontInfo},d.prototype.getBodyCellFontInfo=function(e){return e.isRowGrandTotal?this.totalFontInfo:this.valueFontInfo},d.prototype.getColumnFormatting=function(e){return this.formattingProperties.columnFormatting[e.queryName]},d.prototype.isImage=function(e){return!(e.isRowGrandTotal&&!_.isEmpty(e.columnMetadata.identityExprs))&&t.converterHelper.isImageUrlColumn(e.columnMetadata)},d}();t.TableExBinder=d}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.internal.TablixUtils.CellPosition,o=e.visuals.controls.internal.TablixUtils,i=function(){function e(){}return e.prototype.hasHierarchy=function(){return!0},e.prototype.update=function(e){this.updateColumns(e)},e.prototype.getColumns=function(){return this.columns},e.prototype.getHierarchyDepth=function(){return 1},e.prototype.getHierarchyLeafCount=function(){return _.size(this.columns)},e.prototype.getHierarchyLeafAt=function(e){return this.columns[e]},e.prototype.getFloatingHierarchyLeafCount=function(){return 0},e.prototype.getFloatingHierarchyLeafAt=function(e){return null},e.prototype.getHierarchyItems=function(){return this.columns},e.prototype.getFloatingHierarchyItems=function(){return null},e.prototype.getLeafIndex=function(e){return e.position.column.index},e.prototype.isLeaf=function(e){return!0},e.prototype.isLastItem=function(e,t){return e.position.column.index===t.length-1},e.prototype.getParent=function(e){return null},e.prototype.getChildren=function(e){return null},e.prototype.getLevel=function(e){return 0},e.prototype.getIndex=function(e){return e.position.column.index},e.prototype.getPathIndices=function(e){return[this.getIndex(e)]},e.prototype.getNodeFromPath=function(e){if(1===e.length)return this.columns[e[0]]},e.prototype.getItemsByLevel=function(e){return this.columns.slice()},e.prototype.getLeafAncestorAtLevel=function(e,t){return e},e.prototype.getExpansionState=function(e){return 2},e.prototype.getFirstDescendentLeafIndex=function(e){return this.getLeafIndex(e)},e.prototype.getIntersection=function(e,t){return null},e.prototype.getCorner=function(e,t){return null},e.prototype.getRowLevel=function(e){return 0},e.prototype.getColumnLevel=function(e){return 0},e.prototype.isColumnHeaderMultiValueSubtotal=function(e){return!1},e.prototype.isRowHeaderMultiValueSubtotal=function(e){return!1},e.prototype.updateColumns=function(e){this.columns=[];for(var t=e.length,r=0;r<t;r++)this.columns.push({metadata:e[r],position:this.calculateItemPosition(r,t)})},e.prototype.calculateItemPosition=function(e,t){var o=new r;return o.row.index=o.row.indexInSiblings=0,o.row.isFirst=!0,o.row.isLast=!0,o.column.index=o.column.indexInSiblings=e,o.column.isFirst=0===e,o.column.isLast=e===t-1,o},e}();t.TableExColumnHierarchyNavigator=i;var n=function(){function e(e){this.tablixPropertyManager=e}return e.prototype.update=function(e,t,r,o,i,n){this.isDataComplete=o,this.formattingProperties=n,this.formatters=n.formatters,this.tooltipFormatters=n.tooltipFormatters||{},this.updateRows(e,t),this.updateFloatingRow(r,i)},e.prototype.hasHierarchy=function(){return!1},e.prototype.getRows=function(){return this.rows},e.prototype.getHierarchyDepth=function(){return 1},e.prototype.getHierarchyLeafCount=function(){return _.size(this.rows)},e.prototype.getHierarchyLeafAt=function(e){return this.rows[e]},e.prototype.getFloatingHierarchyLeafCount=function(){return this.floatingRow?1:0},e.prototype.getFloatingHierarchyLeafAt=function(e){return this.floatingRow},e.prototype.getHierarchyItems=function(){return this.rows},e.prototype.getFloatingHierarchyItems=function(){return this.floatingRow?[this.floatingRow]:null},e.prototype.getLeafIndex=function(e){return e.index},e.prototype.isLeaf=function(e){return!0},e.prototype.isLastItem=function(e,t){return this.isDataComplete&&e.index===t.length-1},e.prototype.getParent=function(e){return null},e.prototype.getIndex=function(e){return e.index},e.prototype.getPathIndices=function(e){return[this.getIndex(e)]},e.prototype.getNodeFromPath=function(e){if(1===e.length)return this.rows[e[0]]},e.prototype.getItemsByLevel=function(e){return[this.rows[0]]},e.prototype.getChildren=function(e){return null},e.prototype.getLevel=function(e){return 0},e.prototype.getLeafAncestorAtLevel=function(e,t){return null},e.prototype.getExpansionState=function(e){return 2},e.prototype.getIntersection=function(e,i){var n=i.position.column.index,a=e.values[n],s=e.values.objects&&e.values.objects[n],l=i.metadata.queryName,u=i.metadata,h=e===this.floatingRow,d=new r,c=i.position;d.column.index=c.column.index,d.column.isFirst=c.column.isFirst,d.column.isLast=c.column.isLast;var g=e.index;d.row.index=g,d.row.isFirst=0===g,d.row.isLast=this.isDataComplete&&e===_.last(this.rows);var p,f;if(h&&!u.isMeasure&&0===c.column.index)p=f=this.formattingProperties.total.totalLabel;else{var m=this.formatters[l],v=this.tooltipFormatters[l];p=m?m.format(a,s):null!=a?""+a:"",f=v?v.format(a,s):p}var y={position:d,dataPoint:a,isRowGrandTotal:h,columnMetadata:u,isTotal:h,textContent:p,tooltipContent:f,isKpi:u&&o.isValidStatusGraphic(u.kpi,p),isNumeric:u&&u.type.numeric&&!u.kpi};return s&&(y.backColor=this.tablixPropertyManager.PropValuesBackColor.getValue(s),y.fontColor=this.tablixPropertyManager.PropValuesFontColor.getValue(s),y.icon=t.TablixPropertyManager.PropValuesIcon.getValue(s),y.hyperlink=t.TablixPropertyManager.PropValuesWebURL.getValue(s)),y},e.prototype.getCorner=function(e,t){return{}},e.prototype.getRowLevel=function(e){return 0},e.prototype.getColumnLevel=function(e){return 0},e.prototype.isColumnHeaderMultiValueSubtotal=function(e){return!1},e.prototype.isRowHeaderMultiValueSubtotal=function(e){return!1},e.prototype.updateRows=function(e,t){this.rows=[];for(var r=0;r<e.length;r++)this.rows.push({index:r,values:e[r],identity:t?t[r]:void 0})},e.prototype.updateFloatingRow=function(e,t){_.isEmpty(e)?this.floatingRow=null:this.floatingRow={index:0,values:e,identity:void 0}},e}();t.TableExRowHierarchyNavigator=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e,t,r){this.tooltipService=e,this.selectionManager=t,this.totalLabel=r,this.tooltipsEnabled=!0}return t.prototype.getBodyHandler=function(){var e=this;return{addTooltip:function(t,r){return e.addBodyTooltip(t,r)},removeTooltip:function(t,r){return e.removeTooltip(r)},isTooltipEnabled:function(t){return e.tooltipsEnabled&&e.isBodyTooltipEnabled(t)}}},t.prototype.getHeaderHandler=function(){var e=this;return{addTooltip:function(t,r){return e.addHeaderTooltip(t,r)},removeTooltip:function(t,r){return e.removeTooltip(r)},isTooltipEnabled:function(t){return e.tooltipsEnabled}}},t.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t},t.prototype.tooltipVisible=function(){return this.tooltipService&&this.tooltipService.visible()},t.prototype.hideTooltip=function(){this.tooltipService&&this.tooltipService.hide()},t.prototype.setTooltipsEnabled=function(e){this.tooltipsEnabled=e},t.prototype.addBodyTooltip=function(e,t){var r=this,o=d3.select(t);this.tooltipService.addTooltip(o,function(t){return r.getBodyTooltipInfo(e,t)},function(t){return r.getItemSelectionId(e,t)})},t.prototype.addHeaderTooltip=function(e,t){var r=this,o=d3.select(t);this.tooltipService.addTooltip(o,function(t){return r.getHeaderTooltipInfo(e,t)},function(e){})},t.prototype.removeBodyTooltip=function(e){this.removeTooltip(e)},t.prototype.removeHeaderTooltip=function(e){this.removeTooltip(e)},t.prototype.removeTooltip=function(e){var t=d3.select(e);this.tooltipService.removeTooltips(t)},t.prototype.isBodyTooltipEnabled=function(e){return!e.isRowGrandTotal||!_.isEmpty(e.textContent)},t.prototype.getHeaderTooltipInfo=function(e,t){return[{displayName:e.metadata.displayName}]},t.prototype.getBodyTooltipInfo=function(e,t){if(this.rowHierarchyNavigator){var r=[],o=this.rowHierarchyNavigator.getHierarchyLeafAt(e.position.row.index);if(!e.isRowGrandTotal){var i=this.getGroupingTooltipInfo(o);i&&r.push.apply(r,i)}if(e.columnMetadata.isMeasure){var n=e.columnMetadata.displayName;if(e.isKpi){var a={metadata:e.columnMetadata.kpi,value:e.tooltipContent};r.push({displayName:n,kpiValue:a})}else _.isEmpty(e.tooltipContent)||r.push({displayName:n,value:e.tooltipContent})}else e.isRowGrandTotal&&!_.isEmpty(e.tooltipContent)&&r.push({displayName:e.tooltipContent});return _.isEmpty(r)?void 0:r}},t.prototype.getGroupingTooltipInfo=function(e){if(this.columnHierarchyNavigator&&this.rowHierarchyNavigator){for(var t=this.columnHierarchyNavigator.getColumns(),r=[],o=0,i=t;o<i.length;o++){var n=i[o];if(!n.metadata.isMeasure){var a=this.rowHierarchyNavigator.getIntersection(e,n);
r.push({displayName:n.metadata.displayName,value:a.tooltipContent})}}return r}},t.prototype.getItemSelectionId=function(t,r){if(this.rowHierarchyNavigator&&!t.isRowGrandTotal){var o=this.rowHierarchyNavigator.getHierarchyLeafAt(t.position.row.index);return e.SelectionId.fromSelectorsByColumn(this.selectionManager.createSelectorsByColumn(o))}},t}();e.TableExInteractionManager=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=e.visuals.controls.internal.TablixUtils,o=function(){function o(e){this.hostServices=e,this.totalLabel=this.hostServices.getLocalizedString(r.TotalLabel),this.clearLocal()}return o.prototype.onBodyCellContextMenu=function(e,r){if(t.EventBubblingUtil.markAsHandled(r),!this.isTableEmpty()){var o,i=this.getRowFromCell(e);o=!this.isSelectionEmpty()&&this.isItemSelected(i)?this.selectedItems:[i];var n=this.createContextMenuArgs(e,o,r);n&&this.hostServices.onContextMenu(n)}},o.prototype.onBodyCellClick=function(e,t){this.isTableEmpty()||(e.isRowGrandTotal?this.clearHost():this.select(this.getRowFromCell(e),t))},o.prototype.onWhitespaceClick=function(){this.clearHost()},o.prototype.isDrillingEnabled=function(e,t){if(!this.isTableEmpty()){var r={visualObjects:this.getVisualObjects([this.getRowFromCell(e)]),position:o.getMouseEventPosition(t)};return this.hostServices.onSelecting(r),1===r.action}},o.prototype.select=function(e,t,r,o){if(void 0===r&&(r=!1),this.isItemSelected(e)){if(r)return;1===this.selectedItems.length?this.clearLocal():t?this.unselectItem(e):this.selectedItems=[e]}else t||this.clearLocal(),this.selectedItems.push(e),o||this.hostServices.canSelect(this.createSelectArgs(this.selectedItems))||(this.selectedItems=[e]);o||this.hostServices.onSelect(this.createSelectArgs(this.selectedItems,t))},o.prototype.isBodyCellHighlighted=function(e){return!(!this.isSelectionEmpty()&&!this.isTableEmpty())||this.isItemSelected(this.getRowFromCell(e))},o.prototype.onDataViewChanged=function(e,t){if(this.rowNavigator=e,this.rows=e&&e.getRows(),this.totalRow=e&&e.getFloatingHierarchyLeafAt(0),this.columns=t&&t.getColumns(),!this.isSelectionEmpty()){for(var r=[],i=0,n=this.selectedItems;i<n.length;i++){var a=n[i],s=o.getMatchingRow(a,this.rows);s?r.push(s):r.push(a)}this.selectedItems=r}},o.prototype.clearLocal=function(){this.selectedItems=[]},o.prototype.isSelectionEmpty=function(){return _.isEmpty(this.selectedItems)},o.prototype.isTableEmpty=function(){return!this.rows},o.prototype.isItemSelected=function(e){return this.selectedItems.indexOf(e)!==-1},o.prototype.unselectItem=function(e){_.pull(this.selectedItems,e)},o.prototype.clearHost=function(){this.clearLocal(),this.hostServices.onSelect(this.createSelectArgs([]))},o.prototype.restoreSelection=function(t){if(this.clearLocal(),_.isEmpty(t))return!0;var r=_.keys(t[0].dataMap);if(1!==r.length)return!1;var o=_.chain(this.columns).filter(function(e){return!e.metadata.isMeasure}).map(function(e){return e.metadata.queryName}).value(),i=r[0];if(!_.includes(o,i))return!1;for(var n=!1,a=_.clone(t),s=0,l=this.rows;s<l.length;s++){for(var u=l[s],h=void 0,d=0,c=a;d<c.length;d++){var g=c[d],p=g.dataMap[i][0];if(e.DataViewScopeIdentity.equals(p,u.identity)){h=g;break}}h&&(this.select(u,!0,!1,!0),_.remove(a,h),n=!0)}return n},o.prototype.getRowFromCell=function(e){return e.isRowGrandTotal?this.totalRow:this.rows[e.position.row.index]},o.prototype.createContextMenuArgs=function(e,t,r){for(var i=this,n=[],a=0,s=t;a<s.length;a++){var l=s[a],u=this.createSelectorsByColumn(l);u&&n.push(u)}var h={data:n,position:o.getMouseEventPosition(r)},d=function(){var r=t.length,o=i.columns.length,n=new Array(r+1);n[0]=new Array(o),i.columns.forEach(function(e,t){n[0][t]=e.metadata.displayName}),t.forEach(function(e,t){var r=n[t+1]=new Array(o);i.columns.forEach(function(t,o){r[o]=i.rowNavigator.getIntersection(e,t).textContent})}),e.isRowGrandTotal&&i.totalRow&&i.totalRow.values&&_.isEmpty(i.totalRow.values[0])&&(n[1][0]=i.totalLabel);var a=0;return 0!==i.rows.length&&(a=Math.round(t.length/i.rows.length*100)),{grid:n,coveragePercentage:a}};return h.copyArgs={singleValue:function(){return String(e.dataPoint)},grid:d},h},o.prototype.createSelectArgs=function(e,t){return{visualObjects:this.getVisualObjects(e),multiSelect:t}},o.prototype.getVisualObjects=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r],n=this.createSelectorsByColumn(i);n&&t.push({objectName:"",selectorsByColumn:n})}return t},o.prototype.createSelectorsByColumn=function(e){var t,r=_.find(this.columns,function(e){return!e.metadata.isMeasure});return r?{dataMap:(t={},t[r.metadata.queryName]=[e.identity],t),metadata:_(this.columns).filter(function(e){return e.metadata.isMeasure}).map(function(e){return e.metadata.queryName}).value()}:null},o.getMouseEventPosition=function(e){return{x:e.clientX,y:e.clientY}},o.getMatchingRow=function(t,r){if(_.isEmpty(r))return null;for(var o=0,i=r;o<i.length;o++){var n=i[o];if(e.DataViewScopeIdentity.equals(n.identity,t.identity))return n}return null},o.getMatchingColumnHeader=function(e,t){for(var r=0,o=t;r<o.length;r++){var i=o[r];if(this.areHeadersEqual(i,e))return i}return null},o.areHeadersEqual=function(e,t){return e.metadata.queryName===t.metadata.queryName},o}();t.TableExSelectionManager=o}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e){this.hostServices=e,this.pendingChanges=[]}return t.prototype.onDataViewChanged=function(){this.pendingChanges=[]},t.getSelector=function(e){return{metadata:e.metadata.queryName}},t.prototype.getPendingChange=function(t){return _.find(this.pendingChanges,function(r){return e.TableExSelectionManager.areHeadersEqual(r.header,t)})},t.prototype.queuePendingChange=function(e,t){var r=this.getPendingChange(e);r?r.width=t:this.pendingChanges.push({header:e,width:t})},t.prototype.getColumnWidth=function(t){var r=this.getPendingChange(t);if(r)return r.width;var o=t.metadata.objects;return o?e.TablixPropertyManager.PropColumnWidthValue.getValue(o):void 0},t.prototype.setColumnWidth=function(r,o){this.queuePendingChange(r,o),e.PivotTableSizeManagerUtils.persistWidths([{selector:t.getSelector(r),value:o}],this.hostServices,this.onPersisting)},t.prototype.getRowHeight=function(e){},t.prototype.setRowHeight=function(e,t){},t.prototype.getRowLevelWidth=function(e){},t.prototype.setRowLevelWidth=function(e,t){},t.prototype.getColumnLevelHeight=function(e){},t.prototype.setColumnLevelHeight=function(e,t){},t.prototype.setMissingWidths=function(r){for(var o=[],i=0,n=r;i<n.length;i++){var a=n[i],s=a.header,l=a.width;null==this.getColumnWidth(s)&&(this.queuePendingChange(s,l),o.push({selector:t.getSelector(s),value:l}))}_.isEmpty(o)||e.PivotTableSizeManagerUtils.persistWidths(o,this.hostServices,this.onPersisting)},t.prototype.clearWidths=function(r){for(var o=[],i=0,n=r;i<n.length;i++){var a=n[i];null!=this.getColumnWidth(a)&&o.push({selector:t.getSelector(a),value:void 0}),this.queuePendingChange(a,void 0)}_.isEmpty(o)||e.PivotTableSizeManagerUtils.persistWidths(o,this.hostServices,this.onPersisting)},t}();e.TableExSizeManager=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(e){this.hostServices=e}return t.prototype.sort=function(r,o,i){void 0===i&&(i=!1);var n,a=t.getSortDirection(r),s=e.PivotTableSortingManager.getNextSortDirection(a,r.metadata),l=r.metadata.queryName,u={queryName:l,sortDirection:s};i?(n=_.chain(o).filter(function(e){return void 0!==e.sortOrder&&e.queryName!==l}).sortBy(function(e){return e.sortOrder}).map(function(e){return{queryName:e.queryName,sortDirection:e.sort}}).value(),n.push(u)):n=[u],this.hostServices.onCustomSort({sortDescriptors:n})},t.hasSortingChanged=function(e,t){if(!e||!t)return!1;var r=e.metadata.columns;if(_.isEmpty(r))return!1;var o=t.metadata.columns;if(_.isEmpty(o))return!1;for(var i=function(e){var t=_.find(r,function(t){return e.queryName===t.queryName});if(t&&e.sort!==t.sort)return{value:!0}},n=0,a=o;n<a.length;n++){var s=a[n],l=i(s);if("object"==typeof l)return l.value}return!1},t.getSortDirection=function(e){return e.metadata.sort},t}();e.TableExSortingManager=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r=jsCommon.BrowserUtils,o=e.visuals.controls.pivotTable.PivotTableControl,i=e.visuals.controls.pivotTable.PivotTableRenderingMode,n=jsCommon.ScreenReaderUtil,a=e.visuals.controls.TablixType,s=e.visuals.controls.internal.TablixUtils,l=function(){function l(e,r){void 0===e&&(e=t.TableExOptions.createDefaultConstructorOptions()),this.options=e,this.featureSwitches=r||{},this.options.tooltipsEnabled=this.options.tooltipsEnabled,this.suppressNextRender=!1,this.tooltipType=0}return l.prototype.init=function(e){var r=this;this.element=e.element,this.hostServices=e.host,this.waitingForData=!1,this.style=e.style,this.tablixPropertyManager=new t.TablixPropertyManager(this.style),this.selectionManager=new t.TableExSelectionManager(this.hostServices),this.sortingManager=new t.TableExSortingManager(this.hostServices),this.sizeManager=new t.TableExSizeManager(this.hostServices),this.sizeManager.onPersisting=function(){r.suppressNextRender=!0},this.tooltipService=t.createTooltipService(e.host)},l.prototype.update=function(t){return __awaiter(this,void 0,e.Promise,function(){return __generator(this,function(r){switch(r.label){case 0:return t.type&e.VisualUpdateType.Data?[4,this.onDataViewChanged(t.dataViews,t.operationKind,t.viewport)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.pivotTableControl&&t.type&e.VisualUpdateType.Resize?(this.pivotTableControl.setWidth(t.viewport.width),this.pivotTableControl.setHeight(t.viewport.height),[4,this.renderControl(!1,null,null)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},l.prototype.updatePersistedWidths=function(e){var r=t.TablixPropertyManager.PropColumnPivotTableAutoSizeColumns.getValue(this.dataView.metadata.objects);if(!r&&this.pivotTableControl){for(var o=[],i=this.columnHierarchyNavigator.getColumns(),n=this.pivotTableControl.getColumnWidthMeasureManager().getPageColumns(),a=0,s=0,l=n;s<l.length;s++)for(var u=l[s],h=u.getColumnWidths(),d=0,c=h;d<c.length;d++){var g=c[d];o.push({header:i[a],width:g}),a++}this.sizeManager.setMissingWidths(o)}else r&&e&&e.metadata&&e.metadata.objects&&!t.TablixPropertyManager.PropColumnPivotTableAutoSizeColumns.getValue(e.metadata.objects)&&(this.sizeManager.clearWidths(this.columnHierarchyNavigator.getColumns()),this.suppressNextRender=!1)},l.prototype.onDataViewChanged=function(t,r,o){return __awaiter(this,void 0,e.Promise,function(){var i,n,a=this;return __generator(this,function(s){switch(s.label){case 0:return _.isEmpty(t)?[3,5]:(i=this.dataView,this.dataView=t[0],this.formattingProperties=this.tablixPropertyManager.getTableExObjects(this.dataView,function(e){for(var t,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(t=a.hostServices).getLocalizedString.apply(t,[e].concat(r))},this.style),n=!this.dataView.metadata.segment,r!==e.VisualDataChangeOperationKind.Append?[3,2]:[4,this.onAppendDataView(i,n)]);case 1:return s.sent(),[3,4];case 2:return[4,this.onNewDataView(i,o,n)];case 3:s.sent(),s.label=4;case 4:return this.pivotTableControl.restoreFocus(),[3,6];case 5:this.dataView=void 0,this.selectionManager.onDataViewChanged(void 0,void 0),this.interactionManager&&this.interactionManager.onDataViewChanged(void 0,void 0),this.pivotTableControl&&this.pivotTableControl.clear(),s.label=6;case 6:return this.waitingForData=!1,[2]}})})},l.prototype.onAppendDataView=function(t,r){return __awaiter(this,void 0,e.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.updateHierarchyNavigators(r),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),[4,this.renderControl(!1,null,null)];case 1:return e.sent(),[2]}})})},l.prototype.onNewDataView=function(r,o,i){return __awaiter(this,void 0,e.Promise,function(){var e,n,a,s,l;return __generator(this,function(u){switch(u.label){case 0:return this.updatePersistedWidths(r),e=this.getPreviousVisibleRowStart(),n=this.getPreviousVisibleColumnStart(),a=this.rowHierarchyNavigator?this.rowHierarchyNavigator.getHierarchyLeafCount():0,s=this.columnHierarchyNavigator?this.columnHierarchyNavigator.getHierarchyLeafCount():0,this.createOrUpdateControlAndNavigators(i),this.sizeManager.onDataViewChanged(),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.suppressNextRender&&a===this.rowHierarchyNavigator.getHierarchyLeafCount()&&s===this.columnHierarchyNavigator.getHierarchyLeafCount()?[3,2]:(this.pivotTableControl.clear(),this.pivotTableControl.setWidth(o.width),this.pivotTableControl.setHeight(o.height),l=this.hostServices.tooltips(),this.options.tooltipsEnabled&&l&&l.enabled()?this.tooltipType=1:this.tooltipType=0,this.interactionManager&&this.interactionManager.setTooltipsEnabled(1===this.tooltipType),this.binder.updateFormattingProperties(this.dataView,this.formattingProperties,this.style,0===this.tooltipType),this.applyContainerStyle(),[4,this.renderControl(!0,this.getVisibleRowStart(e,t.TableExSortingManager.hasSortingChanged(r,this.dataView)),this.getVisibleColumnStart(n))]);case 1:u.sent(),u.label=2;case 2:return this.suppressNextRender=!1,[2]}})})},l.prototype.applyContainerStyle=function(){var e=this.binder.getColumnHeaderContainerFontInfo().fontProperties,r=this.pivotTableControl.getColumnHeaderContainer();t.FontProperties.applyStyleToElement(e,r);var o=this.pivotTableControl.getFloatingRowHeaderContainer();t.FontProperties.applyStyleToElement(e,o);var i=this.binder.getValueContainerFontInfo().fontProperties,n=this.pivotTableControl.getBodyCellContainer();t.FontProperties.applyStyleToElement(i,n);var a=this.pivotTableControl.getFloatingBodyCellContainer();t.FontProperties.applyStyleToElement(i,a)},l.prototype.onClearSelection=function(){this.selectionManager.clearLocal()},l.prototype.onRestoreSelection=function(e){if(this.selectionManager){var t=this.selectionManager.restoreSelection(e.selection);return this.renderSelection(),t}return!1},l.prototype.updateHierarchyNavigators=function(e){this.rowHierarchyNavigator.update(this.dataView.table.rows,this.dataView.table.identity,this.dataView.table.totals,e,this.dataView.table.columns,this.formattingProperties),this.columnHierarchyNavigator.update(this.dataView.table.columns)},l.prototype.renderControl=function(e,t,r){var o=this.hostServices.promiseFactory().defer(),n=e?i.ClearMeasurement:i.Incremental;return t||r?this.pivotTableControl.makeVisible(n,t,r,function(e){e?o.reject(e):o.resolve(null)}):this.pivotTableControl.render(n,function(e){e?o.reject(e):o.resolve(null)}),o.promise},l.prototype.getPreviousVisibleRowStart=function(){if(this.pivotTableControl){var e=this.pivotTableControl.getVisibleRowStart();if(!e)return null;var t=this.rowHierarchyNavigator.getHierarchyLeafAt(e.rowIndex);return t?{item:t,offset:e.visibleHeight}:null}},l.prototype.getPreviousVisibleColumnStart=function(){if(this.pivotTableControl){var e=this.pivotTableControl.getVisibleColumnStart();if(!e)return null;var t=this.columnHierarchyNavigator.getHierarchyLeafAt(e.columnIndex);return t?{item:t,offset:e.visibleWidth}:null}},l.prototype.getVisibleRowStart=function(e,r){if(!e)return null;if(0===this.pivotTableControl.getViewport().top)return null;if(r)return{rowIndex:0,visibleHeight:Number.MAX_VALUE};var o=t.TableExSelectionManager.getMatchingRow(e.item,this.rowHierarchyNavigator.getRows());return o&&this.rowHierarchyNavigator.isLeaf(o)?{rowIndex:this.rowHierarchyNavigator.getLeafIndex(o),visibleHeight:e.offset}:null},l.prototype.getVisibleColumnStart=function(e){if(!e)return null;var r=t.TableExSelectionManager.getMatchingColumnHeader(e.item,this.columnHierarchyNavigator.getColumns());return r&&this.columnHierarchyNavigator.isLeaf(r)?{columnIndex:this.columnHierarchyNavigator.getLeafIndex(r),visibleWidth:e.offset}:null},l.prototype.renderSelection=function(){this.pivotTableControl.render(i.ClearRendering)},l.prototype.createOrUpdateControlAndNavigators=function(e){var r=this;if(this.rowHierarchyNavigator||(this.rowHierarchyNavigator=new t.TableExRowHierarchyNavigator(this.tablixPropertyManager),this.columnHierarchyNavigator=new t.TableExColumnHierarchyNavigator),this.updateHierarchyNavigators(e),!this.pivotTableControl){var i={interactivityIndicatorEnabled:this.options.interactivityIndicatorEnabled,selectionEnabled:this.options.selection&&this.options.selection.enabled,sortIconEnabled:this.options.sorting&&this.options.sorting.showActiveSortIcon,sortingEnabled:this.options.sorting&&this.options.sorting.enabled,hyperlinksEnabled:this.featureSwitches.conditionalTablixWebURL,tablixPropertyManager:this.tablixPropertyManager,onBindRowHeader:function(e){return r.onBindRowHeader(e)},onHyperlinkClicked:function(e,t){return r.onHyperlinkClicked(e,t)}},n=document.createElement("div");n.className="tableExContainer",this.element.append(n),this.binder=new t.TableExBinder(i,this.selectionManager,n),this.pivotTableControl=new o(n,this.sizeManager,this.createControlOptions()),this.pivotTableControl.setClassName("tableEx"),this.pivotTableControl.setRowNavigator(this.rowHierarchyNavigator),this.pivotTableControl.setColumnNavigator(this.columnHierarchyNavigator),this.pivotTableControl.setBinder(this.binder)}},l.prototype.createControlOptions=function(){var e=this,r=this.options.scrolling.enabled,o=this.options.columnResizing.enabled;this.options.tooltipsEnabled&&(this.interactionManager=this.interactionManager=new t.TableExInteractionManager(this.tooltipService,this.selectionManager,this.hostServices.getLocalizedString(s.TotalLabel)));var i=this.interactionManager;return this.options.selection.enabled?{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:null,rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:null,columnHeaderClickHandler:function(t,r){return e.onColumnHeaderClick(t,r)},columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:i?i.getHeaderHandler():null,columnHeaderFocusHandler:function(t){return e.onColumnHeaderFocus(t)},bodyCellClickHandler:function(t,r){return e.onBodyCellClick(t,r)},bodyCellContextMenuHandler:function(t,r){return e.onBodyCellContextMenu(t,r)},bodyCellInteractionHandler:i?i.getBodyHandler():null,bodyCellFocusHandler:function(t){return e.onBodyCellFocus(t)},cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:null,cornerCellFocusHandler:null,whitespaceClickHandler:function(t){return e.onWhitespaceClick()},scrollingEnabled:r,columnResizingEnabled:o,rowLevelResizingEnabled:!1,onScroll:function(){return e.onScroll()}}:{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:null,rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:null,columnHeaderClickHandler:null,columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:i?i.getHeaderHandler():null,columnHeaderFocusHandler:null,bodyCellClickHandler:null,bodyCellContextMenuHandler:null,bodyCellInteractionHandler:i?i.getBodyHandler():null,bodyCellFocusHandler:null,cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:null,cornerCellFocusHandler:null,whitespaceClickHandler:null,scrollingEnabled:r,columnResizingEnabled:o,rowLevelResizingEnabled:!1,onScroll:function(){return e.onScroll()}}},l.prototype.onScroll=function(){this.interactionManager&&!this.interactionManager.tooltipVisible()&&this.interactionManager.hideTooltip()},l.prototype.onHyperlinkClicked=function(e,t){this.hostServices.onHyperlinkClick(e,t)},l.prototype.onBodyCellClick=function(e,t){t.preventDefault(),this.selectionManager.isDrillingEnabled(e,t)||(this.selectionManager.onBodyCellClick(e,r.isCtrlOrMeta(t)||1===this.hostServices.dataMultiSelectMode()),this.renderSelection())},l.prototype.onBodyCellContextMenu=function(e,t){t.stopPropagation(),t.preventDefault(),this.selectionManager.onBodyCellContextMenu(e,t)},l.prototype.onBodyCellFocus=function(e){var r;r=e.isRowGrandTotal?this.rowHierarchyNavigator.getFloatingHierarchyLeafAt(e.position.row.index):this.rowHierarchyNavigator.getHierarchyLeafAt(e.position.row.index);var o=this.columnHierarchyNavigator.getHierarchyLeafAt(e.position.column.index),i=this.rowHierarchyNavigator.getIntersection(r,o),a={displayNameParts:[o.metadata.displayName],valueParts:[i.tooltipContent],concatenatedParts:[[0]]};n.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(a))},l.prototype.onColumnHeaderClick=function(e,t){if(this.options.sorting.enabled){var r=this.featureSwitches.tableMultiSort&&t.shiftKey;this.sortingManager.sort(e,this.dataView.table.columns,r)}},l.prototype.onColumnHeaderFocus=function(e){var r,o={displayNameParts:[e.metadata.displayName],valueParts:[],concatenatedParts:[[0]]};switch(e.metadata.sort){case 1:r=this.hostServices.getLocalizedString("Field_Sorted_Ascending");break;case 2:r=this.hostServices.getLocalizedString("Field_Sorted_Descending")}var i;r&&(i=[r]),n.alertScreenReader(t.PivotTableInteractivityUtils.getScreenReaderMessage(o,i))},l.prototype.onWhitespaceClick=function(){this.selectionManager.onWhitespaceClick(),this.renderSelection()},l.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},l.prototype.needsMoreData=function(e){if(this.waitingForData||!this.dataView||!this.dataView.metadata||!this.dataView.metadata.segment)return!1;var t=this.rowHierarchyNavigator.getHierarchyLeafCount(),r=t*s.PreferredLoadMoreThreshold;return this.rowHierarchyNavigator.getLeafIndex(e)>=r},l.prototype.enumerateObjectInstances=function(e){var r=this,o=new t.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,o,this.dataView,a.TableEx,function(e){for(var t,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return(t=r.hostServices).getLocalizedString.apply(t,[e].concat(o))},this.featureSwitches,void 0,this.style),o.complete()},l.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,a.TableEx,this.featureSwitches.tablixIcons,this.featureSwitches.conditionalTablixWebURL,this.featureSwitches.totalsConditionalFormatting),e},l}();t.TableEx=l}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r,o=e.visuals.MatrixHierarchyNavigator;!function(e){function t(e,t,r,o){var i,n,a,s,l,u;void 0===r&&(r=!0);var d=e.columnItem,c=e.rowItem,g=0,p={displayNameParts:[],valueParts:[],concatenatedParts:[],headerParts:[],otherType:{}},f=c&&!_.isEmpty(c.values),m=c&&h(c,t,r,o);m&&((i=p.displayNameParts).push.apply(i,m.displayNameParts),(n=p.valueParts).push.apply(n,m.valueParts),(a=p.headerParts).push.apply(a,_.map(m.valueParts,function(){return!0})),p.concatenatedParts.push(_.map(m.displayNameParts,function(){return g++})));var v=d&&h(d,t,r,o);if(v&&((s=p.displayNameParts).push.apply(s,v.displayNameParts),(l=p.valueParts).push.apply(l,v.valueParts),(u=p.headerParts).push.apply(u,_.map(v.valueParts,function(){return!0})),p.concatenatedParts.push(_.map(v.displayNameParts,function(){return g++}))),f)if(p.displayNameParts.push(e.columnMetadata.displayName),p.concatenatedParts.push([g++]),p.headerParts.push(!1),e.isKpi){var y={metadata:e.columnMetadata.kpi,value:e.tooltipContent},C=p.otherType[p.displayNameParts.length-1]={};C.kpiValue=y,p.valueParts.push(e.tooltipContent)}else _.isEmpty(e.tooltipContent)||p.valueParts.push(e.tooltipContent);return p}function r(e,r){return a(t(e,r))}function i(e,r,o,i){for(var a=[],s=0,l=e;s<l.length;s++){var u=l[s];a.push(t(u,i))}var h=0,d=r.getHierarchyLeafCount()*o.getHierarchyLeafCount();return 0!==d&&(h=Math.round(e.length/d*100)),__assign({coveragePercentage:h},n(a))}function n(e){for(var t={headers:_.uniq(_.flatten(_.map(e,function(e){return e.displayNameParts}))),isHeader:{},values:[]},r=t.values,o=t.headers,i=t.isHeader,n={},a=0;a<o.length;a++)n[o[a]]=a;for(var s=0,l=e;s<l.length;s++){for(var u=l[s],h=_.fill(new Array(o.length),""),a=0;a<u.displayNameParts.length;a++){var d=u.valueParts[a],c=u.displayNameParts[a],g=n[c];h[g]=d,u.headerParts&&(t.isHeader[g]=u.headerParts[a])}r.push(h)}if(!_.isEmpty(e)&&e[0].headerParts)for(var p=function(e){for(var t=r[e],o=[],n=e+1;n<r.length;n++){var a=r[n];_.every(a,function(e,r){return i[r]&&e===t[r]||!i[r]&&(""===e||""===t[r])})&&o.push(n)}if(o.length>0)for(var s=_.reduce(t,function(e,t,r){return""===t&&e.push(r),e},[]),l=0,u=o;l<u.length;l++)for(var h=u[l],d=r[h],n=0;n<s.length;n++){var c=s[n],g=d[c];""!==g&&(t[c]=g,s.splice(n,1),n--)}o.sort(function(e,t){return t-e});for(var p=0,f=o;p<f.length;p++){var m=f[p];r.splice(m,1)}},f=0;f<r.length;f++)p(f);return t}function a(e){for(var t=[],r=function(r){var o=_.filter(e.displayNameParts,function(e,t){return r.indexOf(t)!==-1}),i=_.filter(e.valueParts,function(e,t){return r.indexOf(t)!==-1});if((o.length>0||i.length>0)&&(t.push({displayName:o.join(" "),value:i.join(" ")}),e.otherType)){var n=_.first(r);if(_.has(e.otherType,String(n))){var a=t.length-1;delete t[a].value,t[a]=__assign({},t[a],e.otherType[n])}}},o=0,i=e.concatenatedParts;o<i.length;o++){r(i[o])}return t}function s(e){return[{displayName:e.displayName}]}function l(e,t,r,i,n){if(o.isNodeGrandTotal(e))return r(e)?[{displayName:e.tooltipValueFormatted}]:[{displayName:i}];var a=[],s=u(e,n);return s&&a.push(s),t(e)&&a.push({displayName:n,value:e.valueFormatted}),a}function u(e,t){var r=d(e,t),o=r.displayNameParts,i=r.valueParts;if(o.length>0||i.length>0)return{displayName:o.join(" "),value:i.join(" ")}}function h(e,t,r,o){void 0===r&&(r=!0);var i=p(e),n=e.queryName,a=_.find(i,function(e){return e.queryName===n});return a&&a.isMeasure&&(e=e.parent),d(e,t,r,o)}function d(e,t,r,o){void 0===r&&(r=!0);for(var i=[],n=[];e;)if(r&&e.isSubtotal)e=e.parent;else{var a=p(e);if(!_.isEmpty(a)){for(var s=[],l=0,u=a;l<u.length;l++){var h=u[l];s.push(h.isMeasure?t:h.displayName)}i.push(s.join(" ")),_.every(a,function(e){return e.isMeasure})?n.push(a[0].displayName):e.isSubtotal?n.push(o):n.push(e.tooltipValueFormatted)}e=e.parent}return i=i.reverse(),n=n.reverse(),{displayNameParts:i,valueParts:n}}function c(e,r,o,i,a){var s=g(o,i,e,r),l=0,u=o.getHierarchyLeafCount()*i.getHierarchyLeafCount();0!==u&&(l=Math.round(s.length/u*100));for(var h=[],d=0,c=s;d<c.length;d++){var p=c[d];h.push(t(p,a))}return __assign({coveragePercentage:l},n(h))}function g(e,t,r,o){_.isEmpty(r)&&(r=e.getHierarchyItems()),_.isEmpty(o)&&(o=t.getHierarchyItems());var i=[];e.getLeaves(r,i),i=_.filter(i,function(e){return!e.isSubtotal});var n=[];t.getLeaves(o,n),n=_.filter(n,function(e){return!e.isSubtotal});for(var a=[],s=0,l=i;s<l.length;s++)for(var u=l[s],h=0,d=n;h<d.length;h++){var c=d[h];a.push(e.getIntersection(u,c))}return a.filter(function(e){return!e.isSubtotal&&!e.isGrandTotal})}function p(e){var t=e.hierarchyLevel&&e.hierarchyLevel.sources;return _.isEmpty(t)?[]:_.every(t,function(e){return e.isMeasure})?[t[e.levelSourceIndex||0]]:t}function f(e){return{displayNameParts:[e.displayName],valueParts:[null]}}function m(e,t){for(var r=[],o=0;o<e.displayNameParts.length;o++){var i=e.displayNameParts[o],n=e.valueParts[o];null!=n&&(i+=": "+n),r.push(i)}if(!_.isEmpty(t))for(var a=0,s=t;a<s.length;a++){var l=s[a];r.push(l)}return r.join(". ")}e.getBodyCellInfo=t,e.getBodyCellTooltipInfo=r,e.getGivenBodyCellsInfo=i,e.reconcileDataHierarchyParts=n,e.concatenatePartsToTooltipInfo=a,e.getCornerCellTooltipInfo=s,e.getHeaderTooltipInfo=l,e.getGroupingTooltipDataIems=u,e.getGroupingDataItems=d,e.getGivenGroupingDataItems=c,e.explodeHeadersToBodyItems=g,e.getCornerCellParts=f,e.getScreenReaderMessage=m}(r=t.PivotTableInteractivityUtils||(t.PivotTableInteractivityUtils={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));